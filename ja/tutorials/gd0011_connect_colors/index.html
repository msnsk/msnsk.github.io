<!DOCTYPE html>
<html lang="ja" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Godot で作る同じ色をつなげて消すパズルゲーム | Peanuts Code</title>
<meta name="keywords" content="Godot, GodotEngine, ゲーム開発, チュートリアル, パズルゲーム, モバイルゲーム, 同じ色をつなげて消すゲーム, なぞって消すゲーム, マッチ3" />
<meta name="description" content="このチュートリアルでは、スマホゲームで大人気の ディズニーツムツムのような同じ色のドロップをなぞってつなげて消すタイプのゲームの作り方を説明する。ちなみにディズニーツムツムを知らない方は以下のリンク先を一度ご覧いただきたい。
LINE：ディズニー ツムツム なお、このチュートリアルで最後にできあがるプロジェクトのファイルは GitHubリポジトリ に置いている。.">
<meta name="author" content="Masanao Sako">
<link rel="canonical" href="https://www.peanuts-code.com/ja/tutorials/gd0011_connect_colors/" />
<meta name="google-site-verification" content="XYZabc" />
<meta name="yandex-verification" content="XYZabc" />
<meta name="msvalidate.01" content="XYZabc" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.css" rel="preload stylesheet" as="style">
<link rel="preload" href="/images/logomark.png" as="image">
<link rel="icon" href="https://www.peanuts-code.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.peanuts-code.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.peanuts-code.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://www.peanuts-code.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://www.peanuts-code.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.101.0" />
<link rel="alternate" hreflang="ja" href="https://www.peanuts-code.com/ja/tutorials/gd0011_connect_colors/" />
<link rel="alternate" hreflang="en" href="https://www.peanuts-code.com/en/tutorials/gd0011_connect_colors/" />

<script async src="https://www.googletagmanager.com/gtag/js?id=G-DK0NK2RTTW"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-DK0NK2RTTW', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="Godot で作る同じ色をつなげて消すパズルゲーム" />
<meta property="og:description" content="このチュートリアルでは、スマホゲームで大人気の ディズニーツムツムのような同じ色のドロップをなぞってつなげて消すタイプのゲームの作り方を説明する。ちなみにディズニーツムツムを知らない方は以下のリンク先を一度ご覧いただきたい。
LINE：ディズニー ツムツム なお、このチュートリアルで最後にできあがるプロジェクトのファイルは GitHubリポジトリ に置いている。." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.peanuts-code.com/ja/tutorials/gd0011_connect_colors/" />
<meta property="og:image" content="https://www.peanuts-code.com/images/tutorials/gd0011_connect_colors/img36.gif" /><meta property="article:section" content="tutorials" />
<meta property="article:published_time" content="2022-06-14T22:43:45&#43;09:00" />
<meta property="article:modified_time" content="2022-06-20T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://www.peanuts-code.com/images/tutorials/gd0011_connect_colors/img36.gif" />
<meta name="twitter:title" content="Godot で作る同じ色をつなげて消すパズルゲーム"/>
<meta name="twitter:description" content="このチュートリアルでは、スマホゲームで大人気の ディズニーツムツムのような同じ色のドロップをなぞってつなげて消すタイプのゲームの作り方を説明する。ちなみにディズニーツムツムを知らない方は以下のリンク先を一度ご覧いただきたい。
LINE：ディズニー ツムツム なお、このチュートリアルで最後にできあがるプロジェクトのファイルは GitHubリポジトリ に置いている。."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Tutorials",
      "item": "https://www.peanuts-code.com/ja/tutorials/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Godot で作る同じ色をつなげて消すパズルゲーム",
      "item": "https://www.peanuts-code.com/ja/tutorials/gd0011_connect_colors/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Godot で作る同じ色をつなげて消すパズルゲーム",
  "name": "Godot で作る同じ色をつなげて消すパズルゲーム",
  "description": "このチュートリアルでは、スマホゲームで大人気の ディズニーツムツムのような同じ色のドロップをなぞってつなげて消すタイプのゲームの作り方を説明する。ちなみにディズニーツムツムを知らない方は以下のリンク先を一度ご覧いただきたい。\nLINE：ディズニー ツムツム なお、このチュートリアルで最後にできあがるプロジェクトのファイルは GitHubリポジトリ に置いている。.",
  "keywords": [
    "Godot", "GodotEngine", "ゲーム開発", "チュートリアル", "パズルゲーム", "モバイルゲーム", "同じ色をつなげて消すゲーム", "なぞって消すゲーム", "マッチ3"
  ],
  "articleBody": "このチュートリアルでは、スマホゲームで大人気の ディズニーツムツムのような同じ色のドロップをなぞってつなげて消すタイプのゲームの作り方を説明する。ちなみにディズニーツムツムを知らない方は以下のリンク先を一度ご覧いただきたい。\nLINE：ディズニー ツムツム なお、このチュートリアルで最後にできあがるプロジェクトのファイルは GitHubリポジトリ に置いている。.zipファイルをダウンロードしていただき、「End」フォルダ内の「project.godot」ファイルを Godot Engine でインポートしていただければ、直接プロジェクトを確認していただくことも可能だ。\nEnvironment このチュートリアルは以下の環境で作成しました。\n・Godot のバージョン: 3.4.4\n・コンピュータのOS: macOS 11.6.5\nMemo: ゲームを作り始めるのに以下の記事もお役立てください。\nGodot をダウンロードする Godot のプロジェクトマネージャー Godot の言語設定 新規プロジェクトを作成する まずは Godot Engine を立ち上げて、新規プロジェクトを作成してほしい。プロジェクトの名前は「Connect Colors Start」としておこう。\nプロジェクト設定を更新する エディタが表示されたら、先にプロジェクト全体に関わる設定を更新しておこう。\nまずはゲームのディスプレイサイズを設定する。今回はスマホの縦向きの画面を想定して、縦横の比率を16:9とした。\n「プロジェクト」メニュー＞「プロジェクト設定」を開く。 「一般」タブで「window」で検索して、サイドバーの「Display」＞「Window」を選択する。 「Size」セクションで以下の項目の値を変更する。 Width: 144 Height: 256 Test Width: 288 Test Height: 512\n「Stretch」セクションで以下の項目の値を変更する。 Mode: 2d Aspect: keep\nそのまま「プロジェクト設定」ウインドウを開いた状態で、デバッグパネルでスマホのタッチ操作をマウスで代用するための設定をする。\n「一般」タブで「mouse」で検索し、サイドバーの「Input Devices」＞「Pointing」を選択する。 「Emulate Touch From Mouse」の On のチェックを入れる。\nさらに「プロジェクト設定」ウインドウを開いた状態で、インプットマップにスマホのタッチ操作の相当するアクションを追加しよう。\n「インプットマップ」タブに切り替え、アクションに「tap」を追加する。 「tap」の操作にマウスの左クリックを追加する。\nアセットをダウンロードしてインポートする 次に、KENNEYのサイトからアセットをダウンロードして利用させてもらおう。今回利用するのは Pixel Platformer というアセットパックだ。この素晴らしすぎる無料の素材に感謝せずにはいられない。\nダウンロードしたら「Tilemap」フォルダ内の「characters_packed.png」ファイルをエディタのファイルシステムドックへドラッグ\u0026ドロップしてプロジェクトにインポートしよう。\nファイルをインポートした直後は画像がぼやけた感じになっているので、これを以下の手順で修正しておく。\nファイルシステムドックでインポートしたアセットファイルを選択した状態にする\nインポートドックで「プリセット」＞「2D Pixel」を選択する\n一番下にある「再インポート」ボタンをクリックする。\nこれでピクセルアート特有のエッジの効いた画像になる。\nWorld シーンを作る まず最初のシーンとして、ゲームの舞台を用意する。「World」という名前のシーンを作成しよう。\n「シーン」メニュー＞「新規シーン」を選択する。 「ルートノードを生成」にて「その他のノード」を選択する。 「Node2D」クラスのノードをルートノードとして選択。 ルートノードの名前を「World」に変更する。 一旦ここでシーンを保存しておこう。フォルダを作成して、ファイルパスを「res://World/World.tscn」としてシーンを保存する。\nWorld シーンにノードを追加する World シーンが以下のシーンツリーになるようにノードを追加しよう。なお、それぞれのプロパティ編集は後で順番にやっていくので一旦そのままで良い。\nWorld (Node2D) Bin (StaticBody2D) CollisionPolygon2D SpawnPath (Path2D) Spawner (PathFollow2D) AnimationPlayer Drops (Node2D) DropsLine (Line2D) Pointer (Area2D) CollisionShape2D シーンツリードックの表示は以下のようになったはずだ。\nWorld シーンのノードを編集する Bin (StaticBody2D) ノード このノードの編集は不要だ。「StaticBody2D」は 2D ゲームにおいて、移動しない障害物や壁などに利用される。今回は落ちてくるドロップ（なぞって消すオブジェクト）を画面内にとどめるための入れ物（ビン）として利用する。\nCollisionPolygon2D ノード このノードは親ノードの「Bin」にコリジョン形状を付与するための利用する。コリジョン形状は 2D ワークスペース上で点を打って作る。\n2D ワークスペースのツールバーでグリッドスナップを有効にする。\n基本的に、ウインドウ枠の外側を囲むように点を打ってコリジョン形状を成形する。ただし、上部は、ディスプレイサイズの y 座標 0 より -64px ずらして成形する。理由は、ウインドウ枠上部外側でドロップを生成して落下させるためだ。また、コリジョンポリゴン下部はディスプレイサイズよりやや内側まで配置し、ドロップが転がるように少し斜めにしている。\nSpawnPath (Path2D) ノード このノードはドロップの生成位置を x 軸方向に常に移動させるために使う。これは、ドロップが毎回画面上部の同じ位置から落ちてくるのを防ぐ役割だ。これをウインドウ枠の上部外側に配置する。\n2D ワークスペース上で (16, -32) と (128, -32) の２つの点を打って x 軸に並行な直線のパスを作る。\nSpawner (PathFollow2D) ノード このノードは先に編集した「SpawnPath」ノードのパス上を移動するノードだ。このノードを常にパスに沿って往復させ、このノードの位置からドロップを生成するようにする。これによりドロップの落下位置が「SpawnPath」ノードのパスの範囲で常に変化する\nプロパティ「Rotate」をオフにする。\nAnimationPlayer ノード このノードは「Spawner」を「SpawnPath」のパスに沿って常に往復移動させるために利用する。「Spawner」のプロパティ「Unit Offset」は、親ノード「SpawnPath」のパスの開始位置を 0、終点を 1 で表す。つまりこのプロパティを常に 0 ⇄ 1 で変化させれば、パス上を往復させることができる。\n以下の通りにアニメーションを一つ作成する。 アニメーション名: move_spawn_pos 読み込み後、自動再生: 有効 アニメーションの長さ(秒): 0.4\n*0.4 秒でパスを往復する アニメーションループ: 有効 トラック: Spawner ノード - unit_offset プロパティ Time: 0 / Value: 0 / Easing: 1.00 Time: 0.2 / Value: 1 / Easing: 1.00\n*0.2秒時点でパスの終点から折り返す\nDrops (Node2D) ノード このノードのプロパティ編集は不要だ。役割は、ドロップシーン（後ほど作成）から複数生成するインスタンスをまとめるただの入れ物だ。\nDropLine (Line2D) ノード このノードは同じ色のドロップをなぞった時に、そのドロップとドロップをつなぐ線を描画するために利用する。これにより、どのドロップをなぞってきたのか、いくつつながっているのか、が視覚的に確認しやすくなる。\nプロパティ「Width」を 2 に変更する。これは線の太さだ。\nプロパティ「Capping」＞「Joint Mode」、「Begin Cap Mode」、「End Cap Mode」をそれぞれ「Round」に変更する。これにより、線の繋ぎ目、先端、終端の形状を丸くすることができる。\nPointer (Area2D) ノード このノードの編集は不要だ。目的としては、スマホなら指、PCならマウスカーソルにこのノードを追随させて、ドロップに触っていることを検知するために利用する。のちほど、このノードの位置を常に指またはマウスカーソルの位置と同じにするためのコードをスクリプトに記述する。\nCollisionShape2D ノード このノードは、親ノード「Pointer」にコリジョン形状を付与する。指やマウスカーソルでのドロップをタッチする操作を考慮して、コリジョンはできるだけ小さい形状にする。\nプロパティ「Shape」にリソース「新規 CircleShape2D」を適用する。 適用したリソース「CircleShape2D」のプロパティ「Radius」の値を 1 にする。\n以上で各ノードの編集は完了だ。\nDrop シーンを作る ここからは同じ色をなぞって消す対象となる「Drop」シーンを作っていく。\n「シーン」メニュー＞「新規シーン」を選択する。 「ルートノードを生成」にて「その他のノード」を選択する。 「RigidBody2D」クラスのノードをルートノードとして選択。 ルートノードの名前を「Drop」に変更する。 一旦ここでシーンを保存しておこう。フォルダを作成して、ファイルパスを「res://Drops/Drop.tscn」としてシーンを保存する。\nDrop シーンにノードを追加する Drop シーンが以下のシーンツリーになるようにノードを追加しよう。なお、それぞれのプロパティ編集は後で順番にやっていくので一旦そのままで良い。\nDrop (RigidBody2D) Sprite CollisionShape2D PointableArea (Area2D) CollisionShape2D AnimationPlayer StickableArea (Area2D) CollisionShape2D シーンツリードックの表示は以下のようになったはずだ。\nDrop シーンのノードを編集する Drop (RigidBody2D) ルートノード 「Drop」シーンには、そのインスタンスを「World」シーンに追加した時、自動的に重力に従って落下したり、バウンドしたりしてもらいたい。そのような物理演算による動きをノードのプロパティに合わせて自動的に再現してくれるのが RigidBody2D クラスだ。\nインスペクタードックにて、プロパティ「Physics Material Override」に新規「PhysicsMaterial」リソースを適用する。\nプロパティ「Gravity Scale」の値を 2 にする。ドロップの落下速度を少し速くするのが目的だ。\nノードドック＞グループタブを開き、「Drops」という名前のグループを作って追加する。これはスクリプトでの条件分岐処理で重要だ。\nSprite ノード このノードで「Drop」にテクスチャ（見た目）を付与する。冒頭でインポートしたたくさんのテクスチャをまとめた1枚のスプライトシートから使いたいテクスチャの範囲を指定してスプライトのテクスチャを設定する方法を採用する。\nインスペクターにて、プロパティ「Texture」にファイルシステムからリソース「res://characters_packed.png」をドラッグして適用する。\n「Region」＞「Enabled」をオンにする。\nエディタ下部のテクスチャ領域パネルを開く。ここで行うのはスプライトシートの中の利用したいテクスチャの領域を指定する作業だ。\n作業しやすいように、展開アイコンをクリックしてパネルを広げる。\nパネル上部の「snapモード」で「グリッドスナップ」を選択する。\nパネル上部の「ステップ」を 24px 24px にする。これでグリッドのサイズがスプライトシートのテクスチャ 1 つ分と同じサイズになる。\nスプライトシート上でドラッグ操作により緑色のドロップ（見た目はエイリアンだが）の2種類のテクスチャを範囲選択する。\nインスペクターに戻り、「Animation」＞「Hframes」プロパティの値を 2 に変更する。\nCollisionShape2D ノード (ルートノード Drop の子) このノードはルートノード「Drop」にコリジョン形状を提供する。ルートノードは「RigidBody2D」クラスで、物理ボディの１つだ。物理ボディ同士の衝突判定にはコリジョン設定が必須だ。このコリジョン形状により、複数の「Drop」シーンのインスタンスが画面上でお互いにぶつかり合って、積み上がっていくことを想定している。\nプロパティ「Shape」に新規「CircleShape2D」リソースを適用する。 さらにそのリソースのプロパティ「Radius」の値を 12 に変更する。これで半径 12 px の円形のコリジョン形状ができた。2D ワークスペースで直感的にサイズ調整しても構わない。\nPointableArea (Area2D) ノード このノードは、指またはマウスカーソルがそのドロップに触れたことや離れたことを検知するために利用する。プロパティの編集は不要だが、グループの追加が必要だ。\nノードドック＞グループタブを開き、「Pointable」という名前のグループを作って追加する。これは指またはマウスカーソルがドロップに触れているかどうかを判定する際に利用する。\nCollisionShape2D (PointableArea の子)ノード このノードは、親の「PointableArea」にコリジョン形状を提供する。指やマウスカーソルがドロップの端に触っただけでは反応しないように、ルートノード「Drop」のコリジョン形状よりやや内側に収まるようにする。\nプロパティ「Shape」に新規「CircleShape2D」リソースを適用する。 さらにそのリソースのプロパティ「Radius」の値を 10 に変更する。ルートノード「Drop」のコリジョン形状よりひと回り小さくした。隣接するドロップ同士でこのコリジョン形状と重なってしまうと、ドロップから指が離れたことを検出される前に隣のドロップとの接触が検出されるため、スクリプトでの制御が難しくなってしまうのだ。2D ワークスペースで直感的にサイズ調整しても構わない。\n*このノードのコリジョン形状は内側の円 AnimationPlayer ノード ここではまず先に、指やマウスカーソルが触れていない時のドロップの待機中のアニメーションと、触れた後にそれがわかるように点滅するアニメーションを作成する。このノードは、作成したそれらのアニメーションリソースを再生するのに利用する。\n以下の通りに、ドロップの待機中のアニメーションを作成する。 アニメーション名: idle 読み込み後、自動再生: 有効 アニメーションの長さ(秒): 1 アニメーションループ: 有効 トラック: Sprite ノード - frame プロパティ Time: 0 / Value: 0 / Easing: 1.00 Time: 0.5 / Value: 1 / Easing: 1.00 Sprite ノード - modulate プロパティ Time: 0 / Value: #ffffff / Easing: 1.00\n*「flash」アニメーションでmodulateが変更された後、「idle」アニメーション再生時に確実に初期値に戻すためのトラック\n以下の通りに、ドロップの待機中のアニメーションを作成する。 アニメーション名: flash 読み込み後、自動再生: 無効 アニメーションの長さ(秒): 0.2 アニメーションループ: 有効 トラック: Sprite ノード - frame プロパティ Time: 0 / Value: 0 / Easing: 1.00 Time: 0.1 / Value: 1 / Easing: 1.00 Sprite ノード - modulate プロパティ Time: 0 / Value: #ffffff / Easing: 1.00 Time: 0.1 / Value: #64ffffff / Easing: 1.00\nStickableArea (Area2D) ノード このノードは、ドロップが他のドロップと接触しているかどうかを検知するために利用する。プロパティの編集は不要だが、グループの追加が必要だ。\nノードドック＞グループタブを開き、「Stickable」という名前のグループを作って追加する。これはドロップを指でなぞった時に「隣接している」 = 「つなげるか」かどうかを判定するのに重要だ。\nCollisionShape2D ノード このノードは、親の「StickableArea」にコリジョン形状を提供する。隣接しているドロップを検知するのに利用する。隣り合っているドロップ同士の接触を検知させるために、ルートノード「Drop」のコリジョン形状よりやや大きめにする。\nプロパティ「Shape」に新規「CircleShape2D」リソースを適用する。 さらにそのリソースのプロパティ「Radius」の値を 18 に変更する。これで半径 18 px の円形のコリジョン形状ができた。2D ワークスペースで直感的にサイズ調整しても構わない。\n*このノードのコリジョン形状は一番外側の円 以上で各ノードの編集は完了だ。\nDrop シーンをスクリプトで制御する それではルートノード「Drop」に新規スクリプトをアタッチしよう。ファイルパスを「res://Drops/Drop.gd」としてスクリプトファイルを作成する。\nひとまずスクリプトを以下のように編集してほしい。\n### Drop.gd ### extends RigidBody2D # Drop シーンを継承するシーンにそれぞれの色の名前を割り当てるプロパティ # 今はブランクの文字列 export var color = \"\" # 隣接するドロップを入れる配列を stuck_drop と定義 var stuck_drops = [] # AnimationPlayerノードへの参照 # Drop のインスタンスを World シーンに追加してから利用する onready var anim_player = $AnimationPlayer 次に、「StickableArea」ノードの Area2D ノードのシグナルを利用する。隣接するドロップと接触した時に発信されるシグナル「area_entered」と、接触していたドロップが離れた時に発信されるシグナル「area_exited」をスクリプトに接続しよう。\nそれぞれのシグナルを接続したときに生成されるメソッドを以下のように編集してほしい。\n### Drop.gd ### # StickableArea に他の area (Area2D クラスのノード)が当たった時に呼ばれるメソッド func _on_StickableArea_area_entered(area): # もし当たった area が Stickable グループのノードだったら if area.is_in_group(\"Stickable\"): # その親ノードを drop と定義 var drop = area.get_parent() # 配列 stuck_drops に drop を追加 stuck_drops.append(drop) # StickableArea から他の area (Area2D クラスのノード) が離れた時に呼ばれるメソッド func _on_StickableArea_area_exited(area): # もし当たった area が Stickable グループのノードだったら if area.is_in_group(\"Stickable\"): # その親ノードを drop と定義 var drop = area.get_parent() # 配列 stuck_drops の中の drop の index を調べる var index = stuck_drops.find(drop) # 配列 stuck_drops から index に該当する要素（隣接していた Drop）を削除 stuck_drops.remove(index) これで「Drop.gd」の編集は完了だ。\nDrop シーンを継承したシーンを作る さっき作った「Drop」シーンはこれから作るシーンの雛形だ。これから「Drop」シーンを継承したシーンをドロップの色の数だけ作成する。ドロップの色は、青、緑、オレンジ、赤、黄の 5 色だ。まずは青のドロップを例に手順を進めてみよう。\n「シーン」メニュー＞「新しい継承シーン」を選択する。 継承元のシーンとして「Drops.tscn」を選択する。 シーンが生成されたら、ルートノードの名前を「Blue」に変更する。\n*このルートノードの名前はそれぞれのドロップの色に合わせること。 シーンを一旦保存しておこう。ファイルパスを「res://Drops/BlueDrop.tscn」として保存する。 シーンツリードックでルートノード「BlueDrop」を選択した状態で、インスペクターで Script Variables の「Color」の値を「Blue」とする。\nシーンツリードックで「Sprite」ノードを選択する。エディタ下部の「テクスチャ領域」パネルを開き、青いエイリアンのテクスチャ２つ分を選択しよう。\n以上で、「BlueDrop」シーンは完成だ。同じ手順で残りの 4 色のシーンも作成してほしい。なお、シーンのルートノードの名前とそのプロパティ「Color」の値は以下の通りだ。\nルートノード: GreenDrop / Color: Green ルートノード: OrangeDrop / Color: Orange ルートノード: RedDrop / Color: Red ルートノード: YellowDrop / Color: Yellow 全部で 5 色のドロップの継承シーンができたら作業完了だ。\nWorld シーンをスクリプトで制御する いよいよ今回のチュートリアルも終盤に差し掛かった。では「World」シーンのルートノードにスクリプトをアタッチしよう。ファイルパスは「res://World/World.tscn」として作成する。\nスクリプトエディタが開いたら、まずは以下の通りにプロパティを定義する。\n### World.gd ### extends Node2D # preloadした5色のドロップシーンを要素にもつ配列を drop_scenes として定義 const drop_scenes = [ preload(\"res://Drops/BlueDrop.tscn\"), preload(\"res://Drops/GreenDrop.tscn\"), preload(\"res://Drops/OrangeDrop.tscn\"), preload(\"res://Drops/RedDrop.tscn\"), preload(\"res://Drops/YellowDrop.tscn\") ] # つなげて消せる最小ドロップ数 export (int) var min_erasable = 3 # プレイ画面に表示される最大ドロップ数 export (int) var max_drops = 50 # 現在ゲームをプレイ中の場合は true になる var is_playing = false # 指を画面に当てたまま or マウス左クリックを押したままの場合 true になる var is_holding = false # 現在指またはマウスカーソルが当たっているドロップの参照用 var pointed_drop # 現在つなげているドロップの色 var active_color = \"\" # ホールド中の（なぞってつながっている）ドロップのリスト用の配列 var held_drops = [] # Spawnerノードへの参照 onready var spawner = $SpawnPath/Spawner # Dropsノードへの参照 onready var drops = $Drops # DropsLineノードへの参照 onready var drops_line = $DropsLine # Pointerノードへの参照 onready var pointer = $Pointer 次にゲーム開始直後に画面外上部からドロップが最大ドロップ数の 50 個落ちてくるようコーディングしていこう。\n### World.gd ### # World シーンのノードが全て読み込まれたら呼ばれるメソッド func _ready(): # ランダム系のメソッドの出力結果を毎回ランダムにしてくれる組み込みメソッド randomize() # max_drops の数 (50) だけループする for _i in range(max_drops): # ドロップを生成するメソッド（このあと定義）を呼び出す spawn_drop() # 一つのドロップが生成されたら0.025秒待機して次のドロップ生成 yield(get_tree().create_timer(0.025), \"timeout\") # ドロップを生成するメソッド func spawn_drop(): # 配列 drop_scenes からランダムで選ばれた色のドロップのシーンファイルの参照 var drop_scene = drop_scenes[randi() % drop_scenes.size()] # 選択された色のドロップシーンをインスタンス化する var drop = drop_scene.instance() # ドロップのインスタンスの位置を Spawner ノードの位置と同じにする drop.position = spawner.global_position # ドロップのインスタンスを World シーンに追加する drops.add_child(drop) それではプロジェクトを実行して、ゲーム開始時のランダムに決定された色のドロップが50個降ってくる挙動を見ておこう。なお、初めてプロジェクトを実行する際はメインシーンを「World.tscn」としておこう。\n「Pointer (Area2D)」ノードの位置は、指、またはマウスカーソルの位置に追随させるようにこのあとコーディングするのだが、その時、指やマウスカーソルが「Drop」インスタンスの「PointableArea (Area2D)」と重なった時とそのあと離れた時に「Pointer」ノードがそれを検知してシグナルを発信する。それを利用して、ドロップをなぞった時の処理をコーディングしていこう。\nシーンツリードックで「Pointer」を選択し、ノードドック＞シグナルタブにて、シグナル「area_entered(area: Area2D)」とシグナル「area_exited(area: Area2D)」をスクリプトに接続する。\n自動的に生成されたメソッドを以下のように編集しよう。\n### World.gd ### # Pointer ノードが他の area(Area2D オブジェクト)に触れたら呼ばれるメソッド func _on_Pointer_area_entered(area): # area が「Pointable」グループのノードだったら if area.is_in_group(\"Pointable\"): # pointed_drop に area の親ノード（Drop ノード）の参照を渡す pointed_drop = area.get_parent() # ホールド中のドロップが 0 ではなく.. # かつホールド中の最後のドロップが pointed_drop と隣接していたら if not held_drops.empty() and held_drops[-1] in pointed_drop.stuck_drops: # ドロップのつながりを更新するメソッドを呼ぶ（あとで定義） update_drops_connection() # Pointer ノードが触れていた area(Area2D オブジェクト)が離れたら呼ばれるメソッド func _on_Pointer_area_exited(area): # area が「Pointable」グループのノードだったら if area.is_in_group(\"Pointable\"): # pointed_drop を null にする pointed_drop = null 次は組み込み関数_processを利用して、毎フレーム（60FPS）呼び出したいメソッドを実行する。\n### World.gd ### # 組み込み関数: 60FPSで呼び出される func _process(_delta): # DropsLine　ノードの Points プロパティを更新する update_drops_line() # 指またはマウスカーソルの操作を受けつる get_input() # DropsLine ノードの Points プロパティを更新するメソッド # ドロップが転がったり落ちたりして位置が変わるため func update_drops_line(): # ホールド中のドロップが 1 つでもある場合 if not held_drops.empty(): # テンポラリのVector2配列を作成 var temp_array = PoolVector2Array() # ホールド中のドロップに対してループ for drop in held_drops: # テンポラリの配列にホールド中のドロップの位置を追加 temp_array.append(drop.position) # DropsLine ノードの points プロパティを現在ホールド中のドロップの位置に更新 drops_line.points = temp_array # 指またはマウスの入力があったら処理するメソッド func get_input(): # Pointer ノードの位置を常に指またはマウスカーソルの位置にする pointer.position = get_global_mouse_position() # もし指で画面を押したら、もしくはマウス左ボタンを押したら if Input.is_action_just_pressed(\"tap\"): # ドロップをホールドするメソッド（あとで定義）を呼び出す hold_drop() # ホールド中のドロップのつながりを更新するメソッド（あとで定義）を呼び出す update_drops_connection() # もし指が画面から離れたら、もしくはマウス左ボタンが上がったら if Input.is_action_just_released(\"tap\"): # ホールド中のドロップを消すメソッド（あとで定義）を呼び出す erase_drops() # ホールドを解除するメソッド（あとで定義）を呼び出す release_drops() 上のコードで定義したメソッドget_input内で呼び出している以下のメソッドはこの後順番に定義していく。\nhold_drop update_drops_connection erase_drops release_drops まずはドロップを押さえた時に呼び出されるメソッドhold_dropとupdate_drops_connectionを定義していこう。\n### World.gd ### # ドロップをホールド中にするメソッド func hold_drop(): # もし指またはマウスカーソルがドロップに触れていたら if pointed_drop: # ホールド中とする is_holding = true # ドロップのつながりを更新するメソッド func update_drops_connection(): # もしドロップをホールド中かつ.. # 指またはマウスカーソルがドロップに重なっていたら if is_holding and pointed_drop: # もしホールド中のドロップが 0 だったら if held_drops.empty(): # これからつなぐドロップの色を現在指または.. # マウスカーソルが触れているドロップの色とする active_color = pointed_drop.color # ドロップをつなぐメソッド（あとで定義）を呼ぶ connect_drop() # もし現在指またはマウスカーソルが触れているドロップの色が.. # つないでいるドロップの色と同じだったら elif pointed_drop.color == active_color: # ホールド中のドロップの数が 2 以上かつ現在触れている.. # ドロップがホールド中のドロップの最後から2番目と同じだったら if held_drops.size() \u003e= 2 and pointed_drop == held_drops[-2]: # つながりを解除するメソッド（あとで定義）を呼ぶ disconnect_drop() # ホールド中のドロップの中に現在指またはマウスカーソルが.. # 触れているドロップがなければ elif not pointed_drop in held_drops: # ドロップをつなぐメソッド（あとで定義）を呼ぶ connect_drop() ここで定義したメソッドupdate_drops_connection内を見ると、さらに未定義のconnect_dropメソッドとdisconnect_dropメソッドが呼ばれている。\n続けてこれらのメソッドを定義しよう。\n### World.gd ### # ドロップをつなぐメソッド func connect_drop(): # 現在指またはマウスカーソルが触れているドロップのAnimationPlayerで.. # アニメーション\"flash\"を再生する pointed_drop.anim_player.play(\"flash\") # ホールド中のドロップリストに現在触れているドロップを追加する held_drops.append(pointed_drop) # DropsLine ノードの Points プロパティに現在触れているドロップの位置を追加する drops_line.add_point(pointed_drop.position) # ドロップのつながりを解除するメソッド func disconnect_drop(): # ホールド中のドロップのリストの最後のドロップを canceled_drop とする var canceled_drop = held_drops.pop_back() # canceled_drop の AnimationPlayer でアニメーション（\"flash\"）を停止する canceled_drop.anim_player.stop() # canceled_drop の AnimationPlayer でアニメーション（\"idle\"）を再生する canceled_drop.anim_player.play(\"idle\") # DropsLineノードの Points プロパティから最後の点を削除する drops_line.remove_point(drops_line.get_point_count() - 1) get_inputメソッド内で、指が画面から離れたら、またはマウス左ボタンが上がった時に呼び出される２つのメソッドerase_drops、release_dropsをこれから定義していく。\n### World.gd ### # ドロップを消すメソッド func erase_drops(): # もしホールド中のドロップの数がつなげて消せる最小ドロップ数未満だったら if held_drops.size() \u003c min_erasable: # メソッドを即時終了する return # ホールド中のドロップの配列を変数 erased の値として複製 var erased = held_drops.duplicate() # 配列 erased の要素に対してループ処理 for drop in erased: # 配列 erased に含まれるドロップを解放する drop.queue_free() # 消した分、新しいドロップを生成する spawn_drop() # 0.1 秒待機（それから次のループ） yield(get_tree().create_timer(0.1), \"timeout\")\t# ドロップからホールドを解放するメソッド func release_drops(): # ホールド中ステータスを解除 is_holding = false # ホールド中のドロップの配列の要素対してループ for drop in held_drops: # 配列から取り出したドロップの AnimationPlayer で.. # アニメーションを停止する drop.anim_player.stop() # 配列から取り出したドロップの AnimationPlayer で.. # アニメーション\"idle\"を再生する drop.anim_player.play(\"idle\") # ホールド中のドロップの配列を空っぽにする held_drops.clear() # DropsLine ノードの Points プロパティを空っぽにする drops_line.clear_points() 以上で「World.gd」スクリプトの編集は完了だ。\nシーンを実行して動作確認する 最後にシーンを実行して思った通りの動きが再現できるか確認してみよう。\n以下について想定通りであることが確認できただろうか。\nマウスカーソルがドロップの中央付近にある状態でマウス左ボタンを押すとドロップがホールド状態になり「flash」アニメーションが再生される マウス左ボタンを押したまま、隣接するドロップをなぞっていくと「DropsLine」の線がつながっていく なぞってきたドロップを戻ってなぞり直すとホールドが解除され「idle」アニメーションの再生に戻る なぞったドロップが3つ以上だとマウス左ボタンを離したときにホールド中のドロップが全て消える なぞったドロップが3つ未満だとマウス左ボタンを離してもドロップは消えずホールド解除のみされる サンプルゲーム 今回のチュートリアルで作成したプロジェクトをさらにブラッシュアップしたサンプルゲームを用意した。\nYour browser does not support the video tag. プロジェクトファイルは、GitHubリポジトリ に置いているので、そこから .zip ファイルをダウンロードしていただき、「Sample」フォルダ内の「project.godot」ファイルを Godot Engine でインポートすれば確認していただけるはずだ。\nおわりに 今回のチュートリアルでは同じ色をなぞって消すパズルゲームを作った。ゲームの中毒性を感じずにはいられない種類のゲームだ。最後に作成におけるポイントをまとめておこう。\nドロップは RigidBody2D にして、エンジンに物理演算を任せる。 ドロップに、指やカーソルを検知するための Area2D クラスのノードと、隣接するドロップを検知するための Area2D クラスのノードを追加して、それらのシグナルを利用する。 指やマウスカーソルには Area2D クラスのノードを常に追随させ、ドロップとの接触にはこのノードのシグナルを利用する。 リンク KENNEY Godot Docs: 物理の紹介 Godot Docs: RigidBody2D Godot Docs: Area2Dの使用 Godot Docs: Area2D Godot Docs: CollisionShape2D Godot Docs: CollisionPolygon2D Godot Docs: Path2D Godot Docs: PathFollow2D Zenn:【Godot Engine】Path2D/PathFollow2Dを使って決まった経路で動かす方法 | syun77 Godot Docs: Line2D Qiita:【Godot】Line2Dを使ったトレイルの実装方法 | @2dgames_jp Godot Docs: Introduction to the animation features Godot Docs: AnimationPlayer UPDATE\n2022/06/20 変数holded_dropsのスペルをheld_dropsに修正（GitHubリポジトリ上のコードも修正）\n",
  "wordCount" : "1230",
  "inLanguage": "ja",
  "image":"https://www.peanuts-code.com/images/tutorials/gd0011_connect_colors/img36.gif","datePublished": "2022-06-14T22:43:45+09:00",
  "dateModified": "2022-06-20T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Masanao Sako"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.peanuts-code.com/ja/tutorials/gd0011_connect_colors/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Peanuts Code",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.peanuts-code.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.peanuts-code.com/ja/" accesskey="h" title="Peanuts Code (Alt + H)">
                <img src="/images/logomark.png" alt="logo" aria-label="logo"
                    height="35">Peanuts Code</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://www.peanuts-code.com/en/" title="English"
                            aria-label="English">En</a>
                    </li>
                </ul>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.peanuts-code.com/ja/" title="ホーム">
                    <span>ホーム</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/posts/" title="ブログ">
                    <span>ブログ</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/tutorials/" title="チュートリアル">
                    <span>チュートリアル</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/tags/" title="タグ">
                    <span>タグ</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/about/" title="アバウト">
                    <span>アバウト</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://www.peanuts-code.com/ja/">Home</a>&nbsp;»&nbsp;<a href="https://www.peanuts-code.com/ja/tutorials/">Tutorials</a></div>
    <h1 class="post-title">
      Godot で作る同じ色をつなげて消すパズルゲーム
    </h1>
    <div class="post-meta">2022-06-14&nbsp;·&nbsp;6 分&nbsp;·&nbsp;Masanao Sako&nbsp;|&nbsp;
<ul class="i18n_list">言語:
    <li>
        <a href="https://www.peanuts-code.com/en/tutorials/gd0011_connect_colors/">En</a>
    </li>
</ul>
</div>
  </header> 
<figure class="entry-cover"><img loading="lazy" src="https://www.peanuts-code.com/images/tutorials/gd0011_connect_colors/img36.gif" alt="Godot で作る同じ色をつなげて消すパズルゲーム">
        
</figure><div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目次</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e6%96%b0%e8%a6%8f%e3%83%97%e3%83%ad%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%82%92%e4%bd%9c%e6%88%90%e3%81%99%e3%82%8b" aria-label="新規プロジェクトを作成する">新規プロジェクトを作成する</a><ul>
                        
                <li>
                    <a href="#%e3%83%97%e3%83%ad%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e8%a8%ad%e5%ae%9a%e3%82%92%e6%9b%b4%e6%96%b0%e3%81%99%e3%82%8b" aria-label="プロジェクト設定を更新する">プロジェクト設定を更新する</a></li>
                <li>
                    <a href="#%e3%82%a2%e3%82%bb%e3%83%83%e3%83%88%e3%82%92%e3%83%80%e3%82%a6%e3%83%b3%e3%83%ad%e3%83%bc%e3%83%89%e3%81%97%e3%81%a6%e3%82%a4%e3%83%b3%e3%83%9d%e3%83%bc%e3%83%88%e3%81%99%e3%82%8b" aria-label="アセットをダウンロードしてインポートする">アセットをダウンロードしてインポートする</a></li></ul>
                </li>
                <li>
                    <a href="#world-%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e3%82%8b" aria-label="World シーンを作る">World シーンを作る</a><ul>
                        
                <li>
                    <a href="#world-%e3%82%b7%e3%83%bc%e3%83%b3%e3%81%ab%e3%83%8e%e3%83%bc%e3%83%89%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b" aria-label="World シーンにノードを追加する">World シーンにノードを追加する</a></li>
                <li>
                    <a href="#world-%e3%82%b7%e3%83%bc%e3%83%b3%e3%81%ae%e3%83%8e%e3%83%bc%e3%83%89%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b" aria-label="World シーンのノードを編集する">World シーンのノードを編集する</a><ul>
                        
                <li>
                    <a href="#bin-staticbody2d-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="Bin (StaticBody2D) ノード">Bin (StaticBody2D) ノード</a></li>
                <li>
                    <a href="#collisionpolygon2d-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="CollisionPolygon2D ノード">CollisionPolygon2D ノード</a></li>
                <li>
                    <a href="#spawnpath-path2d-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="SpawnPath (Path2D) ノード">SpawnPath (Path2D) ノード</a></li>
                <li>
                    <a href="#spawner-pathfollow2d-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="Spawner (PathFollow2D) ノード">Spawner (PathFollow2D) ノード</a></li>
                <li>
                    <a href="#animationplayer-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="AnimationPlayer ノード">AnimationPlayer ノード</a></li>
                <li>
                    <a href="#drops-node2d-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="Drops (Node2D) ノード">Drops (Node2D) ノード</a></li>
                <li>
                    <a href="#dropline-line2d-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="DropLine (Line2D) ノード">DropLine (Line2D) ノード</a></li>
                <li>
                    <a href="#pointer-area2d-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="Pointer (Area2D) ノード">Pointer (Area2D) ノード</a></li>
                <li>
                    <a href="#collisionshape2d-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="CollisionShape2D ノード">CollisionShape2D ノード</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#drop-%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e3%82%8b" aria-label="Drop シーンを作る">Drop シーンを作る</a><ul>
                        
                <li>
                    <a href="#drop-%e3%82%b7%e3%83%bc%e3%83%b3%e3%81%ab%e3%83%8e%e3%83%bc%e3%83%89%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b" aria-label="Drop シーンにノードを追加する">Drop シーンにノードを追加する</a></li>
                <li>
                    <a href="#drop-%e3%82%b7%e3%83%bc%e3%83%b3%e3%81%ae%e3%83%8e%e3%83%bc%e3%83%89%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b" aria-label="Drop シーンのノードを編集する">Drop シーンのノードを編集する</a><ul>
                        
                <li>
                    <a href="#drop-rigidbody2d-%e3%83%ab%e3%83%bc%e3%83%88%e3%83%8e%e3%83%bc%e3%83%89" aria-label="Drop (RigidBody2D) ルートノード">Drop (RigidBody2D) ルートノード</a></li>
                <li>
                    <a href="#sprite-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="Sprite ノード">Sprite ノード</a></li>
                <li>
                    <a href="#collisionshape2d-%e3%83%8e%e3%83%bc%e3%83%89-%e3%83%ab%e3%83%bc%e3%83%88%e3%83%8e%e3%83%bc%e3%83%89-drop-%e3%81%ae%e5%ad%90" aria-label="CollisionShape2D ノード (ルートノード Drop の子)">CollisionShape2D ノード (ルートノード Drop の子)</a></li>
                <li>
                    <a href="#pointablearea-area2d-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="PointableArea (Area2D) ノード">PointableArea (Area2D) ノード</a></li>
                <li>
                    <a href="#collisionshape2d-pointablearea-%e3%81%ae%e5%ad%90%e3%83%8e%e3%83%bc%e3%83%89" aria-label="CollisionShape2D (PointableArea の子)ノード">CollisionShape2D (PointableArea の子)ノード</a></li>
                <li>
                    <a href="#animationplayer-%e3%83%8e%e3%83%bc%e3%83%89-1" aria-label="AnimationPlayer ノード">AnimationPlayer ノード</a></li>
                <li>
                    <a href="#stickablearea-area2d-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="StickableArea (Area2D) ノード">StickableArea (Area2D) ノード</a></li>
                <li>
                    <a href="#collisionshape2d-%e3%83%8e%e3%83%bc%e3%83%89-1" aria-label="CollisionShape2D ノード">CollisionShape2D ノード</a></li></ul>
                </li>
                <li>
                    <a href="#drop-%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%81%a7%e5%88%b6%e5%be%a1%e3%81%99%e3%82%8b" aria-label="Drop シーンをスクリプトで制御する">Drop シーンをスクリプトで制御する</a></li></ul>
                </li>
                <li>
                    <a href="#drop-%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e7%b6%99%e6%89%bf%e3%81%97%e3%81%9f%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e3%82%8b" aria-label="Drop シーンを継承したシーンを作る">Drop シーンを継承したシーンを作る</a></li>
                <li>
                    <a href="#world-%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%81%a7%e5%88%b6%e5%be%a1%e3%81%99%e3%82%8b" aria-label="World シーンをスクリプトで制御する">World シーンをスクリプトで制御する</a></li>
                <li>
                    <a href="#%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e5%ae%9f%e8%a1%8c%e3%81%97%e3%81%a6%e5%8b%95%e4%bd%9c%e7%a2%ba%e8%aa%8d%e3%81%99%e3%82%8b" aria-label="シーンを実行して動作確認する">シーンを実行して動作確認する</a></li>
                <li>
                    <a href="#%e3%82%b5%e3%83%b3%e3%83%97%e3%83%ab%e3%82%b2%e3%83%bc%e3%83%a0" aria-label="サンプルゲーム">サンプルゲーム</a></li>
                <li>
                    <a href="#%e3%81%8a%e3%82%8f%e3%82%8a%e3%81%ab" aria-label="おわりに">おわりに</a></li>
                <li>
                    <a href="#%e3%83%aa%e3%83%b3%e3%82%af" aria-label="リンク">リンク</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>このチュートリアルでは、スマホゲームで大人気の ディズニーツムツムのような同じ色のドロップをなぞってつなげて消すタイプのゲームの作り方を説明する。ちなみにディズニーツムツムを知らない方は以下のリンク先を一度ご覧いただきたい。</p>
<p><a href="https://www.disney.co.jp/games/dtt.html" target="_blank">LINE：ディズニー ツムツム</a>
</p>
<br>
<p>なお、このチュートリアルで最後にできあがるプロジェクトのファイルは <a href="https://github.com/msnsk/ConnectColors.git" target="_blank">GitHubリポジトリ</a>
 に置いている。.zipファイルをダウンロードしていただき、「End」フォルダ内の「project.godot」ファイルを Godot Engine でインポートしていただければ、直接プロジェクトを確認していただくことも可能だ。<br>
<br></p>
<blockquote>
<p><em><strong><span style="color:salmon">Environment</span>
</strong><br>
このチュートリアルは以下の環境で作成しました。</em><br>
・<em>Godot のバージョン: <strong>3.4.4</strong></em><br>
・<em>コンピュータのOS: <strong>macOS 11.6.5</strong></em></p>
</blockquote>
<blockquote>
<p><em><strong><span style="color:salmon">Memo:</span>
</strong><br>
ゲームを作り始めるのに以下の記事もお役立てください。<br>
<a href="https://www.peanuts-code.com/ja/tutorials/gd0001_download/" title="Godot をダウンロードする">Godot をダウンロードする</a>
<br>
<a href="https://www.peanuts-code.com/ja/tutorials/gd0002_project_manager/" title="Godot のプロジェクトマネージャー">Godot のプロジェクトマネージャー</a>
<br>
<a href="https://www.peanuts-code.com/ja/tutorials/gd0003_change_language/" title="Godot の言語設定">Godot の言語設定</a>
</em></p>
</blockquote>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="新規プロジェクトを作成する">新規プロジェクトを作成する<a hidden class="anchor" aria-hidden="true" href="#新規プロジェクトを作成する">#</a></h1>
<p>まずは Godot Engine を立ち上げて、新規プロジェクトを作成してほしい。プロジェクトの名前は「Connect Colors Start」としておこう。</p>
<br>
<h2 id="プロジェクト設定を更新する">プロジェクト設定を更新する<a hidden class="anchor" aria-hidden="true" href="#プロジェクト設定を更新する">#</a></h2>
<p>エディタが表示されたら、先にプロジェクト全体に関わる設定を更新しておこう。</p>
<p>まずはゲームのディスプレイサイズを設定する。今回はスマホの縦向きの画面を想定して、縦横の比率を16:9とした。</p>
<ol>
<li>「プロジェクト」メニュー＞「プロジェクト設定」を開く。</li>
<li>「一般」タブで「window」で検索して、サイドバーの「Display」＞「Window」を選択する。</li>
<li>「Size」セクションで以下の項目の値を変更する。
<ul>
<li>Width: 144</li>
<li>Height: 256</li>
<li>Test Width: 288</li>
<li>Test Height: 512<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img1.png" alt="Display - Window - Size"  />
</li>
</ul>
</li>
<li>「Stretch」セクションで以下の項目の値を変更する。
<ul>
<li>Mode: 2d</li>
<li>Aspect: keep<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img2.png" alt="Display - Window - Stretch"  />
</li>
</ul>
</li>
</ol>
<br>
<p>そのまま「プロジェクト設定」ウインドウを開いた状態で、デバッグパネルでスマホのタッチ操作をマウスで代用するための設定をする。</p>
<ol>
<li>「一般」タブで「mouse」で検索し、サイドバーの「Input Devices」＞「Pointing」を選択する。</li>
<li>「Emulate Touch From Mouse」の On のチェックを入れる。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img2.1.png" alt="Input Devices - Pointing - Emulate Touch From Mouse"  />
</li>
</ol>
<br>
<p>さらに「プロジェクト設定」ウインドウを開いた状態で、インプットマップにスマホのタッチ操作の相当するアクションを追加しよう。</p>
<ol>
<li>「インプットマップ」タブに切り替え、アクションに「tap」を追加する。</li>
<li>「tap」の操作にマウスの左クリックを追加する。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img2.2.png" alt="Inputmap - action - tap"  />
</li>
</ol>
<br>
<h2 id="アセットをダウンロードしてインポートする">アセットをダウンロードしてインポートする<a hidden class="anchor" aria-hidden="true" href="#アセットをダウンロードしてインポートする">#</a></h2>
<p>次に、KENNEYのサイトからアセットをダウンロードして利用させてもらおう。今回利用するのは <strong><a href="https://www.kenney.nl/assets/pixel-platformer" target="_blank">Pixel Platformer</a>
</strong> というアセットパックだ。この素晴らしすぎる無料の素材に感謝せずにはいられない。</p>
<p>ダウンロードしたら「Tilemap」フォルダ内の「characters_packed.png」ファイルをエディタのファイルシステムドックへドラッグ&amp;ドロップしてプロジェクトにインポートしよう。</p>
<p>ファイルをインポートした直後は画像がぼやけた感じになっているので、これを以下の手順で修正しておく。</p>
<ol>
<li>ファイルシステムドックでインポートしたアセットファイルを選択した状態にする<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img3.png" alt="select the asset"  />
</li>
<li>インポートドックで「プリセット」＞「2D Pixel」を選択する<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img4.png" alt="select 2D Pixel"  />
</li>
<li>一番下にある「再インポート」ボタンをクリックする。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img5.png" alt="click reinport"  />
</li>
</ol>
<p>これでピクセルアート特有のエッジの効いた画像になる。<br>
<br></p>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="world-シーンを作る">World シーンを作る<a hidden class="anchor" aria-hidden="true" href="#world-シーンを作る">#</a></h1>
<p>まず最初のシーンとして、ゲームの舞台を用意する。「World」という名前のシーンを作成しよう。</p>
<ol>
<li>「シーン」メニュー＞「新規シーン」を選択する。</li>
<li>「ルートノードを生成」にて「その他のノード」を選択する。</li>
<li>「Node2D」クラスのノードをルートノードとして選択。</li>
<li>ルートノードの名前を「World」に変更する。</li>
<li>一旦ここでシーンを保存しておこう。フォルダを作成して、ファイルパスを「res://World/World.tscn」としてシーンを保存する。<br>
<br></li>
</ol>
<h2 id="world-シーンにノードを追加する">World シーンにノードを追加する<a hidden class="anchor" aria-hidden="true" href="#world-シーンにノードを追加する">#</a></h2>
<p>World シーンが以下のシーンツリーになるようにノードを追加しよう。なお、それぞれのプロパティ編集は後で順番にやっていくので一旦そのままで良い。</p>
<ul>
<li>World (Node2D)
<ul>
<li>Bin (StaticBody2D)
<ul>
<li>CollisionPolygon2D</li>
</ul>
</li>
<li>SpawnPath (Path2D)
<ul>
<li>Spawner (PathFollow2D)</li>
</ul>
</li>
<li>AnimationPlayer</li>
<li>Drops (Node2D)</li>
<li>DropsLine (Line2D)</li>
<li>Pointer (Area2D)
<ul>
<li>CollisionShape2D</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>シーンツリードックの表示は以下のようになったはずだ。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img6.png" alt="scene tree dock"  />
<br>
<br></p>
<h2 id="world-シーンのノードを編集する">World シーンのノードを編集する<a hidden class="anchor" aria-hidden="true" href="#world-シーンのノードを編集する">#</a></h2>
<h3 id="bin-staticbody2d-ノード">Bin (StaticBody2D) ノード<a hidden class="anchor" aria-hidden="true" href="#bin-staticbody2d-ノード">#</a></h3>
<p>このノードの編集は不要だ。「StaticBody2D」は 2D ゲームにおいて、移動しない障害物や壁などに利用される。今回は落ちてくるドロップ（なぞって消すオブジェクト）を画面内にとどめるための入れ物（ビン）として利用する。<br>
<br></p>
<h3 id="collisionpolygon2d-ノード">CollisionPolygon2D ノード<a hidden class="anchor" aria-hidden="true" href="#collisionpolygon2d-ノード">#</a></h3>
<p>このノードは親ノードの「Bin」にコリジョン形状を付与するための利用する。コリジョン形状は 2D ワークスペース上で点を打って作る。</p>
<ol>
<li>
<p>2D ワークスペースのツールバーでグリッドスナップを有効にする。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img7.png" alt="enable grid snap"  />
</p>
</li>
<li>
<p>基本的に、ウインドウ枠の外側を囲むように点を打ってコリジョン形状を成形する。ただし、上部は、ディスプレイサイズの y 座標 0 より -64px ずらして成形する。理由は、ウインドウ枠上部外側でドロップを生成して落下させるためだ。また、コリジョンポリゴン下部はディスプレイサイズよりやや内側まで配置し、ドロップが転がるように少し斜めにしている。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img8.png" alt="create collisoin shape"  />
<br>
<br></p>
</li>
</ol>
<h3 id="spawnpath-path2d-ノード">SpawnPath (Path2D) ノード<a hidden class="anchor" aria-hidden="true" href="#spawnpath-path2d-ノード">#</a></h3>
<p>このノードはドロップの生成位置を x 軸方向に常に移動させるために使う。これは、ドロップが毎回画面上部の同じ位置から落ちてくるのを防ぐ役割だ。これをウインドウ枠の上部外側に配置する。</p>
<ol>
<li>2D ワークスペース上で (16, -32) と (128, -32) の２つの点を打って x 軸に並行な直線のパスを作る。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img9.png" alt="create path2d path"  />
<br>
<br></li>
</ol>
<h3 id="spawner-pathfollow2d-ノード">Spawner (PathFollow2D) ノード<a hidden class="anchor" aria-hidden="true" href="#spawner-pathfollow2d-ノード">#</a></h3>
<p>このノードは先に編集した「SpawnPath」ノードのパス上を移動するノードだ。このノードを常にパスに沿って往復させ、このノードの位置からドロップを生成するようにする。これによりドロップの落下位置が「SpawnPath」ノードのパスの範囲で常に変化する</p>
<ol>
<li>プロパティ「Rotate」をオフにする。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img10.png" alt="disable property rotate"  />
<br>
<br></li>
</ol>
<h3 id="animationplayer-ノード">AnimationPlayer ノード<a hidden class="anchor" aria-hidden="true" href="#animationplayer-ノード">#</a></h3>
<p>このノードは「Spawner」を「SpawnPath」のパスに沿って常に往復移動させるために利用する。「Spawner」のプロパティ「Unit Offset」は、親ノード「SpawnPath」のパスの開始位置を 0、終点を 1 で表す。つまりこのプロパティを常に 0 ⇄ 1 で変化させれば、パス上を往復させることができる。</p>
<ol>
<li>以下の通りにアニメーションを一つ作成する。
<ul>
<li>アニメーション名: move_spawn_pos</li>
<li>読み込み後、自動再生: 有効</li>
<li>アニメーションの長さ(秒): 0.4<br>
*0.4 秒でパスを往復する</li>
<li>アニメーションループ: 有効</li>
<li>トラック:
<ul>
<li>Spawner ノード - unit_offset プロパティ
<ul>
<li>Time: 0 / Value: 0 / Easing: 1.00</li>
<li>Time: 0.2 / Value: 1 / Easing: 1.00<br>
*0.2秒時点でパスの終点から折り返す<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img11.png" alt="create animation"  />
<br>
<br></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="drops-node2d-ノード">Drops (Node2D) ノード<a hidden class="anchor" aria-hidden="true" href="#drops-node2d-ノード">#</a></h3>
<p>このノードのプロパティ編集は不要だ。役割は、ドロップシーン（後ほど作成）から複数生成するインスタンスをまとめるただの入れ物だ。<br>
<br></p>
<h3 id="dropline-line2d-ノード">DropLine (Line2D) ノード<a hidden class="anchor" aria-hidden="true" href="#dropline-line2d-ノード">#</a></h3>
<p>このノードは同じ色のドロップをなぞった時に、そのドロップとドロップをつなぐ線を描画するために利用する。これにより、どのドロップをなぞってきたのか、いくつつながっているのか、が視覚的に確認しやすくなる。</p>
<ol>
<li>
<p>プロパティ「Width」を 2 に変更する。これは線の太さだ。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img12.png" alt="Line2D Width property"  />
</p>
</li>
<li>
<p>プロパティ「Capping」＞「Joint Mode」、「Begin Cap Mode」、「End Cap Mode」をそれぞれ「Round」に変更する。これにより、線の繋ぎ目、先端、終端の形状を丸くすることができる。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img13.png" alt="Line2D Capping each property"  />
<br>
<br></p>
</li>
</ol>
<h3 id="pointer-area2d-ノード">Pointer (Area2D) ノード<a hidden class="anchor" aria-hidden="true" href="#pointer-area2d-ノード">#</a></h3>
<p>このノードの編集は不要だ。目的としては、スマホなら指、PCならマウスカーソルにこのノードを追随させて、ドロップに触っていることを検知するために利用する。のちほど、このノードの位置を常に指またはマウスカーソルの位置と同じにするためのコードをスクリプトに記述する。<br>
<br></p>
<h3 id="collisionshape2d-ノード">CollisionShape2D ノード<a hidden class="anchor" aria-hidden="true" href="#collisionshape2d-ノード">#</a></h3>
<p>このノードは、親ノード「Pointer」にコリジョン形状を付与する。指やマウスカーソルでのドロップをタッチする操作を考慮して、コリジョンはできるだけ小さい形状にする。</p>
<ol>
<li>プロパティ「Shape」にリソース「新規 CircleShape2D」を適用する。</li>
<li>適用したリソース「CircleShape2D」のプロパティ「Radius」の値を 1 にする。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img14.png" alt="CollisionShape2D Shape, Radius"  />
</li>
</ol>
<br>
<p>以上で各ノードの編集は完了だ。<br>
<br></p>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="drop-シーンを作る">Drop シーンを作る<a hidden class="anchor" aria-hidden="true" href="#drop-シーンを作る">#</a></h1>
<p>ここからは同じ色をなぞって消す対象となる「Drop」シーンを作っていく。</p>
<ol>
<li>「シーン」メニュー＞「新規シーン」を選択する。</li>
<li>「ルートノードを生成」にて「その他のノード」を選択する。</li>
<li>「RigidBody2D」クラスのノードをルートノードとして選択。</li>
<li>ルートノードの名前を「Drop」に変更する。</li>
<li>一旦ここでシーンを保存しておこう。フォルダを作成して、ファイルパスを「res://Drops/Drop.tscn」としてシーンを保存する。<br>
<br></li>
</ol>
<h2 id="drop-シーンにノードを追加する">Drop シーンにノードを追加する<a hidden class="anchor" aria-hidden="true" href="#drop-シーンにノードを追加する">#</a></h2>
<p>Drop シーンが以下のシーンツリーになるようにノードを追加しよう。なお、それぞれのプロパティ編集は後で順番にやっていくので一旦そのままで良い。</p>
<ul>
<li>Drop (RigidBody2D)
<ul>
<li>Sprite</li>
<li>CollisionShape2D</li>
<li>PointableArea (Area2D)
<ul>
<li>CollisionShape2D</li>
</ul>
</li>
<li>AnimationPlayer</li>
<li>StickableArea (Area2D)
<ul>
<li>CollisionShape2D</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>シーンツリードックの表示は以下のようになったはずだ。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img15.png" alt="Drop scene tree"  />
</p>
<br>
<h2 id="drop-シーンのノードを編集する">Drop シーンのノードを編集する<a hidden class="anchor" aria-hidden="true" href="#drop-シーンのノードを編集する">#</a></h2>
<h3 id="drop-rigidbody2d-ルートノード">Drop (RigidBody2D) ルートノード<a hidden class="anchor" aria-hidden="true" href="#drop-rigidbody2d-ルートノード">#</a></h3>
<p>「Drop」シーンには、そのインスタンスを「World」シーンに追加した時、自動的に重力に従って落下したり、バウンドしたりしてもらいたい。そのような物理演算による動きをノードのプロパティに合わせて自動的に再現してくれるのが RigidBody2D クラスだ。</p>
<ol>
<li>インスペクタードックにて、プロパティ「Physics Material Override」に新規「PhysicsMaterial」リソースを適用する。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img16.png" alt="Physics Material Override"  />
</li>
<li>プロパティ「Gravity Scale」の値を 2 にする。ドロップの落下速度を少し速くするのが目的だ。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img17.png" alt="Gravity Scale"  />
</li>
<li>ノードドック＞グループタブを開き、「Drops」という名前のグループを作って追加する。これはスクリプトでの条件分岐処理で重要だ。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img17.1.png" alt="Node dock - groups - Drops"  />
</li>
</ol>
<br>
<h3 id="sprite-ノード">Sprite ノード<a hidden class="anchor" aria-hidden="true" href="#sprite-ノード">#</a></h3>
<p>このノードで「Drop」にテクスチャ（見た目）を付与する。冒頭でインポートしたたくさんのテクスチャをまとめた1枚のスプライトシートから使いたいテクスチャの範囲を指定してスプライトのテクスチャを設定する方法を採用する。</p>
<ol>
<li>インスペクターにて、プロパティ「Texture」にファイルシステムからリソース「res://characters_packed.png」をドラッグして適用する。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img18.png" alt="Sprite node Texture property"  />
</li>
<li>「Region」＞「Enabled」をオンにする。<br>
<img loading="lazy" src="/images/tutorials/gd_common/node/Sprite/property/Region%3eEnabled=On.png" alt="Region &amp;gt; Enabled = on"  />
</li>
<li>エディタ下部の<strong>テクスチャ領域</strong>パネルを開く。ここで行うのはスプライトシートの中の利用したいテクスチャの領域を指定する作業だ。<br>
<img loading="lazy" src="/images/tutorials/gd_common/panel/TextureRegion/tab_name.png" alt="Region panel"  />

<ol>
<li>作業しやすいように、展開アイコンをクリックしてパネルを広げる。<br>
<img loading="lazy" src="/images/tutorials/gd_common/panel/TextureRegion/expand_icon.png" alt="Expand Region pannel"  />
</li>
<li>パネル上部の「snapモード」で「グリッドスナップ」を選択する。<br>
<img loading="lazy" src="/images/tutorials/gd_common/panel/TextureRegion/snap_mode=grid_snap.png" alt="Region pannel &amp;gt; choose grid snap"  />
</li>
<li>パネル上部の「ステップ」を 24px 24px にする。これでグリッドのサイズがスプライトシートのテクスチャ 1 つ分と同じサイズになる。<br>
<img loading="lazy" src="/images/tutorials/gd_common/panel/TextureRegion/step=24x24.png" alt="Region pannel &amp;gt; input grid step"  />
</li>
<li>スプライトシート上でドラッグ操作により緑色のドロップ（見た目はエイリアンだが）の2種類のテクスチャを範囲選択する。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img19.png" alt="Select region"  />
</li>
</ol>
</li>
<li>インスペクターに戻り、「Animation」＞「Hframes」プロパティの値を 2 に変更する。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img20.png" alt="animation - hframes property"  />
</li>
</ol>
<br>
<h3 id="collisionshape2d-ノード-ルートノード-drop-の子">CollisionShape2D ノード (ルートノード Drop の子)<a hidden class="anchor" aria-hidden="true" href="#collisionshape2d-ノード-ルートノード-drop-の子">#</a></h3>
<p>このノードはルートノード「Drop」にコリジョン形状を提供する。ルートノードは「RigidBody2D」クラスで、物理ボディの１つだ。物理ボディ同士の衝突判定にはコリジョン設定が必須だ。このコリジョン形状により、複数の「Drop」シーンのインスタンスが画面上でお互いにぶつかり合って、積み上がっていくことを想定している。</p>
<ol>
<li>プロパティ「Shape」に新規「CircleShape2D」リソースを適用する。</li>
<li>さらにそのリソースのプロパティ「Radius」の値を 12 に変更する。これで半径 12 px の円形のコリジョン形状ができた。2D ワークスペースで直感的にサイズ調整しても構わない。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img21.png" alt="CollisionShape2D - Shape - CircleShape2D"  />
 <img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img22.png" alt="CollisionShape2D - 2DWrokSpace"  />
</li>
</ol>
<br>
<h3 id="pointablearea-area2d-ノード">PointableArea (Area2D) ノード<a hidden class="anchor" aria-hidden="true" href="#pointablearea-area2d-ノード">#</a></h3>
<p>このノードは、指またはマウスカーソルがそのドロップに触れたことや離れたことを検知するために利用する。プロパティの編集は不要だが、グループの追加が必要だ。</p>
<ol>
<li>ノードドック＞グループタブを開き、「Pointable」という名前のグループを作って追加する。これは指またはマウスカーソルがドロップに触れているかどうかを判定する際に利用する。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img23.png" alt="Node dock - Groups - Pointable"  />
</li>
</ol>
<br>
<h3 id="collisionshape2d-pointablearea-の子ノード">CollisionShape2D (PointableArea の子)ノード<a hidden class="anchor" aria-hidden="true" href="#collisionshape2d-pointablearea-の子ノード">#</a></h3>
<p>このノードは、親の「PointableArea」にコリジョン形状を提供する。指やマウスカーソルがドロップの端に触っただけでは反応しないように、ルートノード「Drop」のコリジョン形状よりやや内側に収まるようにする。</p>
<ol>
<li>プロパティ「Shape」に新規「CircleShape2D」リソースを適用する。</li>
<li>さらにそのリソースのプロパティ「Radius」の値を 10 に変更する。ルートノード「Drop」のコリジョン形状よりひと回り小さくした。隣接するドロップ同士でこのコリジョン形状と重なってしまうと、ドロップから指が離れたことを検出される前に隣のドロップとの接触が検出されるため、スクリプトでの制御が難しくなってしまうのだ。2D ワークスペースで直感的にサイズ調整しても構わない。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img24.png" alt="CollisionShape2D - Shape - CircleShape2D"  />
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img25.png" alt="CollisionShape2D - 2DWrokSpace"  />
*このノードのコリジョン形状は内側の円</li>
</ol>
<br>
<h3 id="animationplayer-ノード-1">AnimationPlayer ノード<a hidden class="anchor" aria-hidden="true" href="#animationplayer-ノード-1">#</a></h3>
<p>ここではまず先に、指やマウスカーソルが触れていない時のドロップの待機中のアニメーションと、触れた後にそれがわかるように点滅するアニメーションを作成する。このノードは、作成したそれらのアニメーションリソースを再生するのに利用する。</p>
<ol>
<li>以下の通りに、ドロップの待機中のアニメーションを作成する。
<ul>
<li>アニメーション名: idle</li>
<li>読み込み後、自動再生: 有効</li>
<li>アニメーションの長さ(秒): 1</li>
<li>アニメーションループ: 有効</li>
<li>トラック:
<ul>
<li>Sprite ノード - frame プロパティ
<ul>
<li>Time: 0 / Value: 0 / Easing: 1.00</li>
<li>Time: 0.5 / Value: 1 / Easing: 1.00</li>
</ul>
</li>
<li>Sprite ノード - modulate プロパティ
<ul>
<li>Time: 0 / Value: #ffffff / Easing: 1.00<br>
*「flash」アニメーションでmodulateが変更された後、「idle」アニメーション再生時に確実に初期値に戻すためのトラック<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img26.gif" alt="2D Workspace - idle animation"  />
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img26.png" alt="Animation panel - idle animation"  />
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>以下の通りに、ドロップの待機中のアニメーションを作成する。
<ul>
<li>アニメーション名: flash</li>
<li>読み込み後、自動再生: 無効</li>
<li>アニメーションの長さ(秒): 0.2</li>
<li>アニメーションループ: 有効</li>
<li>トラック:
<ul>
<li>Sprite ノード - frame プロパティ
<ul>
<li>Time: 0 / Value: 0 / Easing: 1.00</li>
<li>Time: 0.1 / Value: 1 / Easing: 1.00</li>
</ul>
</li>
<li>Sprite ノード - modulate プロパティ
<ul>
<li>Time: 0 / Value: #ffffff / Easing: 1.00</li>
<li>Time: 0.1 / Value: #64ffffff / Easing: 1.00<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img27.gif" alt="2D Workspace - flash animation"  />
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img27.png" alt="Animation panel - flash animation"  />
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<br>
<h3 id="stickablearea-area2d-ノード">StickableArea (Area2D) ノード<a hidden class="anchor" aria-hidden="true" href="#stickablearea-area2d-ノード">#</a></h3>
<p>このノードは、ドロップが他のドロップと接触しているかどうかを検知するために利用する。プロパティの編集は不要だが、グループの追加が必要だ。</p>
<ol>
<li>ノードドック＞グループタブを開き、「Stickable」という名前のグループを作って追加する。これはドロップを指でなぞった時に「隣接している」 = 「つなげるか」かどうかを判定するのに重要だ。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img28.png" alt="Node dock - Groups - Stickable"  />
</li>
</ol>
<br>
<h3 id="collisionshape2d-ノード-1">CollisionShape2D ノード<a hidden class="anchor" aria-hidden="true" href="#collisionshape2d-ノード-1">#</a></h3>
<p>このノードは、親の「StickableArea」にコリジョン形状を提供する。隣接しているドロップを検知するのに利用する。隣り合っているドロップ同士の接触を検知させるために、ルートノード「Drop」のコリジョン形状よりやや大きめにする。</p>
<ol>
<li>プロパティ「Shape」に新規「CircleShape2D」リソースを適用する。</li>
<li>さらにそのリソースのプロパティ「Radius」の値を 18 に変更する。これで半径 18 px の円形のコリジョン形状ができた。2D ワークスペースで直感的にサイズ調整しても構わない。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img29.png" alt="CollisionShape2D - Shape - CircleShape2D"  />
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img30.png" alt="CollisionShape2D - 2DWrokSpace"  />
*このノードのコリジョン形状は一番外側の円</li>
</ol>
<br>
<p>以上で各ノードの編集は完了だ。</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2 id="drop-シーンをスクリプトで制御する">Drop シーンをスクリプトで制御する<a hidden class="anchor" aria-hidden="true" href="#drop-シーンをスクリプトで制御する">#</a></h2>
<p>それではルートノード「Drop」に新規スクリプトをアタッチしよう。ファイルパスを「res://Drops/Drop.gd」としてスクリプトファイルを作成する。</p>
<p>ひとまずスクリプトを以下のように編集してほしい。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">### Drop.gd ###</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">RigidBody2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Drop シーンを継承するシーンにそれぞれの色の名前を割り当てるプロパティ</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 今はブランクの文字列</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">var</span> color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 隣接するドロップを入れる配列を stuck_drop と定義</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> stuck_drops <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># AnimationPlayerノードへの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Drop のインスタンスを World シーンに追加してから利用する</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> anim_player <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimationPlayer</span>
</span></span></code></pre></div><br>
<p>次に、「StickableArea」ノードの Area2D ノードのシグナルを利用する。隣接するドロップと接触した時に発信されるシグナル「area_entered」と、接触していたドロップが離れた時に発信されるシグナル「area_exited」をスクリプトに接続しよう。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img31.png" alt="StickableArea - signals"  />
</p>
<p>それぞれのシグナルを接続したときに生成されるメソッドを以下のように編集してほしい。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">### Drop.gd ###</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># StickableArea に他の area (Area2D クラスのノード)が当たった時に呼ばれるメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_StickableArea_area_entered(area):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># もし当たった area が Stickable グループのノードだったら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> area<span style="color:#f92672">.</span>is_in_group(<span style="color:#e6db74">&#34;Stickable&#34;</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># その親ノードを drop と定義</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> drop <span style="color:#f92672">=</span> area<span style="color:#f92672">.</span>get_parent()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 配列 stuck_drops に drop を追加</span>
</span></span><span style="display:flex;"><span>		stuck_drops<span style="color:#f92672">.</span>append(drop)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># StickableArea から他の area (Area2D クラスのノード) が離れた時に呼ばれるメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_StickableArea_area_exited(area):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># もし当たった area が Stickable グループのノードだったら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> area<span style="color:#f92672">.</span>is_in_group(<span style="color:#e6db74">&#34;Stickable&#34;</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># その親ノードを drop と定義</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> drop <span style="color:#f92672">=</span> area<span style="color:#f92672">.</span>get_parent()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 配列 stuck_drops の中の drop の index を調べる</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> index <span style="color:#f92672">=</span> stuck_drops<span style="color:#f92672">.</span>find(drop)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 配列 stuck_drops から index に該当する要素（隣接していた Drop）を削除</span>
</span></span><span style="display:flex;"><span>		stuck_drops<span style="color:#f92672">.</span>remove(index)
</span></span></code></pre></div><br>
<p>これで「Drop.gd」の編集は完了だ。</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="drop-シーンを継承したシーンを作る">Drop シーンを継承したシーンを作る<a hidden class="anchor" aria-hidden="true" href="#drop-シーンを継承したシーンを作る">#</a></h1>
<p>さっき作った「Drop」シーンはこれから作るシーンの雛形だ。これから「Drop」シーンを継承したシーンをドロップの色の数だけ作成する。ドロップの色は、青、緑、オレンジ、赤、黄の 5 色だ。まずは<strong>青</strong>のドロップを例に手順を進めてみよう。</p>
<ol>
<li>「シーン」メニュー＞「新しい継承シーン」を選択する。</li>
<li>継承元のシーンとして「Drops.tscn」を選択する。</li>
<li>シーンが生成されたら、ルートノードの名前を「Blue」に変更する。<br>
*このルートノードの名前はそれぞれのドロップの色に合わせること。</li>
<li>シーンを一旦保存しておこう。ファイルパスを「res://Drops/BlueDrop.tscn」として保存する。</li>
<li>シーンツリードックでルートノード「BlueDrop」を選択した状態で、インスペクターで Script Variables の「Color」の値を「Blue」とする。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img32.png" alt="BlueDrop - Color property"  />
</li>
<li>シーンツリードックで「Sprite」ノードを選択する。エディタ下部の「テクスチャ領域」パネルを開き、<strong>青いエイリアン</strong>のテクスチャ２つ分を選択しよう。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img33.png" alt="Sprite - Texture Region"  />
</li>
</ol>
<p>以上で、「BlueDrop」シーンは完成だ。同じ手順で残りの 4 色のシーンも作成してほしい。なお、シーンのルートノードの名前とそのプロパティ「Color」の値は以下の通りだ。</p>
<ul>
<li>ルートノード: GreenDrop / Color: Green</li>
<li>ルートノード: OrangeDrop / Color: Orange</li>
<li>ルートノード: RedDrop / Color: Red</li>
<li>ルートノード: YellowDrop / Color: Yellow</li>
</ul>
<p>全部で 5 色のドロップの継承シーンができたら作業完了だ。</p>
<br>
<hr>
<h1 id="world-シーンをスクリプトで制御する">World シーンをスクリプトで制御する<a hidden class="anchor" aria-hidden="true" href="#world-シーンをスクリプトで制御する">#</a></h1>
<p>いよいよ今回のチュートリアルも終盤に差し掛かった。では「World」シーンのルートノードにスクリプトをアタッチしよう。ファイルパスは「res://World/World.tscn」として作成する。</p>
<p>スクリプトエディタが開いたら、まずは以下の通りにプロパティを定義する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">### World.gd ###</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Node2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># preloadした5色のドロップシーンを要素にもつ配列を drop_scenes として定義</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> drop_scenes <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Drops/BlueDrop.tscn&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Drops/GreenDrop.tscn&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Drops/OrangeDrop.tscn&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Drops/RedDrop.tscn&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Drops/YellowDrop.tscn&#34;</span>)
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># つなげて消せる最小ドロップ数</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> (<span style="color:#a6e22e">int</span>) <span style="color:#66d9ef">var</span> min_erasable <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># プレイ画面に表示される最大ドロップ数</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> (<span style="color:#a6e22e">int</span>) <span style="color:#66d9ef">var</span> max_drops <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 現在ゲームをプレイ中の場合は true になる</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> is_playing <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 指を画面に当てたまま or マウス左クリックを押したままの場合 true になる</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> is_holding <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 現在指またはマウスカーソルが当たっているドロップの参照用</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> pointed_drop
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 現在つなげているドロップの色</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> active_color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ホールド中の（なぞってつながっている）ドロップのリスト用の配列</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> held_drops <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Spawnerノードへの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> spawner <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>SpawnPath<span style="color:#f92672">/</span>Spawner
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Dropsノードへの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> drops <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>Drops
</span></span><span style="display:flex;"><span><span style="color:#75715e"># DropsLineノードへの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> drops_line <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>DropsLine
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Pointerノードへの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> pointer <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>Pointer
</span></span></code></pre></div><br>
<p>次にゲーム開始直後に画面外上部からドロップが最大ドロップ数の 50 個落ちてくるようコーディングしていこう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">### World.gd ###</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># World シーンのノードが全て読み込まれたら呼ばれるメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ランダム系のメソッドの出力結果を毎回ランダムにしてくれる組み込みメソッド</span>
</span></span><span style="display:flex;"><span>	randomize()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># max_drops の数 (50) だけループする</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> _i <span style="color:#f92672">in</span> range(max_drops):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ドロップを生成するメソッド（このあと定義）を呼び出す</span>
</span></span><span style="display:flex;"><span>		spawn_drop()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 一つのドロップが生成されたら0.025秒待機して次のドロップ生成</span>
</span></span><span style="display:flex;"><span>		yield(get_tree()<span style="color:#f92672">.</span>create_timer(<span style="color:#ae81ff">0.025</span>), <span style="color:#e6db74">&#34;timeout&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ドロップを生成するメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> spawn_drop():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 配列 drop_scenes からランダムで選ばれた色のドロップのシーンファイルの参照</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> drop_scene <span style="color:#f92672">=</span> drop_scenes[randi() <span style="color:#f92672">%</span> drop_scenes<span style="color:#f92672">.</span>size()]
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 選択された色のドロップシーンをインスタンス化する</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> drop <span style="color:#f92672">=</span> drop_scene<span style="color:#f92672">.</span>instance()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ドロップのインスタンスの位置を Spawner ノードの位置と同じにする</span>
</span></span><span style="display:flex;"><span>	drop<span style="color:#f92672">.</span>position <span style="color:#f92672">=</span> spawner<span style="color:#f92672">.</span>global_position
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ドロップのインスタンスを World シーンに追加する</span>
</span></span><span style="display:flex;"><span>	drops<span style="color:#f92672">.</span>add_child(drop)
</span></span></code></pre></div><p>それではプロジェクトを実行して、ゲーム開始時のランダムに決定された色のドロップが50個降ってくる挙動を見ておこう。なお、初めてプロジェクトを実行する際はメインシーンを「World.tscn」としておこう。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img34.gif" alt="run project"  />
</p>
<br>
<p>「Pointer (Area2D)」ノードの位置は、指、またはマウスカーソルの位置に追随させるようにこのあとコーディングするのだが、その時、指やマウスカーソルが「Drop」インスタンスの「PointableArea (Area2D)」と重なった時とそのあと離れた時に「Pointer」ノードがそれを検知してシグナルを発信する。それを利用して、ドロップをなぞった時の処理をコーディングしていこう。</p>
<p>シーンツリードックで「Pointer」を選択し、ノードドック＞シグナルタブにて、シグナル「area_entered(area: Area2D)」とシグナル「area_exited(area: Area2D)」をスクリプトに接続する。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img35.png" alt="connect signals"  />
</p>
<p>自動的に生成されたメソッドを以下のように編集しよう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">### World.gd ###</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Pointer ノードが他の area(Area2D オブジェクト)に触れたら呼ばれるメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Pointer_area_entered(area):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># area が「Pointable」グループのノードだったら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> area<span style="color:#f92672">.</span>is_in_group(<span style="color:#e6db74">&#34;Pointable&#34;</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># pointed_drop に area の親ノード（Drop ノード）の参照を渡す</span>
</span></span><span style="display:flex;"><span>		pointed_drop <span style="color:#f92672">=</span> area<span style="color:#f92672">.</span>get_parent()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ホールド中のドロップが 0 ではなく..</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># かつホールド中の最後のドロップが pointed_drop と隣接していたら</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> held_drops<span style="color:#f92672">.</span>empty() <span style="color:#f92672">and</span> held_drops[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">in</span> pointed_drop<span style="color:#f92672">.</span>stuck_drops:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># ドロップのつながりを更新するメソッドを呼ぶ（あとで定義）</span>
</span></span><span style="display:flex;"><span>			update_drops_connection()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Pointer ノードが触れていた area(Area2D オブジェクト)が離れたら呼ばれるメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Pointer_area_exited(area):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># area が「Pointable」グループのノードだったら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> area<span style="color:#f92672">.</span>is_in_group(<span style="color:#e6db74">&#34;Pointable&#34;</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># pointed_drop を null にする</span>
</span></span><span style="display:flex;"><span>		pointed_drop <span style="color:#f92672">=</span> null
</span></span></code></pre></div><br>
<p>次は組み込み関数<code>_process</code>を利用して、毎フレーム（60FPS）呼び出したいメソッドを実行する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">### World.gd ###</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 組み込み関数: 60FPSで呼び出される</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _process(_delta):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># DropsLine　ノードの Points プロパティを更新する</span>
</span></span><span style="display:flex;"><span>	update_drops_line()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 指またはマウスカーソルの操作を受けつる</span>
</span></span><span style="display:flex;"><span>	get_input()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># DropsLine ノードの Points プロパティを更新するメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ドロップが転がったり落ちたりして位置が変わるため</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> update_drops_line():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ホールド中のドロップが 1 つでもある場合</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> held_drops<span style="color:#f92672">.</span>empty():
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># テンポラリのVector2配列を作成</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> temp_array <span style="color:#f92672">=</span> PoolVector2Array()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ホールド中のドロップに対してループ</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> drop <span style="color:#f92672">in</span> held_drops:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># テンポラリの配列にホールド中のドロップの位置を追加</span>
</span></span><span style="display:flex;"><span>			temp_array<span style="color:#f92672">.</span>append(drop<span style="color:#f92672">.</span>position)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># DropsLine ノードの points プロパティを現在ホールド中のドロップの位置に更新</span>
</span></span><span style="display:flex;"><span>		drops_line<span style="color:#f92672">.</span>points <span style="color:#f92672">=</span> temp_array
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 指またはマウスの入力があったら処理するメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> get_input():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Pointer ノードの位置を常に指またはマウスカーソルの位置にする</span>
</span></span><span style="display:flex;"><span>	pointer<span style="color:#f92672">.</span>position <span style="color:#f92672">=</span> get_global_mouse_position()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># もし指で画面を押したら、もしくはマウス左ボタンを押したら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_just_pressed(<span style="color:#e6db74">&#34;tap&#34;</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ドロップをホールドするメソッド（あとで定義）を呼び出す</span>
</span></span><span style="display:flex;"><span>		hold_drop()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ホールド中のドロップのつながりを更新するメソッド（あとで定義）を呼び出す</span>
</span></span><span style="display:flex;"><span>		update_drops_connection()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># もし指が画面から離れたら、もしくはマウス左ボタンが上がったら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_just_released(<span style="color:#e6db74">&#34;tap&#34;</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ホールド中のドロップを消すメソッド（あとで定義）を呼び出す</span>
</span></span><span style="display:flex;"><span>		erase_drops()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ホールドを解除するメソッド（あとで定義）を呼び出す</span>
</span></span><span style="display:flex;"><span>		release_drops()
</span></span></code></pre></div><p>上のコードで定義したメソッド<code>get_input</code>内で呼び出している以下のメソッドはこの後順番に定義していく。</p>
<ul>
<li><code>hold_drop</code></li>
<li><code>update_drops_connection</code></li>
<li><code>erase_drops</code></li>
<li><code>release_drops</code></li>
</ul>
<br>
<p>まずはドロップを押さえた時に呼び出されるメソッド<code>hold_drop</code>と<code>update_drops_connection</code>を定義していこう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">### World.gd ###</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ドロップをホールド中にするメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> hold_drop():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># もし指またはマウスカーソルがドロップに触れていたら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> pointed_drop:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ホールド中とする</span>
</span></span><span style="display:flex;"><span>		is_holding <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ドロップのつながりを更新するメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> update_drops_connection():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># もしドロップをホールド中かつ..</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 指またはマウスカーソルがドロップに重なっていたら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> is_holding <span style="color:#f92672">and</span> pointed_drop:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># もしホールド中のドロップが 0 だったら</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> held_drops<span style="color:#f92672">.</span>empty():
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># これからつなぐドロップの色を現在指または..</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># マウスカーソルが触れているドロップの色とする</span>
</span></span><span style="display:flex;"><span>			active_color <span style="color:#f92672">=</span> pointed_drop<span style="color:#f92672">.</span>color
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># ドロップをつなぐメソッド（あとで定義）を呼ぶ</span>
</span></span><span style="display:flex;"><span>			connect_drop()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># もし現在指またはマウスカーソルが触れているドロップの色が..</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># つないでいるドロップの色と同じだったら</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">elif</span> pointed_drop<span style="color:#f92672">.</span>color <span style="color:#f92672">==</span> active_color:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># ホールド中のドロップの数が 2 以上かつ現在触れている..</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># ドロップがホールド中のドロップの最後から2番目と同じだったら</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> held_drops<span style="color:#f92672">.</span>size() <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">and</span> pointed_drop <span style="color:#f92672">==</span> held_drops[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]:
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># つながりを解除するメソッド（あとで定義）を呼ぶ</span>
</span></span><span style="display:flex;"><span>				disconnect_drop()
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># ホールド中のドロップの中に現在指またはマウスカーソルが..</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 触れているドロップがなければ</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">elif</span> <span style="color:#f92672">not</span> pointed_drop <span style="color:#f92672">in</span> held_drops:
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># ドロップをつなぐメソッド（あとで定義）を呼ぶ</span>
</span></span><span style="display:flex;"><span>				connect_drop()
</span></span></code></pre></div><p>ここで定義したメソッド<code>update_drops_connection</code>内を見ると、さらに未定義の<code>connect_drop</code>メソッドと<code>disconnect_drop</code>メソッドが呼ばれている。</p>
<p>続けてこれらのメソッドを定義しよう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">### World.gd ###</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ドロップをつなぐメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> connect_drop():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 現在指またはマウスカーソルが触れているドロップのAnimationPlayerで..</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># アニメーション&#34;flash&#34;を再生する</span>
</span></span><span style="display:flex;"><span>	pointed_drop<span style="color:#f92672">.</span>anim_player<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;flash&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ホールド中のドロップリストに現在触れているドロップを追加する</span>
</span></span><span style="display:flex;"><span>	held_drops<span style="color:#f92672">.</span>append(pointed_drop)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># DropsLine ノードの Points プロパティに現在触れているドロップの位置を追加する</span>
</span></span><span style="display:flex;"><span>	drops_line<span style="color:#f92672">.</span>add_point(pointed_drop<span style="color:#f92672">.</span>position)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ドロップのつながりを解除するメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> disconnect_drop():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># ホールド中のドロップのリストの最後のドロップを canceled_drop とする</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> canceled_drop <span style="color:#f92672">=</span> held_drops<span style="color:#f92672">.</span>pop_back()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># canceled_drop の AnimationPlayer でアニメーション（&#34;flash&#34;）を停止する</span>
</span></span><span style="display:flex;"><span>	canceled_drop<span style="color:#f92672">.</span>anim_player<span style="color:#f92672">.</span>stop()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># canceled_drop の AnimationPlayer でアニメーション（&#34;idle&#34;）を再生する</span>
</span></span><span style="display:flex;"><span>	canceled_drop<span style="color:#f92672">.</span>anim_player<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;idle&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># DropsLineノードの Points プロパティから最後の点を削除する</span>
</span></span><span style="display:flex;"><span>	drops_line<span style="color:#f92672">.</span>remove_point(drops_line<span style="color:#f92672">.</span>get_point_count() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span></code></pre></div><br>
<p><code>get_input</code>メソッド内で、指が画面から離れたら、またはマウス左ボタンが上がった時に呼び出される２つのメソッド<code>erase_drops</code>、<code>release_drops</code>をこれから定義していく。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">### World.gd ###</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ドロップを消すメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> erase_drops():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># もしホールド中のドロップの数がつなげて消せる最小ドロップ数未満だったら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> held_drops<span style="color:#f92672">.</span>size() <span style="color:#f92672">&lt;</span> min_erasable:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># メソッドを即時終了する</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ホールド中のドロップの配列を変数 erased の値として複製</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> erased <span style="color:#f92672">=</span> held_drops<span style="color:#f92672">.</span>duplicate()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 配列 erased の要素に対してループ処理</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> drop <span style="color:#f92672">in</span> erased:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 配列 erased に含まれるドロップを解放する</span>
</span></span><span style="display:flex;"><span>		drop<span style="color:#f92672">.</span>queue_free()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 消した分、新しいドロップを生成する</span>
</span></span><span style="display:flex;"><span>		spawn_drop()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 0.1 秒待機（それから次のループ）</span>
</span></span><span style="display:flex;"><span>		yield(get_tree()<span style="color:#f92672">.</span>create_timer(<span style="color:#ae81ff">0.1</span>), <span style="color:#e6db74">&#34;timeout&#34;</span>)	
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ドロップからホールドを解放するメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> release_drops(): 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ホールド中ステータスを解除</span>
</span></span><span style="display:flex;"><span>	is_holding <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ホールド中のドロップの配列の要素対してループ</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> drop <span style="color:#f92672">in</span> held_drops:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 配列から取り出したドロップの AnimationPlayer で..</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># アニメーションを停止する</span>
</span></span><span style="display:flex;"><span>		drop<span style="color:#f92672">.</span>anim_player<span style="color:#f92672">.</span>stop()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 配列から取り出したドロップの AnimationPlayer で..</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># アニメーション&#34;idle&#34;を再生する</span>
</span></span><span style="display:flex;"><span>		drop<span style="color:#f92672">.</span>anim_player<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;idle&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ホールド中のドロップの配列を空っぽにする</span>
</span></span><span style="display:flex;"><span>	held_drops<span style="color:#f92672">.</span>clear()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># DropsLine ノードの Points プロパティを空っぽにする</span>
</span></span><span style="display:flex;"><span>	drops_line<span style="color:#f92672">.</span>clear_points()
</span></span></code></pre></div><br>
<p>以上で「World.gd」スクリプトの編集は完了だ。</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="シーンを実行して動作確認する">シーンを実行して動作確認する<a hidden class="anchor" aria-hidden="true" href="#シーンを実行して動作確認する">#</a></h1>
<p>最後にシーンを実行して思った通りの動きが再現できるか確認してみよう。<br>
<img loading="lazy" src="/images/tutorials/gd0011_connect_colors/img36.gif" alt="run project finally"  />
</p>
<p>以下について想定通りであることが確認できただろうか。</p>
<ul>
<li>マウスカーソルがドロップの中央付近にある状態でマウス左ボタンを押すとドロップがホールド状態になり「flash」アニメーションが再生される</li>
<li>マウス左ボタンを押したまま、隣接するドロップをなぞっていくと「DropsLine」の線がつながっていく</li>
<li>なぞってきたドロップを戻ってなぞり直すとホールドが解除され「idle」アニメーションの再生に戻る</li>
<li>なぞったドロップが3つ以上だとマウス左ボタンを離したときにホールド中のドロップが全て消える</li>
<li>なぞったドロップが3つ未満だとマウス左ボタンを離してもドロップは消えずホールド解除のみされる</li>
</ul>
<br>
<hr>
<h1 id="サンプルゲーム">サンプルゲーム<a hidden class="anchor" aria-hidden="true" href="#サンプルゲーム">#</a></h1>
<p>今回のチュートリアルで作成したプロジェクトをさらにブラッシュアップしたサンプルゲームを用意した。</p>

<video controls autoplay loop muted playsinline aria-label='Sample game demo' style='ZgotmplZ'>

    <source src="/images/tutorials/gd0011_connect_colors/img37.mp4" type="video/mp4">
    
    Your browser does not support the video tag.
</video>

<br>
<p>プロジェクトファイルは、<a href="https://github.com/msnsk/ConnectColors.git" target="_blank">GitHubリポジトリ</a>
に置いているので、そこから .zip ファイルをダウンロードしていただき、「Sample」フォルダ内の「project.godot」ファイルを Godot Engine でインポートすれば確認していただけるはずだ。</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="おわりに">おわりに<a hidden class="anchor" aria-hidden="true" href="#おわりに">#</a></h1>
<p>今回のチュートリアルでは同じ色をなぞって消すパズルゲームを作った。ゲームの中毒性を感じずにはいられない種類のゲームだ。最後に作成におけるポイントをまとめておこう。</p>
<ul>
<li>ドロップは RigidBody2D にして、エンジンに物理演算を任せる。</li>
<li>ドロップに、指やカーソルを検知するための Area2D クラスのノードと、隣接するドロップを検知するための Area2D クラスのノードを追加して、それらのシグナルを利用する。</li>
<li>指やマウスカーソルには Area2D クラスのノードを常に追随させ、ドロップとの接触にはこのノードのシグナルを利用する。</li>
</ul>
<br>
<hr>
<h1 id="リンク">リンク<a hidden class="anchor" aria-hidden="true" href="#リンク">#</a></h1>
<ul>
<li><a href="https://www.kenney.nl/assets" target="_blank">KENNEY</a>
</li>
<li><a href="https://docs.godotengine.org/ja/stable/tutorials/physics/physics_introduction.html" target="_blank">Godot Docs: 物理の紹介</a>
</li>
<li><a href="https://docs.godotengine.org/ja/stable/classes/class_rigidbody2d.html" target="_blank">Godot Docs: RigidBody2D</a>
</li>
<li><a href="https://docs.godotengine.org/ja/stable/tutorials/physics/using_area_2d.html" target="_blank">Godot Docs: Area2Dの使用</a>
</li>
<li><a href="https://docs.godotengine.org/ja/stable/classes/class_area2d.html" target="_blank">Godot Docs: Area2D</a>
</li>
<li><a href="https://docs.godotengine.org/ja/stable/classes/class_collisionshape2d.html" target="_blank">Godot Docs: CollisionShape2D</a>
</li>
<li><a href="https://docs.godotengine.org/ja/stable/classes/class_collisionpolygon2d.html" target="_blank">Godot Docs: CollisionPolygon2D</a>
</li>
<li><a href="https://docs.godotengine.org/ja/stable/classes/class_path2d.html" target="_blank">Godot Docs: Path2D</a>
</li>
<li><a href="https://docs.godotengine.org/ja/stable/classes/class_pathfollow2d.html" target="_blank">Godot Docs: PathFollow2D</a>
</li>
<li><a href="https://zenn.dev/syun77/articles/0ade855311ecb8" target="_blank">Zenn:【Godot Engine】Path2D/PathFollow2Dを使って決まった経路で動かす方法 | syun77 </a>
</li>
<li><a href="https://docs.godotengine.org/ja/stable/classes/class_line2d.html" target="_blank">Godot Docs: Line2D</a>
</li>
<li><a href="https://qiita.com/2dgames_jp/items/391f5d4e4b1a345b8029" target="_blank">Qiita:【Godot】Line2Dを使ったトレイルの実装方法 | @2dgames_jp</a>
</li>
<li><a href="https://docs.godotengine.org/ja/stable/tutorials/animation/introduction.html" target="_blank">Godot Docs: Introduction to the animation features</a>
</li>
<li><a href="https://docs.godotengine.org/ja/stable/classes/class_animationplayer.html" target="_blank">Godot Docs: AnimationPlayer</a>
</li>
</ul>
<p><strong>UPDATE</strong><br>
2022/06/20 変数<code>holded_drops</code>のスペルを<code>held_drops</code>に修正（GitHubリポジトリ上のコードも修正）</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://www.peanuts-code.com/ja/tags/godot/">Godot</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/godotengine/">GodotEngine</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%82%B2%E3%83%BC%E3%83%A0%E9%96%8B%E7%99%BA/">ゲーム開発</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB/">チュートリアル</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%83%91%E3%82%BA%E3%83%AB%E3%82%B2%E3%83%BC%E3%83%A0/">パズルゲーム</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%83%A2%E3%83%90%E3%82%A4%E3%83%AB%E3%82%B2%E3%83%BC%E3%83%A0/">モバイルゲーム</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E5%90%8C%E3%81%98%E8%89%B2%E3%82%92%E3%81%A4%E3%81%AA%E3%81%92%E3%81%A6%E6%B6%88%E3%81%99%E3%82%B2%E3%83%BC%E3%83%A0/">同じ色をつなげて消すゲーム</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%81%AA%E3%81%9E%E3%81%A3%E3%81%A6%E6%B6%88%E3%81%99%E3%82%B2%E3%83%BC%E3%83%A0/">なぞって消すゲーム</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%83%9E%E3%83%83%E3%83%813/">マッチ3</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://www.peanuts-code.com/ja/tutorials/gd0012_match3/">
    <span class="title">« 前のページ</span>
    <br>
    <span>Godot で作るマッチ 3 パズルゲーム</span>
  </a>
  <a class="next" href="https://www.peanuts-code.com/ja/tutorials/gd0010_2d_grid_based_movement/">
    <span class="title">次のページ »</span>
    <br>
    <span>Godot で作る 2D グリッドベース移動</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作る同じ色をつなげて消すパズルゲーム on twitter"
        href="https://twitter.com/intent/tweet/?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e5%90%8c%e3%81%98%e8%89%b2%e3%82%92%e3%81%a4%e3%81%aa%e3%81%92%e3%81%a6%e6%b6%88%e3%81%99%e3%83%91%e3%82%ba%e3%83%ab%e3%82%b2%e3%83%bc%e3%83%a0&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0011_connect_colors%2f&amp;hashtags=Godot%2cGodotEngine%2c%e3%82%b2%e3%83%bc%e3%83%a0%e9%96%8b%e7%99%ba%2c%e3%83%81%e3%83%a5%e3%83%bc%e3%83%88%e3%83%aa%e3%82%a2%e3%83%ab%2c%e3%83%91%e3%82%ba%e3%83%ab%e3%82%b2%e3%83%bc%e3%83%a0%2c%e3%83%a2%e3%83%90%e3%82%a4%e3%83%ab%e3%82%b2%e3%83%bc%e3%83%a0%2c%e5%90%8c%e3%81%98%e8%89%b2%e3%82%92%e3%81%a4%e3%81%aa%e3%81%92%e3%81%a6%e6%b6%88%e3%81%99%e3%82%b2%e3%83%bc%e3%83%a0%2c%e3%81%aa%e3%81%9e%e3%81%a3%e3%81%a6%e6%b6%88%e3%81%99%e3%82%b2%e3%83%bc%e3%83%a0%2c%e3%83%9e%e3%83%83%e3%83%813">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作る同じ色をつなげて消すパズルゲーム on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0011_connect_colors%2f&amp;title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e5%90%8c%e3%81%98%e8%89%b2%e3%82%92%e3%81%a4%e3%81%aa%e3%81%92%e3%81%a6%e6%b6%88%e3%81%99%e3%83%91%e3%82%ba%e3%83%ab%e3%82%b2%e3%83%bc%e3%83%a0&amp;summary=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e5%90%8c%e3%81%98%e8%89%b2%e3%82%92%e3%81%a4%e3%81%aa%e3%81%92%e3%81%a6%e6%b6%88%e3%81%99%e3%83%91%e3%82%ba%e3%83%ab%e3%82%b2%e3%83%bc%e3%83%a0&amp;source=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0011_connect_colors%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作る同じ色をつなげて消すパズルゲーム on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0011_connect_colors%2f&title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e5%90%8c%e3%81%98%e8%89%b2%e3%82%92%e3%81%a4%e3%81%aa%e3%81%92%e3%81%a6%e6%b6%88%e3%81%99%e3%83%91%e3%82%ba%e3%83%ab%e3%82%b2%e3%83%bc%e3%83%a0">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作る同じ色をつなげて消すパズルゲーム on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0011_connect_colors%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作る同じ色をつなげて消すパズルゲーム on whatsapp"
        href="https://api.whatsapp.com/send?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e5%90%8c%e3%81%98%e8%89%b2%e3%82%92%e3%81%a4%e3%81%aa%e3%81%92%e3%81%a6%e6%b6%88%e3%81%99%e3%83%91%e3%82%ba%e3%83%ab%e3%82%b2%e3%83%bc%e3%83%a0%20-%20https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0011_connect_colors%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作る同じ色をつなげて消すパズルゲーム on telegram"
        href="https://telegram.me/share/url?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e5%90%8c%e3%81%98%e8%89%b2%e3%82%92%e3%81%a4%e3%81%aa%e3%81%92%e3%81%a6%e6%b6%88%e3%81%99%e3%83%91%e3%82%ba%e3%83%ab%e3%82%b2%e3%83%bc%e3%83%a0&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0011_connect_colors%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://www.peanuts-code.com/ja/">Peanuts Code</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
