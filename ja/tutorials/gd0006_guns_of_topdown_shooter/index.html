<!DOCTYPE html>
<html lang="ja" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Godot で作るトップダウンシューティングの 4 種類の銃 | Peanuts Code</title>
<meta name="keywords" content="Godot, GodotEngine, ゲーム開発, チュートリアル, 2D, トップダウン, 見下ろし型, シューティング, 銃, 射撃" />
<meta name="description" content="このチュートリアルでは、2Dトップダウンシューティングゲーム（見下ろし型シューティングゲーム）で一般的によく登場する銃を4種類作っていく。具体的には以下の通りだ。
ハンドガン ショットガン マシンガン レーザーガン Environment このチュートリアルは以下の環境で作成しました。">
<meta name="author" content="Masanao Sako">
<link rel="canonical" href="https://www.peanuts-code.com/ja/tutorials/gd0006_guns_of_topdown_shooter/" />
<meta name="google-site-verification" content="XYZabc" />
<meta name="yandex-verification" content="XYZabc" />
<meta name="msvalidate.01" content="XYZabc" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.css" rel="preload stylesheet" as="style">
<link rel="preload" href="/images/logomark.png" as="image">
<link rel="icon" href="https://www.peanuts-code.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.peanuts-code.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.peanuts-code.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://www.peanuts-code.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://www.peanuts-code.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.100.2" />
<link rel="alternate" hreflang="ja" href="https://www.peanuts-code.com/ja/tutorials/gd0006_guns_of_topdown_shooter/" />
<link rel="alternate" hreflang="en" href="https://www.peanuts-code.com/en/tutorials/gd0006_guns_of_topdown_shooter/" />

<script async src="https://www.googletagmanager.com/gtag/js?id=G-DK0NK2RTTW"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-DK0NK2RTTW', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="Godot で作るトップダウンシューティングの 4 種類の銃" />
<meta property="og:description" content="このチュートリアルでは、2Dトップダウンシューティングゲーム（見下ろし型シューティングゲーム）で一般的によく登場する銃を4種類作っていく。具体的には以下の通りだ。
ハンドガン ショットガン マシンガン レーザーガン Environment このチュートリアルは以下の環境で作成しました。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.peanuts-code.com/ja/tutorials/gd0006_guns_of_topdown_shooter/" />
<meta property="og:image" content="https://www.peanuts-code.com/images/tutorials/gd0006_GunsOfTopdownShooter/img37.gif" /><meta property="article:section" content="tutorials" />
<meta property="article:published_time" content="2022-05-04T01:30:00&#43;09:00" />
<meta property="article:modified_time" content="2022-05-04T01:30:00&#43;09:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://www.peanuts-code.com/images/tutorials/gd0006_GunsOfTopdownShooter/img37.gif" />
<meta name="twitter:title" content="Godot で作るトップダウンシューティングの 4 種類の銃"/>
<meta name="twitter:description" content="このチュートリアルでは、2Dトップダウンシューティングゲーム（見下ろし型シューティングゲーム）で一般的によく登場する銃を4種類作っていく。具体的には以下の通りだ。
ハンドガン ショットガン マシンガン レーザーガン Environment このチュートリアルは以下の環境で作成しました。"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Tutorials",
      "item": "https://www.peanuts-code.com/ja/tutorials/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Godot で作るトップダウンシューティングの 4 種類の銃",
      "item": "https://www.peanuts-code.com/ja/tutorials/gd0006_guns_of_topdown_shooter/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Godot で作るトップダウンシューティングの 4 種類の銃",
  "name": "Godot で作るトップダウンシューティングの 4 種類の銃",
  "description": "このチュートリアルでは、2Dトップダウンシューティングゲーム（見下ろし型シューティングゲーム）で一般的によく登場する銃を4種類作っていく。具体的には以下の通りだ。\nハンドガン ショットガン マシンガン レーザーガン Environment このチュートリアルは以下の環境で作成しました。",
  "keywords": [
    "Godot", "GodotEngine", "ゲーム開発", "チュートリアル", "2D", "トップダウン", "見下ろし型", "シューティング", "銃", "射撃"
  ],
  "articleBody": "このチュートリアルでは、2Dトップダウンシューティングゲーム（見下ろし型シューティングゲーム）で一般的によく登場する銃を4種類作っていく。具体的には以下の通りだ。\nハンドガン ショットガン マシンガン レーザーガン Environment このチュートリアルは以下の環境で作成しました。\n・Godot のバージョン: 3.4.2\n・コンピュータのOS: macOS 11.6.5\nこのチュートリアルでは、銃の作成にフォーカスするため、以下は予め用意しておいた。\nゲームの世界\n「World.tscn」というシーンを用意し、見た目は「TileMap」ノードを追加して簡単に作成している。「TileMap」以外に「Player」ノードと複数の「Obstacle」ノードを追加している。これらについては個別のシーンを作成して、インスタンスを追加した形だ。\nプレイヤーキャラクター\n「Player.tscn」シーンとして作成した。ルートノードは「KinematicBody2D」クラスで、子ノードに「Sprite」と「CollisionShape2D」を追加している。「Sprite」のテクスチャは銃をもったスキンヘッドのヒットマンにしている。ヒットマンが持っている銃の画像の先端の位置に「Position2D」クラスの「Muzzle」という名前のノードを配置している。これは後ほど銃を撃った時の弾丸インスタンスの生成される位置を指定するのに使用する。\nインプットマップには以下のアクションを追加済みだ。プレイヤーキャラクターの移動や射撃、銃の切り替えに使用する。\nup: W キー・・・プレイヤーキャラクターを前進させる時に使う down: S キー・・・プレイヤーキャラクターを後退させる時に使う fire: マウス左ボタン・・・銃を撃つ switch: マウス右ボタン・・・銃の種類を切り替える\nちなみに、チュートリアルの内容を簡潔にするため、プレイヤーキャラクターのスプライトは銃の種類が変わっても同じままだ。見た目はハンドガンっぽいが、マシンガンにもレーザーガンにもなる、なんでもありの銃、ということにしておこう。 障害物\n「Obstacle.tscn」というシーンを作成している。Obstacle は日本語で障害物という意味だ。画面上にたくさん置いている茶色い木箱のオブジェクトは全てこのシーンのインスタンスである。ルートノードは「StaticBody2D」クラスにして、その子ノードとして「Sprite」と「CollisionShape2D」を追加している。\n解放された（破壊された）時に同じ場所に爆発を表現するための「Smoke.tscn」というシーンのインスタンスを生成するようにしている。「Smoke」シーンは「Particle2D」ノードのみで構成され、こちらもパーティクルの実行が完了したら自動的に解放されるようにしている。\nこれらの下準備によりプロジェクトを実行すると、以下のように世界とヒットマンと障害物が描画され、現時点でヒットマンは移動操作のみ可能な状態だ。\nこのチュートリアルのプロジェクトファイルは GitHubリポジトリ に置いている。.zipファイルをダウンロードしていただき、「Start」フォルダの方を Godot Engine にインポートしていただければ、上述の下準備だけ完了したプロジェクトから開始できる。また、取り急ぎ完成形を確認されたい場合は「End」フォルダの方をインポートしていただければOKだ。\nまた今回プロジェクトにインポート済みのアセットは全て KENNEY（ケニー） のサイトからダウンロードして利用させていただいたものだ。CC0の非常に使いやすいアセットを豊富にご用意いただいていることに感謝申し上げたい。特に今回ご利用させていただいたのは下記のアセットパックだ。\nTopdown Shooter Particle Pack それでは銃の実装を進めていこう。\n弾丸のシーンを作る まずは弾丸のシーンを作ろう。ハンドガン、ショットガン、マシンガンの3種類の銃でこの弾丸のシーンを使いまわせるので、先に作ってしまおうというわけだ。\n「シーン」メニュー＞「新規シーン」を選択する。 「ルートノードを生成」で「その他のノード」を選択する。 ルートノードに「Area2D」クラスを選択し、名前を「Bullet」に変更する。 ルートノードに「Line2D」クラスの子ノードを追加する。このチュートリアルでのこのノードの用途は弾丸の見た目を作るのに使用するのみだ。もちろん「Line2D」ではなく弾丸用のテクスチャ画像を用意して「Sprite」にしても良い。 ルートノードに「CollisionShape2D」クラスの子ノードを追加する。 ルートノードに「VisibilityNotifier2D」クラスの子ノードを追加する。銃で撃った弾が画面外に出てしまったら、それをシグナルで通知し、弾丸のインスタンスを解放するために使用する。 一旦シーンを保存しておく。保存先のフォルダは用意しているのでファイルパスが「res://Bullet/Bullet.tscn」になるようにして保存しよう。 ここまででシーンツリーは以下のようになったはずだ。\n続いて、各ノードを編集をしていく。\n2D ワークスペースで「Line2D」ノードのパスを描く。まず１つ目の点を (-5, 0) に、次に2つ目の点を (5, 0) に打って直線のパスを描く。インスペクターで直接入力しても良い。\nインスペクターにて「Line2D」ノードの「Width」プロパティの値を 6 にする。\n「Default Color」プロパティで弾丸の色を指定する。もちろんあなたの好みの色にしてもらって構わない。このチュートリアルではサンプルとして #708293 の青っぽいグレーの色を指定した。\n「Capping」＞「End Cap Mode」プロパティを「Round」にする。これでパスの終端（2つ目の点）が丸くなったはずだ。角張っているより、この方がずっと弾丸らしい。\n2D ワークスペース上で「Line2D」は以下のようになったはずだ。\n「CollisionShape2D」ノードの「Shape」プロパティに「新規 RectangleShape2D」リソースを割り当てる。 2D ワークスペースで「Line2D」で作成した弾丸の形状に合わせてコリジョン形状を調整する。ピッタリでも良いし、弾丸のサイズよりやや内側に小さく作っても良い。このサンプルではリソース「RectangleShape2D」の「Extents」プロパティの値が (5, 2) となっている。\n2D ワークスペースで「VisibilityNotifier2D」ノードの形状を調整する。この形状が画面外に出た時に発信されるシグナルを利用することになる。「CollisionShape2D」より x 軸方向で狭くして、2D ワークスペースで「CollisionShape2D」のコリジョン形状が確認しやすいようにした。y 軸方向の長さは同じにした。サイズはだいたいで構わない。このサンプルでは「Scale」プロパティの値は (0.5, 0.1) になっている。\nノードの追加とそれぞれのノードのプロパティ編集はここまでだ。\n続いてルートノードにスクリプトをアタッチしてコーディングしていく。\nルートノードにスクリプトをアタッチする。ファイルパスを「res://Bullet/Bullet.gd」として作成しよう。 「Bullet.gd」スクリプトを以下のように編集する。 ### Bullet.gd ### extends Area2D # 1秒あたりの弾丸のスピード var speed = 1500 # 弾丸が飛んでいく方向ベクトル：いったん(0, 0) var direction = Vector2.ZERO # 物理プロセス: 60回/秒呼ばれる組み込みメソッド func _physics_process(delta): # 弾丸の現在の回転角度からコサイン関数で弾丸が飛んでいく方向ベクトルの x の値を取得 direction.x = cos(global_rotation) # 弾丸の現在の回転角度からサイン関数で弾丸が飛んでいく方向ベクトルの y の値を取得 direction.y = sin(global_rotation) # 方向 × スピードで弾丸を毎フレーム移動させる translate(direction * speed * delta) 続いて、弾丸が物理ボディに当たったら発信されるシグナルをこのスクリプトに接続しよう。ルートノード「Bullet」が「Area2D」クラスなので、シーンツリードックでルートノード「Bullet」を選択し、そのままノードドック＞シグナルタブにて「body_entered(body)」シグナルを選択して「接続」をクリック（またはシグナルをダブルクリック）して接続する。\n接続できたら、自動的に追加されたメソッド_on_Bullet_body_enteredを以下のように編集しよう。\n### Bullet.gd ### # 弾丸が物理ボディに当たったら発信されるシグナルによって呼ばれるメソッド func _on_Bullet_body_entered(body): # もし当たったボディが障害物だったら if body.is_in_group(\"Obstacles\"): # 障害物のオブジェクトを解放する body.queue_free() # 弾丸インスタンスを解放する queue_free() ちなみに、事前に「Obstacle」シーンのルートノードは「Obstacles」というグループに追加済みだ。\nこれで、外壁に当たれば弾丸だけ解放され、障害物に当たれば、障害物と弾丸が解放されるようになった。\nさらにもう一つシグナルを追加する。「VisibilityNotifier2D」ノードが画面上から消えた時に発信されるシグナル「screen_exited()」を「Bullet.gd」スクリプトに接続しよう。手順は先程のシグナル接続と同様で、シーンツリードックで「VisibilityNotifier2D」ノードを選択し、ノードドック＞シグナルタブで「screen_exited()」シグナルを接続すればOKだ。\n接続できたら、自動的に追加されたメソッド_on_VisibilityNotifier2D_screen_exitedを以下のように編集しよう。\n### Bullet.gd ### # VisibilityNotifier2D ノードが画面外に出た時に発信されるシグナルで呼ばれるメソッド func _on_VisibilityNotifier2D_screen_exited(): # 弾丸インスタンスを解放する queue_free() これで画面外に出た時もその弾丸は解放されるようになった。\n以上で弾丸シーンは完成だ。\nハンドガンを実装する まずは一番簡単なハンドガン（拳銃）から撃てるようにしていこう。編集するスクリプトは「Player.gd」なのだが、すでに下準備の段階である程度のコードが出来上がっているので、そちらを先に確認しておこう。\nPlayer.gd のコードの下準備部分を見る ### Player.gd ### extends KinematicBody2D # プリロードした弾丸シーンの参照 const bullet_scn = preload(\"res://Bullet/Bullet.tscn\") # 現在使用中の銃（銃の種類ごとの数字の割り当ては以下のコメント） var gun = 0 # 0: hand # 1: shot # 2: machine # 3: lazer # プレイヤーキャラクターのスピード var speed = 200 # プレイヤーキャラクターの方向を伴うスピード var velocity = Vector2() # Muzzleノードの参照：銃口の位置 onready var muzzle = $Muzzle # シーンが読み込まれたら呼ばれるメソッド func _ready(): rotation_degrees = 270 # ゲーム開始時プレイヤーに上を向かせる # 物理プロセス：デフォルトで60回/秒呼ばれるメソッド func _physics_process(delta): move()　# プレイヤーキャラクターを移動させるメソッドを呼ぶ switch_gun() # 銃の種類を切り替えるメソッドを呼ぶ fire() # 銃を撃つメソッドを呼ぶ # プレイヤーキャラクターを移動させるメソッド func move(): look_at(get_global_mouse_position()) # キャラクターにマウスカーソルの方を向かせる velocity = Vector2() # ベロシティ（方向をもった速度）を(0, 0)に初期化 if Input.is_action_pressed(\"down\"): # Sキーを押したら... velocity = Vector2(-speed, 0).rotated(rotation) # ベロシティを後ろ向きにセット if Input.is_action_pressed(\"up\"): # Wキーを押したら... velocity = Vector2(speed, 0).rotated(rotation) # ベロシティを前向きにセット velocity = move_and_slide(velocity) # ベロシティに合わせて移動 # 銃の種類を切り替えるメソッド func switch_gun(): if Input.is_action_just_pressed(\"switch\"): # マウス右ボタンをクリックをした場合... if gun \u003c 3: # 銃の割り当て番号が 3 未満の場合は... gun += 1 # 割り当て番号を 1 増やす else: # 銃の割り当て番号が 3（最後の数字）の場合は... gun = 0 # 銃の割り当て番号を 0 にする print(\"Switched to \", gun) # デバッグ用に出力パネルに表示 # 銃を撃つメソッド func fire(): pass ということで、fireメソッドが今のところ中身が空っぽだ。これを次のように更新する。ちなみに fire は日本語で「（銃などを）撃つ」という意味だ。\n### Player.gd ### # 銃を撃つメソッド func fire(): # 銃の種類がハンドガン（0）かつマウス左ボタンをクリックした場合 if gun == 0 and Input.is_action_just_pressed(\"fire\"): # 弾丸インスタンスを生成して発射するメソッドを呼ぶ put_bullet() ここでput_bulletというメソッドが登場したが、これはこれから定義するメソッドだ。fireメソッドの下に以下のコードを追加して定義しよう。\n### Player.gd ### # 弾丸インスタンスを生成して発射するメソッド func put_bullet(): # 弾丸シーンのインスタンスの参照 var bullet = bullet_scn.instance() # 弾丸インスタンスの位置を銃口の位置と同じにする bullet.global_position = muzzle.global_position # 弾丸インスタンスの向きを Player の向きと同じにする bullet.rotation_degrees = rotation_degrees # Playerではなくその親ノード(World)の子にする get_parent().add_child(bullet) # Worldの2番目の子にする（タイルマップより前面、プレイヤーキャラクターより背面） get_parent().move_child(bullet, 1) これでハンドガンの実装ができたはずだ。プロジェクトを実行して確認してみよう。\nショットガンを実装する 次はショットガン（散弾銃）を実装する。トップダウンシューティングでのショットガンは、複数の弾丸がそれぞれ少しずつ角度の差をつけて前方に飛んでいくような仕様が一般的だろう。一回で広範囲の複数オブジェクトを一掃できる強力な銃だ。\nまずはfireメソッドから更新しよう。\n### Player.gd ### func fire(): # 銃の種類がハンドガン（0）かつマウス左ボタンをクリックした場合 if gun == 0 and Input.is_action_just_pressed(\"fire\"): put_bullet() # 銃の種類がショットガン（1）かつマウス左ボタンをクリックした場合 if gun == 1 and Input.is_action_just_pressed(\"fire\"): # 5回ループ for n in 5: # 弾丸インスタンスを生成して発射するメソッドの引数に値を渡して呼ぶ put_bullet(n) fireメソッドに２つ目のifブロックを追加した。プロパティgunの値が 1（ショットガンの割り当て番号）の場合にマウス左クリックでショットガンを撃てる。ifブロックの中身はforループで5回put_bulletを呼んでいるが、先程のハンドガンの時と違い、引数にループの周回数nを渡している。このメソッドが受け取った引数をどう処理するかは、このあとput_bulletメソッドを更新していくのでそこで確認しよう。\nfunc put_bullet(dir_offset = 2): # 引数dir_offsetを追加し、デフォルト値は2とした var bullet = bullet_scn.instance() bullet.global_position = muzzle.global_position bullet.rotation_degrees = rotation_degrees + (20 - 10 * dir_offset) # 更新 get_parent().add_child(bullet) get_parent().move_child(bullet, 1) 少しややこしいが、メソッドを呼ぶときに引数dir_offsetが未入力の場合、デフォルト値の2が自動的に引数に渡される。メソッドのブロック内3行目で弾丸の回転角度（向き）を指定しているのだが、例えばハンドガンの場合は、引数を指定せずにこのメソッドを呼んでいるので、引数にはデフォルト値の 2 が渡されて、20 - 10 * dir_offsetの部分が 0 になり、弾丸の角度はプレイヤーキャラクターの向いている角度と同じになる。\n一方、ショットガンの場合は、fireメソッド内のforループで5回このput_bulletメソッドが呼ばれており、ループの周回数 n（0からカウントして4まで）を引数dir_offsetに渡す形にしている。よって、ループが何周目かによって弾丸の角度は以下のように変化する。\nループ0周目：プレイヤーキャラクターの向いている角度 + 20° ループ1周目：プレイヤーキャラクターの向いている角度 + 10° ループ2周目：プレイヤーキャラクターの向いている角度 + 0° ループ3周目：プレイヤーキャラクターの向いている角度 + -10° ループ4周目：プレイヤーキャラクターの向いている角度 + -20° 上記のコードにより、5発の弾丸が「Player」が向いている方向に対して -20° から +20° の範囲で 10° ずつ異なる角度で同時に発射され、一度に広範囲を射撃できる銃の完成だ。なお、5 回程度のループであればコンピュータ上で一瞬で処理されるので、ほぼ同時にそれぞれの角度に弾丸が飛んでいくことになる。\nこれでショットガンの実装ができたはずだ。プロジェクトを実行して確認する際、マウス右ボタンを1回クリックしてショットガンに切り替えてから射撃してみよう。\nマシンガンを実装する 続いてマシンガン（機関銃）を実装していこう。マシンガンは一回いっかいトリガーを引いて射撃する銃とは違い、トリガーを引いている間、自動的に連続して射撃できる銃だ。ショットガンのようにワンショットで広範囲の射撃はできないが、高速で自動射撃するため、プレイヤーキャラクター自身が回転すればすぐに広範囲のオブジェクトを一掃できる。\nそれでは「Player.gd」スクリプトにマシンガン用のコードを追加していこう。\nまずはプロパティintervalを追加した。\n### Player.gd ### var speed = 200 var velocity = Vector2() # マシンガンの次の弾丸が発射されるまでのカウント var interval: int = 0 # 追加 マシンガンの仕様として、マウス左ボタンを押したままにすれば自動的に弾丸が連続して発射されるようにするのだが、_physics_processメソッドでfireメソッドを毎フレーム呼ぶと、弾丸と弾丸の間隔が短すぎて弾丸が止まって見える（以下のGIF画像参照）。\n物理プロセスの 60 FPS（毎秒60フレーム）というフレームレートはかなり早いのだ。そこで今回は、毎フレーム、intervalプロパティに +1 してそのカウントが 5 を超えたら弾丸を発射するようにする。つまり、5 フレームに 1 回発射する計算だ。\nそこを踏まえてfireメソッドにマシンガン用のifブロックを追加していこう。\nfunc fire(): # 銃の種類がハンドガン（0）かつマウス左ボタンをクリックした場合 if gun == 0 and Input.is_action_just_pressed(\"fire\"): put_bullet() # 銃の種類がショットガン（1）かつマウス左ボタンをクリックした場合 if gun == 1 and Input.is_action_just_pressed(\"fire\"): for n in 5: put_bullet(n) # 銃の種類がマシンガン（2）かつマウス左ボタンを押している場合 if gun == 2 and Input.is_action_pressed(\"fire\"): # 次の弾丸までのカウントを +1 する interval += 1 # カウントが5以上だったら if interval \u003e= 5: # カウントを0に戻して interval = 0 # 弾丸インスタンスを生成して発射するメソッドを引数なしで呼ぶ put_bullet() なお、ハンドガンとショットガンはInputクラスのis_action_just_pressedメソッドをifの条件に使っているが、こちらは左ボタンを押し続けても連続的には入力を検知されないようになっている。一方、マシンガンの場合はis_action_pressedメソッドを使っている。「just」がないだけで似たような名前のメソッドだが、こちらは押し続けていても毎フレーム入力が検知されるので、「押しっぱなし」の操作で利用するのに向いているのだ。\nこれでマシンガンの実装ができたはずだ。プロジェクトを実行して確認する際、マウス右ボタンを2回クリックしてマシンガンに切り替えてから射撃してみよう。\nレーザーのシーンを作る 最後はレーザーガン（光線銃）を実装するのだが、これは弾丸ではなくレーザーを発射するので、まず先にレーザーのシーンを作成していこう。パーティクルやアニメーションにより最低限のそれらしい演出も加える。\n「シーン」メニュー＞「新規シーン」を選択する。 「ルートノードを生成」で「その他のノード」を選択する。 ルートノードに「RayCast2D」クラスを選択し、名前を「Laser」に変更する。 ルートノードに「Line2D」クラスの子ノードを追加する。弾丸シーンと同様にレーザーの見た目を作るのに使用する。もちろん「Line2D」ではなくレーザー用のテクスチャ画像を用意して「Sprite」にする方法もあるが今回は不採用だ。 ルートノードに「Particle2D」クラスの子ノードを追加する。これはレーザーがオブジェクトに当たった箇所に粒子が泡立つような演出を追加するのに利用する。 ルートノードに「Tween」クラスの子ノードを追加する。これはレーザー発射時にレーザーの幅を 0 から一定の幅までゆっくり太くしていく演出と、レーザー終了時の逆の演出に利用する。 一旦シーンを保存しておく。保存先のフォルダは用意しているのでファイルパスが「res://Laser/Laser.tscn」になるようにして保存しよう。 ここまででシーンツリーは以下のようになったはずだ。\n続いて、各ノードを編集をしていく。\nインスペクターにて、ルートの「Laser」ノードの「Enabled」プロパティをオンにして、「Cast To」プロパティを (2000, 0) にする。\n2D ワークスペース上では以下のスクリーンショットのようになったはずだ。\n2D ワークスペースで「Line2D」ノードのパスを描く。まず１つ目の点を (0, 0) に、次に2つ目の点を (200, 0) に打って直線のパスを描く。インスペクターで直接入力しても良い。なお、２つ目の点はスクリプトで制御するので、y の値が 0 であれば、x の値は 2D ワークスペース上で確認しやすい適当な値で良い。\nインスペクターにて「Line2D」ノードの「Width」プロパティの値を 16 にする。\n「Default Color」プロパティでレーザーの色を指定する。もちろんあなたのイメージするレーザーの色にしてもらって構わない。このチュートリアルではサンプルとして #00b1ff の青色を指定した。\n2D ワークスペース上で「Line2D」はだいたい以下のようになったはずだ。\nここから「Particle2D」ノードのプロパティを以下のように編集する。プロパティが多いので大変だが頑張ろう。 まず先に「Textures」＞「Texture」プロパティにリソース「res://Assets/circle_05.png」を適用する。\n「Emitting」プロパティをオンにする。\n「Drawing」＞「Visibility Rect」プロパティの値を (x: -50, y: -50, w: 100, h: 100) にする。\n「Transform」＞「Position」プロパティを(x: 200, y: 0)にして、「Transform」＞「Scale」プロパティを (x: 0.1, y: 0.1) にする\n「Process Material」プロパティに 「新規 ParticleMaterial」を割り当てる。\nここからは今割り当てたリソース「ParticleMaterial」のプロパティを編集していく。\n「Emission Shape」＞\n「Shape」プロパティを「Box」に変更する。\n「Direction」＞\n「Direction」プロパティを (x: -1, y: 0, z: 0) にする。x軸の負の方向になる。 「Spread」プロパティを 60 にする。60°の幅でパーティクルが移動する。\n「Gravity」＞\n「Gravity」プロパティを (x: -300, y: 0, z: 0) にする。x軸の負の方向に重力を加える。\n「Initial Velocity」＞\n「Velocity」プロパティを 800 にする。速度を 800 とした。これはおそらく秒速だ。\n「Scale」＞\n「Scale Curve」プロパティに「新規 CurveTexture」を割り当てる。この次は割り当てたリソースのプロパティ編集だ。\n「CurveTexture」＞ 「Curve」プロパティに「新規 Curve」プロパティを割り当て、値の変化を以下のスクリーンショットのように２つの点を打ってカーブを作って設定する。\nこれで、時間経過とともにパーティクル１つひとつが次第に小さくなる。\n「Color」＞\n「Color Ramp」プロパティにリソース「新規 GradientTexture」を割り当てる。パーティクルが生成されて消失するまでに次第に色を変える演出のためだ。\n上で割り当てた「GradientTexture」リソースのプロパティにリソース「新規 Gradient」を割り当てる。\n「Gradient」リソースのプロパティを編集するが、ここはインスペクターで直感的にグラデーションの基準となる色を３つ指定する。\n一番左端：#001096（深い青色） 中央やや左寄りの位置：#2780ff（水色っぽい青色） 一番右端：#00ffffff（不透明度0の白色）\nすると、結果的に以下のようなリソースのプロパティになる。\n以上で、ノードの追加とそれぞれのノードのプロパティ編集は完了だ。\nここからはルートノード「Laser」にスクリプトをアタッチしてコーディングしていく。\nルートノード「Laser」にスクリプトをアタッチし、ファイルパスを「res://Laser/Laser.gd」として作成する。 「Laser.gd」スクリプトを以下のように編集する。 ### Laser.gd ### extends RayCast2D # Line2Dノードの参照 onready var line = $Line2D # Particle2Dノードの参照 onready var particle = $Particles2D # Tweenノードの参照 onready var tween = $Tween # シーンが読み込まれたら呼ばれるメソッド func _ready(): # Particle2DノードのEmittingプロパティをオフにする（インスペクターでオンにしたままの時の対策） particle.emitting = false # Tweenノードのアニメーションの設定：Line2DのWidthプロパティを0から10に0.5秒かけて変化させる tween.interpolate_property(line, \"width\", 0, 10.0, 0.5) # Tweenノードのアニメーション開始 tween.start() # 物理プロセス：60FPSで呼ばれるメソッド func _physics_process(delta): # もしRayCast2D（ルートノード）が物理ボディに当たっている場合は... if is_colliding(): # Line2Dノードの２つ目の点（終端）の位置をRayCast2Dが物理ボディに当たった位置に設定する line.set_point_position(1, to_local(get_collision_point())) # もし当たったのが障害物だったら... if get_collider().is_in_group(\"Obstacles\"): # 障害物インスタンスの参照 var obstacle = get_collider() # 障害物インスタンスのレーザー照射時間（irradiated_timeプロパティ）に delta の値を加算する obstacle.irradiated_time += delta # もしレーザー照射時間が最大照射時間（max_irradiationプロパティ）を超えたら... if obstacle.irradiated_time \u003e obstacle.max_irradiation: # 障害物インスタンスを解放する obstacle.queue_free() # もしRayCast2D（ルートノード）が物理ボディに当たっていない場合は... else: # Line2Dノードの２つ目の点（終端）の位置をRayCast2D（ルートノード）の先端の位置と同じにする line.set_point_position(1, cast_to) # Particle2Dノードの位置をLine2Dノードのパスの終端の位置と同じにする particle.position = line.points[1] # Particle2DノードのEmittingプロパティをオンにする（パーティクルのアニメーション開始） particle.emitting = true # マウス左ボタンから指を離した場合... if Input.is_action_just_released(\"fire\"): # レーザーを止めるメソッドを呼ぶ stop_laser() # レーザーを止めるメソッドを定義 func stop_laser(): # Tweenノードのアニメーションを設定：Line2DノードのWidthプロパティを10から0に0.5秒かけて変化させる tween.interpolate_property(line, \"width\", 10.0, 0, 0.5) # Tweenノードのアニメーション開始 tween.start() # Tweenノードのアニメーションが終わるまで待機 yield(tween, \"tween_completed\") # Tweenノードを解放する queue_free() このコードについて、少し補足しておく。下準備として作成済みの障害物のシーン「Obstacle.tscn」のルートノードにアタッチしている「Obstacle.gd」スクリプトにて、irradiated_timeとmax_irradiationという２つのプロパティを定義している。前者はレーザーの照射時間、後者はレーザーの最大照射時間として用意したものだ。レーザーが当たってすぐに障害物が破壊されるより、一定時間（最大照射時間：0.2秒）照射されたら破壊される設定の方がレーザーっぽさが出るのではないか、という考えからこのような仕組みを作った次第だ。\nこれでレーザーシーンが用意できた。次は「Player」シーンを更新して、レーザーを発射できるようにしていく。\nレーザーガンを実装する レーザーシーンができたので、レーザーガンを実装していこう。レーザーガンの仕様として、まず発射時に、先に作成した「Laser.tscn」のインスタンスを「Player」シーンに追加するようにしていく。プレイヤーの操作はマシンガンと同様に、マウス左ボタンを押したままにしている間は発射し続けられるようにする。一方、ボタンから指を離すと、先にコーディングした「Laser.gd」スクリプトにより、レーザーが消えて、インスタンスも解放される。\nそれでは具体的に「Player.gd」スクリプトを編集していこう。まずはfireメソッドの 4 つ目のifブロックを以下のように追加してほしい。\n### Player.gd ### func fire(): # 銃の種類がハンドガン（0）かつマウス左ボタンをクリックした場合 if gun == 0 and Input.is_action_just_pressed(\"fire\"): put_bullet() # 銃の種類がショットガン（1）かつマウス左ボタンをクリックした場合 if gun == 1 and Input.is_action_just_pressed(\"fire\"): for n in 5: put_bullet(n) # 銃の種類がマシンガン（2）かつマウス左ボタンを押している場合 if gun == 2 and Input.is_action_pressed(\"fire\"): # 次の弾丸までのカウントを +1 する interval += 1 # カウントが5以上だったら if interval \u003e= 5: # カウントを0に戻して interval = 0 # 弾丸インスタンスを生成して発射するメソッドを引数なしで呼ぶ put_bullet() # 銃の種類がレーザーガン(3)かつマウスの左ボタンを押している場合 if gun == 3 and Input.is_action_just_pressed(\"fire\"): # レーザーインスタンスを生成して発射するメソッドを呼ぶ load_laser() 追加した 4 つ目のifブロックで、銃がレーザーの時にマウスの左ボタンを押し続けている間はload_laserメソッドを呼ぶようにした。このメソッドはこれから定義するところだ。以下のコードをput_bulletメソッドの下に追加しよう。\n### Player.gd ### # レーザーインスタンスを生成して発射するメソッド func load_laser(): # Laser.tscnのインスタンスの参照 var laser = laser_scn.instance() # Laserインスタンスの位置を銃口の位置と同じにする laser.position = muzzle.position # LaserインスタンスをPlayerルートノードに子ノードとして追加する add_child(laser) # LaserインスタンスノードをPlayerルートノードの子ノードのうち0番目（最背面）に移動する # Playerノードの子Spriteノードのテクスチャ画像（の銃口部分）より背面にするため move_child(laser, 0) マウス左ボタンを押して「Laser」インスタンスが生成された後は、「Laser.gd」スクリプトの方でレーザーの位置、向き、長さ、幅、先端のパーティクルの位置は全て制御される。指が離れた時の「Laser」インスタンスの解放も含めて、だ。\n以上で、レーザーガンの実装は完了だ。プロジェクトを実行して確認する際、マウス右ボタンを3回クリックしてレーザーガンに切り替えてから射撃してみよう。\n完成してから気がついたが、レーザーは他の色にした方がよかったかもしれない。まるで水鉄砲か高水圧洗浄機のようだ。\n最後にもう一度プロジェクトを実行し、４つの銃を切り替えながらプレイしてみよう。\nおわりに 今回、トップダウンシューティングゲームによく登場する銃 4 種類を実装した。もし、もっと細かく作り込むなら、例えば、以下のような要素を追加するとさらに面白くなるかもしれない。\n銃の種類によって弾丸の見た目や速度を変える。 銃を切り替えたらプレイヤーキャラクターのスプライトも変更する。 弾丸をリロードしたりレーザーのエネルギーを充填するアニメーションや間を設ける。 弾丸がオブジェクトに当たって解放される時に煙や破片のようなパーティクルを追加して演出する。 銃の種類ごとに当たったオブジェクトへのダメージを設定し、オブジェクト側にもいわゆるHPなどの一定のライフの値を設定し、ライフが 0 になったら破壊できるようにする。 リンク KENNEY Godot 公式オンラインドキュメント：2D移動の概要 Godot 公式オンラインドキュメント：Line2D Godot 公式オンラインドキュメント：RayCast2D Godot 公式オンラインドキュメント：パーティクル・システム(2D) Godot 公式オンラインドキュメント：Particles2D Godot 公式オンラインドキュメント：ParticlesMaterial note：[Godot]ゲームで使う数学の覚書 UPDATE\n2022/05/07 タイポ修正\n",
  "wordCount" : "973",
  "inLanguage": "ja",
  "image":"https://www.peanuts-code.com/images/tutorials/gd0006_GunsOfTopdownShooter/img37.gif","datePublished": "2022-05-04T01:30:00+09:00",
  "dateModified": "2022-05-04T01:30:00+09:00",
  "author":{
    "@type": "Person",
    "name": "Masanao Sako"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.peanuts-code.com/ja/tutorials/gd0006_guns_of_topdown_shooter/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Peanuts Code",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.peanuts-code.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.peanuts-code.com/ja/" accesskey="h" title="Peanuts Code (Alt + H)">
                <img src="/images/logomark.png" alt="logo" aria-label="logo"
                    height="35">Peanuts Code</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://www.peanuts-code.com/en/" title="English"
                            aria-label="English">En</a>
                    </li>
                </ul>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.peanuts-code.com/ja/" title="ホーム">
                    <span>ホーム</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/posts/" title="ブログ">
                    <span>ブログ</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/tutorials/" title="チュートリアル">
                    <span>チュートリアル</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/tags/" title="タグ">
                    <span>タグ</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/about/" title="アバウト">
                    <span>アバウト</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://www.peanuts-code.com/ja/">Home</a>&nbsp;»&nbsp;<a href="https://www.peanuts-code.com/ja/tutorials/">Tutorials</a></div>
    <h1 class="post-title">
      Godot で作るトップダウンシューティングの 4 種類の銃
    </h1>
    <div class="post-meta">2022-05-04&nbsp;·&nbsp;5 分&nbsp;·&nbsp;Masanao Sako&nbsp;|&nbsp;
<ul class="i18n_list">言語:
    <li>
        <a href="https://www.peanuts-code.com/en/tutorials/gd0006_guns_of_topdown_shooter/">En</a>
    </li>
</ul>
</div>
  </header> 
<figure class="entry-cover"><img loading="lazy" src="https://www.peanuts-code.com/images/tutorials/gd0006_GunsOfTopdownShooter/img37.gif" alt="Godot で作るトップダウンシューティングの 4 種類の銃">
        
</figure><div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目次</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%bc%be%e4%b8%b8%e3%81%ae%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e3%82%8b" aria-label="弾丸のシーンを作る">弾丸のシーンを作る</a></li>
                <li>
                    <a href="#%e3%83%8f%e3%83%b3%e3%83%89%e3%82%ac%e3%83%b3%e3%82%92%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b" aria-label="ハンドガンを実装する">ハンドガンを実装する</a></li>
                <li>
                    <a href="#%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88%e3%82%ac%e3%83%b3%e3%82%92%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b" aria-label="ショットガンを実装する">ショットガンを実装する</a></li>
                <li>
                    <a href="#%e3%83%9e%e3%82%b7%e3%83%b3%e3%82%ac%e3%83%b3%e3%82%92%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b" aria-label="マシンガンを実装する">マシンガンを実装する</a></li>
                <li>
                    <a href="#%e3%83%ac%e3%83%bc%e3%82%b6%e3%83%bc%e3%81%ae%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e3%82%8b" aria-label="レーザーのシーンを作る">レーザーのシーンを作る</a></li>
                <li>
                    <a href="#%e3%83%ac%e3%83%bc%e3%82%b6%e3%83%bc%e3%82%ac%e3%83%b3%e3%82%92%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b" aria-label="レーザーガンを実装する">レーザーガンを実装する</a></li>
                <li>
                    <a href="#%e3%81%8a%e3%82%8f%e3%82%8a%e3%81%ab" aria-label="おわりに">おわりに</a></li>
                <li>
                    <a href="#%e3%83%aa%e3%83%b3%e3%82%af" aria-label="リンク">リンク</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>このチュートリアルでは、2Dトップダウンシューティングゲーム（見下ろし型シューティングゲーム）で一般的によく登場する銃を4種類作っていく。具体的には以下の通りだ。</p>
<ul>
<li>ハンドガン</li>
<li>ショットガン</li>
<li>マシンガン</li>
<li>レーザーガン</li>
</ul>
<br>
<blockquote>
<p><em><strong><span style="color:salmon">Environment</span>
</strong><br>
このチュートリアルは以下の環境で作成しました。</em><br>
・<em>Godot のバージョン: <strong>3.4.2</strong></em><br>
・<em>コンピュータのOS: <strong>macOS 11.6.5</strong></em></p>
</blockquote>
<br>
<p>このチュートリアルでは、銃の作成にフォーカスするため、以下は予め用意しておいた。</p>
<ol>
<li>
<p><strong>ゲームの世界</strong><br>
「World.tscn」というシーンを用意し、見た目は「TileMap」ノードを追加して簡単に作成している。「TileMap」以外に「Player」ノードと複数の「Obstacle」ノードを追加している。これらについては個別のシーンを作成して、インスタンスを追加した形だ。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img0.1.png" alt="Worldシーンツリー"  />
</p>
</li>
<li>
<p><strong>プレイヤーキャラクター</strong><br>
「Player.tscn」シーンとして作成した。ルートノードは「KinematicBody2D」クラスで、子ノードに「Sprite」と「CollisionShape2D」を追加している。「Sprite」のテクスチャは銃をもったスキンヘッドのヒットマンにしている。ヒットマンが持っている銃の画像の先端の位置に「Position2D」クラスの「Muzzle」という名前のノードを配置している。これは後ほど銃を撃った時の弾丸インスタンスの生成される位置を指定するのに使用する。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img0.2.png" alt="Playerシーンツリー"  />
<br>
インプットマップには以下のアクションを追加済みだ。プレイヤーキャラクターの移動や射撃、銃の切り替えに使用する。</p>
<ul>
<li><strong>up</strong>: W キー・・・プレイヤーキャラクターを前進させる時に使う</li>
<li><strong>down</strong>: S キー・・・プレイヤーキャラクターを後退させる時に使う</li>
<li><strong>fire</strong>: マウス左ボタン・・・銃を撃つ</li>
<li><strong>switch</strong>: マウス右ボタン・・・銃の種類を切り替える<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img1.png" alt="inputmap"  />
<br>
ちなみに、チュートリアルの内容を簡潔にするため、プレイヤーキャラクターのスプライトは銃の種類が変わっても同じままだ。見た目はハンドガンっぽいが、マシンガンにもレーザーガンにもなる、なんでもありの銃、ということにしておこう。</li>
</ul>
</li>
<li>
<p><strong>障害物</strong><br>
「Obstacle.tscn」というシーンを作成している。Obstacle は日本語で障害物という意味だ。画面上にたくさん置いている茶色い木箱のオブジェクトは全てこのシーンのインスタンスである。ルートノードは「StaticBody2D」クラスにして、その子ノードとして「Sprite」と「CollisionShape2D」を追加している。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img1.1.png" alt="Obstacleシーンツリー"  />
<br>
解放された（破壊された）時に同じ場所に爆発を表現するための「Smoke.tscn」というシーンのインスタンスを生成するようにしている。「Smoke」シーンは「Particle2D」ノードのみで構成され、こちらもパーティクルの実行が完了したら自動的に解放されるようにしている。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img1.2.png" alt="Smokeシーンツリー"  />
</p>
</li>
</ol>
<br>
<p>これらの下準備によりプロジェクトを実行すると、以下のように世界とヒットマンと障害物が描画され、現時点でヒットマンは移動操作のみ可能な状態だ。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img2.gif" alt="プロジェクトを実行"  />
</p>
<br>
<p>このチュートリアルのプロジェクトファイルは <strong><a href="https://github.com/msnsk/GunsOfTopdownShooter.git" target="_blank">GitHubリポジトリ</a>
</strong> に置いている。.zipファイルをダウンロードしていただき、「Start」フォルダの方を Godot Engine にインポートしていただければ、上述の下準備だけ完了したプロジェクトから開始できる。また、取り急ぎ完成形を確認されたい場合は「End」フォルダの方をインポートしていただければOKだ。</p>
<p>また今回プロジェクトにインポート済みのアセットは全て <strong><a href="https://www.kenney.nl/assets" target="_blank">KENNEY（ケニー）</a>
</strong> のサイトからダウンロードして利用させていただいたものだ。CC0の非常に使いやすいアセットを豊富にご用意いただいていることに感謝申し上げたい。特に今回ご利用させていただいたのは下記のアセットパックだ。</p>
<blockquote>
<ul>
<li><a href="https://www.kenney.nl/assets/topdown-shooter" target="_blank">Topdown Shooter</a>
</li>
<li><a href="https://www.kenney.nl/assets/particle-pack" target="_blank">Particle Pack</a>
</li>
</ul>
</blockquote>
<br>
<p>それでは銃の実装を進めていこう。</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="弾丸のシーンを作る">弾丸のシーンを作る<a hidden class="anchor" aria-hidden="true" href="#弾丸のシーンを作る">#</a></h1>
<p>まずは弾丸のシーンを作ろう。ハンドガン、ショットガン、マシンガンの3種類の銃でこの弾丸のシーンを使いまわせるので、先に作ってしまおうというわけだ。</p>
<ol>
<li>「シーン」メニュー＞「新規シーン」を選択する。</li>
<li>「ルートノードを生成」で「その他のノード」を選択する。</li>
<li>ルートノードに「Area2D」クラスを選択し、名前を「Bullet」に変更する。</li>
<li>ルートノードに「Line2D」クラスの子ノードを追加する。このチュートリアルでのこのノードの用途は弾丸の見た目を作るのに使用するのみだ。もちろん「Line2D」ではなく弾丸用のテクスチャ画像を用意して「Sprite」にしても良い。</li>
<li>ルートノードに「CollisionShape2D」クラスの子ノードを追加する。</li>
<li>ルートノードに「VisibilityNotifier2D」クラスの子ノードを追加する。銃で撃った弾が画面外に出てしまったら、それをシグナルで通知し、弾丸のインスタンスを解放するために使用する。</li>
<li>一旦シーンを保存しておく。保存先のフォルダは用意しているのでファイルパスが「res://Bullet/Bullet.tscn」になるようにして保存しよう。</li>
</ol>
<p>ここまででシーンツリーは以下のようになったはずだ。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img3.png" alt="プロジェクトを実行"  />
</p>
<br>
<p>続いて、各ノードを編集をしていく。</p>
<ol start="8">
<li>2D ワークスペースで「Line2D」ノードのパスを描く。まず１つ目の点を (-5, 0) に、次に2つ目の点を (5, 0) に打って直線のパスを描く。インスペクターで直接入力しても良い。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img4.png" alt="Line2Dプロパティ"  />
</li>
<li>インスペクターにて「Line2D」ノードの「Width」プロパティの値を 6 にする。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img5.png" alt="Line2Dプロパティ"  />
</li>
<li>「Default Color」プロパティで弾丸の色を指定する。もちろんあなたの好みの色にしてもらって構わない。このチュートリアルではサンプルとして #708293 の青っぽいグレーの色を指定した。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img6.png" alt="Line2Dプロパティ"  />
</li>
<li>「Capping」＞「End Cap Mode」プロパティを「Round」にする。これでパスの終端（2つ目の点）が丸くなったはずだ。角張っているより、この方がずっと弾丸らしい。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img7.png" alt="Line2Dプロパティ"  />
<br>
2D ワークスペース上で「Line2D」は以下のようになったはずだ。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img8.png" alt="2DワークスペースのLine2D"  />
</li>
<li>「CollisionShape2D」ノードの「Shape」プロパティに「新規 RectangleShape2D」リソースを割り当てる。</li>
<li>2D ワークスペースで「Line2D」で作成した弾丸の形状に合わせてコリジョン形状を調整する。ピッタリでも良いし、弾丸のサイズよりやや内側に小さく作っても良い。このサンプルではリソース「RectangleShape2D」の「Extents」プロパティの値が (5, 2) となっている。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img10.png" alt="CollisionShape2Dプロパティ"  />
<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img9.png" alt="2DワークスペースのLine2D"  />
</li>
<li>2D ワークスペースで「VisibilityNotifier2D」ノードの形状を調整する。この形状が画面外に出た時に発信されるシグナルを利用することになる。「CollisionShape2D」より x 軸方向で狭くして、2D ワークスペースで「CollisionShape2D」のコリジョン形状が確認しやすいようにした。y 軸方向の長さは同じにした。サイズはだいたいで構わない。このサンプルでは「Scale」プロパティの値は (0.5, 0.1) になっている。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img11.png" alt="VisibilityNotifier2Dプロパティ"  />
<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img12.png" alt="VisibilityNotifier2Dプロパティ"  />
</li>
</ol>
<p>ノードの追加とそれぞれのノードのプロパティ編集はここまでだ。</p>
<br>
<p>続いてルートノードにスクリプトをアタッチしてコーディングしていく。</p>
<ol>
<li>ルートノードにスクリプトをアタッチする。ファイルパスを「res://Bullet/Bullet.gd」として作成しよう。</li>
<li>「Bullet.gd」スクリプトを以下のように編集する。</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">### Bullet.gd ###</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Area2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1秒あたりの弾丸のスピード</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> speed <span style="color:#f92672">=</span> <span style="color:#ae81ff">1500</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 弾丸が飛んでいく方向ベクトル：いったん(0, 0)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> direction <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 物理プロセス: 60回/秒呼ばれる組み込みメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _physics_process(delta):
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 弾丸の現在の回転角度からコサイン関数で弾丸が飛んでいく方向ベクトルの x の値を取得</span>
</span></span><span style="display:flex;"><span>	direction<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> cos(global_rotation)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 弾丸の現在の回転角度からサイン関数で弾丸が飛んでいく方向ベクトルの y の値を取得</span>
</span></span><span style="display:flex;"><span>	direction<span style="color:#f92672">.</span>y <span style="color:#f92672">=</span> sin(global_rotation)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 方向 × スピードで弾丸を毎フレーム移動させる</span>
</span></span><span style="display:flex;"><span>	translate(direction <span style="color:#f92672">*</span> speed <span style="color:#f92672">*</span> delta)
</span></span></code></pre></div><br>
<p>続いて、弾丸が物理ボディに当たったら発信されるシグナルをこのスクリプトに接続しよう。ルートノード「Bullet」が「Area2D」クラスなので、シーンツリードックでルートノード「Bullet」を選択し、そのままノードドック＞シグナルタブにて「body_entered(body)」シグナルを選択して「接続」をクリック（またはシグナルをダブルクリック）して接続する。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img12.1.png" alt="body_enteredシグナル接続した状態"  />
<br>
接続できたら、自動的に追加されたメソッド<code>_on_Bullet_body_entered</code>を以下のように編集しよう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">### Bullet.gd ###</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 弾丸が物理ボディに当たったら発信されるシグナルによって呼ばれるメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Bullet_body_entered(body):
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># もし当たったボディが障害物だったら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> body<span style="color:#f92672">.</span>is_in_group(<span style="color:#e6db74">&#34;Obstacles&#34;</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># 障害物のオブジェクトを解放する</span>
</span></span><span style="display:flex;"><span>		body<span style="color:#f92672">.</span>queue_free()
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 弾丸インスタンスを解放する</span>
</span></span><span style="display:flex;"><span>	queue_free()
</span></span></code></pre></div><p>ちなみに、事前に「Obstacle」シーンのルートノードは「Obstacles」というグループに追加済みだ。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img13.png" alt="Obstaclesグループ"  />
</p>
<p>これで、外壁に当たれば弾丸だけ解放され、障害物に当たれば、障害物と弾丸が解放されるようになった。</p>
<br>
<p>さらにもう一つシグナルを追加する。「VisibilityNotifier2D」ノードが画面上から消えた時に発信されるシグナル「screen_exited()」を「Bullet.gd」スクリプトに接続しよう。手順は先程のシグナル接続と同様で、シーンツリードックで「VisibilityNotifier2D」ノードを選択し、ノードドック＞シグナルタブで「screen_exited()」シグナルを接続すればOKだ。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img13.1.png" alt="screen_exited()シグナル接続した状態"  />
</p>
<p>接続できたら、自動的に追加されたメソッド<code>_on_VisibilityNotifier2D_screen_exited</code>を以下のように編集しよう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">### Bullet.gd ###</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># VisibilityNotifier2D ノードが画面外に出た時に発信されるシグナルで呼ばれるメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_VisibilityNotifier2D_screen_exited():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 弾丸インスタンスを解放する</span>
</span></span><span style="display:flex;"><span>	queue_free()
</span></span></code></pre></div><p>これで画面外に出た時もその弾丸は解放されるようになった。</p>
<br>
<p>以上で弾丸シーンは完成だ。</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="ハンドガンを実装する">ハンドガンを実装する<a hidden class="anchor" aria-hidden="true" href="#ハンドガンを実装する">#</a></h1>
<p>まずは一番簡単なハンドガン（拳銃）から撃てるようにしていこう。編集するスクリプトは「Player.gd」なのだが、すでに下準備の段階である程度のコードが出来上がっているので、そちらを先に確認しておこう。</p>
<details>
<summary>Player.gd のコードの下準備部分を見る</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">### Player.gd ###</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">KinematicBody2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># プリロードした弾丸シーンの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> bullet_scn <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://Bullet/Bullet.tscn&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 現在使用中の銃（銃の種類ごとの数字の割り当ては以下のコメント）</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> gun <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0: hand</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1: shot</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2: machine</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3: lazer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># プレイヤーキャラクターのスピード</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> speed <span style="color:#f92672">=</span> <span style="color:#ae81ff">200</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># プレイヤーキャラクターの方向を伴うスピード</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> velocity <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Muzzleノードの参照：銃口の位置</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> muzzle <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>Muzzle
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># シーンが読み込まれたら呼ばれるメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	rotation_degrees <span style="color:#f92672">=</span> <span style="color:#ae81ff">270</span> <span style="color:#75715e"># ゲーム開始時プレイヤーに上を向かせる</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 物理プロセス：デフォルトで60回/秒呼ばれるメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _physics_process(delta):
</span></span><span style="display:flex;"><span>	move()　<span style="color:#75715e"># プレイヤーキャラクターを移動させるメソッドを呼ぶ</span>
</span></span><span style="display:flex;"><span>	switch_gun() <span style="color:#75715e"># 銃の種類を切り替えるメソッドを呼ぶ</span>
</span></span><span style="display:flex;"><span>	fire() <span style="color:#75715e"># 銃を撃つメソッドを呼ぶ</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#75715e"># プレイヤーキャラクターを移動させるメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> move():
</span></span><span style="display:flex;"><span>	look_at(get_global_mouse_position()) <span style="color:#75715e"># キャラクターにマウスカーソルの方を向かせる</span>
</span></span><span style="display:flex;"><span>	velocity <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>() <span style="color:#75715e"># ベロシティ（方向をもった速度）を(0, 0)に初期化</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_pressed(<span style="color:#e6db74">&#34;down&#34;</span>): <span style="color:#75715e"># Sキーを押したら...</span>
</span></span><span style="display:flex;"><span>		velocity <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>(<span style="color:#f92672">-</span>speed, <span style="color:#ae81ff">0</span>)<span style="color:#f92672">.</span>rotated(rotation) <span style="color:#75715e"># ベロシティを後ろ向きにセット</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_pressed(<span style="color:#e6db74">&#34;up&#34;</span>): <span style="color:#75715e"># Wキーを押したら...</span>
</span></span><span style="display:flex;"><span>		velocity <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>(speed, <span style="color:#ae81ff">0</span>)<span style="color:#f92672">.</span>rotated(rotation) <span style="color:#75715e"># ベロシティを前向きにセット</span>
</span></span><span style="display:flex;"><span>	velocity <span style="color:#f92672">=</span> move_and_slide(velocity) <span style="color:#75715e"># ベロシティに合わせて移動</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 銃の種類を切り替えるメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> switch_gun():
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_just_pressed(<span style="color:#e6db74">&#34;switch&#34;</span>): <span style="color:#75715e"># マウス右ボタンをクリックをした場合...</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> gun <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">3</span>: <span style="color:#75715e"># 銃の割り当て番号が 3 未満の場合は...</span>
</span></span><span style="display:flex;"><span>			gun <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e"># 割り当て番号を 1 増やす</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span>: <span style="color:#75715e"># 銃の割り当て番号が 3（最後の数字）の場合は...</span>
</span></span><span style="display:flex;"><span>			gun <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># 銃の割り当て番号を 0 にする</span>
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;Switched to &#34;</span>, gun) <span style="color:#75715e"># デバッグ用に出力パネルに表示</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 銃を撃つメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> fire():
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">pass</span>
</span></span></code></pre></div></details>
<br>
<br>
<p>ということで、<code>fire</code>メソッドが今のところ中身が空っぽだ。これを次のように更新する。ちなみに fire は日本語で「（銃などを）撃つ」という意味だ。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">### Player.gd ###</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 銃を撃つメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> fire():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 銃の種類がハンドガン（0）かつマウス左ボタンをクリックした場合</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> gun <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">and</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_just_pressed(<span style="color:#e6db74">&#34;fire&#34;</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># 弾丸インスタンスを生成して発射するメソッドを呼ぶ</span>
</span></span><span style="display:flex;"><span>		put_bullet()
</span></span></code></pre></div><p>ここで<code>put_bullet</code>というメソッドが登場したが、これはこれから定義するメソッドだ。<code>fire</code>メソッドの下に以下のコードを追加して定義しよう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">### Player.gd ###</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 弾丸インスタンスを生成して発射するメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> put_bullet():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 弾丸シーンのインスタンスの参照</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> bullet <span style="color:#f92672">=</span> bullet_scn<span style="color:#f92672">.</span>instance()
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 弾丸インスタンスの位置を銃口の位置と同じにする</span>
</span></span><span style="display:flex;"><span>	bullet<span style="color:#f92672">.</span>global_position <span style="color:#f92672">=</span> muzzle<span style="color:#f92672">.</span>global_position
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 弾丸インスタンスの向きを Player の向きと同じにする</span>
</span></span><span style="display:flex;"><span>	bullet<span style="color:#f92672">.</span>rotation_degrees <span style="color:#f92672">=</span> rotation_degrees
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># Playerではなくその親ノード(World)の子にする</span>
</span></span><span style="display:flex;"><span>	get_parent()<span style="color:#f92672">.</span>add_child(bullet)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># Worldの2番目の子にする（タイルマップより前面、プレイヤーキャラクターより背面）</span>
</span></span><span style="display:flex;"><span>	get_parent()<span style="color:#f92672">.</span>move_child(bullet, <span style="color:#ae81ff">1</span>)
</span></span></code></pre></div><br>
<p>これでハンドガンの実装ができたはずだ。プロジェクトを実行して確認してみよう。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img14.gif" alt="ハンドガン"  />
</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="ショットガンを実装する">ショットガンを実装する<a hidden class="anchor" aria-hidden="true" href="#ショットガンを実装する">#</a></h1>
<p>次はショットガン（散弾銃）を実装する。トップダウンシューティングでのショットガンは、複数の弾丸がそれぞれ少しずつ角度の差をつけて前方に飛んでいくような仕様が一般的だろう。一回で広範囲の複数オブジェクトを一掃できる強力な銃だ。</p>
<p>まずは<code>fire</code>メソッドから更新しよう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">### Player.gd ###</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> fire():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 銃の種類がハンドガン（0）かつマウス左ボタンをクリックした場合</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> gun <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">and</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_just_pressed(<span style="color:#e6db74">&#34;fire&#34;</span>):
</span></span><span style="display:flex;"><span>		put_bullet()
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 銃の種類がショットガン（1）かつマウス左ボタンをクリックした場合</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> gun <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">and</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_just_pressed(<span style="color:#e6db74">&#34;fire&#34;</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># 5回ループ</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> <span style="color:#ae81ff">5</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># 弾丸インスタンスを生成して発射するメソッドの引数に値を渡して呼ぶ</span>
</span></span><span style="display:flex;"><span>			put_bullet(n)
</span></span></code></pre></div><p><code>fire</code>メソッドに２つ目の<code>if</code>ブロックを追加した。プロパティ<code>gun</code>の値が 1（ショットガンの割り当て番号）の場合にマウス左クリックでショットガンを撃てる。<code>if</code>ブロックの中身は<code>for</code>ループで5回<code>put_bullet</code>を呼んでいるが、先程のハンドガンの時と違い、引数にループの周回数<code>n</code>を渡している。このメソッドが受け取った引数をどう処理するかは、このあと<code>put_bullet</code>メソッドを更新していくのでそこで確認しよう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> put_bullet(dir_offset <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>): <span style="color:#75715e"># 引数dir_offsetを追加し、デフォルト値は2とした</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> bullet <span style="color:#f92672">=</span> bullet_scn<span style="color:#f92672">.</span>instance()
</span></span><span style="display:flex;"><span>	bullet<span style="color:#f92672">.</span>global_position <span style="color:#f92672">=</span> muzzle<span style="color:#f92672">.</span>global_position
</span></span><span style="display:flex;"><span>	bullet<span style="color:#f92672">.</span>rotation_degrees <span style="color:#f92672">=</span> rotation_degrees <span style="color:#f92672">+</span> (<span style="color:#ae81ff">20</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> dir_offset) <span style="color:#75715e"># 更新</span>
</span></span><span style="display:flex;"><span>	get_parent()<span style="color:#f92672">.</span>add_child(bullet)
</span></span><span style="display:flex;"><span>	get_parent()<span style="color:#f92672">.</span>move_child(bullet, <span style="color:#ae81ff">1</span>)
</span></span></code></pre></div><p>少しややこしいが、メソッドを呼ぶときに引数<code>dir_offset</code>が未入力の場合、デフォルト値の2が自動的に引数に渡される。メソッドのブロック内3行目で弾丸の回転角度（向き）を指定しているのだが、例えばハンドガンの場合は、引数を指定せずにこのメソッドを呼んでいるので、引数にはデフォルト値の 2 が渡されて、<code>20 - 10 * dir_offset</code>の部分が 0 になり、弾丸の角度はプレイヤーキャラクターの向いている角度と同じになる。</p>
<p>一方、ショットガンの場合は、<code>fire</code>メソッド内の<code>for</code>ループで5回この<code>put_bullet</code>メソッドが呼ばれており、ループの周回数 n（0からカウントして4まで）を引数<code>dir_offset</code>に渡す形にしている。よって、ループが何周目かによって弾丸の角度は以下のように変化する。</p>
<ul>
<li>ループ0周目：プレイヤーキャラクターの向いている角度 + 20°</li>
<li>ループ1周目：プレイヤーキャラクターの向いている角度 + 10°</li>
<li>ループ2周目：プレイヤーキャラクターの向いている角度 + 0°</li>
<li>ループ3周目：プレイヤーキャラクターの向いている角度 + -10°</li>
<li>ループ4周目：プレイヤーキャラクターの向いている角度 + -20°</li>
</ul>
<p>上記のコードにより、5発の弾丸が「Player」が向いている方向に対して -20° から +20° の範囲で 10° ずつ異なる角度で同時に発射され、一度に広範囲を射撃できる銃の完成だ。なお、5 回程度のループであればコンピュータ上で一瞬で処理されるので、ほぼ同時にそれぞれの角度に弾丸が飛んでいくことになる。</p>
<br>
<p>これでショットガンの実装ができたはずだ。プロジェクトを実行して確認する際、マウス右ボタンを1回クリックしてショットガンに切り替えてから射撃してみよう。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img15.gif" alt="ショットガン"  />
</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="マシンガンを実装する">マシンガンを実装する<a hidden class="anchor" aria-hidden="true" href="#マシンガンを実装する">#</a></h1>
<p>続いてマシンガン（機関銃）を実装していこう。マシンガンは一回いっかいトリガーを引いて射撃する銃とは違い、トリガーを引いている間、自動的に連続して射撃できる銃だ。ショットガンのようにワンショットで広範囲の射撃はできないが、高速で自動射撃するため、プレイヤーキャラクター自身が回転すればすぐに広範囲のオブジェクトを一掃できる。</p>
<p>それでは「Player.gd」スクリプトにマシンガン用のコードを追加していこう。</p>
<p>まずはプロパティ<code>interval</code>を追加した。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">### Player.gd ###</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> speed <span style="color:#f92672">=</span> <span style="color:#ae81ff">200</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> velocity <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>()
</span></span><span style="display:flex;"><span><span style="color:#75715e"># マシンガンの次の弾丸が発射されるまでのカウント</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> interval: <span style="color:#a6e22e">int</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># 追加</span>
</span></span></code></pre></div><p>マシンガンの仕様として、マウス左ボタンを押したままにすれば自動的に弾丸が連続して発射されるようにするのだが、<code>_physics_process</code>メソッドで<code>fire</code>メソッドを毎フレーム呼ぶと、弾丸と弾丸の間隔が短すぎて弾丸が止まって見える（以下のGIF画像参照）。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img16.gif" alt="マシンガン毎フレーム発射時"  />
</p>
<p>物理プロセスの 60 FPS（毎秒60フレーム）というフレームレートはかなり早いのだ。そこで今回は、毎フレーム、<code>interval</code>プロパティに +1 してそのカウントが 5 を超えたら弾丸を発射するようにする。つまり、5 フレームに 1 回発射する計算だ。</p>
<p>そこを踏まえて<code>fire</code>メソッドにマシンガン用の<code>if</code>ブロックを追加していこう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> fire():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 銃の種類がハンドガン（0）かつマウス左ボタンをクリックした場合</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> gun <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">and</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_just_pressed(<span style="color:#e6db74">&#34;fire&#34;</span>):
</span></span><span style="display:flex;"><span>		put_bullet()
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 銃の種類がショットガン（1）かつマウス左ボタンをクリックした場合</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> gun <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">and</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_just_pressed(<span style="color:#e6db74">&#34;fire&#34;</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> <span style="color:#ae81ff">5</span>:
</span></span><span style="display:flex;"><span>			put_bullet(n)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 銃の種類がマシンガン（2）かつマウス左ボタンを押している場合</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> gun <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">and</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_pressed(<span style="color:#e6db74">&#34;fire&#34;</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># 次の弾丸までのカウントを +1 する</span>
</span></span><span style="display:flex;"><span>		interval <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># カウントが5以上だったら</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> interval <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">5</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># カウントを0に戻して</span>
</span></span><span style="display:flex;"><span>			interval <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># 弾丸インスタンスを生成して発射するメソッドを引数なしで呼ぶ</span>
</span></span><span style="display:flex;"><span>			put_bullet()
</span></span></code></pre></div><p>なお、ハンドガンとショットガンは<code>Input</code>クラスの<code>is_action_just_pressed</code>メソッドを<code>if</code>の条件に使っているが、こちらは左ボタンを押し続けても連続的には入力を検知されないようになっている。一方、マシンガンの場合は<code>is_action_pressed</code>メソッドを使っている。「just」がないだけで似たような名前のメソッドだが、こちらは押し続けていても毎フレーム入力が検知されるので、「押しっぱなし」の操作で利用するのに向いているのだ。</p>
<br>
<p>これでマシンガンの実装ができたはずだ。プロジェクトを実行して確認する際、マウス右ボタンを2回クリックしてマシンガンに切り替えてから射撃してみよう。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img17.gif" alt="マシンガン"  />
</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="レーザーのシーンを作る">レーザーのシーンを作る<a hidden class="anchor" aria-hidden="true" href="#レーザーのシーンを作る">#</a></h1>
<p>最後はレーザーガン（光線銃）を実装するのだが、これは弾丸ではなくレーザーを発射するので、まず先にレーザーのシーンを作成していこう。パーティクルやアニメーションにより最低限のそれらしい演出も加える。</p>
<ol>
<li>「シーン」メニュー＞「新規シーン」を選択する。</li>
<li>「ルートノードを生成」で「その他のノード」を選択する。</li>
<li>ルートノードに「RayCast2D」クラスを選択し、名前を「Laser」に変更する。</li>
<li>ルートノードに「Line2D」クラスの子ノードを追加する。弾丸シーンと同様にレーザーの見た目を作るのに使用する。もちろん「Line2D」ではなくレーザー用のテクスチャ画像を用意して「Sprite」にする方法もあるが今回は不採用だ。</li>
<li>ルートノードに「Particle2D」クラスの子ノードを追加する。これはレーザーがオブジェクトに当たった箇所に粒子が泡立つような演出を追加するのに利用する。</li>
<li>ルートノードに「Tween」クラスの子ノードを追加する。これはレーザー発射時にレーザーの幅を 0 から一定の幅までゆっくり太くしていく演出と、レーザー終了時の逆の演出に利用する。</li>
<li>一旦シーンを保存しておく。保存先のフォルダは用意しているのでファイルパスが「res://Laser/Laser.tscn」になるようにして保存しよう。</li>
</ol>
<p>ここまででシーンツリーは以下のようになったはずだ。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img18.png" alt="Laserシーンツリー"  />
</p>
<br>
<p>続いて、各ノードを編集をしていく。</p>
<ol start="8">
<li>インスペクターにて、ルートの「Laser」ノードの「Enabled」プロパティをオンにして、「Cast To」プロパティを (2000, 0) にする。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img20.png" alt="Laserノードのプロパティ"  />
<br>
2D ワークスペース上では以下のスクリーンショットのようになったはずだ。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img19.png" alt="2Dワークスペース上のLaserノード"  />
</li>
<li>2D ワークスペースで「Line2D」ノードのパスを描く。まず１つ目の点を (0, 0) に、次に2つ目の点を (200, 0) に打って直線のパスを描く。インスペクターで直接入力しても良い。なお、２つ目の点はスクリプトで制御するので、y の値が 0 であれば、x の値は 2D ワークスペース上で確認しやすい適当な値で良い。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img21.png" alt="Line2Dノードのプロパティ"  />
</li>
<li>インスペクターにて「Line2D」ノードの「Width」プロパティの値を 16 にする。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img22.png" alt="Line2Dノードのプロパティ"  />
</li>
<li>「Default Color」プロパティでレーザーの色を指定する。もちろんあなたのイメージするレーザーの色にしてもらって構わない。このチュートリアルではサンプルとして #00b1ff の青色を指定した。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img23.png" alt="Line2Dノードのプロパティ"  />
<br>
2D ワークスペース上で「Line2D」はだいたい以下のようになったはずだ。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img24.png" alt="2DワークスペースのLine2D"  />
</li>
<li>ここから「Particle2D」ノードのプロパティを以下のように編集する。プロパティが多いので大変だが頑張ろう。
<ol>
<li>まず先に「Textures」＞「Texture」プロパティにリソース「res://Assets/circle_05.png」を適用する。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img25.png" alt="Particle2Dノードのプロパティ"  />
</li>
<li>「Emitting」プロパティをオンにする。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img26.png" alt="Particle2Dノードのプロパティ"  />
</li>
<li>「Drawing」＞「Visibility Rect」プロパティの値を (x: -50, y: -50, w: 100, h: 100) にする。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img27.png" alt="Particle2Dノードのプロパティ"  />
</li>
<li>「Transform」＞「Position」プロパティを(x: 200, y: 0)にして、「Transform」＞「Scale」プロパティを (x: 0.1, y: 0.1) にする<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img28.png" alt="Particle2Dノードのプロパティ"  />
</li>
<li>「Process Material」プロパティに 「新規 ParticleMaterial」を割り当てる。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img29.png" alt="Particle2Dノードのプロパティ"  />
<br>
ここからは今割り当てたリソース「ParticleMaterial」のプロパティを編集していく。<br>
<br>
<ul>
<li>
<p>「Emission Shape」＞</p>
<ul>
<li>「Shape」プロパティを「Box」に変更する。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img30.png" alt="Particle2Dノードのプロパティ"  />
</li>
</ul>
</li>
<li>
<p>「Direction」＞</p>
<ul>
<li>「Direction」プロパティを (x: -1, y: 0, z: 0) にする。x軸の負の方向になる。</li>
<li>「Spread」プロパティを 60 にする。60°の幅でパーティクルが移動する。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img31.png" alt="Particle2Dノードのプロパティ"  />
</li>
</ul>
</li>
<li>
<p>「Gravity」＞</p>
<ul>
<li>「Gravity」プロパティを (x: -300, y: 0, z: 0) にする。x軸の負の方向に重力を加える。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img32.png" alt="Particle2Dノードのプロパティ"  />
</li>
</ul>
</li>
<li>
<p>「Initial Velocity」＞</p>
<ul>
<li>「Velocity」プロパティを 800 にする。速度を 800 とした。これはおそらく秒速だ。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img33.png" alt="Particle2Dノードのプロパティ"  />
</li>
</ul>
</li>
<li>
<p>「Scale」＞</p>
<ul>
<li>「Scale Curve」プロパティに「新規 CurveTexture」を割り当てる。この次は割り当てたリソースのプロパティ編集だ。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img34.png" alt="Particle2Dノードのプロパティ"  />
</li>
<li>「CurveTexture」＞
<ul>
<li>「Curve」プロパティに「新規 Curve」プロパティを割り当て、値の変化を以下のスクリーンショットのように２つの点を打ってカーブを作って設定する。<br>
これで、時間経過とともにパーティクル１つひとつが次第に小さくなる。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img34.1.png" alt="Particle2Dノードのプロパティ"  />
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>「Color」＞</p>
<ul>
<li>「Color Ramp」プロパティにリソース「新規 GradientTexture」を割り当てる。パーティクルが生成されて消失するまでに次第に色を変える演出のためだ。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img35.png" alt="Particle2Dノードのプロパティ"  />
</li>
<li>上で割り当てた「GradientTexture」リソースのプロパティにリソース「新規 Gradient」を割り当てる。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img35.1.png" alt="Particle2Dノードのプロパティ"  />

<ul>
<li>「Gradient」リソースのプロパティを編集するが、ここはインスペクターで直感的にグラデーションの基準となる色を３つ指定する。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img35.2.png" alt="Particle2Dノードのプロパティ"  />

<ul>
<li>一番左端：#001096（深い青色）</li>
<li>中央やや左寄りの位置：#2780ff（水色っぽい青色）</li>
<li>一番右端：#00ffffff（不透明度0の白色）<br>
すると、結果的に以下のようなリソースのプロパティになる。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img35.3.png" alt="Particle2Dノードのプロパティ"  />
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
</ol>
<p>以上で、ノードの追加とそれぞれのノードのプロパティ編集は完了だ。</p>
<br>
<p>ここからはルートノード「Laser」にスクリプトをアタッチしてコーディングしていく。</p>
<ol>
<li>ルートノード「Laser」にスクリプトをアタッチし、ファイルパスを「res://Laser/Laser.gd」として作成する。</li>
<li>「Laser.gd」スクリプトを以下のように編集する。</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">### Laser.gd ###</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">RayCast2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Line2Dノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> line <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>Line2D
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Particle2Dノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> particle <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Particles2D</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tweenノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> tween <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Tween</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># シーンが読み込まれたら呼ばれるメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># Particle2DノードのEmittingプロパティをオフにする（インスペクターでオンにしたままの時の対策）</span>
</span></span><span style="display:flex;"><span>	particle<span style="color:#f92672">.</span>emitting <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># Tweenノードのアニメーションの設定：Line2DのWidthプロパティを0から10に0.5秒かけて変化させる</span>
</span></span><span style="display:flex;"><span>	tween<span style="color:#f92672">.</span>interpolate_property(line, <span style="color:#e6db74">&#34;width&#34;</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">10.0</span>, <span style="color:#ae81ff">0.5</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># Tweenノードのアニメーション開始</span>
</span></span><span style="display:flex;"><span>	tween<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 物理プロセス：60FPSで呼ばれるメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _physics_process(delta):
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># もしRayCast2D（ルートノード）が物理ボディに当たっている場合は...</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> is_colliding():
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># Line2Dノードの２つ目の点（終端）の位置をRayCast2Dが物理ボディに当たった位置に設定する</span>
</span></span><span style="display:flex;"><span>		line<span style="color:#f92672">.</span>set_point_position(<span style="color:#ae81ff">1</span>, to_local(get_collision_point()))
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># もし当たったのが障害物だったら...</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> get_collider()<span style="color:#f92672">.</span>is_in_group(<span style="color:#e6db74">&#34;Obstacles&#34;</span>):
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># 障害物インスタンスの参照</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">var</span> obstacle <span style="color:#f92672">=</span> get_collider()
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># 障害物インスタンスのレーザー照射時間（irradiated_timeプロパティ）に delta の値を加算する</span>
</span></span><span style="display:flex;"><span>			obstacle<span style="color:#f92672">.</span>irradiated_time <span style="color:#f92672">+=</span> delta
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># もしレーザー照射時間が最大照射時間（max_irradiationプロパティ）を超えたら...</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> obstacle<span style="color:#f92672">.</span>irradiated_time <span style="color:#f92672">&gt;</span> obstacle<span style="color:#f92672">.</span>max_irradiation: 
</span></span><span style="display:flex;"><span>				<span style="color:#75715e"># 障害物インスタンスを解放する</span>
</span></span><span style="display:flex;"><span>				obstacle<span style="color:#f92672">.</span>queue_free()
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># もしRayCast2D（ルートノード）が物理ボディに当たっていない場合は...</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># Line2Dノードの２つ目の点（終端）の位置をRayCast2D（ルートノード）の先端の位置と同じにする</span>
</span></span><span style="display:flex;"><span>		line<span style="color:#f92672">.</span>set_point_position(<span style="color:#ae81ff">1</span>, cast_to)
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># Particle2Dノードの位置をLine2Dノードのパスの終端の位置と同じにする</span>
</span></span><span style="display:flex;"><span>	particle<span style="color:#f92672">.</span>position <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>points[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># Particle2DノードのEmittingプロパティをオンにする（パーティクルのアニメーション開始）</span>
</span></span><span style="display:flex;"><span>	particle<span style="color:#f92672">.</span>emitting <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># マウス左ボタンから指を離した場合...</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_just_released(<span style="color:#e6db74">&#34;fire&#34;</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># レーザーを止めるメソッドを呼ぶ</span>
</span></span><span style="display:flex;"><span>		stop_laser()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># レーザーを止めるメソッドを定義</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> stop_laser():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># Tweenノードのアニメーションを設定：Line2DノードのWidthプロパティを10から0に0.5秒かけて変化させる</span>
</span></span><span style="display:flex;"><span>	tween<span style="color:#f92672">.</span>interpolate_property(line, <span style="color:#e6db74">&#34;width&#34;</span>, <span style="color:#ae81ff">10.0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># Tweenノードのアニメーション開始</span>
</span></span><span style="display:flex;"><span>	tween<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># Tweenノードのアニメーションが終わるまで待機</span>
</span></span><span style="display:flex;"><span>	yield(tween, <span style="color:#e6db74">&#34;tween_completed&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># Tweenノードを解放する</span>
</span></span><span style="display:flex;"><span>	queue_free()
</span></span></code></pre></div><p>このコードについて、少し補足しておく。下準備として作成済みの障害物のシーン「Obstacle.tscn」のルートノードにアタッチしている「Obstacle.gd」スクリプトにて、<code>irradiated_time</code>と<code>max_irradiation</code>という２つのプロパティを定義している。前者はレーザーの照射時間、後者はレーザーの最大照射時間として用意したものだ。レーザーが当たってすぐに障害物が破壊されるより、一定時間（最大照射時間：0.2秒）照射されたら破壊される設定の方がレーザーっぽさが出るのではないか、という考えからこのような仕組みを作った次第だ。</p>
<br>
<p>これでレーザーシーンが用意できた。次は「Player」シーンを更新して、レーザーを発射できるようにしていく。</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="レーザーガンを実装する">レーザーガンを実装する<a hidden class="anchor" aria-hidden="true" href="#レーザーガンを実装する">#</a></h1>
<p>レーザーシーンができたので、レーザーガンを実装していこう。レーザーガンの仕様として、まず発射時に、先に作成した「Laser.tscn」のインスタンスを「Player」シーンに追加するようにしていく。プレイヤーの操作はマシンガンと同様に、マウス左ボタンを押したままにしている間は発射し続けられるようにする。一方、ボタンから指を離すと、先にコーディングした「Laser.gd」スクリプトにより、レーザーが消えて、インスタンスも解放される。</p>
<p>それでは具体的に「Player.gd」スクリプトを編集していこう。まずは<code>fire</code>メソッドの 4 つ目の<code>if</code>ブロックを以下のように追加してほしい。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">### Player.gd ###</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> fire():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 銃の種類がハンドガン（0）かつマウス左ボタンをクリックした場合</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> gun <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">and</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_just_pressed(<span style="color:#e6db74">&#34;fire&#34;</span>):
</span></span><span style="display:flex;"><span>		put_bullet()
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 銃の種類がショットガン（1）かつマウス左ボタンをクリックした場合</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> gun <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">and</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_just_pressed(<span style="color:#e6db74">&#34;fire&#34;</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> <span style="color:#ae81ff">5</span>:
</span></span><span style="display:flex;"><span>			put_bullet(n)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 銃の種類がマシンガン（2）かつマウス左ボタンを押している場合</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> gun <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">and</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_pressed(<span style="color:#e6db74">&#34;fire&#34;</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># 次の弾丸までのカウントを +1 する</span>
</span></span><span style="display:flex;"><span>		interval <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># カウントが5以上だったら</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> interval <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">5</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># カウントを0に戻して</span>
</span></span><span style="display:flex;"><span>			interval <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># 弾丸インスタンスを生成して発射するメソッドを引数なしで呼ぶ</span>
</span></span><span style="display:flex;"><span>			put_bullet()
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 銃の種類がレーザーガン(3)かつマウスの左ボタンを押している場合</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> gun <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">and</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_just_pressed(<span style="color:#e6db74">&#34;fire&#34;</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># レーザーインスタンスを生成して発射するメソッドを呼ぶ</span>
</span></span><span style="display:flex;"><span>		load_laser()
</span></span></code></pre></div><p>追加した 4 つ目の<code>if</code>ブロックで、銃がレーザーの時にマウスの左ボタンを押し続けている間は<code>load_laser</code>メソッドを呼ぶようにした。このメソッドはこれから定義するところだ。以下のコードを<code>put_bullet</code>メソッドの下に追加しよう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">### Player.gd ###</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># レーザーインスタンスを生成して発射するメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> load_laser():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># Laser.tscnのインスタンスの参照</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> laser <span style="color:#f92672">=</span> laser_scn<span style="color:#f92672">.</span>instance()
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># Laserインスタンスの位置を銃口の位置と同じにする</span>
</span></span><span style="display:flex;"><span>	laser<span style="color:#f92672">.</span>position <span style="color:#f92672">=</span> muzzle<span style="color:#f92672">.</span>position
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># LaserインスタンスをPlayerルートノードに子ノードとして追加する</span>
</span></span><span style="display:flex;"><span>	add_child(laser)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># LaserインスタンスノードをPlayerルートノードの子ノードのうち0番目（最背面）に移動する</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># Playerノードの子Spriteノードのテクスチャ画像（の銃口部分）より背面にするため</span>
</span></span><span style="display:flex;"><span>	move_child(laser, <span style="color:#ae81ff">0</span>)
</span></span></code></pre></div><p>マウス左ボタンを押して「Laser」インスタンスが生成された後は、「Laser.gd」スクリプトの方でレーザーの位置、向き、長さ、幅、先端のパーティクルの位置は全て制御される。指が離れた時の「Laser」インスタンスの解放も含めて、だ。</p>
<br>
<p>以上で、レーザーガンの実装は完了だ。プロジェクトを実行して確認する際、マウス右ボタンを3回クリックしてレーザーガンに切り替えてから射撃してみよう。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img36.gif" alt="プロジェクトを実行してレーザーガンの確認"  />
</p>
<p>完成してから気がついたが、レーザーは他の色にした方がよかったかもしれない。まるで水鉄砲か高水圧洗浄機のようだ。</p>
<br>
<p>最後にもう一度プロジェクトを実行し、４つの銃を切り替えながらプレイしてみよう。<br>
<img loading="lazy" src="/images/tutorials/gd0006_GunsOfTopdownShooter/img37.gif" alt="プロジェクトを実行して全種類の銃の確認"  />
</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="おわりに">おわりに<a hidden class="anchor" aria-hidden="true" href="#おわりに">#</a></h1>
<p>今回、トップダウンシューティングゲームによく登場する銃 4 種類を実装した。もし、もっと細かく作り込むなら、例えば、以下のような要素を追加するとさらに面白くなるかもしれない。</p>
<ul>
<li>銃の種類によって弾丸の見た目や速度を変える。</li>
<li>銃を切り替えたらプレイヤーキャラクターのスプライトも変更する。</li>
<li>弾丸をリロードしたりレーザーのエネルギーを充填するアニメーションや間を設ける。</li>
<li>弾丸がオブジェクトに当たって解放される時に煙や破片のようなパーティクルを追加して演出する。</li>
<li>銃の種類ごとに当たったオブジェクトへのダメージを設定し、オブジェクト側にもいわゆるHPなどの一定のライフの値を設定し、ライフが 0 になったら破壊できるようにする。</li>
</ul>
<br>
<hr>
<h1 id="リンク">リンク<a hidden class="anchor" aria-hidden="true" href="#リンク">#</a></h1>
<ul>
<li><a href="https://www.kenney.nl/" target="_blank">KENNEY</a>
</li>
<li><a href="https://docs.godotengine.org/ja/stable/tutorials/2d/2d_movement.html" target="_blank">Godot 公式オンラインドキュメント：2D移動の概要</a>
</li>
<li><a href="https://docs.godotengine.org/ja/stable/classes/class_line2d.html" target="_blank">Godot 公式オンラインドキュメント：Line2D</a>
</li>
<li><a href="https://docs.godotengine.org/ja/stable/classes/class_raycast2d.html" target="_blank">Godot 公式オンラインドキュメント：RayCast2D</a>
</li>
<li><a href="https://docs.godotengine.org/ja/stable/tutorials/2d/particle_systems_2d.html" target="_blank">Godot 公式オンラインドキュメント：パーティクル・システム(2D)</a>
</li>
<li><a href="https://docs.godotengine.org/ja/stable/classes/class_particles2d.html#class-particles2d" target="_blank">Godot 公式オンラインドキュメント：Particles2D</a>
</li>
<li><a href="https://docs.godotengine.org/ja/stable/classes/class_particlesmaterial.html#class-particlesmaterial" target="_blank">Godot 公式オンラインドキュメント：ParticlesMaterial</a>
</li>
<li><a href="https://note.com/doromaito/n/n79c6b008ec44" target="_blank">note：[Godot]ゲームで使う数学の覚書</a>
</li>
</ul>
<br>
<p><strong>UPDATE</strong><br>
2022/05/07 タイポ修正</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://www.peanuts-code.com/ja/tags/godot/">Godot</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/godotengine/">GodotEngine</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%82%B2%E3%83%BC%E3%83%A0%E9%96%8B%E7%99%BA/">ゲーム開発</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB/">チュートリアル</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/2d/">2D</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%83%88%E3%83%83%E3%83%97%E3%83%80%E3%82%A6%E3%83%B3/">トップダウン</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E8%A6%8B%E4%B8%8B%E3%82%8D%E3%81%97%E5%9E%8B/">見下ろし型</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0/">シューティング</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E9%8A%83/">銃</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E5%B0%84%E6%92%83/">射撃</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://www.peanuts-code.com/ja/tutorials/gd0007_bullethell/">
    <span class="title">« 前のページ</span>
    <br>
    <span>Godot で作る弾幕シューティングの弾幕</span>
  </a>
  <a class="next" href="https://www.peanuts-code.com/ja/tutorials/gd0009_various_searches/">
    <span class="title">次のページ »</span>
    <br>
    <span>Godot エディタの便利な検索機能</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るトップダウンシューティングの 4 種類の銃 on twitter"
        href="https://twitter.com/intent/tweet/?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%88%e3%83%83%e3%83%97%e3%83%80%e3%82%a6%e3%83%b3%e3%82%b7%e3%83%a5%e3%83%bc%e3%83%86%e3%82%a3%e3%83%b3%e3%82%b0%e3%81%ae%204%20%e7%a8%ae%e9%a1%9e%e3%81%ae%e9%8a%83&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0006_guns_of_topdown_shooter%2f&amp;hashtags=Godot%2cGodotEngine%2c%e3%82%b2%e3%83%bc%e3%83%a0%e9%96%8b%e7%99%ba%2c%e3%83%81%e3%83%a5%e3%83%bc%e3%83%88%e3%83%aa%e3%82%a2%e3%83%ab%2c2D%2c%e3%83%88%e3%83%83%e3%83%97%e3%83%80%e3%82%a6%e3%83%b3%2c%e8%a6%8b%e4%b8%8b%e3%82%8d%e3%81%97%e5%9e%8b%2c%e3%82%b7%e3%83%a5%e3%83%bc%e3%83%86%e3%82%a3%e3%83%b3%e3%82%b0%2c%e9%8a%83%2c%e5%b0%84%e6%92%83">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るトップダウンシューティングの 4 種類の銃 on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0006_guns_of_topdown_shooter%2f&amp;title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%88%e3%83%83%e3%83%97%e3%83%80%e3%82%a6%e3%83%b3%e3%82%b7%e3%83%a5%e3%83%bc%e3%83%86%e3%82%a3%e3%83%b3%e3%82%b0%e3%81%ae%204%20%e7%a8%ae%e9%a1%9e%e3%81%ae%e9%8a%83&amp;summary=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%88%e3%83%83%e3%83%97%e3%83%80%e3%82%a6%e3%83%b3%e3%82%b7%e3%83%a5%e3%83%bc%e3%83%86%e3%82%a3%e3%83%b3%e3%82%b0%e3%81%ae%204%20%e7%a8%ae%e9%a1%9e%e3%81%ae%e9%8a%83&amp;source=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0006_guns_of_topdown_shooter%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るトップダウンシューティングの 4 種類の銃 on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0006_guns_of_topdown_shooter%2f&title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%88%e3%83%83%e3%83%97%e3%83%80%e3%82%a6%e3%83%b3%e3%82%b7%e3%83%a5%e3%83%bc%e3%83%86%e3%82%a3%e3%83%b3%e3%82%b0%e3%81%ae%204%20%e7%a8%ae%e9%a1%9e%e3%81%ae%e9%8a%83">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るトップダウンシューティングの 4 種類の銃 on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0006_guns_of_topdown_shooter%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るトップダウンシューティングの 4 種類の銃 on whatsapp"
        href="https://api.whatsapp.com/send?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%88%e3%83%83%e3%83%97%e3%83%80%e3%82%a6%e3%83%b3%e3%82%b7%e3%83%a5%e3%83%bc%e3%83%86%e3%82%a3%e3%83%b3%e3%82%b0%e3%81%ae%204%20%e7%a8%ae%e9%a1%9e%e3%81%ae%e9%8a%83%20-%20https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0006_guns_of_topdown_shooter%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るトップダウンシューティングの 4 種類の銃 on telegram"
        href="https://telegram.me/share/url?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%88%e3%83%83%e3%83%97%e3%83%80%e3%82%a6%e3%83%b3%e3%82%b7%e3%83%a5%e3%83%bc%e3%83%86%e3%82%a3%e3%83%b3%e3%82%b0%e3%81%ae%204%20%e7%a8%ae%e9%a1%9e%e3%81%ae%e9%8a%83&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0006_guns_of_topdown_shooter%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://www.peanuts-code.com/ja/">Peanuts Code</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
