<!doctype html><html lang=ja dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Godot3 で作るプラットフォーマー Part 1：プレイヤーキャラクターを作ろう！ | Peanuts Code</title>
<meta name=keywords content="GodotEngine,GameDev,2D,アクションゲーム,横スクロール,プラットフォーマー"><meta name=description content="このチュートリアルシリーズでは、スーパーマリオのような横スクロールアクションゲーム、いわゆる「プラットフォーマー」というジャンルのゲームを作っていく。今回は、初回ということで、ゲームのプレイ画面にプレイヤーキャラクターを用意して操作するところまでやってみよう。

Memo:

ゲームを作り始めるのに以下の記事もお役立てください。
Godot をダウンロードする

Godot のプロジェクトマネージャー

Godot の言語設定

Godot で作るブロック崩しシリーズ
"><meta name=author content="gobo"><link rel=canonical href=https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_1/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.peanuts-code.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.peanuts-code.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.peanuts-code.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.peanuts-code.com/apple-touch-icon.png><link rel=mask-icon href=https://www.peanuts-code.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ja href=https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_1/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Godot3 で作るプラットフォーマー Part 1：プレイヤーキャラクターを作ろう！"><meta property="og:description" content="このチュートリアルシリーズでは、スーパーマリオのような横スクロールアクションゲーム、いわゆる「プラットフォーマー」というジャンルのゲームを作っていく。今回は、初回ということで、ゲームのプレイ画面にプレイヤーキャラクターを用意して操作するところまでやってみよう。

Memo:

ゲームを作り始めるのに以下の記事もお役立てください。
Godot をダウンロードする

Godot のプロジェクトマネージャー

Godot の言語設定

Godot で作るブロック崩しシリーズ
"><meta property="og:type" content="article"><meta property="og:url" content="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_1/"><meta property="og:image" content="https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_1/img56.gif"><meta property="article:section" content="tutorials"><meta property="article:published_time" content="2022-01-29T23:38:27+09:00"><meta property="article:modified_time" content="2022-10-16T00:00:00+00:00"><meta property="og:site_name" content="Peanuts Code 🥜"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_1/img56.gif"><meta name=twitter:title content="Godot3 で作るプラットフォーマー Part 1：プレイヤーキャラクターを作ろう！"><meta name=twitter:description content="このチュートリアルシリーズでは、スーパーマリオのような横スクロールアクションゲーム、いわゆる「プラットフォーマー」というジャンルのゲームを作っていく。今回は、初回ということで、ゲームのプレイ画面にプレイヤーキャラクターを用意して操作するところまでやってみよう。

Memo:

ゲームを作り始めるのに以下の記事もお役立てください。
Godot をダウンロードする

Godot のプロジェクトマネージャー

Godot の言語設定

Godot で作るブロック崩しシリーズ
"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"🤖 チュート","item":"https://www.peanuts-code.com/ja/tutorials/"},{"@type":"ListItem","position":2,"name":"🤖 シリーズ：Godot で作るプラットフォーマー","item":"https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/"},{"@type":"ListItem","position":3,"name":"Godot3 で作るプラットフォーマー Part 1：プレイヤーキャラクターを作ろう！","item":"https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Godot3 で作るプラットフォーマー Part 1：プレイヤーキャラクターを作ろう！","name":"Godot3 で作るプラットフォーマー Part 1：プレイヤーキャラクターを作ろう！","description":"このチュートリアルシリーズでは、スーパーマリオのような横スクロールアクションゲーム、いわゆる「プラットフォーマー」というジャンルのゲームを作っていく。今回は、初回ということで、ゲームのプレイ画面にプレイヤーキャラクターを用意して操作するところまでやってみよう。\nMemo: ゲームを作り始めるのに以下の記事もお役立てください。\nGodot をダウンロードする Godot のプロジェクトマネージャー Godot の言語設定 Godot で作るブロック崩しシリーズ ","keywords":["GodotEngine","GameDev","2D","アクションゲーム","横スクロール","プラットフォーマー"],"articleBody":"このチュートリアルシリーズでは、スーパーマリオのような横スクロールアクションゲーム、いわゆる「プラットフォーマー」というジャンルのゲームを作っていく。今回は、初回ということで、ゲームのプレイ画面にプレイヤーキャラクターを用意して操作するところまでやってみよう。\nMemo: ゲームを作り始めるのに以下の記事もお役立てください。\nGodot をダウンロードする Godot のプロジェクトマネージャー Godot の言語設定 Godot で作るブロック崩しシリーズ 新規プロジェクトを作る 右側の「新規プロジェクト」ボタンをクリックする。\nプロジェクトを保存したい場所を選択して、右上の「フォルダーを作成」をクリックしてプロジェクトのフォルダ名を入力して「OK」をクリックする。ここではシンプルに「Platformer」と名付けたが、実際に自分のオリジナルのゲームを開発するときは仮でも独自の名前を設定しよう。\n「現在のフォルダーを選択」をクリックする。\nレンダラーには「OpenGL ES3.0」を選択して「作成して編集」をクリックする。Webブラウザで動くようなゲームを開発する場合はレンダラーに「OpenGL ES 2.0」を選択するが、このチュートリアルでは PC ゲームを想定しているので、これで良い。\nこれでエディターの初期画面が表示された。\nアセットファイルを取り込む まずはプロジェクトに必要なキャラクターや背景の画像ファイル一式（アセット）をまとめて準備しておこう。\nただし、このまま画像のインポートをすると、ドット絵（Pixel Art）の場合、特有のエッジが効いた画像ではなく、ぼやけた感じの画像に補正されてしまう。これを避けるために、事前準備として、インポートのデフォルトの設定を変更する。\n具体的には、Godot エディタ左上の「インポート」ドックを開き、「プリセット」ボタンをクリックしたら「2D Pixel」を選択する。\n同様に「プリセット」を開き、「‘Texture’のデフォルトとして設定」を選択する。\nこれでインポートの必要な設定変更ができたので、下記のリンクからアセットをまとめてダウンロードしよう。\nDownload Assets: 1. Dropboxの共有フォルダ \u003e Assets.zip 2. アセット1: Pixel Adventure 3. アセット2: Pixel Adventure 2 1 は、このチュートリアルのために 2、3 でダウンロードしたファイルを一つにまとめたものです。2、3で直接ダウンロードする場合、制作者の方に寄付したり、作品に高評価をつけたりすることで、結果制作活動を応援することができます。ここで取り扱っているアセットファイルは Creative Commons Zero (CC0) ライセンスの下でリリースされています。ライセンスについて詳しくはこちら をご覧ください。\nダウンロードしたアセットファイルをまとめた「Assets」フォルダを丸ごと、ファイルシステム上の「res://」フォルダ直下にドラッグ\u0026ドロップして取り込む。\nゲームのウインドウサイズを設定する 事前準備がもう少しある。実際にゲームをプレイする時のウインドウサイズを設定しておこう。\n「プロジェクト」メニュー＞「プロジェクト設定」を選択する。\n「一般」タブを開いた状態で、「検索」ボタンをクリックして「window」と検索しよう。すると「Display」カテゴリの「Window」という項目が見つかるはずだ。これを選択してウインドウサイズを設定する。\n「Size」セクションの「Width（幅）」と「Height（高さ）」を 384 x 256 px に設定する。これから使用するキャラクターのスプライトの画像が 32 x 32 px なので、32 で割り切れるサイズにした。\n続けて「Stretch」セクションの「Mode」を「2d」に変更し、「Aspect（縦横比）」を「keep」にしておこう。\nLevel1 シーンを作る レベルというと、日本ではRPGのキャラクターの成長を表す指標としてよく用いられる単語だが、海外のゲームの場合、日本のアクションゲームやシューティングゲームで階層を表す「ステージ」に相当する単語として用いられる。海外のスタンダードにも慣れておきたいので、このチュートリアルでも「ステージ」ではなく「レベル」という単語を使用していく。\nさっそくだが、まずは最初のレベルである「Level1」のシーンを作っていく。\nプロジェクトを作ってすぐの画面では、左側のシーンドックでルートノードを生成できる。ここでは「2D シーン」を選択しよう。これを選択すると「Node2D」クラスのノードがルートノードとして作られる。\nNode2D ノードの名前を「Level1」に変更しよう。\nそのまま「シーン」メニュー＞「シーンを保存」、もしくは Windows: Ctrl + S / macOS: Cmd + S のショートカットでシーンを保存する。このとき、レベルのシーンをまとめるためのフォルダを先々のために用意しておく。まずは表示されたパネルの右上にある「フォルダーを作成」をクリックする。\n「Levels」と名付けて「OK」をクリック。\nLevel1 シーンのファイル名を「Level1.tscn」として「保存」をクリックする。\nこれでゲームの舞台となる「Level1」シーンが用意できた。この舞台に、背景を配置したり、役者であるプレイヤーキャラクターや、敵キャラクター、コインなどのアイテム、ゴールなどを配置して、徐々にゲーム画面を作り上げていく。\nプレイヤーキャラクターのノードを作る 「Level1」ノードが同名の「Level1」シーンのルートノードであり、そのルートノードに紐づくノードを子ノードと言う。子ノードにさらにノードがぶら下がって孫ノードとなり、これらのルートの下に紐づく子ノード以下のノードの集まりをブランチという。\nシーンを一つの木だとすると、ルートノードが木の幹、ブランチが枝葉である。このような構造を一般的にツリー構造と呼ぶ。Godot の一つの特徴として、このツリー構造を最大限活かして、コンポーネントの構成が非常に分かりやすくなっている。\nではルートノード「Level1」にプレイヤーキャラクターとして必要なノードを追加していこう。「Level1」ノードを選択した状態で、上の「＋」ボタン、もしくはショートカット（Windows: Ctrl + A / macOS: Cmd + A）でノードを追加する。\n最初に追加するのは「KinematicBody2D」クラスのノードだ。検索して選択したら「作成」ボタンをクリックすれば、このクラスのノードが追加される。「KinematicBody2D」ノードの名前を「Player」に変更しておこう。\n次に「Player」ノードを選択して、子ノードを追加する。「AnimatedSprite」クラスのノードを追加しよう。\n同様に、「Player」ノードを選択した状態で、子ノードをもう一つ追加する。今度は「CollisionShape2D」クラスのノードを追加しよう。\nここまでで、シーンドックはこのように表示されていればOKだ。\nAnimatedSprite ノードを編集する ただ一枚の画像をスプライトとして割り当てるなら「Sprite」クラスのノードを使用するが、スプライトに複数の画像を割り当ててアニメーションさせたいときは、「AnimatedSprite」クラスのノードを使用する。\n公式オンラインドキュメント： AnimatedSprite シーンドックで「AnimatedSprite」ノードを選択した状態で、右側のインスペクタードックを見てほしい。\nでは、一番上の「Frames」プロパティを編集する。「空」の箇所をクリックするとプルダウンメニューが表示されるので、「新規 SpriteFrames」を選択しよう。\n次に「Playing」プロパティをオンにしよう。デフォルトではオフになっているが、それではアニメーションが再生されないから要注意だ。\nプロパティの編集はひとまずこれだけだ。次に、一番上の「Frames」プロパティの「SpriteFrames」をクリックしよう。\nすると Godot エディタ下部の「スプライトフレーム」パネルが開く。ここでアニメーションを作っていく。\n元々一つ用意されているアニメーションの名前を「defalut」から「idle」に変更しよう。\nこのアニメーション「idle」にスプライトシート（複数の画像が一つの画像ファイルにまとめられたもの）を割り当てる。「アニメーションフレーム」セクション上部の左から二番目のアイコンをクリックしよう。\nこのチュートリアルで使うプレイヤーキャラクターは「Pink Man」にしたいので、先ほどインポートしたアセットファイル一式から「res://Assets/Main Characters/Pink Man」フォルダまでたどり、「idle (32x32).png」ファイルを選択して「開く」を押す。\n今度はパネル左上を見てみよう。スプライトシート上で水平方向と垂直方向にいくつずつ画像が分けられているのかを指定する。今回開いたスプライトシートを見ると、画像は横一列に11種類用意されているので、ここでは「水平：11、垂直：1」としておこう。この数値がおかしいと、画像が途中で切れたり、隣の画像が入ってきたりするのでよく見て設定してほしい。\n続けてパネル右上を見てみると「すべてのフレームを選択/消去」ボタンがある。これをクリックしよう。\nすると、シートの画像が正しい区切りで全て選択できた。\n最後にパネル下部の「11フレームを追加」をクリックする。\nこれでスプライトシート上の全てのスプライトのテクスチャ画像を一括で取り込むことができた。\nアニメーションの速度を変更しておこう。値は 1 秒あたりのフレーム数（FPS: Frames Per Second）だ。デフォルトは 5 になっており、値が大きくなるほど、アニメーションの動きが速くなる。ここでは 24 とした。\nちなみに、アニメーションフレームセクション右上の (+) と (-) ボタンで画像の拡大縮小が可能だ。\n同様の手順で他のスプライトシートの分もアニメーションを用意しておこう。\nなお「Pink Man/Fall (32x32).png」と「Pink Man/Jump (32x32).png」はスプライトシートではなくテクスチャ画像が1つだけのファイルなので、単純にファイルシステムドックからアニメーションフレームへドラッグ\u0026ドロップしたほうが早い。\nインスペクターで「Animation」プロパティの選択を切り替えながら、2D ワークスペース上でそれぞれのアニメーションをチェックしてみよう。\n最終的に作ったアニメーション全てを使うかどうかはまだこの時点ではわからないが、ひとまずプレイヤーキャラクターのアニメーション作成は完了だ。\nCollisionShape2D ノードを編集する ここからは「CollisionShape2D」ノードのプロパティを編集していく。とは言っても、比較的直感的に作業することが多いので、サクッと終えられるに違いない。さっそくコリジョン形状を設定しよう。\n公式オンラインドキュメント： CollisionShape2D シーンドックで「CollisionShape2D」ノードを選択したら、インスペクターで「Shape」プロパティのプルダウンメニューをクリックし、「新規CapsuleShape2D」を選択しよう。「新規RectangleShape2D」でも良いのだが、スプライトのテクスチャが丸みのあるデザインのため、今回は四角ではなくカプセル型にした。\n次に2Dワークスペースで、今設定したばかりのコリジョン形状を調整していく。まずはドラッグ操作で調整しやすいように、ツールバーのスナッピングオプションアイコンをクリックして、「ピクセルスナップを使用」にチェックを入れておく。これで 1 pixel 単位でコリジョン形状がスナップするので、調整しやすいはずだ。ドット絵の場合は特に便利なので覚えておこう。\nそのまま2Dワークスペース上で、コリジョン形状の上と右にある 赤い丸 をドラッグしてサイズと形を調整しよう。下のスクリーンショットのように、横幅はスプライトテクスチャの体の幅に、縦の高さはスプライトテクスチャの頭のてっぺんから足までの長さに、それぞれ合わせられたらOKだ。\n調整が完了したら、「Player」ノードの子ノードである「AnimatedSprite」ノードや「CollisionShape2D」ノードの位置が2Dワークスペース上で誤ってズレてしまわないように、子ノードを選択できないようにしよう。\nまずシーンドックで「Player」ノードを選択する。\nツールバーの「子ノードを選択不可にする」アイコンをクリックするだけでOKだ。\n同じアイコンがシーンドックの「Player」ノードの横に表示された。これで2Dワークスペース上で「Player」の子ノードは選択できない状態になった。\n仮の足場を作る このゲームはプラットフォーマーなので、このあとキャラクターに歩いたりジャンプしたりする動作を設定していく。しかし、その時に足場がないと、キャラクターはゲームが開始するや否や、重力によって画面の下方向に落下して消えてしまう。\nそこで、「Level1」ノードに、ひとまず仮の足場として「StaticBody2D」ノードを追加しよう。名前を「TempGround」とでも変更しておくと分かりやすい。さらに「TempGround」ノードに「CollisionShape2D」ノードを追加しよう。ちなみに、マップはあとできちんと作る機会があるので安心してほしい。\n「CollisionShape2D」ノードにコリジョン形状を設定する。「Shape」プロパティを「新規RectangleShape2D」とし、「Extents」プロパティ (x, y) を (128, 10) に設定しよう。\n2D ワークスペースで「Player」ノードを大体中央に移動し、「TempGround」ノードをその少し下に配置する。これで仮の足場ができた。\nインプットマップにアクションを追加する インプットマップとは、ゲームの入力操作設定だ。キーボードのキーやマウスのクリック、ゲームパッドのボタンなど、ゲームで利用する予定のものを「アクション」として登録することができる。デフォルトの「アクション」もいくつか登録されているが、このチュートリアルではキーボードのキー入力をいくつか追加登録していく。プレイヤーの動きをプログラミングする前に必要な作業だ。\nまずは「プロジェクト」メニュー＞「プロジェクト設定」を選択する。\n「インプットマップ」タブに切り替えたら、追加したい「アクション」（入力操作）に名前をつけて「追加」ボタンで登録する。\n以下の4つのアクションを登録しよう。登録できたら「+」ボタンでキーを割り当てていく。\nmove_right move_left jump_force dash\n登録したアクションの「+」ボタンを押したら、入力装置の種類の選択をする。ここでは「キー」を選択しよう。これはキーボードのキーを意味している。\n中央に「確認」のダイアログが出るので、この状態で設定したいキーボードのキーを実際に押下する。例えば、一つ目のアクション「move_right」の場合はキーボードの「右矢印キー」を押下すれば良い。確定するときは「OK」をクリックする。つい「Enter」キーを押下しがちだが、それだと「Enter」キーが割り当てられてしまう。\n追加した4つのアクションには以下通りにキーを割り当てると良い。もちろん自分好みに変更していただいても結構だ。\nmove_right: Right（右矢印キー） move_left: Left（左矢印キー） jump: Up（上矢印キー） dash: Space（スペースキー） 4つとも登録できたら「閉じる」ボタンをクリックして設定は完了だ。\nPlayer ノードにスクリプトをアタッチする さてここからは、プレイヤーキャラクターの動きを作っていく。動きを作るには、プログラミングが必要だ。プログラミングがまだ不慣れな方は、ひとまずチュートリアルのコードをコピー＆ペーストして、プレイヤーキャラクターの動きを見ながら理解を深めていっていただいても良いだろう。\nところで、Godot では GDScriptという独自のプログラミング言語か、別のゲームエンジン Unity でも使用される C# と言うプログラミング言語を使用する。C# の場合、Godot とは別のエディターを使用する必要があったり、文法がやや難しかったりで、経験者向きの側面が強いことから、このチュートリアルでは、文法がより初学者にも理解しやすい GDScript を使用する。GDScript なら、Godot エディター上でそのままコーディング（コードを入力してプログラムを作っていく作業のこと）でき、ドキュメンテーションを Godot エディター上で確認できるので、よりゲーム開発の作業に集中しやすいだろう。\nでは「Player」ノードにプログラムを記述するためのスクリプトをアタッチしよう。シーンドックで「Player」を選択し、右上の「選択したノードに新規または既存のスクリプトをアタッチする」アイコンをクリックする。\nスクリプトの保存先を変更したいので、「パス」の右側にあるフォルダーアイコンをクリックする。\nパネルが開いたら、パスを確認しよう。パスがリソースのルート「res://」になっていなければ、左上の「↑」アイコンをクリックしてルートまで戻り、そこで右上の「フォルダーを作成」ボタンをクリックする。\nフォルダーの名前に「Player」と入力して「OK」をクリックして確定する。\nパネル上部の「パス」が今作成したフォルダーのパスになっていればOKだ。ファイル名を「Player.gd」として「開く」をクリックしよう。ちなみに、ファイルの拡張子 .gd は GDScript ファイルのことを指している。\nパスが変更されたのを確認したら「作成」ボタンをクリックする。\nGodot エディタの中央が、2D ワークスペースからスクリプトエディタに切り替わり、今アタッチしたばかりのスクリプト「Player.gd」が開いた状態になった。これから、このスクリプトを編集していく。\nプレイヤーキャラクターの動きを実装する まず、デフォルトで入力されているコメントや_readyメソッドはこのスクリプトでは不要なので、削除しておこう。\n次に必要なプロパティ（クラス内で定義する変数のこと）を定義していく。下記のコードを「Player.gd」スクリプトの 3 行目以下に記述してほしい。\nexport var acceleration = 256 export var max_speed = 64 export var max_dash_speed = 80 export var friction = 0.1 export var gravity = 512 export var jump_force = 224 export var air_resistance = 0.02 var velocity = Vector2.ZERO コードの先頭にexportがついているプロパティは、その値をインスペクターでも編集できるようになる。試しに「player」ノードを選択してインスペクターを見てみよう。スクリプトに記述したプロパティが表示されているのがわかるだろう。スクリプトで定義した値がデフォルトの値になっている。\nexportキーワードをつければ、スクリプト上でプロパティの値を直接編集しなくても、インスペクター上で気軽に編集できる。デバッグしながら値の微調整が必要になると思われるプロパティにはexportをつけるのがおすすめだ。\nでは今回定義したプロパティについてそれぞれ説明しておこう。\nacceleration: プレイヤーキャラクターの左右移動操作時の加速度。 max_speed: プレイヤーキャラクターの左右移動操作時の最大速度。 max_dash_speed: プレイヤーキャラクターの左右ダッシュ移動操作時の最大速度。 friction: プレイヤーキャラクターの左右移動操作をやめた時に受ける摩擦抵抗。 gravity: プレイヤーキャラクターが常に画面下方向に受ける重力。 jump_force: プレイヤーキャラクターのジャンプ操作時のジャンプ力。 air_resistance: プレイヤーキャラクターのジャンプ操作時に受ける空気抵抗。 velocity: 方向の要素を持ったプレイヤーキャラクターの速度、デフォルト値はVector2型で(0, 0)。値はこのあとのプログラミングによりリアルタイムで更新される予定。 さらにスクリプトの一番下の行で、spriteプロパティをonreadyキーワードをつけて定義しよう。\nonready var sprite = $AnimatedSprite spriteプロパティの値は、「Player」ノードの子ノードである「AnimatedSprite」ノードを定義した。onreadyをつけたプロパティは、全てのノードの読み込みが終わってから定義される。ノードの読み込みは親ノードの方が子ノードより先なので、子ノードをプロパティに格納したい場合は、onreadyキーワードを利用してプロパティを定義する。\nこのようにして、子ノードのプロパティやメソッドにアクセスする予定がある場合は、プロパティとして定義しておくと、このあとのコーディングが楽になる。また、シーンツリー（シーン内のノードの構成）に変更があっても、このプロパティの値だけ変更すれば良いので、メンテナンスがしやすいというメリットもある。Godot でのゲーム開発では割と一般的な手法だ。\n次に定義するのは_physics_processメソッドだ。このメソッドは「Node」クラスの組み込み関数だ。「KinematicBody2D」クラスは「Node」クラスを継承しているので利用できる。\n_physics_processメソッドは、物理フレーム（デフォルトでは1秒間に60フレーム）ごとにメソッド内のコードを実行してくれる。これを利用して、プレイヤーの入力操作によって、プレイヤーキャラクターの動きを制御することができる。\nでは具体的にやっていこう。スクリプトの一番下に次のコードを記述しよう。\nfunc _physics_process(delta): velocity.y += gravity * delta _physics_processの引数deltaは1フレームあたりの秒数（デフォルトでは1/60秒）だ。velocity.yの値にgravityにdeltaを乗じた値を足している。ゲーム開発では一般的に、2次元の x, y 座標で y 軸の値は、画面の下にいくほど大きく、上にいくほど小さくなる。毎フレームgravityの値をvelocityの y に加算することで、プレイヤーキャラクターを常に画面下方向に動かす力を加えている。これにより、キャラクターに重力がかかっている状態を作ることができた。\nさらに、次のコードを_physics_processメソッドに追加しよう。\nvar x_input = Input.get_action_strength(\"move_right\") - Input.get_action_strength(\"move_left\") if x_input != 0: velocity.x += x_input * acceleration velocity.x = clamp(velocity.x, -max_speed, max_speed) メソッド内でx_input変数を定義した。Inputクラスのget_action_strengthメソッドは、引数のインプットアクションが入力されれば 1 を、されなければ 0 を返す。つまり、プレイヤーが右矢印キーを押せば 1 、左矢印キーを押せば -1 、どちらも押さなければ 0 の値がx_inputに入る。\nその次のif x_input != 0:の if 構文は、右か左の矢印キーいずれかを押した場合、ということになる。\nvelocity.xに、x_inputにaccelerationを乗じた値を加算している。これで、プレイヤーが右か左の矢印キーを押した方向へ、毎フレーム加速しながらプレイヤーキャラクターを移動させる仕組みができた。\nしかし、このままだと毎フレーム加速し続け、とんでもないスピードでキャラクターが移動してしまう。そこで、組み込みのclampメソッドを利用して、velocity.xの値が最大値および最小値の範囲内に収まるようにする。clampメソッドは最大値に第二引数、最小値に第三引数、どちらにも達していなければ第一引数を返す。\nさらに、プレイヤーキャラクターにダッシュ機能を実装したいので、インプットアクション「dash」の入力操作、つまりスペースキーを入力しているかどうかで、条件分岐させた。if x_input != 0:のブロックは以下のように変更した。\nif x_input != 0: velocity.x += x_input * acceleration if Input.is_action_pressed(\"dash\"): velocity.x = clamp(velocity.x, -max_dash_speed, max_dash_speed) else: velocity.x = clamp(velocity.x, -max_speed, max_speed) さらにif x_input != 0:ブロックの最後にこのコードも追加しよう。\nsprite.flip_h = x_input \u003c 0 スプライトのテクスチャの水平方向に反転させるプロパティflip_hは、x_inputが 0 より小さい値（つまり左矢印キーを押下して -1 ）になっているときに有効になるようにした。\nvelocityの値を実際のキャラクターの移動に反映させるために、「KinematicBody2D」クラスの組み込みメソッドであるmove_and_slideを_physics_processメソッドの最後に追加する。\nvelocity = move_and_slide(velocity, Vector2.UP) このmove_and_slideメソッドは、第一引数に割り当てた速度に delta を自動的に乗じて、このスクリプトがアタッチされている「KinematicBody2D」クラスのノードを移動してくれる。第二引数は、上方向がどちらかを指定する。プラットフォーマーは画面の上方向がそれに当たるのでVector2.UPを割り当てた。これによって、自動的に天井、地面、壁がどの方向なのかを判別してくれる。\nでは一旦ここでプロジェクトを実行してキャラクターの動きを確認してみよう。\nデバッグパネルで、足場である「TempGround」ノードのコリジョン形状が見えるようにするため、先に「デバッグ」メニュー＞「コリジョン形状を表示」にチェックを入れておこう。\nGodot エディタ右上の「プロジェクトを実行」アイコンをクリックする。\nまだメインシーンを選択していない場合はダイアログが表示されるので、「現在のものを選択」をクリックする。\nデバッグパネルが開くので動きを確認してみよう。\n重力は機能して、キャラクターはきちんと足場に落ちている。スプライトのテクスチャもflip_hプロパティの切り替えにより向きが変われば反転している。しかし、左右の移動は右または左の矢印キーを一回押下しただけで滑り続けて止まらない状態だ。さらに必要なコードを追加していこう。\n今度は、velocity = move_and_slide(velocity, Vector2.UP)のコードより前に、以下の if ブロックのコードを追加しよう。\nif is_on_floor(): if x_input == 0: sprite.play(\"idle\") velocity.x = lerp(velocity.x, 0, friction) else: sprite.play(\"run\") is_on_floorメソッドは、現在地面にキャラクターが接しているかを判定してくれる。接していれば戻り値が true になる。if x_input == 0:は左右移動の入力がない場合という条件の if 構文だ。この if / else ブロック内を見ていく。\nまず、sprite（「AnimatedSprite」ノード）のplayメソッドによりアニメーション「idle」を再生する。\n次に、velocity.xの値は組み込みのlerpメソッドにより、現在のvelocity.xの値の間を第三引数であるfrictionプロパティの重み分だけ、第二引数 0 に近づけていく。_physics_processメソッドが毎フレーム実行されることにより、次第に値は 0 になる。\nelse ブロックの方は、左右移動の入力があった場合という条件になり、このとき「AnimatedSprite」ノードのplayメソッドによりアニメーション「run」が再生される。\nそれでは、改めてプロジェクトを実行して、滑らなくなったか、アニメーションが切り替わるか確認しよう。\nlerpメソッドによる摩擦抵抗の実装で、左右移動の入力がなければ減速して停止するようになった。スペースキーを押下した時のダッシュの挙動も上々だ。ちなみに、何度かmax_dash_speedの値を変更して検証してみたが、80 ではあまり移動速度が変わらなかったので 200 に変更した。せっかくなので、あなたもインスペクターからお好みの速度に調整してみよう。\n次はキャラクターがジャンプできるようにしょう。続けてif is_on_floor():ブロック内に次のコードを追加しよう。\nif Input.is_action_just_pressed(\"jump\"): sprite.play(\"jump\") velocity.y = -jump_force この if ブロックif Input.is_action_just_pressed(\"jump\"):は、（地面にキャラクターが接している時に）インプットアクション「jump」の操作、つまり上矢印キーを一回押した場合、という意味合いだ。この場合「AnimatedSprite」ノードのplayメソッドによりアニメーション「jump」を再生する。そして、この瞬間にvelocity.yにジャンプ力を示すjump_forceを引き算している。引き算するのは、先ほどお伝えした通り、画面上方向にいくほど y 軸の値が小さくなるからだ。\nではプロジェクトを実行して、ジャンプ操作も確認してみよう。\n今のところ大きな問題はなさそうなので良しとしよう。\nあとは少し細かいが、ジャンプ中に左右移動の入力がなかった場合と、ジャンプしてすぐに上矢印キーを離した場合、このそれぞれの動きをコーディングしていこう。\nif is_on_floor():ブロックに続けて、以下のelseブロックを追加して、if / else構文にする。\nelse: if x_input == 0: velocity.x = lerp(velocity.x, 0, air_resistance) if Input.is_action_just_released(\"jump\") and velocity.y \u003c -jump_force / 2: velocity.y = -jump_force / 2 elseブロックは、is_on_floorメソッドの戻り値が false だったら、と言い換えられる。つまり、「地面に接していなかったら（空中だったら）」という意味になる。さらにネストされたif構文が続く。一つ目のifブロックの条件は、if x_input == 0:で、これは「左右移動の入力がなかったら」という意味だ。その場合、velocity.xはlerpメソッドにより、air_resistanceの空気抵抗により毎フレーム 0 に近づいていく。\nelseブロックにネストされて2つ目のif構文を見てみよう。条件式は2つの条件がandで結合されていて、「2つとも満たした場合」という条件になる。\n一つ目の条件は、Inputクラスのis_action_just_releasedメソッドを利用した、（空中で）一度「jump」アクション操作（上矢印キー）を離した場合、という内容だ。\n2つ目の条件は、velocity.yの値が-jump_force / 2（ジャンプ力の2分の1）未満の場合、という内容だ。\nこれらを合わせると、空中でスペースキーを離した時にプレイヤーキャラクターの y 軸方向の速度がジャンプ力の半分未満だったら、という意味になる。これを満たした場合、velocity.yの値には-jump_force / 2（ジャンプ力の半分）の値を適用する。これにより、スペースキーをちょんと押しただけだと、低いジャンプになる。\nそれでは、プロジェクトを実行して変更した内容を確認してみよう。\nスペースキーを押し続けた時と、ちょんと押した時とで、ジャンプする高さが変わった。また、ジャンプ中に左右移動の入力をしない場合、空気抵抗の影響を受け、x 方向の移動距離が少し落ちた。\nひとまずプレイヤーキャラクターの動きが想定通りになったので、「Player.gd」スクリプトの編集は一旦ここまでにしておこう。\nPart 1 で編集したスクリプトのコード 今回編集した「Player.gd」スクリプト全体のコードを最後に共有しておこう。何か動きが思い通りに行かない場合はこちらを参考にしてほしい。\nPlayer.gd スクリプトを確認する extends KinematicBody2D export var acceleration = 256 export var max_speed = 64 export var max_dash_speed = 80 export var friction = 0.1 export var gravity = 512 export var jump_force = 224 export var air_resistance = 0.02 var velocity = Vector2() onready var sprite = $AnimatedSprite func _physics_process(delta): velocity.y += gravity * delta var x_input = Input.get_action_strength(\"move_right\") - Input.get_action_strength(\"move_left\") if x_input != 0: velocity.x += x_input * acceleration if Input.is_action_pressed(\"dash\"): velocity.x = clamp(velocity.x, -max_dash_speed, max_dash_speed) else: velocity.x = clamp(velocity.x, -max_speed, max_speed) sprite.flip_h = x_input \u003c 0 if is_on_floor(): if x_input == 0: sprite.play(\"idle\") velocity.x = lerp(velocity.x, 0, friction) else: sprite.play(\"run\") if Input.is_action_just_pressed(\"jump\"): sprite.play(\"jump\") velocity.y = -jump_force else: if x_input == 0: velocity.x = lerp(velocity.x, 0, air_resistance) if Input.is_action_just_released(\"jump\") and velocity.y \u003c -jump_force / 2: velocity.y = -jump_force / 2 velocity = move_and_slide(velocity, Vector2.UP) Player ノードをシーンにする 最後に「Player」ノードを個別のシーンとして保存し、「Level1」シーンには「Player」シーンのインスタンスをノードとして追加させるようにする。今後、別の新たなブランチをルートノードに追加する場合も、「Player」ノードと同様に、先に別シーンとして作成してから、そのインスタンスをルートノードに追加していくことになるだろう。\n実は Godot では、このように個々のシーンのインスタンスを別のより大きなシーンの子ノードとして追加するのが一般的だ。ゲームの小さい部品を作って、それらを集めて少し大きな部品のシーンを作る、ということを繰り返して、少しずつゲームの規模を大きくしていくというわけだ。とはいえ、Godot でのゲーム開発をはじめ、オブジェクト指向プログラミング全般がそういうものだとも言えるだろう。大きく複雑なプログラムも小さくて簡単なプログラムの組み合わせに過ぎない、と考えれば、ゲーム開発はまったくもって怖くない。\nでは具体的な作業を進めよう。\nシーンドックで「Player」ノードを右クリックして「ブランチをシーンとして保存」を選択する。\nシーンの保存先パスを「res://Player」とし、ファイル名を「Player.tscn」として、「保存」をクリックする。\nすると「Level1」シーンの「Player」ノードの右側に「エディターで開く」アイコンが表示される。これは別のシーンのインスタンスであることを示している。このアイコンをクリックしてみよう。\nするとシーンドックと2Dワークスペースが「Player.tscn」シーンの表示に切り替わる。これで「Player」ノードをシーンにすることができた。\n最後に、後処理を少しやっておこう。まず「Player.tscn」シーンのまま、インスペクターの「Position」プロパティを見て見よう。今までのまま(192, 80)のように、（0, 0）以外の値になっているはずだ。これを、「Player.tscn」シーン上では (0, 0)にしておこう。なぜならこのシーン上でプレイヤーキャラクターの位置を変更する必要がないからだ。\n続けて、2Dワークスペースにて「Level1」タブをクリックして「Level1.tscn」シーンに戻そう。\n同じくインスペクターから「Position」プロパティを (0, 0) から (192, 80)などに変更しておこう。これでさっきデバッグしていた時と同じ状態に戻った。\nおわりに 以上で Part 1 は完了だ。プレイヤーキャラクターが自分の操作で想定通りに動くと嬉しいものだ。ゲーム開発のモチベーションを高めるには、最初にプレイヤーキャラクターを作るというのが実践しやすい一つの方法ではないだろうか。\n次回はタイルマップを作ってゲームの世界を作っていくのでお楽しみに。\nUPDATE\n2022-10-16 仮の足場を作るの手順の「Area2D」の誤記を「StaticBody2D」に訂正\n2022-03-26 Dropbox のアセットの内容に Part 12 で利用するファイルを追加してリンクを更新\n2022-03-24 Dropbox のアセットの内容に Part 11 で利用するファイルを追加してリンクを更新\n","wordCount":"13756","inLanguage":"ja","image":"https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_1/img56.gif","datePublished":"2022-01-29T23:38:27+09:00","dateModified":"2022-10-16T00:00:00Z","author":{"@type":"Person","name":"gobo"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_1/"},"publisher":{"@type":"Organization","name":"Peanuts Code","logo":{"@type":"ImageObject","url":"https://www.peanuts-code.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.peanuts-code.com/ja/ accesskey=h title="Peanuts Code (Alt + H)"><img src=https://www.peanuts-code.com/images/logomark.png alt aria-label=logo height=35>Peanuts Code</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://www.peanuts-code.com/en/ title=English aria-label=🇬🇧English>🇬🇧English</a></li></ul></div></div><ul id=menu><li><a href=https://www.peanuts-code.com/ja/ title=ホーム><span>ホーム</span></a></li><li><a href=https://www.peanuts-code.com/ja/portfolio/ title=ゲーム><span>ゲーム</span></a></li><li><a href=https://www.peanuts-code.com/ja/posts/ title=ブログ><span>ブログ</span></a></li><li><a href=https://www.peanuts-code.com/ja/tutorials/ title=チュート><span>チュート</span></a></li><li><a href=https://www.peanuts-code.com/ja/about/ title=サイト紹介><span>サイト紹介</span></a></li><li><a href=https://www.peanuts-code.com/ja/search/ title="サイト内検索 (Alt + /)" accesskey=/><span>サイト内検索</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.peanuts-code.com/ja/>ホーム</a>&nbsp;»&nbsp;<a href=https://www.peanuts-code.com/ja/tutorials/>🤖 チュート</a>&nbsp;»&nbsp;<a href=https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/>🤖 シリーズ：Godot で作るプラットフォーマー</a></div><h1 class="post-title entry-hint-parent">Godot3 で作るプラットフォーマー Part 1：プレイヤーキャラクターを作ろう！</h1><div class=post-meta><span title='2022-01-29 23:38:27 +0900 +0900'>2022-01-29</span>&nbsp;·&nbsp;28 分</div><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Godot3 で作るプラットフォーマー Part 1：プレイヤーキャラクターを作ろう！ on x" href="https://x.com/intent/tweet/?text=Godot3%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%201%ef%bc%9a%e3%83%97%e3%83%ac%e3%82%a4%e3%83%a4%e3%83%bc%e3%82%ad%e3%83%a3%e3%83%a9%e3%82%af%e3%82%bf%e3%83%bc%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_1%2f&amp;hashtags=GodotEngine%2cGameDev%2c2D%2c%e3%82%a2%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e3%82%b2%e3%83%bc%e3%83%a0%2c%e6%a8%aa%e3%82%b9%e3%82%af%e3%83%ad%e3%83%bc%e3%83%ab%2c%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Godot3 で作るプラットフォーマー Part 1：プレイヤーキャラクターを作ろう！ on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_1%2f&title=Godot3%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%201%ef%bc%9a%e3%83%97%e3%83%ac%e3%82%a4%e3%83%a4%e3%83%bc%e3%82%ad%e3%83%a3%e3%83%a9%e3%82%af%e3%82%bf%e3%83%bc%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Godot3 で作るプラットフォーマー Part 1：プレイヤーキャラクターを作ろう！ on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_1%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li></ul><ul class=post-tags><li><a href=https://www.peanuts-code.com/ja/tags/godotengine/>GodotEngine</a></li><li><a href=https://www.peanuts-code.com/ja/tags/gamedev/>GameDev</a></li><li><a href=https://www.peanuts-code.com/ja/tags/2d/>2D</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B2%E3%83%BC%E3%83%A0/>アクションゲーム</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E6%A8%AA%E3%82%B9%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%AB/>横スクロール</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%BC/>プラットフォーマー</a></li></ul></header><figure class=entry-cover><img loading=eager src=https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_1/img56.gif alt="プラットフォーマー Part 1 サムネイル"></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目次</span></summary><div class=inner><nav id=TableOfContents></nav></div></details></div><div class=post-content><p>このチュートリアルシリーズでは、スーパーマリオのような横スクロールアクションゲーム、いわゆる「プラットフォーマー」というジャンルのゲームを作っていく。今回は、初回ということで、ゲームのプレイ画面にプレイヤーキャラクターを用意して操作するところまでやってみよう。</p><blockquote><p><em><strong><span style=color:teal>Memo:</span></strong><br>ゲームを作り始めるのに以下の記事もお役立てください。<br><a href=https://www.peanuts-code.com/ja/tutorials/gd0001_download/ title="Godot をダウンロードする">Godot をダウンロードする</a><br><a href=https://www.peanuts-code.com/ja/tutorials/gd0002_project_manager/ title="Godot のプロジェクトマネージャー">Godot のプロジェクトマネージャー</a><br><a href=https://www.peanuts-code.com/ja/tutorials/gd0003_change_language/ title="Godot の言語設定">Godot の言語設定</a><br><a href=https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/ title="Godot で作るブロック崩しシリーズ">Godot で作るブロック崩しシリーズ</a></em></p></blockquote><br><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=新規プロジェクトを作る>新規プロジェクトを作る</h1><p>右側の「新規プロジェクト」ボタンをクリックする。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img1.png alt=新規プロジェクト></p><p>プロジェクトを保存したい場所を選択して、右上の「フォルダーを作成」をクリックしてプロジェクトのフォルダ名を入力して「OK」をクリックする。ここではシンプルに「Platformer」と名付けたが、実際に自分のオリジナルのゲームを開発するときは仮でも独自の名前を設定しよう。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img2.png alt=フォルダー作成></p><p>「現在のフォルダーを選択」をクリックする。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img3.png alt=現在のフォルダーを選択></p><p>レンダラーには「OpenGL ES3.0」を選択して「作成して編集」をクリックする。Webブラウザで動くようなゲームを開発する場合はレンダラーに「OpenGL ES 2.0」を選択するが、このチュートリアルでは PC ゲームを想定しているので、これで良い。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img4.png alt=レンダラーを選択して作成して編集></p><p>これでエディターの初期画面が表示された。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img5.png alt=エディターの初期画面></p><br><hr><h1 id=アセットファイルを取り込む>アセットファイルを取り込む</h1><p>まずはプロジェクトに必要なキャラクターや背景の画像ファイル一式（アセット）をまとめて準備しておこう。</p><p>ただし、このまま画像のインポートをすると、ドット絵（Pixel Art）の場合、特有のエッジが効いた画像ではなく、ぼやけた感じの画像に補正されてしまう。これを避けるために、事前準備として、インポートのデフォルトの設定を変更する。</p><p>具体的には、Godot エディタ左上の「インポート」ドックを開き、「プリセット」ボタンをクリックしたら「2D Pixel」を選択する。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img5.0.1.png alt=エディターの初期画面></p><p>同様に「プリセット」を開き、「&lsquo;Texture&rsquo;のデフォルトとして設定」を選択する。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img5.0.2.png alt=エディターの初期画面></p><p>これでインポートの必要な設定変更ができたので、下記のリンクからアセットをまとめてダウンロードしよう。</p><blockquote><p><em><strong><span style=color:salmon>Download Assets:</span></strong></em><br><em>1. <a href="https://www.dropbox.com/s/wq5iyetd57t9gkh/Assets.zip?dl=0" target=_blank>Dropboxの共有フォルダ > Assets.zip</a></em><br><em>2. <a href=https://pixelfrog-assets.itch.io/pixel-adventure-1 target=_blank>アセット1: Pixel Adventure</a></em><br><em>3. <a href=https://pixelfrog-assets.itch.io/pixel-adventure-2 target=_blank>アセット2: Pixel Adventure 2</a></em></p><p><em>1 は、このチュートリアルのために 2、3 でダウンロードしたファイルを一つにまとめたものです。2、3で直接ダウンロードする場合、制作者の方に寄付したり、作品に高評価をつけたりすることで、結果制作活動を応援することができます。ここで取り扱っているアセットファイルは Creative Commons Zero (CC0) ライセンスの下でリリースされています。ライセンスについて詳しくは<a href=http://creativecommons.org/publicdomain/zero/1.0/ target=_blank>こちら</a>
をご覧ください。</em></p></blockquote><p>ダウンロードしたアセットファイルをまとめた「Assets」フォルダを丸ごと、ファイルシステム上の「res://」フォルダ直下にドラッグ&ドロップして取り込む。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img5.1.png alt=ファイルシステムにアセット追加></p><br><hr><h1 id=ゲームのウインドウサイズを設定する>ゲームのウインドウサイズを設定する</h1><p>事前準備がもう少しある。実際にゲームをプレイする時のウインドウサイズを設定しておこう。</p><p>「プロジェクト」メニュー＞「プロジェクト設定」を選択する。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img5.2.png alt=プロジェクト設定></p><p>「一般」タブを開いた状態で、「検索」ボタンをクリックして「window」と検索しよう。すると「Display」カテゴリの「Window」という項目が見つかるはずだ。これを選択してウインドウサイズを設定する。<br>「Size」セクションの「Width（幅）」と「Height（高さ）」を 384 x 256 px に設定する。これから使用するキャラクターのスプライトの画像が 32 x 32 px なので、32 で割り切れるサイズにした。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img5.3.png alt=ウインドウのSizeを設定></p><p>続けて「Stretch」セクションの「Mode」を「2d」に変更し、「Aspect（縦横比）」を「keep」にしておこう。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img5.4.png alt=ウインドウのStretchを設定></p><br><hr><h1 id=level1-シーンを作る>Level1 シーンを作る</h1><p>レベルというと、日本ではRPGのキャラクターの成長を表す指標としてよく用いられる単語だが、海外のゲームの場合、日本のアクションゲームやシューティングゲームで階層を表す「ステージ」に相当する単語として用いられる。海外のスタンダードにも慣れておきたいので、このチュートリアルでも「ステージ」ではなく「レベル」という単語を使用していく。</p><p>さっそくだが、まずは最初のレベルである「Level1」のシーンを作っていく。<br>プロジェクトを作ってすぐの画面では、左側のシーンドックでルートノードを生成できる。ここでは「2D シーン」を選択しよう。これを選択すると「Node2D」クラスのノードがルートノードとして作られる。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img6.png alt=ルートノードを生成></p><p>Node2D ノードの名前を「Level1」に変更しよう。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img7.png alt=Node2Dノードをリネーム></p><p>そのまま「シーン」メニュー＞「シーンを保存」、もしくは Windows: Ctrl + S / macOS: Cmd + S のショートカットでシーンを保存する。このとき、レベルのシーンをまとめるためのフォルダを先々のために用意しておく。まずは表示されたパネルの右上にある「フォルダーを作成」をクリックする。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img8.png alt=フォルダーを作成></p><p>「Levels」と名付けて「OK」をクリック。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img9.png alt=Levelsに変更></p><p>Level1 シーンのファイル名を「Level1.tscn」として「保存」をクリックする。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img10.png alt=Level1.tscnとして保存></p><p>これでゲームの舞台となる「Level1」シーンが用意できた。この舞台に、背景を配置したり、役者であるプレイヤーキャラクターや、敵キャラクター、コインなどのアイテム、ゴールなどを配置して、徐々にゲーム画面を作り上げていく。</p><hr><h1 id=プレイヤーキャラクターのノードを作る>プレイヤーキャラクターのノードを作る</h1><p>「Level1」ノードが同名の「Level1」シーンのルートノードであり、そのルートノードに紐づくノードを子ノードと言う。子ノードにさらにノードがぶら下がって孫ノードとなり、これらのルートの下に紐づく子ノード以下のノードの集まりをブランチという。</p><p>シーンを一つの木だとすると、ルートノードが木の幹、ブランチが枝葉である。このような構造を一般的にツリー構造と呼ぶ。Godot の一つの特徴として、このツリー構造を最大限活かして、コンポーネントの構成が非常に分かりやすくなっている。</p><p>ではルートノード「Level1」にプレイヤーキャラクターとして必要なノードを追加していこう。「Level1」ノードを選択した状態で、上の「＋」ボタン、もしくはショートカット（Windows: Ctrl + A / macOS: Cmd + A）でノードを追加する。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img10.1.png alt=ノードを追加></p><p>最初に追加するのは「KinematicBody2D」クラスのノードだ。検索して選択したら「作成」ボタンをクリックすれば、このクラスのノードが追加される。「KinematicBody2D」ノードの名前を「Player」に変更しておこう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img11.png alt=ルートにKinematicBody2Dノードを追加してPlayerに名前を変更></p><p>次に「Player」ノードを選択して、子ノードを追加する。「AnimatedSprite」クラスのノードを追加しよう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img12.png alt=PlayerノードにAnimatedSprite追加></p><p>同様に、「Player」ノードを選択した状態で、子ノードをもう一つ追加する。今度は「CollisionShape2D」クラスのノードを追加しよう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img13.png alt=PlayerノードにCollisionShape2Dノードを追加></p><p>ここまでで、シーンドックはこのように表示されていればOKだ。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img14.png alt=シーンドックを確認></p><br><hr><h1 id=animatedsprite-ノードを編集する>AnimatedSprite ノードを編集する</h1><p>ただ一枚の画像をスプライトとして割り当てるなら「Sprite」クラスのノードを使用するが、スプライトに複数の画像を割り当ててアニメーションさせたいときは、「AnimatedSprite」クラスのノードを使用する。</p><blockquote><p><em><strong><span style=color:salmon>公式オンラインドキュメント：</span></strong><br><a href=https://docs.godotengine.org/en/stable/classes/class_animatedsprite.html target=_blank>AnimatedSprite</a></em></p></blockquote><p>シーンドックで「AnimatedSprite」ノードを選択した状態で、右側のインスペクタードックを見てほしい。</p><p>では、一番上の「Frames」プロパティを編集する。「空」の箇所をクリックするとプルダウンメニューが表示されるので、「新規 SpriteFrames」を選択しよう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img15.png alt="新規 SpriteFramesを選択"></p><p>次に「Playing」プロパティをオンにしよう。デフォルトではオフになっているが、それではアニメーションが再生されないから要注意だ。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img16.png alt=Playingプロパティをオン></p><p>プロパティの編集はひとまずこれだけだ。次に、一番上の「Frames」プロパティの「SpriteFrames」をクリックしよう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img17.png alt=SpriteFramesをクリック></p><p>すると Godot エディタ下部の「スプライトフレーム」パネルが開く。ここでアニメーションを作っていく。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img18.png alt=スプライトフレームパネルを開く></p><p>元々一つ用意されているアニメーションの名前を「defalut」から「idle」に変更しよう。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img19.png alt=アニメーションの名前をidleに変更></p><p>このアニメーション「idle」にスプライトシート（複数の画像が一つの画像ファイルにまとめられたもの）を割り当てる。「アニメーションフレーム」セクション上部の左から二番目のアイコンをクリックしよう。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img20.png alt=スプライトシートの読み込み></p><p>このチュートリアルで使うプレイヤーキャラクターは「Pink Man」にしたいので、先ほどインポートしたアセットファイル一式から「res://Assets/Main Characters/Pink Man」フォルダまでたどり、「idle (32x32).png」ファイルを選択して「開く」を押す。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img21.png alt=スプライトシートを開く></p><p>今度はパネル左上を見てみよう。スプライトシート上で水平方向と垂直方向にいくつずつ画像が分けられているのかを指定する。今回開いたスプライトシートを見ると、画像は横一列に11種類用意されているので、ここでは「水平：11、垂直：1」としておこう。この数値がおかしいと、画像が途中で切れたり、隣の画像が入ってきたりするのでよく見て設定してほしい。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img22.png alt=スプライトシートのテクスチャの数を合わせる></p><p>続けてパネル右上を見てみると「すべてのフレームを選択/消去」ボタンがある。これをクリックしよう。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img23.png alt=全てのフレームを選択></p><p>すると、シートの画像が正しい区切りで全て選択できた。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img24.png alt=全てのテクスチャが選択された></p><p>最後にパネル下部の「11フレームを追加」をクリックする。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img25.png alt=11フレームを追加></p><p>これでスプライトシート上の全てのスプライトのテクスチャ画像を一括で取り込むことができた。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img26.png alt=スプライトシートでテクスチャの取り込み完了></p><p>アニメーションの速度を変更しておこう。値は 1 秒あたりのフレーム数（FPS: Frames Per Second）だ。デフォルトは 5 になっており、値が大きくなるほど、アニメーションの動きが速くなる。ここでは 24 とした。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img27.png alt=アニメーションの速度を24に設定></p><p>ちなみに、アニメーションフレームセクション右上の (+) と (-) ボタンで画像の拡大縮小が可能だ。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img27.1.png alt=アニメーションフレームの拡大と縮小></p><p>同様の手順で他のスプライトシートの分もアニメーションを用意しておこう。<br>なお「Pink Man/Fall (32x32).png」と「Pink Man/Jump (32x32).png」はスプライトシートではなくテクスチャ画像が1つだけのファイルなので、単純にファイルシステムドックからアニメーションフレームへドラッグ&ドロップしたほうが早い。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img28.png alt=double_jump></p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img29.png alt=fall></p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img30.png alt=hit></p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img31.png alt=jump></p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img32.png alt=run></p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img33.png alt=wall_jump></p><p>インスペクターで「Animation」プロパティの選択を切り替えながら、2D ワークスペース上でそれぞれのアニメーションをチェックしてみよう。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img34.gif alt=2Dワークスペースでアニメーションをチェック></p><p>最終的に作ったアニメーション全てを使うかどうかはまだこの時点ではわからないが、ひとまずプレイヤーキャラクターのアニメーション作成は完了だ。</p><br><hr><h1 id=collisionshape2d-ノードを編集する>CollisionShape2D ノードを編集する</h1><p>ここからは「CollisionShape2D」ノードのプロパティを編集していく。とは言っても、比較的直感的に作業することが多いので、サクッと終えられるに違いない。さっそくコリジョン形状を設定しよう。</p><blockquote><p><em><strong><span style=color:salmon>公式オンラインドキュメント：</span></strong><br><a href=https://docs.godotengine.org/en/stable/classes/class_collisionshape2d.html target=_blank>CollisionShape2D</a></em></p></blockquote><p>シーンドックで「CollisionShape2D」ノードを選択したら、インスペクターで「Shape」プロパティのプルダウンメニューをクリックし、「新規CapsuleShape2D」を選択しよう。「新規RectangleShape2D」でも良いのだが、スプライトのテクスチャが丸みのあるデザインのため、今回は四角ではなくカプセル型にした。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img35.png alt=新規CapsuleShape2Dを選択></p><p>次に2Dワークスペースで、今設定したばかりのコリジョン形状を調整していく。まずはドラッグ操作で調整しやすいように、ツールバーの<strong>スナッピングオプション</strong>アイコンをクリックして、「ピクセルスナップを使用」にチェックを入れておく。これで 1 pixel 単位でコリジョン形状がスナップするので、調整しやすいはずだ。ドット絵の場合は特に便利なので覚えておこう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img36.png alt=ピクセルスナップを有効にする></p><p>そのまま2Dワークスペース上で、コリジョン形状の上と右にある <strong><span style=color:salmon>赤い丸</span>
</strong>をドラッグしてサイズと形を調整しよう。下のスクリーンショットのように、横幅はスプライトテクスチャの体の幅に、縦の高さはスプライトテクスチャの頭のてっぺんから足までの長さに、それぞれ合わせられたらOKだ。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img37.png alt=コリジョン形状の調整></p><p>調整が完了したら、「Player」ノードの子ノードである「AnimatedSprite」ノードや「CollisionShape2D」ノードの位置が2Dワークスペース上で誤ってズレてしまわないように、子ノードを選択できないようにしよう。</p><p>まずシーンドックで「Player」ノードを選択する。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img38.png alt=Playerノード選択></p><p>ツールバーの「子ノードを選択不可にする」アイコンをクリックするだけでOKだ。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img39.png alt=子ノードを選択不可にする></p><p>同じアイコンがシーンドックの「Player」ノードの横に表示された。これで2Dワークスペース上で「Player」の子ノードは選択できない状態になった。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img40.png alt=子ノードを選択不可にした></p><br><hr><h1 id=仮の足場を作る>仮の足場を作る</h1><p>このゲームはプラットフォーマーなので、このあとキャラクターに歩いたりジャンプしたりする動作を設定していく。しかし、その時に足場がないと、キャラクターはゲームが開始するや否や、重力によって画面の下方向に落下して消えてしまう。</p><p>そこで、「Level1」ノードに、ひとまず仮の足場として「StaticBody2D」ノードを追加しよう。名前を「TempGround」とでも変更しておくと分かりやすい。さらに「TempGround」ノードに「CollisionShape2D」ノードを追加しよう。ちなみに、マップはあとできちんと作る機会があるので安心してほしい。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img41.png alt=Area2Dで仮の足場を追加></p><p>「CollisionShape2D」ノードにコリジョン形状を設定する。「Shape」プロパティを「新規RectangleShape2D」とし、「Extents」プロパティ (x, y) を (128, 10) に設定しよう。</p><p>2D ワークスペースで「Player」ノードを大体中央に移動し、「TempGround」ノードをその少し下に配置する。これで仮の足場ができた。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img42.png alt=PlayerノードとTempGroundノードを移動></p><br><hr><h1 id=インプットマップにアクションを追加する>インプットマップにアクションを追加する</h1><p>インプットマップとは、ゲームの入力操作設定だ。キーボードのキーやマウスのクリック、ゲームパッドのボタンなど、ゲームで利用する予定のものを「アクション」として登録することができる。デフォルトの「アクション」もいくつか登録されているが、このチュートリアルではキーボードのキー入力をいくつか追加登録していく。プレイヤーの動きをプログラミングする前に必要な作業だ。</p><p>まずは「プロジェクト」メニュー＞「プロジェクト設定」を選択する。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img42.1.png alt=プロジェクト設定></p><p>「インプットマップ」タブに切り替えたら、追加したい「アクション」（入力操作）に名前をつけて「追加」ボタンで登録する。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img42.2.png alt=インプットマップにアクション追加></p><p>以下の4つのアクションを登録しよう。登録できたら「+」ボタンでキーを割り当てていく。</p><ul><li>move_right</li><li>move_left</li><li>jump_force</li><li>dash<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img42.3.png alt=4つのアクションを追加></li></ul><p>登録したアクションの「+」ボタンを押したら、入力装置の種類の選択をする。ここでは「キー」を選択しよう。これはキーボードのキーを意味している。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img42.4.png alt=キーを選択></p><p>中央に「確認」のダイアログが出るので、この状態で設定したいキーボードのキーを実際に押下する。例えば、一つ目のアクション「move_right」の場合はキーボードの「右矢印キー」を押下すれば良い。確定するときは「OK」をクリックする。つい「Enter」キーを押下しがちだが、それだと「Enter」キーが割り当てられてしまう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img42.5.png alt=キーの割り当て></p><p>追加した4つのアクションには以下通りにキーを割り当てると良い。もちろん自分好みに変更していただいても結構だ。</p><ul><li>move_right: Right（右矢印キー）</li><li>move_left: Left（左矢印キー）</li><li>jump: Up（上矢印キー）</li><li>dash: Space（スペースキー）</li></ul><p>4つとも登録できたら「閉じる」ボタンをクリックして設定は完了だ。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img42.6.png alt=閉じるで終了></p><br><hr><h1 id=player-ノードにスクリプトをアタッチする>Player ノードにスクリプトをアタッチする</h1><p>さてここからは、プレイヤーキャラクターの動きを作っていく。動きを作るには、プログラミングが必要だ。プログラミングがまだ不慣れな方は、ひとまずチュートリアルのコードをコピー＆ペーストして、プレイヤーキャラクターの動きを見ながら理解を深めていっていただいても良いだろう。</p><p>ところで、Godot では <strong>GDScript</strong>という独自のプログラミング言語か、別のゲームエンジン Unity でも使用される <strong>C#</strong> と言うプログラミング言語を使用する。C# の場合、Godot とは別のエディターを使用する必要があったり、文法がやや難しかったりで、経験者向きの側面が強いことから、このチュートリアルでは、文法がより初学者にも理解しやすい GDScript を使用する。GDScript なら、Godot エディター上でそのままコーディング（コードを入力してプログラムを作っていく作業のこと）でき、ドキュメンテーションを Godot エディター上で確認できるので、よりゲーム開発の作業に集中しやすいだろう。</p><p>では「Player」ノードにプログラムを記述するためのスクリプトをアタッチしよう。シーンドックで「Player」を選択し、右上の「選択したノードに新規または既存のスクリプトをアタッチする」アイコンをクリックする。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img43.png alt=スクリプトをアタッチする></p><p>スクリプトの保存先を変更したいので、「パス」の右側にあるフォルダーアイコンをクリックする。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img44.png alt=スクリプトの保存先を変更></p><p>パネルが開いたら、パスを確認しよう。パスがリソースのルート「res://」になっていなければ、左上の「↑」アイコンをクリックしてルートまで戻り、そこで右上の「フォルダーを作成」ボタンをクリックする。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img45.png alt=ルートにフォルダー作成></p><p>フォルダーの名前に「Player」と入力して「OK」をクリックして確定する。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img46.png alt=Playerフォルダーを作成></p><p>パネル上部の「パス」が今作成したフォルダーのパスになっていればOKだ。ファイル名を「Player.gd」として「開く」をクリックしよう。ちなみに、ファイルの拡張子 <strong>.gd</strong> は GDScript ファイルのことを指している。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img47.png alt=Player.gdスクリプトのパスを決定して開く></p><p>パスが変更されたのを確認したら「作成」ボタンをクリックする。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img48.png alt=作成をクリック></p><p>Godot エディタの中央が、2D ワークスペースからスクリプトエディタに切り替わり、今アタッチしたばかりのスクリプト「Player.gd」が開いた状態になった。これから、このスクリプトを編集していく。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img49.png alt=スクリプトエディタの表示></p><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=プレイヤーキャラクターの動きを実装する>プレイヤーキャラクターの動きを実装する</h1><p>まず、デフォルトで入力されているコメントや<code>_ready</code>メソッドはこのスクリプトでは不要なので、削除しておこう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img50.gif alt=デフォルトのボイラープレートを削除></p><p>次に必要なプロパティ（クラス内で定義する変数のこと）を定義していく。下記のコードを「Player.gd」スクリプトの 3 行目以下に記述してほしい。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>acceleration</span> <span class=o>=</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>max_speed</span> <span class=o>=</span> <span class=mi>64</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>max_dash_speed</span> <span class=o>=</span> <span class=mi>80</span> 
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>friction</span> <span class=o>=</span> <span class=mf>0.1</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>gravity</span> <span class=o>=</span> <span class=mi>512</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>jump_force</span> <span class=o>=</span> <span class=mi>224</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>air_resistance</span> <span class=o>=</span> <span class=mf>0.02</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>velocity</span> <span class=o>=</span> <span class=nc>Vector2</span><span class=o>.</span><span class=n>ZERO</span>
</span></span></code></pre></div><p>コードの先頭に<code>export</code>がついているプロパティは、その値をインスペクターでも編集できるようになる。試しに「player」ノードを選択してインスペクターを見てみよう。スクリプトに記述したプロパティが表示されているのがわかるだろう。スクリプトで定義した値がデフォルトの値になっている。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img51.png alt=exportのプロパティをインスペクターで確認></p><p><code>export</code>キーワードをつければ、スクリプト上でプロパティの値を直接編集しなくても、インスペクター上で気軽に編集できる。デバッグしながら値の微調整が必要になると思われるプロパティには<code>export</code>をつけるのがおすすめだ。</p><p>では今回定義したプロパティについてそれぞれ説明しておこう。</p><ul><li><code>acceleration</code>: プレイヤーキャラクターの左右移動操作時の加速度。</li><li><code>max_speed</code>: プレイヤーキャラクターの左右移動操作時の最大速度。</li><li><code>max_dash_speed</code>: プレイヤーキャラクターの左右ダッシュ移動操作時の最大速度。</li><li><code>friction</code>: プレイヤーキャラクターの左右移動操作をやめた時に受ける摩擦抵抗。</li><li><code>gravity</code>: プレイヤーキャラクターが常に画面下方向に受ける重力。</li><li><code>jump_force</code>: プレイヤーキャラクターのジャンプ操作時のジャンプ力。</li><li><code>air_resistance</code>: プレイヤーキャラクターのジャンプ操作時に受ける空気抵抗。</li><li><code>velocity</code>: 方向の要素を持ったプレイヤーキャラクターの速度、デフォルト値は<code>Vector2</code>型で(0, 0)。値はこのあとのプログラミングによりリアルタイムで更新される予定。</li></ul><p>さらにスクリプトの一番下の行で、<code>sprite</code>プロパティを<code>onready</code>キーワードをつけて定義しよう。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sprite</span> <span class=o>=</span> <span class=nx>$AnimatedSprite</span>
</span></span></code></pre></div><p><code>sprite</code>プロパティの値は、「Player」ノードの子ノードである「AnimatedSprite」ノードを定義した。<code>onready</code>をつけたプロパティは、全てのノードの読み込みが終わってから定義される。ノードの読み込みは親ノードの方が子ノードより先なので、子ノードをプロパティに格納したい場合は、<code>onready</code>キーワードを利用してプロパティを定義する。</p><p>このようにして、子ノードのプロパティやメソッドにアクセスする予定がある場合は、プロパティとして定義しておくと、このあとのコーディングが楽になる。また、シーンツリー（シーン内のノードの構成）に変更があっても、このプロパティの値だけ変更すれば良いので、メンテナンスがしやすいというメリットもある。Godot でのゲーム開発では割と一般的な手法だ。</p><p>次に定義するのは<code>_physics_process</code>メソッドだ。このメソッドは「Node」クラスの組み込み関数だ。「KinematicBody2D」クラスは「Node」クラスを継承しているので利用できる。</p><p><code>_physics_process</code>メソッドは、物理フレーム（デフォルトでは1秒間に60フレーム）ごとにメソッド内のコードを実行してくれる。これを利用して、プレイヤーの入力操作によって、プレイヤーキャラクターの動きを制御することができる。</p><p>では具体的にやっていこう。スクリプトの一番下に次のコードを記述しよう。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_physics_process</span><span class=p>(</span><span class=n>delta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>velocity</span><span class=o>.</span><span class=n>y</span> <span class=o>+=</span> <span class=n>gravity</span> <span class=o>*</span> <span class=n>delta</span>
</span></span></code></pre></div><p><code>_physics_process</code>の引数<code>delta</code>は1フレームあたりの秒数（デフォルトでは1/60秒）だ。<code>velocity.y</code>の値に<code>gravity</code>に<code>delta</code>を乗じた値を足している。ゲーム開発では一般的に、2次元の x, y 座標で y 軸の値は、画面の下にいくほど大きく、上にいくほど小さくなる。毎フレーム<code>gravity</code>の値を<code>velocity</code>の <code>y</code> に加算することで、プレイヤーキャラクターを常に画面下方向に動かす力を加えている。これにより、キャラクターに重力がかかっている状態を作ることができた。</p><p>さらに、次のコードを<code>_physics_process</code>メソッドに追加しよう。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl>	<span class=kd>var</span> <span class=n>x_input</span> <span class=o>=</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>get_action_strength</span><span class=p>(</span><span class=s2>&#34;move_right&#34;</span><span class=p>)</span> <span class=o>-</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>get_action_strength</span><span class=p>(</span><span class=s2>&#34;move_left&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>x_input</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>+=</span> <span class=n>x_input</span> <span class=o>*</span> <span class=n>acceleration</span>
</span></span><span class=line><span class=cl>		<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=nb>clamp</span><span class=p>(</span><span class=n>velocity</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=o>-</span><span class=n>max_speed</span><span class=p>,</span> <span class=n>max_speed</span><span class=p>)</span>
</span></span></code></pre></div><p>メソッド内で<code>x_input</code>変数を定義した。<code>Input</code>クラスの<code>get_action_strength</code>メソッドは、引数のインプットアクションが入力されれば 1 を、されなければ 0 を返す。つまり、プレイヤーが右矢印キーを押せば 1 、左矢印キーを押せば -1 、どちらも押さなければ 0 の値が<code>x_input</code>に入る。</p><p>その次の<code>if x_input != 0:</code>の if 構文は、右か左の矢印キーいずれかを押した場合、ということになる。</p><p><code>velocity.x</code>に、<code>x_input</code>に<code>acceleration</code>を乗じた値を加算している。これで、プレイヤーが右か左の矢印キーを押した方向へ、毎フレーム加速しながらプレイヤーキャラクターを移動させる仕組みができた。</p><p>しかし、このままだと毎フレーム加速し続け、とんでもないスピードでキャラクターが移動してしまう。そこで、組み込みの<code>clamp</code>メソッドを利用して、<code>velocity.x</code>の値が最大値および最小値の範囲内に収まるようにする。<code>clamp</code>メソッドは最大値に第二引数、最小値に第三引数、どちらにも達していなければ第一引数を返す。</p><p>さらに、プレイヤーキャラクターにダッシュ機能を実装したいので、インプットアクション「dash」の入力操作、つまりスペースキーを入力しているかどうかで、条件分岐させた。<code>if x_input != 0:</code>のブロックは以下のように変更した。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl>	<span class=k>if</span> <span class=n>x_input</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>+=</span> <span class=n>x_input</span> <span class=o>*</span> <span class=n>acceleration</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>is_action_pressed</span><span class=p>(</span><span class=s2>&#34;dash&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=nb>clamp</span><span class=p>(</span><span class=n>velocity</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=o>-</span><span class=n>max_dash_speed</span><span class=p>,</span> <span class=n>max_dash_speed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=nb>clamp</span><span class=p>(</span><span class=n>velocity</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=o>-</span><span class=n>max_speed</span><span class=p>,</span> <span class=n>max_speed</span><span class=p>)</span>
</span></span></code></pre></div><p>さらに<code>if x_input != 0:</code>ブロックの最後にこのコードも追加しよう。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=n>flip_h</span> <span class=o>=</span> <span class=n>x_input</span> <span class=o>&lt;</span> <span class=mi>0</span>
</span></span></code></pre></div><p>スプライトのテクスチャの水平方向に反転させるプロパティ<code>flip_h</code>は、<code>x_input</code>が 0 より小さい値（つまり左矢印キーを押下して -1 ）になっているときに有効になるようにした。</p><p><code>velocity</code>の値を実際のキャラクターの移動に反映させるために、「KinematicBody2D」クラスの組み込みメソッドである<code>move_and_slide</code>を<code>_physics_process</code>メソッドの最後に追加する。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl>	<span class=n>velocity</span> <span class=o>=</span> <span class=nf>move_and_slide</span><span class=p>(</span><span class=n>velocity</span><span class=p>,</span> <span class=nc>Vector2</span><span class=o>.</span><span class=n>UP</span><span class=p>)</span>
</span></span></code></pre></div><p>この<code>move_and_slide</code>メソッドは、第一引数に割り当てた速度に delta を自動的に乗じて、このスクリプトがアタッチされている「KinematicBody2D」クラスのノードを移動してくれる。第二引数は、上方向がどちらかを指定する。プラットフォーマーは画面の上方向がそれに当たるので<code>Vector2.UP</code>を割り当てた。これによって、自動的に天井、地面、壁がどの方向なのかを判別してくれる。</p><p>では一旦ここでプロジェクトを実行してキャラクターの動きを確認してみよう。</p><p>デバッグパネルで、足場である「TempGround」ノードのコリジョン形状が見えるようにするため、先に「デバッグ」メニュー＞「コリジョン形状を表示」にチェックを入れておこう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img52.png alt=デバッグ＞コリジョン形状を表示にチェック></p><p>Godot エディタ右上の「プロジェクトを実行」アイコンをクリックする。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img53.png alt=プロジェクトを実行></p><p>まだメインシーンを選択していない場合はダイアログが表示されるので、「現在のものを選択」をクリックする。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img54.png alt=現在のものを選択></p><p>デバッグパネルが開くので動きを確認してみよう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img55.gif alt=動作確認></p><p>重力は機能して、キャラクターはきちんと足場に落ちている。スプライトのテクスチャも<code>flip_h</code>プロパティの切り替えにより向きが変われば反転している。しかし、左右の移動は右または左の矢印キーを一回押下しただけで滑り続けて止まらない状態だ。さらに必要なコードを追加していこう。</p><br><p>今度は、<code>velocity = move_and_slide(velocity, Vector2.UP)</code>のコードより前に、以下の if ブロックのコードを追加しよう。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl>	<span class=k>if</span> <span class=nf>is_on_floor</span><span class=p>():</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>x_input</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;idle&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=nb>lerp</span><span class=p>(</span><span class=n>velocity</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>friction</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;run&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p><code>is_on_floor</code>メソッドは、現在地面にキャラクターが接しているかを判定してくれる。接していれば戻り値が true になる。<code>if x_input == 0:</code>は左右移動の入力がない場合という条件の if 構文だ。この if / else ブロック内を見ていく。</p><p>まず、<code>sprite</code>（「AnimatedSprite」ノード）の<code>play</code>メソッドによりアニメーション「idle」を再生する。</p><p>次に、<code>velocity.x</code>の値は組み込みの<code>lerp</code>メソッドにより、現在の<code>velocity.x</code>の値の間を第三引数である<code>friction</code>プロパティの重み分だけ、第二引数 0 に近づけていく。<code>_physics_process</code>メソッドが毎フレーム実行されることにより、次第に値は 0 になる。</p><p>else ブロックの方は、左右移動の入力があった場合という条件になり、このとき「AnimatedSprite」ノードの<code>play</code>メソッドによりアニメーション「run」が再生される。</p><p>それでは、改めてプロジェクトを実行して、滑らなくなったか、アニメーションが切り替わるか確認しよう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img56.gif alt=プロジェクトを実行して滑らなくなったか確認></p><p><code>lerp</code>メソッドによる摩擦抵抗の実装で、左右移動の入力がなければ減速して停止するようになった。スペースキーを押下した時のダッシュの挙動も上々だ。ちなみに、何度か<code>max_dash_speed</code>の値を変更して検証してみたが、80 ではあまり移動速度が変わらなかったので 200 に変更した。せっかくなので、あなたもインスペクターからお好みの速度に調整してみよう。</p><br><p>次はキャラクターがジャンプできるようにしょう。続けて<code>if is_on_floor():</code>ブロック内に次のコードを追加しよう。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl>		<span class=k>if</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>is_action_just_pressed</span><span class=p>(</span><span class=s2>&#34;jump&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>			<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;jump&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>y</span> <span class=o>=</span> <span class=o>-</span><span class=n>jump_force</span>
</span></span></code></pre></div><p>この if ブロック<code>if Input.is_action_just_pressed("jump"):</code>は、（地面にキャラクターが接している時に）インプットアクション「jump」の操作、つまり上矢印キーを一回押した場合、という意味合いだ。この場合「AnimatedSprite」ノードの<code>play</code>メソッドによりアニメーション「jump」を再生する。そして、この瞬間に<code>velocity.y</code>にジャンプ力を示す<code>jump_force</code>を引き算している。引き算するのは、先ほどお伝えした通り、画面上方向にいくほど y 軸の値が小さくなるからだ。</p><p>ではプロジェクトを実行して、ジャンプ操作も確認してみよう。</p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img57.gif alt=プロジェクトを実行してジャンプの動作確認></p><p>今のところ大きな問題はなさそうなので良しとしよう。</p><p>あとは少し細かいが、ジャンプ中に左右移動の入力がなかった場合と、ジャンプしてすぐに上矢印キーを離した場合、このそれぞれの動きをコーディングしていこう。</p><p><code>if is_on_floor():</code>ブロックに続けて、以下の<code>else</code>ブロックを追加して、<code>if / else</code>構文にする。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl>	<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>x_input</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=nb>lerp</span><span class=p>(</span><span class=n>velocity</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>air_resistance</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>is_action_just_released</span><span class=p>(</span><span class=s2>&#34;jump&#34;</span><span class=p>)</span> <span class=ow>and</span> <span class=n>velocity</span><span class=o>.</span><span class=n>y</span> <span class=o>&lt;</span> <span class=o>-</span><span class=n>jump_force</span> <span class=o>/</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>y</span> <span class=o>=</span> <span class=o>-</span><span class=n>jump_force</span> <span class=o>/</span> <span class=mi>2</span>
</span></span></code></pre></div><p><code>else</code>ブロックは、<code>is_on_floor</code>メソッドの戻り値が false だったら、と言い換えられる。つまり、「地面に接していなかったら（空中だったら）」という意味になる。さらにネストされた<code>if</code>構文が続く。一つ目の<code>if</code>ブロックの条件は、<code>if x_input == 0:</code>で、これは「左右移動の入力がなかったら」という意味だ。その場合、<code>velocity.x</code>は<code>lerp</code>メソッドにより、<code>air_resistance</code>の空気抵抗により毎フレーム 0 に近づいていく。</p><p><code>else</code>ブロックにネストされて2つ目の<code>if</code>構文を見てみよう。条件式は2つの条件が<code>and</code>で結合されていて、「2つとも満たした場合」という条件になる。</p><p>一つ目の条件は、<code>Input</code>クラスの<code>is_action_just_released</code>メソッドを利用した、（空中で）一度「jump」アクション操作（上矢印キー）を離した場合、という内容だ。</p><p>2つ目の条件は、<code>velocity.y</code>の値が<code>-jump_force / 2</code>（ジャンプ力の2分の1）未満の場合、という内容だ。</p><p>これらを合わせると、空中でスペースキーを離した時にプレイヤーキャラクターの y 軸方向の速度がジャンプ力の半分未満だったら、という意味になる。これを満たした場合、<code>velocity.y</code>の値には<code>-jump_force / 2</code>（ジャンプ力の半分）の値を適用する。これにより、スペースキーをちょんと押しただけだと、低いジャンプになる。</p><p>それでは、プロジェクトを実行して変更した内容を確認してみよう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img58.gif alt=ジャンプの高さと空気抵抗の影響を確認></p><p>スペースキーを押し続けた時と、ちょんと押した時とで、ジャンプする高さが変わった。また、ジャンプ中に左右移動の入力をしない場合、空気抵抗の影響を受け、x 方向の移動距離が少し落ちた。</p><p>ひとまずプレイヤーキャラクターの動きが想定通りになったので、「Player.gd」スクリプトの編集は一旦ここまでにしておこう。</p><br><hr><h1 id=part-1-で編集したスクリプトのコード>Part 1 で編集したスクリプトのコード</h1><p>今回編集した「Player.gd」スクリプト全体のコードを最後に共有しておこう。何か動きが思い通りに行かない場合はこちらを参考にしてほしい。</p><details><summary>Player.gd スクリプトを確認する</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>KinematicBody2D</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>acceleration</span> <span class=o>=</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>max_speed</span> <span class=o>=</span> <span class=mi>64</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>max_dash_speed</span> <span class=o>=</span> <span class=mi>80</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>friction</span> <span class=o>=</span> <span class=mf>0.1</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>gravity</span> <span class=o>=</span> <span class=mi>512</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>jump_force</span> <span class=o>=</span> <span class=mi>224</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>air_resistance</span> <span class=o>=</span> <span class=mf>0.02</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>velocity</span> <span class=o>=</span> <span class=nc>Vector2</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sprite</span> <span class=o>=</span> <span class=nx>$AnimatedSprite</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_physics_process</span><span class=p>(</span><span class=n>delta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>velocity</span><span class=o>.</span><span class=n>y</span> <span class=o>+=</span> <span class=n>gravity</span> <span class=o>*</span> <span class=n>delta</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=n>x_input</span> <span class=o>=</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>get_action_strength</span><span class=p>(</span><span class=s2>&#34;move_right&#34;</span><span class=p>)</span> <span class=o>-</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>get_action_strength</span><span class=p>(</span><span class=s2>&#34;move_left&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>x_input</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>+=</span> <span class=n>x_input</span> <span class=o>*</span> <span class=n>acceleration</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>is_action_pressed</span><span class=p>(</span><span class=s2>&#34;dash&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=nb>clamp</span><span class=p>(</span><span class=n>velocity</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=o>-</span><span class=n>max_dash_speed</span><span class=p>,</span> <span class=n>max_dash_speed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=nb>clamp</span><span class=p>(</span><span class=n>velocity</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=o>-</span><span class=n>max_speed</span><span class=p>,</span> <span class=n>max_speed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=n>flip_h</span> <span class=o>=</span> <span class=n>x_input</span> <span class=o>&lt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nf>is_on_floor</span><span class=p>():</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>x_input</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;idle&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=nb>lerp</span><span class=p>(</span><span class=n>velocity</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>friction</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;run&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>is_action_just_pressed</span><span class=p>(</span><span class=s2>&#34;jump&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>			<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;jump&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>y</span> <span class=o>=</span> <span class=o>-</span><span class=n>jump_force</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>x_input</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=nb>lerp</span><span class=p>(</span><span class=n>velocity</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>air_resistance</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>is_action_just_released</span><span class=p>(</span><span class=s2>&#34;jump&#34;</span><span class=p>)</span> <span class=ow>and</span> <span class=n>velocity</span><span class=o>.</span><span class=n>y</span> <span class=o>&lt;</span> <span class=o>-</span><span class=n>jump_force</span> <span class=o>/</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>y</span> <span class=o>=</span> <span class=o>-</span><span class=n>jump_force</span> <span class=o>/</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>velocity</span> <span class=o>=</span> <span class=nf>move_and_slide</span><span class=p>(</span><span class=n>velocity</span><span class=p>,</span> <span class=nc>Vector2</span><span class=o>.</span><span class=n>UP</span><span class=p>)</span>
</span></span></code></pre></div></details><br><hr><h1 id=player-ノードをシーンにする>Player ノードをシーンにする</h1><p>最後に「Player」ノードを個別のシーンとして保存し、「Level1」シーンには「Player」シーンのインスタンスをノードとして追加させるようにする。今後、別の新たなブランチをルートノードに追加する場合も、「Player」ノードと同様に、先に別シーンとして作成してから、そのインスタンスをルートノードに追加していくことになるだろう。</p><p>実は Godot では、このように個々のシーンのインスタンスを別のより大きなシーンの子ノードとして追加するのが一般的だ。ゲームの小さい部品を作って、それらを集めて少し大きな部品のシーンを作る、ということを繰り返して、少しずつゲームの規模を大きくしていくというわけだ。とはいえ、Godot でのゲーム開発をはじめ、オブジェクト指向プログラミング全般がそういうものだとも言えるだろう。大きく複雑なプログラムも小さくて簡単なプログラムの組み合わせに過ぎない、と考えれば、ゲーム開発はまったくもって怖くない。</p><p>では具体的な作業を進めよう。</p><p>シーンドックで「Player」ノードを右クリックして「ブランチをシーンとして保存」を選択する。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img59.png alt=Playerノード以下のブランチをシーンとして保存></p><p>シーンの保存先パスを「res://Player」とし、ファイル名を「Player.tscn」として、「保存」をクリックする。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img60.png alt=Player.tscnを保存></p><p>すると「Level1」シーンの「Player」ノードの右側に「エディターで開く」アイコンが表示される。これは別のシーンのインスタンスであることを示している。このアイコンをクリックしてみよう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img61.png alt=Playerインスタンスノード右側にエディターで開くアイコン></p><p>するとシーンドックと2Dワークスペースが「Player.tscn」シーンの表示に切り替わる。これで「Player」ノードをシーンにすることができた。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img62.png alt=Playerシーンに切り替わる></p><p>最後に、後処理を少しやっておこう。まず「Player.tscn」シーンのまま、インスペクターの「Position」プロパティを見て見よう。今までのまま(192, 80)のように、（0, 0）以外の値になっているはずだ。これを、「Player.tscn」シーン上では (0, 0)にしておこう。なぜならこのシーン上でプレイヤーキャラクターの位置を変更する必要がないからだ。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img63.png alt=Player.tscnでpositionを変更></p><p>続けて、2Dワークスペースにて「Level1」タブをクリックして「Level1.tscn」シーンに戻そう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img64.png alt=Level1シーン上でPlayerノードの場所調整></p><p>同じくインスペクターから「Position」プロパティを (0, 0) から (192, 80)などに変更しておこう。これでさっきデバッグしていた時と同じ状態に戻った。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_1/img63.png alt=Playerノードのpositionを開く></p><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=おわりに>おわりに</h1><p>以上で Part 1 は完了だ。プレイヤーキャラクターが自分の操作で想定通りに動くと嬉しいものだ。ゲーム開発のモチベーションを高めるには、最初にプレイヤーキャラクターを作るというのが実践しやすい一つの方法ではないだろうか。</p><p>次回はタイルマップを作ってゲームの世界を作っていくのでお楽しみに。</p><br><hr><p><strong>UPDATE</strong><br>2022-10-16 <strong>仮の足場を作る</strong>の手順の「Area2D」の誤記を「StaticBody2D」に訂正<br>2022-03-26 Dropbox のアセットの内容に Part 12 で利用するファイルを追加してリンクを更新<br>2022-03-24 Dropbox のアセットの内容に Part 11 で利用するファイルを追加してリンクを更新</p><hr></div><footer class=post-footer><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Godot3 で作るプラットフォーマー Part 1：プレイヤーキャラクターを作ろう！ on x" href="https://x.com/intent/tweet/?text=Godot3%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%201%ef%bc%9a%e3%83%97%e3%83%ac%e3%82%a4%e3%83%a4%e3%83%bc%e3%82%ad%e3%83%a3%e3%83%a9%e3%82%af%e3%82%bf%e3%83%bc%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_1%2f&amp;hashtags=GodotEngine%2cGameDev%2c2D%2c%e3%82%a2%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e3%82%b2%e3%83%bc%e3%83%a0%2c%e6%a8%aa%e3%82%b9%e3%82%af%e3%83%ad%e3%83%bc%e3%83%ab%2c%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Godot3 で作るプラットフォーマー Part 1：プレイヤーキャラクターを作ろう！ on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_1%2f&title=Godot3%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%201%ef%bc%9a%e3%83%97%e3%83%ac%e3%82%a4%e3%83%a4%e3%83%bc%e3%82%ad%e3%83%a3%e3%83%a9%e3%82%af%e3%82%bf%e3%83%bc%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Godot3 で作るプラットフォーマー Part 1：プレイヤーキャラクターを作ろう！ on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_1%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li></ul><ul class=post-tags><li><a href=https://www.peanuts-code.com/ja/tags/godotengine/>GodotEngine</a></li><li><a href=https://www.peanuts-code.com/ja/tags/gamedev/>GameDev</a></li><li><a href=https://www.peanuts-code.com/ja/tags/2d/>2D</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B2%E3%83%BC%E3%83%A0/>アクションゲーム</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E6%A8%AA%E3%82%B9%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%AB/>横スクロール</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%BC/>プラットフォーマー</a></li></ul><nav class=paginav><a class=prev href=https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_2/><span class=title>« 前へ</span><br><span>Godot で作るプラットフォーマー Part 2：タイルマップを作ろう！</span>
</a><a class=next href=https://www.peanuts-code.com/ja/posts/post0001_no_matter_how_old/><span class=title>次へ »</span><br><span>📔 ゲーム開発を始めるのに年齢は関係ない</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://www.peanuts-code.com/ja/>Peanuts Code</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="コピー";function s(){t.innerHTML="コピーされました!",setTimeout(()=>{t.innerHTML="コピー"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>