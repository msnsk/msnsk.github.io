<!DOCTYPE html>
<html lang="ja" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！ | Peanuts Code</title>
<meta name="keywords" content="Godot, GodotEngine, ゲーム開発, チュートリアル, 初級, 2D, プラットフォーマー, アクションゲーム, 横スクロール, スタート画面, タイトル画面, スタートメニュー, キャラクター選択, プレイヤー選択, シングルトン" />
<meta name="description" content="第10回目の今回は、ゲーム開始時に表示されるスタート画面を作る。タイトル画面、スタートメニューとも言う。
それだけだと、前回と比べて簡単すぎるので、ゲーム開始時にプレイヤーキャラクターを選択できる仕組みも実装する。画面遷移のイメージは以下の通りだ。
 まずゲームを始めるとスタート画面が表示される。 スタートボタンを押すとプレイヤーキャラクター選択画面に遷移する。 プレイヤーキャラクターを選択するとゲームプレイ開始。  ということで、今回の作業は以下の通りだ。">
<meta name="author" content="Masanao Sako">
<link rel="canonical" href="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_10/" />
<meta name="google-site-verification" content="XYZabc" />
<meta name="yandex-verification" content="XYZabc" />
<meta name="msvalidate.01" content="XYZabc" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.css" rel="preload stylesheet" as="style">
<link rel="preload" href="/images/logomark.png" as="image">
<link rel="icon" href="https://www.peanuts-code.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.peanuts-code.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.peanuts-code.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://www.peanuts-code.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://www.peanuts-code.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.97.3" />
<link rel="alternate" hreflang="ja" href="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_10/" />

<script async src="https://www.googletagmanager.com/gtag/js?id=G-DK0NK2RTTW"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-DK0NK2RTTW', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！" />
<meta property="og:description" content="第10回目の今回は、ゲーム開始時に表示されるスタート画面を作る。タイトル画面、スタートメニューとも言う。
それだけだと、前回と比べて簡単すぎるので、ゲーム開始時にプレイヤーキャラクターを選択できる仕組みも実装する。画面遷移のイメージは以下の通りだ。
 まずゲームを始めるとスタート画面が表示される。 スタートボタンを押すとプレイヤーキャラクター選択画面に遷移する。 プレイヤーキャラクターを選択するとゲームプレイ開始。  ということで、今回の作業は以下の通りだ。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_10/" />
<meta property="og:image" content="https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_10/img43.gif" /><meta property="article:section" content="tutorials" />
<meta property="article:published_time" content="2022-03-22T17:32:43&#43;09:00" />
<meta property="article:modified_time" content="2022-03-22T17:32:43&#43;09:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_10/img43.gif" />
<meta name="twitter:title" content="Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！"/>
<meta name="twitter:description" content="第10回目の今回は、ゲーム開始時に表示されるスタート画面を作る。タイトル画面、スタートメニューとも言う。
それだけだと、前回と比べて簡単すぎるので、ゲーム開始時にプレイヤーキャラクターを選択できる仕組みも実装する。画面遷移のイメージは以下の通りだ。
 まずゲームを始めるとスタート画面が表示される。 スタートボタンを押すとプレイヤーキャラクター選択画面に遷移する。 プレイヤーキャラクターを選択するとゲームプレイ開始。  ということで、今回の作業は以下の通りだ。"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Tutorials",
      "item": "https://www.peanuts-code.com/ja/tutorials/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "シリーズ：Godot で作るプラットフォーマー",
      "item": "https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！",
      "item": "https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_10/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！",
  "name": "Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！",
  "description": "第10回目の今回は、ゲーム開始時に表示されるスタート画面を作る。タイトル画面、スタートメニューとも言う。\nそれだけだと、前回と比べて簡単すぎるので、ゲーム開始時にプレイヤーキャラクターを選択できる仕組みも実装する。画面遷移のイメージは以下の通りだ。\n まずゲームを始めるとスタート画面が表示される。 スタートボタンを押すとプレイヤーキャラクター選択画面に遷移する。 プレイヤーキャラクターを選択するとゲームプレイ開始。  ということで、今回の作業は以下の通りだ。",
  "keywords": [
    "Godot", "GodotEngine", "ゲーム開発", "チュートリアル", "初級", "2D", "プラットフォーマー", "アクションゲーム", "横スクロール", "スタート画面", "タイトル画面", "スタートメニュー", "キャラクター選択", "プレイヤー選択", "シングルトン"
  ],
  "articleBody": "第10回目の今回は、ゲーム開始時に表示されるスタート画面を作る。タイトル画面、スタートメニューとも言う。\nそれだけだと、前回と比べて簡単すぎるので、ゲーム開始時にプレイヤーキャラクターを選択できる仕組みも実装する。画面遷移のイメージは以下の通りだ。\n まずゲームを始めるとスタート画面が表示される。 スタートボタンを押すとプレイヤーキャラクター選択画面に遷移する。 プレイヤーキャラクターを選択するとゲームプレイ開始。  ということで、今回の作業は以下の通りだ。\n スタート画面を作る プレイヤーキャラクターの種類（スプライトのテクスチャのみ）を増やす プレイヤーキャラクター選択画面を作る スタート画面とプレイヤーキャラクター選択画面をゲームに紐付ける  では順番にやっていこう。\n Memo： \n過去のシリーズをまだご覧になっていない方は、そちらを先にご覧いただくことをおすすめします。\nGodot で作るプラットフォーマー \n  \n (adsbygoogle = window.adsbygoogle || []).push({});   スタート画面を作る シーンを作る まずはスタート画面を作っていく。画面のレイアウトはゲームオーバー画面と似た感じにしてしまおう。そうすればゲームオーバー画面のシーンを流用できる。\nということで、新規シーンは作らずに、ファイルシステムドック内でゲームオーバー画面のシーンを複製するところから作業を始める。では下記の手順でスタート画面のシーンを作成しよう。\n ファイルシステムで「res://UI/GameOver/GameOver.tscn」を右クリック＞「複製」を選択する。\n シーンの名前を「GameStart.tscn」とする。 ファイルシステムで「res://UI/」で右クリック＞「新規フォルダー」を選択し、フォルダーの名前を「GameStart」とする。 「res://UI/GameStart」に「GameStart.tscn」をドラッグして移動する\n  シーンツリーを編集する 「GameOver.tscn」から複製したばかりの「GameStart.tscn」を開いてみよう。\n見ての通り、「GameOver」シーンそのままの状態だ。これを以下の手順でスタート画面仕様に修正していく。\n 「GameOver」ルートノードの名前を「GameStart」に変更する。 「GameStart」ノードを右クリック＞「スクリプトをデタッチ」する。 「GameOverLabel」ノードの名前を「TitleLabel」に変更する。 「RestartVBox」ノードの名前を「StartVBox」に変更する。 「RestartButton」ノードの名前を「StartButton」に変更する。 「RestartLabel」ノードの名前を「StartLabel」に変更する。 「StartVBox」ブランチを「ButtonsHBox」ノードから出して「VBoxContainer」の子にする（1階層上げる） 「ButtonsHBox」ブランチを削除する。 「ColorRect」ノードを削除する。 「ConfirmationDialog」ノードを削除する。 新たに「GameStart」ルートノードに「AnimationPlayer」ノードを追加する。  以上の作業でシーンツリーは以下のスクリーンショットのようになったはずだ。\n最後に「StartButton」ノードの「button_up()」シグナルを切断しておこう。\n続いて、各ノードのプロパティを更新していく。\n各ノードのプロパティを編集する 各ノードのプロパティの値も、シーンの複製元である「GameOver.tscn」の状態のままなのでスタート画面仕様に修正していく。シーンツリーの上から順番にやっていこう。\nGameStart 「Pause Mode」プロパティは、「GameOver」シーンの名残で「Process」のままになっているので、「Inherit」にしておく。その他のプロパティも編集は不要だ。\nTextureRect 「Texture」プロパティに割り当てるテクスチャ画像を差し替えて、ゲームオーバー画面と差別化する。ファイルシステムドックから「res://Assets/Background/Pink.png」をドラッグ\u0026ドロップして適用する。\nVBoxContainer このノードのプロパティは編集不要だ。\nTitleLabel スタート画面は、ゲーム開始時に最初に表示される画面なので、ゲームのタイトルを大きめに表示させたい。また、文字の見た目も色を変えたりアウトラインをつけるなどして、ゲームオーバー画面と差別化する。\n 「Text」プロパティに以下のゲームタイトルの文字列（改行あり）を入力する（あなたの好きなタイトルにしていただいて問題ない）。\nplatformer\ntutorial 「Theme Overrides」＞「Fonts」＞「Font」で「新規 DynamicFont」を選択する。 「Font」＞「Settings」＞「Size」プロパティを 48 にする。 「Font」＞「Settings」＞「Outline Size」プロパティを 5 にする。 「Font」＞「Settings」＞「Outline Color」プロパティで色を # 302e3e （濃いグレー）にする。 「Font」＞「Font」＞「Font Data」に「res://fonts/connection_ii/ConnectionII.otf」を適用する。\n 「Visibility」＞「Modulate」プロパティで色を # 7ec8ff（水色）にする。\n  StartVBox このノードのプロパティは編集不要だ。\nStartButton ボタンのアイコンをゲームプレイを開始するイメージに近いテクスチャ画像に差し替える。\n 「Textures」＞「Normal」プロパティにファイルシステムドックから「res://Assets/Menu/Buttons/Play.png」をドラッグ\u0026ドロップして画像を差し替える。\n  StartLabel ボタンアイコンの説明書きがゲームオーバー画面仕様の「RESTART」になっているので「START」に更新する。\n 「Text」プロパティに「press space or enter key」と入力する。  AnimationPlayer このノードは「Start」ボタンを押した時に、少し凹んだようなアニメーションを作るために用いる。インスペクターのプロパティはそのままで良い。\n新規アニメーションを以下の内容で作成しよう。\n アニメーション名: press_start アニメーションの長さ(秒): 0.1 アニメーションループ: 無効 トラック：  「StartButton」ノード ＞「modulate」プロパティ  Time: 0秒 / Value: # ffffff / Easing: 1.00 Time: 0.05秒 / Value: # c8c8c8 / Easing: 1.00 Time: 0.1秒 / Value: # ffffff / Easing: 1.00   「StartButton」ノード ＞「rect_scale」プロパティ  Time: 0秒 / Value: (1, 1) / Easing: 1.00 Time: 0.05秒 / Value: (0.9, 0.9) / Easing: 1.00 Time: 0秒 / Value: (1, 1) / Easing: 1.00      以上で、スタート画面のプロパティ編集作業は完了だ。一からシーンを作るよりは省エネで作業を終えられたのではないだろうか。ちなみに、シーンの見た目は以下のようになったはずだ。\nスクリプトをアタッチして編集する 続いて、スタート画面上のボタンをプレイヤーがクリックした時の動作をスクリプトで制御していく。\n「GameStart」ルートノードに新しいスクリプトをアタッチする。この時、スクリプトのファイルパスを「res://UI/GameStart/GameStart.gd」として作成する。\nスクリプトエディタで「GameStart.gd」スクリプトが開いたら、以下のように編集する。\nextends Control  # StartButton ノードの参照 onready var start_button = $VBoxContainer/StartVBox/StartButton # AnimationPlayer ノードの参照 onready var anim_player = $AnimationPlayer   func _ready(): \t# ゲーム開始時にアニメーションで変更されるプロパティを初期化 \tstart_button.modulate = Color(1, 1, 1, 1) \tstart_button.rect_scale = Vector2(1, 1) \n次にシグナルを接続しよう。「StartButton」ノードの「button_up()」シグナルを「GameStart.gd」スクリプトに接続する。\nスクリプトに_on_StartButton_button_upメソッドが生成されたら、以下のように編集する。\n # Start ボタンをクリックした時のシグナルで呼ばれるメソッド func _on_StartButton_button_up(): \t# デバッグ用 \tprint(\"_on_StartButton_button_up called.\") \t# AnimationPlayer の press_start アニメーションを再生 \tanim_player.play(\"press_start\") \t# アニメーションが終わるまで待機 \tyield(anim_player, \"animation_finished\") \t# このノードを解放（削除）する \tqueue_free() \t# デバッグ用 \tprint(\"GameStart scene is now freed.\") Start ボタンを押したら、次のプレイヤーキャラクター選択画面に遷移させる予定なので、この時点で「GameStart」シーンは用済みなのでqueue_freeメソッドで解放している。\n最後にキー入力での制御を実装しておく。インプットマップにデフォルトで登録されているアクション「ui_accept」に該当するスペースキー、またはエンターキーを押した時に、さっきシグナル接続で生成された_on_StartButton_button_upを実行するようにした。これでマウスでもキーボードでも同じ結果が得られるようになった。\n func _input(event): \t# スペースキーかエンターキーが押された場合 \tif event.is_action_pressed(\"ui_accept\"): \t# スタートボタンが押された時のメソッドを呼ぶ \t_on_StartButton_button_up() \n「GameStart」シーンの作成はこれで完成なので、最後にシーンを実行して挙動を確認しておこう。\nスタートボタンを押すと、ルートノードが解放されて何もノードが存在しない状態になるので、グレーの画面が表示されるのは正常な動作だ。なお、GIF画像ではアニメーションが若干不自然だが、実際にはもう少し短い時間で自然にアニメーションするはずだ。\n \n (adsbygoogle = window.adsbygoogle || []).push({});   プレイヤーキャラクターの種類を増やす ファイルシステムドックをご覧いただくと「res://Assets/Main Characters/」フォルダの中に4種類のプレイヤーキャラクターのアセットが見つかるだろう。ここまでのチュートリアルでは、4種類のうち「Pink Man」のスプライトシートのみを使ってきたが、ここで4種類全てのアセットを使用する時がきた。\nとはいえ、4種類のプレイヤーキャラクターのシーンを作る必要はなく、「Player」シーン＞「AnimatedSprite」ノード＞「Frames」プロパティに適用する「SpriteFrames」クラスのリソースファイルを4種類作成するだけで良い。つまり、キャラクター選択時に、「AnimatedSprite」ノードのテクスチャだけ差し替える、という作戦だ。\n（おさらいも兼ねて）事前確認として「Pink Man」以外のスプライトシートのアセットファイルにもしブラーがかかっていたら（ぼやけた感じがしたら）、ファイルシステムドックでファイルを選択して、インポートドックから「プリセット」＞「2D Pixel」を選択して「再インポート」をクリックしておこう。これでドット絵特有のエッジが効いた表示に更新される。\nでは順番にやっていこう。\nSpriteFrames リソースを作成する PinkMan ほぼ作業不要の「PinkMan」から「SpriteFrames」クラスのリソースファイルを作成する。\n 「Player.tscn」を開く。 「AnimatedSprite」ノードの「Frames」プロパティの値になっている「SpriteFrames」を右クリック＞「保存」を選択する。\n ファイルパスが「res://Player/PinkMan.tres」になるようにファイル名を「PinkMan.tres」として保存する。\n  PinkMan の場合はすでにアニメーションフレームが作成済みなので、リソースファイル作成はこれで完了だ。\nMaskDude 次は「MaskDude」のリソースファイルを作成する。\n ファイルシステムドックで、先に作成したPinkManのリソース「res://Player/PinkMan.tres」を右クリック＞「複製」を選択する。 ファイル名を「MaskDude.tres」とする。\n ファイルシステムドックで作成した「MaskDude.tres」をダブルクリックしてスプライトフレームパネルを開く。 登録しているアニメーションを上から一つ選択する。\n 既存のアニメーションフレームを全て削除する。\n スプライトシートアイコンをクリックする。\n 適切なスプライトシートのファイルを選択し、アニメーションフレームに反映すればOK。\n 次のアニメーションを選択して同様の作業を行う。全てのアニメーションのアニメーションフレームが更新できたら、リソースファイルの作成は完了とする。  NinjaFrog 作業は「MaskDude」シーンと同様だ。リソースのファイル名はもちろん「NinjaFrog.tres」にして保存する。\nVirtualGuy こちらも作業は「MaskDude」シーンと同様だ。リソースのファイル名はもちろん「VirtualGuy.tres」にして保存する。\n「VirtualGuy.tres」の編集が終われば、プレイヤーキャラクター4種類のリソースファイルの完成だ。ここらで一度休憩を入れよう。\n \n (adsbygoogle = window.adsbygoogle || []).push({});   プレイヤーキャラクター選択画面を作る さて、ここからはプレイヤーキャラクターを選択する画面のシーンを作っていく。画面の仕様は以下のようにする。\n 画面上部にプレイヤーキャラクターの名前を表示する。 画面中央にプレイヤーキャラクターのビジュアル（テクスチャ）をアニメーション付きで表示する。 キーボードの左右矢印キーか画面に表示されている矢印ボタンをクリックでキャラクターを切り替える。 キーボードのスペースキーまたはエンターキーでキャラクターを選択したらゲームプレイ開始。  では例によって、シーンを作成するところから始めよう。\nシーンを作る 以下の手順でプレイヤーキャラクター選択用のシーンを作っていく。\n 「シーン」メニュー＞「新規シーン」を選択する。 「ルートノードの生成」で「ユーザーインターフェース」を選択して、「Control」クラスを選択する。 「Control」ルートノードが生成されたら、名前を「CharacterSelect」に変更する。 「res://UI」フォルダーに「CharacterSelect」フォルダーを新規作成し、ファイルパスを「res://UI/CharacterSelect/CharacterSelect.tscn」としてシーンを保存する。  必要なノードを追加する 続いて、作成した「CharacterSelect」シーンに必要なノードを追加していこう。\n 「CharacterSelect」ルートノードに「TextureRect」ノードを追加する。 「CharacterSelect」ルートノードに「VBoxContainer」ノードを追加する。 「VBoxContainer」ノードに「Label」ノードを追加し、名前を「CharacterName」に変更する。 「VBoxContainer」ノードに「HBoxContainer」ノードを追加する。 「HBoxContainer」ノードに、「TextureButton」ノードを 2 つ追加し、それぞれの名前を「LeftButton」、「RightButton」に変更する。 「VBoxContainer」ノードに「Label」ノードを追加し、名前を「Caption」に変更する。 「CharacterSelect」ノードに「AnimatedSprite」ノードを追加する。 「CharacterSelect」ノードに「AnimationPlayer」ノードを追加する。  ここまででシーンツリーは以下のようになったはずだ。\n各ノードのプロパティを編集する 次に、インスペクターで各ノードのプロパティを編集して、プレイヤーキャラクター選択画面をデザインしていこう。\nCharacterSelect このルートノードは子ノードの入れ物として利用する。\n 2Dワークスペースのツールバー＞「レイアウト」から「Rect全面」を選択して、ノードのサイズを前画面サイズに揃える。  TextureRect このノードは背景用に利用する。\n 2Dワークスペースのツールバー＞「レイアウト」から「Rect全面」を選択して、画面全体に広げる。 「Texture」プロパティに、ファイルシステムから「res://Assets/Background/Yellow.png」をドラッグ\u0026ドロップして適用する。 「Stretch Mode」プロパティを「Tile」にする。  VBoxContainer このノードはプレイヤーキャラクター選択画面に表示されるキャラクター名やキャラクターのスプライト、選択ボタン、操作説明を縦に整列させるためのコンテナとして利用するだけなので、プロパティの編集は少ない。\n 2Dワークスペースのツールバー＞「レイアウト」から「Rect全面」を選択して、ノードのサイズを前画面サイズに揃える。 インスペクターで「Alignment」を「Center」にする。 「Theme Overrides」＞「Constants」＞「Separation」ノードを 48 にする。  CharacterName このノードは、現在選択しているキャラクターの名前を表示するのに利用する。表示位置は画面の上部中央になる予定だが、他のノードの設定がまだなので現時点では中央にされる。後から徐々に意図した形になるはずなので、位置はそのままにしておくこと。\n インスペクターで「Text」プロパティは仮に「Mask Dude」と入力する。 「Align」プロパティを「Center」にする。 「Theme Overrides」＞「Fonts」＞「Font」で「新規 DynamicFont」を選択する。 「Font」＞「Settings」＞「Size」プロパティを 32 にする。 「Font」＞「Settings」＞「Outline Size」プロパティを 5 にする。 「Font」＞「Settings」＞「Outline Color」プロパティで色を # 302e3e （濃いグレー）にする。 「Font」＞「Font」＞「Font Data」に「res://fonts/connection_ii/ConnectionII.otf」を適用する。  HBoxContainer このノードは水平方向に子ノードを横並びに配置するコンテナだ。左右の矢印ボタンアイコンを子ノードに持つので、それを横並びに配置する。またその左右の矢印ボタンの間に、プレイヤーキャラクターのスプライトを表示させたいので、ボタンとボタンの間をたっぷり目に空けておく必要がある。\n インスペクターで「Alignment」プロパティを「Center」にする。 「Theme Overrides」＞「Constants」＞「Separation」ノードを 156 にする。  LeftButton このノードは「TextureRect」クラスなので、ボタンにテクスチャ画像を割り当てることができる。名前の通り、左向き矢印ボタンを作るのに利用する。\n インスペクターで「Expand」プロパティをオンにする。 「Stretch Mode」プロパティを「Keep Aspect Centered」にする。 「Textures」＞「Normal」プロパティに、ファイルシステムドックから「res://Assets/Menu/Buttons/Previous.png」をドラッグ\u0026ドロップして適用する。 「Control」クラスの「Rect」＞「Min Size」プロパティを (42, 40) にする。  RightButton このノードも「LeftButton」同様に「TextureRect」クラスで、右向き矢印ボタンを作るのに利用する。\n インスペクターで「Expand」プロパティをオンにする。 「Stretch Mode」プロパティを「Keep Aspect Centered」にする。 「Textures」＞「Normal」プロパティに、ファイルシステムドックから「res://Assets/Menu/Buttons/Next.png」をドラッグ\u0026ドロップして適用する。 「Control」クラスの「Rect」＞「Min Size」プロパティを (42, 40) にする。  Caption このノードは、単なる「Label」クラスのノードである。プレイヤーキャラクター選択画面での操作説明を画面下部に表示させるために利用する。\n インスペクターで「Text」プロパティに以下の開業を含む文字列を入力する。\npress left or right key to select a character\npress enter or space key to confirm 「Align」プロパティを「Center」にする。 「Uppercase」プロパティをオンにする。 「Theme Overrides」＞「Fonts」＞「Font」プロパティに、ファイルシステムドックから「res://fonts/poco/Poco.tres」をドラッグ\u0026ドロップして適用する。\n*このリソースファイルは他のシーンでも利用しているのでリソースのプロパティはそのままにしておくこと。もし編集したい場合は必ずリソースを「ユニーク化」して他のノードのデザインに影響しないようにすること。 「CanvasItem」クラスの「Visibility」＞「Modulate」プロパティで色を # 000000（黒）にする。  AnimatedSprite このノードは、先に作成した 4 種類のプレイヤーキャラクターの「SpriteFrames」クラスのリソースファイルを「Frames」プロパティに適用させて、画面上に実際にキャラクターのスプライトを表示するために利用する。\n インスペクターで「Frames」プロパティに、ファイルシステムドックから先に作った「res://Player/MaskDude.tres」をドラッグ\u0026ドロップして適用させる。最初は「MaskDude」のスプライトで表示させるためだ。 「Animation」プロパティは「idle」を選択する。これが一番、2Dワークスペース上で位置を把握しやすいはずだ。 「Position」プロパティは (192, 124) にする。これがちょうど左右のボタンの中間にあたる位置だ。  AnimationPlayer このノードは「LeftButton」と「RightButton」をクリックした時に再生させる、ボタンが凹んだような簡単なアニメーションを作るのに利用する。\n インスペクターでのプロパティ編集は不要だ。 アニメーションパネルを開く。 まず左矢印ボタンのアニメーションを作成する。   アニメーション名: press_left アニメーションの長さ(秒): 0.1 アニメーションループ: 無効 トラック:  「LeftButton」ノード ＞「modulate」プロパティ  Time: 0秒 / Value: # ffffff / Easing: 1.00 Time: 0.05秒 / Value: # c8c8c8 / Easing: 1.00 Time: 0.1秒 / Value: # ffffff / Easing: 1.00   「LeftButton」ノード ＞「rect_scale」プロパティ  Time: 0秒 / Value: (1, 1) / Easing: 1.00 Time: 0.05秒 / Value: (0.9, 0.9) / Easing: 1.00 Time: 0.1秒 / Value: (1, 1) / Easing: 1.00       次に右矢印ボタンのアニメーションを作成する。トラックのノードが違うこと以外は先に作成した「press_left」アニメーションとほとんど同じだ。   アニメーション名: press_right アニメーションの長さ(秒): 0.1 アニメーションループ: 無効 トラック:  「RightButton」ノード ＞「modulate」プロパティ  Time: 0秒 / Value: # ffffff / Easing: 1.00 Time: 0.05秒 / Value: # c8c8c8 / Easing: 1.00 Time: 0.1秒 / Value: # ffffff / Easing: 1.00   「RightButton」ノード ＞「rect_scale」プロパティ  Time: 0秒 / Value: (1, 1) / Easing: 1.00 Time: 0.05秒 / Value: (0.9, 0.9) / Easing: 1.00 Time: 0.1秒 / Value: (1, 1) / Easing: 1.00       シングルトンを作る シングルトンというのはプログラミング用語で、インスタンスが1つしかないように設計されたクラスのことで、他の複数のクラスで何らかの共通したプロパティやメソッドを利用する必要がある場合に用いられる。詳しい定義や仕組み、使い方などは、以下のリンク先のリソースをご参照いただきたい。\n Memo: \nWikipedia - Singleton パターン Godot 公式オンラインドキュメント - シングルトン(自動読み込み) \n このチュートリアルでシングルトンを使用する理由は、4種類のプレイヤーキャラクターの「SpriteFrames」のリソースをシングルトンのプロパティとして用意しておけば、「CharacterSelect」シーンの「AnimatedSprite」ノードにも、「Level」シーン＞「Player」＞「AnimatedSprite」ノードにもいつでも利用できるようになるからだ。\n仮に、「CharacterSelect」ノードのプロパティとして「SpriteFrames」のリソースを用意することの弊害が一つある。それは「CharacterSelect」インスタンスノードは用済みになったら「Game」シーンから解放（削除）させる、ということだ。解放してしまうと、リソースの参照先を見失って、プレイヤーキャラクターのスプライトにテクスチャを割り当てることができなくなる。その結果、プレイヤーキャラクターは透明人間状態になってしまう。\n一方、シングルトンのスクリプトで「SpriteFrames」リソースを定義しておけば、他の複数のノードからいつでもそれを参照することができる。\nシングルトンのスクリプトを作る 説明が長くなったが、ここからは以下の手順でシングルトンを実際に作成していこう。\n ファイルシステムドックで「res://」フォルダを右クリック＞「新規スクリプト」を選択する。\n 「スクリプト作成」ダイアログが表示されたら、継承元を必ず「Node」にして、ファイル名を「Global.gd」として作成する。\n 「プロジェクト」メニュー＞「プロジェクト設定」を選択する。 「自動読み込み（AutoLoad）」タブを開きパス入力欄の右側にあるフォルダアイコンをクリックする（Global.gdのパスを直接打ち込んでも良い）。\n 「Global.gd」スクリプトを選択して開く。\n パス入力欄に「Global.gd」のファイルパスが入ったら右側の「追加」をクリックする。\n 自動読み込みに追加されたことを確認したら、ウインドウを閉じる。ちなみに「グローバル変数」とは他のどのスクリプトのどのスコープからでもアクセスできる変数のことだが、これを利用したいので有効のままで良い。\n  以上の作業で、シングルトン「Global.gd」スクリプトがゲーム開始時に一番最初に読み込まれ、常にどのシーンのどのノードのスクリプトからでもシングルトンのプロパティやメソッドにアクセスできるようになった。ゲーム開始時に自動読み込みされる時、自動的に「Node」が作成され、これに「Global.gd」スクリプトがアタッチされる仕組みだ。つまり、このスクリプトに記述するプロパティにアクセスしたければ、この「Node」のプロパティを参照するようコーディングすれば良い。なお、「Node」は自動的にスクリプトと同じ「Global」という名前になるので、簡単にアクセスできる。\nシングルトンのスクリプトを編集する ではシングルトンの「Global.gd」スクリプトを開き、以下のコードを記述しよう。\nextends Node   var spriteframes = [ \tpreload(\"res://Player/MaskDude.tres\"), \tpreload(\"res://Player/NinjaFrog.tres\"), \tpreload(\"res://Player/PinkMan.tres\"), \tpreload(\"res://Player/VirtualGuy.tres\") ] プリロードされた4種類のプレイヤーキャラクターの「SpriteFrames」リソースを配列にまとめた。これで、プレイヤーキャラクターの4種類のリソースにどこからでも簡単にアクセスできる。\n CharacterSelect にスクリプトをアタッチして編集する 「CharacterSelect」ノードに新規スクリプトをアタッチしよう。ファイルパスは「res://UI/CharacterSelect/CharacterSelect.gd」となるようにする。\nでは作成したシングルトンを利用しつつ、コーディングしていこう。\nextends Control  # カスタムシグナル、引数に SpriteFrames リソースの参照を渡す signal character_selected(sprite_frames)  # 現在キャラクター選択中のフラグを立てる（true） var is_choosing = true # AnimatedSprite のアニメーションの現在のフレーム番号を保持 var frames_num = 0 # キャラクターの名前の配列（要素の順番はシングルトンの SpriteFrames の配列に合わせる） var characters = [\"Mask Dude\", \"Ninja Frog\", \"Pink Man\", \"Virtual Guy\"]  # シングルトンのノードの参照 onready var global = get_node(\"/root/Global\") # CharacterName ノードの参照 onready var char_name = $VBoxContainer/CharacterName # LeftButton ノードの参照 onready var l_button = $VBoxContainer/HBoxContainer/LeftButton # RightButton ノードの参照 onready var r_button = $VBoxContainer/HBoxContainer/RightButton # AnimatedSprite ノードの参照 onready var sprite = $AnimatedSprite # AnimationPlayer ノードの参照 onready var anim_player = $AnimationPlayer   func _ready(): \t# 以下4行: AnimationPlayer のアニメーションで変更されるプロパティに初期値を設定 \tl_button.modulate = Color(1, 1, 1, 1) \tl_button.rect_scale = Vector2(1, 1) \tr_button.modulate = Color(1, 1, 1, 1) \tr_button.rect_scale = Vector2(1, 1) \t# 以下のメソッドを呼ぶ（この後定義する） \tplay_animations()   # _ready で呼ばれる: AnimatedSprite のアニメーションを制御する func play_animations(): \t# アニメーションの名前の配列（Array型を指定しないと PoolStringArray 型になる） \tvar animations: Array = sprite.frames.get_animation_names() \t# 現在再生中のアニメーションの上記配列内の順番 \tvar anim_index = 0  # アニメーションのループ回数をカウントするための変数 \tvar count = 0 \t# デバッグ用 \tprint(\"animations array is \", animations) \t\t# アニメーションの名前の配列から不要な要素を削除するため配列の要素でループ \tfor anim in animations: \t# アニメーションが fall か jump の場合は配列から削除（フレームが1つしかなく面白くないため） \tif anim == \"fall\" or anim == \"jump\": \tanimations.remove(animations.find(anim)) \tprint(\"removed \", anim, \" from animations array.\") \t\t# 現在キャラクター選択中のフラグが立っている間はループする \twhile is_choosing: \t# アニメーションの名前の配列から現在の再生中のアニメーションを指定して再生 \tsprite.play(animations[anim_index]) \t# 最後のアニメーションフレーム終了まで待機 \tyield(sprite, \"animation_finished\") \t# アニメーションを一度停止する \tsprite.stop() \t# アニメーションが 4 周するまで while ループ \tif count  4: \tcount += 1 \tcontinue \t# アニメーションが 4 周したらカウントを 0 にする \tcount = 0 \t# 現在再生中のアニメーションの番号が、アニメーションの配列の要素数 - 1 より小さい場合は  \tif anim_index  animations.size() - 1: \t# アニメーションの番号に 1　を加えて、次のアニメーションを再生するように仕込む \tanim_index += 1 \t# 現在再生中のアニメーションの番号が、アニメーションの配列の要素数 - 1 になったら \telse: \t# 全てのアニメーションを再生したので、アニメーションの番号を 0 に戻して、最初のアニメーションに戻る \tanim_index = 0 少しコードが長い印象を持たれたかもしれないが、やっていることは単に「AnimatedSprite」ノードに設定済みのアニメーションを自動的に順次再生させているだけである。アニメーションを4周再生したら、次のアニメーションを再生し、全てのアニメーションを4回ずつ再生したらまた最初のアニメーションの再生から始めるようにwhileループを利用して制御している。\n次はキャラクターを切り替える左右のボタンを押した時の制御を実装する。これにはシグナルを利用する。「LeftButton」ノードおよび「RightButton」ノードの「pressed()」シグナルを今編集している「CharacterSelect.gd」スクリプトに接続しよう。\n接続して自動生成されたメソッドを以下のように編集する。ちなみに左ボタンが逆送り、右ボタンが順送りでキャラクターを切り替えるように実装している。\nfunc _on_LeftButton_pressed(): \t# AnimationPlayer の press_left アニメーションを再生 \tanim_player.play(\"press_left\") \t# シングルトンの SpriteFrames のリソースの配列から、 \t# 一つ前のキャラクターのものを AnimatedSprite ノードの frames プロパティに適用する \t# CharacterName の text プロパティにその SpriteFrames に合致したキャラクターの名前を入れる \t# 今、配列の最初のリソースを適用している時は配列の最後のリソースを適用する \tif frames_num  0: \tframes_num -= 1 \tsprite.frames = global.spriteframes[frames_num] \tchar_name.text = characters[frames_num] \telse: \tsprite.frames = global.spriteframes[global.spriteframes.size() -1] \tchar_name.text = characters[characters.size() - 1] \tframes_num = global.spriteframes.size() -1   func _on_RightButton_pressed(): \t# AnimationPlayer の press_right アニメーションを再生 \tanim_player.play(\"press_right\") \t# シングルトンの SpriteFrames のリソースの配列から、 \t# 次のキャラクターのものを AnimatedSprite ノードの frames プロパティに適用する \t# CharacterName の text プロパティにその SpriteFrames に合致したキャラクターの名前を入れる \t# 今、配列の最後のリソースを適用している時は配列の最初のリソースを適用する \tif frames_num  global.spriteframes.size() -1: \tframes_num += 1 \tsprite.frames = global.spriteframes[frames_num] \tchar_name.text = characters[frames_num] \telse: \tsprite.frames = global.spriteframes[0] \tchar_name.text = characters[0] \tframes_num = 0 キャラクターを切り替える操作のたびに「AnimatedSprite」の「Frames」プロパティに適切な「SpriteFrames」リソースを適用しているが、その時、シングルトンの「Global.gd」スクリプト内の配列spriteframes から当てはまる要素（SpriteFrames リソース）をピックアップして適用している。\n最後にキーボードでの入力も受け付けられるようにコードを追加する。_inputメソッドは GDScript の組み込み関数で、これを利用してあらゆる入力に対する制御を実装できる。引数のeventは「InputEvent」クラスのオブジェクトで、キーボード入力やマウスクリックなどの入力イベントを指す。さまざまなメソッドが用意されているので、非常に便利である。\n 公式オンラインドキュメント: \nUsing InputEvent void _input ( InputEvent event ) virtual InputEvent \n func _input(event): \t# 左矢印キーを押したら \tif event.is_action_pressed(\"ui_left\"): \t# 左ボタンアイコンをクリックした時に呼ばれるメソッドを呼ぶ \t_on_LeftButton_pressed() \t# 右矢印キーを押したら \telif event.is_action_pressed(\"ui_right\"): \t# 右ボタンアイコンをクリックした時に呼ばれるメソッドを呼ぶ \t_on_RightButton_pressed() \t# スペースキーかエンターキーを押したら \telif event.is_action_released(\"ui_accept\"): \t# キャラクター選択中のフラグを無効にする \tis_choosing = false \temit_signal(\"character_selected\", global.spriteframes[frames_num]) \tprint(\"emitted signal: character_selected\") \tqueue_free() \tprint(\"CharacterSelect scene is now freed.\") \nこれで「CharacterSelect」シーンの作成は完了だ。\n \n (adsbygoogle = window.adsbygoogle || []).push({});   Game シーンに GameStart シーンと CharacterSelect シーンのインスタンスを追加する それではここまでで作成した「GameStart」シーンと「CharacterSelect」シーンをインスタンス化して「Game」シーンに追加しよう。\n…といういつもの流れとは少し異なる手順で進める。\nGame シーンツリーを整理する 一旦「Game」シーンツリーを整理しよう。\n「Game」シーンに UI 系のブランチが多いと、各ブランチのスクリプトで制御している入力操作が同時に処理されてしまう可能性があり面倒だ。例えばスタート画面でキーボードのスペースキーでキャラクター選択画面に遷移させただけのつもりが、次の画面のキャラクター選択が同時に確定してしまい、キャラクターを選ぶ間もなく一気にゲームプレイ画面に遷移する、というような問題だ。\nスクリプトのコードを工夫すれば対処可能だが、この問題を完全に回避する分かりやす方法は、必要なノード以外をシーンツリー上に存在させないことだ。そこで、最初の画面である「GameStart」シーンのインスタンス、および入力操作の影響を受けない「HUD」シーンのインスタンスのみを「Game」シーンツリーに追加しておき、他のシーンのインスタンスはスクリプトで、必要な時に作成\u0026追加することにする。\nということで、まずは「Game」シーンで、今回のチュートリアルで作成した「GameStart.tscn」のインスタンスを追加し、前回のチュートリアルで追加済みの「GameOver.tscn」のインスタンスノードを削除しよう。作業後の「Game」シーンツリーは以下のようになる。\nGame.gd スクリプトを更新する ここから「Game.gd」スクリプトで、不要になったノードを削除したり、必要になったノードを追加したり、選択されたキャラクターの「SpriteFrames」リソースを「Level」ブランチ内のプレイヤーキャラクターに適用したり、という処理を実装していく。若干複雑かもしれないが、頑張ってやっていこう。\nそれでは「Game.gd」スクリプトを開いてほしい。そして、まずはプロパティの定義と_readyメソッドまで見ていこう。「# 追加」や「# 削除」とコメントしている行が更新箇所だ。\nextends Node   export var current_level = 1 export var final_level = 2  var health: float = 100.0 var score: int = 0 var level: Node2D var player: KinematicBody2D # 選択されたキャラクターの SpriteFrames リソースの参照用 var char_frames: SpriteFrames # 追加 # UI ノードの参照 onready var ui_layer = $UI # 追加 # GameStart ノードの参照 onready var gamestart = $UI/GameStart # 追加 onready var hud = $UI/HUD #onready var gameover = $UI/GameOver # Added @ Part 9 # 削除: シーンツリーから削除した   func _ready(): \t#gameover.visible = false # Added @ Part 9 # 削除: シーンツリーから削除した \t# GameStart ノードが解放された時に発信されるシグナルを _on_GameStart_tree_exited メソッドに接続 \tgamestart.connect(\"tree_exited\", self ,\"_on_GameStart_tree_exited\") # 追加 \t# 以下 4 行：ゲーム開始時に呼ぶ必要がなくなったので別のメソッドへ移動 \t#add_level() \t#hud.update_health(health) \t#hud.update_score(score) \t#hud.update_level(current_level) \n続いて、先にコード上で接続したシグナル「tree_exited()」の接続先メソッド_on_GameStart_tree_exitedを定義しよう。なお、このシグナルは「GameStart」シーンが解放された時に発信される。\nfunc _on_GameStart_tree_exited(): \t# CharacterSelect ノードのインスタンスを作成 \tvar char_select = load(\"res://UI/CharacterSelect/CharacterSelect.tscn\").instance() \t# CharacterSelect ノードの character_selected カスタムシグナルを _on_CharacterSelect_character_selected メソッドに接続 \tchar_select.connect(\"character_selected\", self ,\"_on_CharacterSelect_character_selected\") \t# UI ノードの子として CharacterSelect インスタンスノードを追加 \tui_layer.add_child(char_select) \nさらに、今しがた「CharacterSelect」ノードから「character_selected」シグナルを接続した_on_CharacterSelect_character_selectedメソッドを編集していく。ちなみにこのシグナルは、キャラクター選択が確定したら発信される。このシグナルは自作したシグナルで、引数sprite_framesを持っている。これを接続先のメソッドの引数に渡す格好だ。\nfunc _on_CharacterSelect_character_selected(sprite_frames): \t# このスクリプトのプロパティ char_frames に選択したキャラクターの SpriteFrames リソースを渡す \tchar_frames = sprite_frames \t# 以下 4 行： _ready メソッドからこちらに移動させた \tadd_level() \thud.update_health(health) \thud.update_score(score) \thud.update_level(current_level) 「CharacterSelect.gd」スクリプトでは、「character_selected」シグナル発信後、まもなく「CharacterSelect」ノードは解放される。ここでシングルトンを作成したおかげで、char_framesプロパティは「CharacterSelect」ノードからバトンパスされたかのように、シングルトンの「SpriteFrames」リソースを参照した状態になる。\nキャラクター選択画面の次はゲームプレイの開始となるので、もともと_readyメソッドで実行していたadd_levelメソッドでの「Level」シーンのインスタンス追加や「HUD」ノードの各コンポーネントの初期設定メソッドをこのタイミングで実行させている。\nここでadd_levelメソッドに大事な 1 行を加えることを忘れてはいけない。「Level」ノード＞「Player」ノード＞「AnimatedSprite」ノードの「Frames」プロパティに、キャラクター選択画面で選択したキャラクターの「SpriteFrames」リソースを適用するための 1 行だ。これにより、ゲームプレイ画面のプレイヤーキャラクターが、キャラクター選択画面で選んだキャラクターと同じ見た目になるわけだ。\nfunc add_level(): \tlevel = load(\"res://Levels/Level\" + str(current_level) + \".tscn\").instance() \tlevel.connect(\"tree_exited\", self, \"change_level\") \tlevel.connect(\"player_dropped\", self, \"_on_Level_player_dropped\") \tcall_deferred(\"add_child\", level) # エラー解消のため修正 \tplayer = level.get_node(\"Player\") \tplayer.connect(\"enemy_hit\", self, \"_on_Player_enemy_hit\") \tplayer.connect(\"item_hit\", self, \"_on_Player_item_hit\") \t# Player ノードの子 AnimatedSprite ノードに選択したキャラクターの SpriteFrames リソースを適用 \tplayer.get_node(\"AnimatedSprite\").frames = char_frames # 追加 \nこのあとmanage_healthメソッドまでのコードは今までと変わりない。manage_healthメソッドの変更内容を見ていこう。\n# 中略  func manage_health(damage): \thealth -= damage # Moved from _on_Player_enemy_hit() \tprint(\"Health updated: \", health) # Moved from _on_Player_enemy_hit() \thud.update_health(health) # Moved from _on_Player_enemy_hit()  \tif health  0: \tplayer.anim_player.play(\"die\") \tyield(player.anim_player, \"animation_finished\") \t#gameover.visible = true # 削除: シーンツリーから削除しているため不要 \t# GameOver シーンをインスタンス化 \tvar gameover = load(\"res://UI/GameOver/GameOver.tscn\").instance() # 追加 \t# UI ノードに GameOver シーンのインスタンスノードを追加 \tui_layer.add_child(gameover) # 追加 \tprint(\"Game over screen is shown up.\") \tget_tree().paused = true \tprint(\"Scene tree paused: \", get_tree().paused) これまでは「GameOver」シーンのインスタンスは最初から「Game」シーンツリーに追加してあったが、さっき削除したので、visibleプロパティの有効化は不要となった。反対に「GameOver」シーンのインスタンスをスクリプト上で追加する必要があるので、そのためのコードを追加した。インスタンスを子ノードにする作業はたった 2 行のコードで実装できるのだ。（子ノードの順番の入れ替えが必要な場合はもう1行必要だ）。\n以上で「Game.gd」スクリプトの編集は完了だ。\n最後にプロジェクトを実行して、今回作成した「GameStart」シーンと「CharacterSelect」シーンがプロジェクトの中でうまく動作するか確認しておこう。\n以下のポイントで問題なさそうなので、ここで今回の作業を終えよう。\n 最初にスタート画面が表示された。 スペースキーを押すとプレイヤーキャラクター選択画面が表示された。 プレイヤーキャラクター選択画面で、マウスでの左右ボタンの操作、キーボードでの左右矢印キーの操作によって、キャラクターの名前とスプライトの見た目が順番に切り替わった。 プレイヤーキャラクター選択画面でキャラクターはアニメーションし続けた。 プレイヤーキャラクター選択画面でスペースキーを押すとゲームプレイ画面に遷移した。 ゲームプレイ画面にはプレイヤーキャラクター選択画面で最後に選択したキャラクターが登場した。   \n (adsbygoogle = window.adsbygoogle || []).push({});   Part 10 で編集したスクリプトのコード 最後に今回の Part 10 で編集したスクリプトのコードを共有しておくので、必要に応じて確認してほしい。\n GameStart.gd の全コード extends Control # Added @ Part 10   onready var start_button = $VBoxContainer/StartVBox/StartButton onready var anim_player = $AnimationPlayer  func _ready(): \tstart_button.modulate = Color(1, 1, 1, 1) \tstart_button.rect_scale = Vector2(1, 1)   func _on_StartButton_button_up(): \t#print(\"_on_StartButton_button_up called.\") \tanim_player.play(\"press_start\") \tyield(anim_player, \"animation_finished\") \tqueue_free() \tprint(\"GameStart scene is now freed.\")   func _input(event): \tif event.is_action_released(\"ui_accept\"): \t_on_StartButton_button_up()   CharacterSelect.gd の全コード extends Control # Added @ Part 10  signal character_selected(sprite_frames)  var is_choosing = true var frames_num = 0 var characters = [\"Mask Dude\", \"Ninja Frog\", \"Pink Man\", \"Virtual Guy\"]  onready var global = get_node(\"/root/Global\") onready var char_name = $VBoxContainer/CharacterName onready var l_button = $VBoxContainer/HBoxContainer/LeftButton onready var r_button = $VBoxContainer/HBoxContainer/RightButton onready var sprite = $AnimatedSprite onready var anim_player = $AnimationPlayer   func _ready(): \tl_button.modulate = Color(1, 1, 1, 1) \tl_button.rect_scale = Vector2(1, 1) \tr_button.modulate = Color(1, 1, 1, 1) \tr_button.rect_scale = Vector2(1, 1) \tplay_animations()   func play_animations(): \tvar animations: Array = sprite.frames.get_animation_names() \tvar anim_index = 0 \tvar count = 0 \t#print(\"animations array is \", animations) \t\tfor anim in animations: \tif anim == \"fall\" or anim == \"jump\": \tanimations.remove(animations.find(anim)) \t#print(\"removed \", anim, \" from animations array.\") \t\twhile is_choosing: \tsprite.play(animations[anim_index]) \tyield(sprite, \"animation_finished\") \tsprite.stop() \tif count  4: \tcount += 1 \tcontinue\t\tcount = 0 \tif anim_index  animations.size() - 1: \tanim_index += 1 \telse: \tanim_index = 0   func _on_LeftButton_pressed(): \tanim_player.play(\"press_left\") \tif frames_num  0: \tframes_num -= 1 \tsprite.frames = global.spriteframes[frames_num] \tchar_name.text = characters[frames_num] \telse: \tsprite.frames = global.spriteframes[global.spriteframes.size() - 1] \tchar_name.text = characters[characters.size() - 1] \tframes_num = global.spriteframes.size() - 1   func _on_RightButton_pressed(): \tanim_player.play(\"press_right\") \tif frames_num  global.spriteframes.size() -1: \tframes_num += 1 \tsprite.frames = global.spriteframes[frames_num] \tchar_name.text = characters[frames_num] \telse: \tsprite.frames = global.spriteframes[0] \tchar_name.text = characters[0] \tframes_num = 0   func _input(event): \tif event.is_action_pressed(\"ui_left\"): \t_on_LeftButton_pressed() \telif event.is_action_pressed(\"ui_right\"): \t_on_RightButton_pressed() \telif event.is_action_released(\"ui_accept\"): \tis_choosing = false \temit_signal(\"character_selected\", global.spriteframes[frames_num]) \t#print(\"emitted signal: character_selected\") \tqueue_free() \tprint(\"CharacterSelect scene is now freed.\")   Global.gd の全コード extends Node # Added @ Part 10   var spriteframes = [ \tpreload(\"res://Player/MaskDude.tres\"), \tpreload(\"res://Player/NinjaFrog.tres\"), \tpreload(\"res://Player/PinkMan.tres\"), \tpreload(\"res://Player/VirtualGuy.tres\") ]   Game.gd の全コード extends Node # Added @ Part 7  export var current_level = 1 export var final_level = 2  var health: float = 100.0 # Added @ Part 8 var score: int = 0 # Added @ Part 8 var level: Node2D var player: KinematicBody2D var char_frames: SpriteFrames # Added @ Part 10  onready var ui_layer = $UI # Added @ Part 10 onready var gamestart = $UI/GameStart # Added @ Part 10 onready var hud = $UI/HUD # Added @ Part 8 #onready var gameover = $UI/GameOver # Added @ Part 9 # Removed @ Part 10   func _ready(): \t#gameover.visible = false # Added @ Part 9 # Removed @ Part 10 \tgamestart.connect(\"tree_exited\", self ,\"_on_GameStart_tree_exited\") # Added @ Part 10   func _on_GameStart_tree_exited(): # Added @ Part 10 \tvar char_select = load(\"res://UI/CharacterSelect/CharacterSelect.tscn\").instance() \tchar_select.connect(\"character_selected\", self ,\"_on_CharacterSelect_character_selected\") # Added @ Part 10 \tui_layer.add_child(char_select)   func _on_CharacterSelect_character_selected(sprite_frames): # Added @ Part 10 \tchar_frames = sprite_frames \tadd_level() # Moved @ Part 10 # Modified @ Part 10 \thud.update_health(health) # Added @ Part 8 # Moved @ Part 10 \thud.update_score(score) # Added @ Part 8 # Moved @ Part 10 \thud.update_level(current_level) # Added @ Part 8 # Moved @ Part 10   func add_level(): # Modified @ Part 10 \tlevel = load(\"res://Levels/Level\" + str(current_level) + \".tscn\").instance() \tlevel.connect(\"tree_exited\", self, \"change_level\") \tlevel.connect(\"player_dropped\", self, \"_on_Level_player_dropped\") # Added @ Part 9 \tcall_deferred(\"add_child\", level) # Fixed error \tplayer = level.get_node(\"Player\") # Added @ Part 8 \tplayer.connect(\"enemy_hit\", self, \"_on_Player_enemy_hit\") # Added @ Part 8 \tplayer.connect(\"item_hit\", self, \"_on_Player_item_hit\") # Added @ Part 8 \tplayer.get_node(\"AnimatedSprite\").frames = char_frames # Added @ Part 10   func change_level(): \tprint(\"change_level() called.\") \tif current_level  final_level: \tprint(\"change to next level.\") \tlevel.queue_free() \tcurrent_level += 1 \thud.update_level(current_level) # Added @ Part 8 \tadd_level() \telse: \tprint(\"Game Clear! Congrats!\") \tget_tree().quit()   func _on_Player_enemy_hit(damage): # Added @ Part 8 \tmanage_health(damage) # Modified @ Part 9   func _on_Player_item_hit(point): # Added @ Part 8 \tscore += point \thud.update_score(score)   func _on_Level_player_dropped(): # Added @ Part 9 \tmanage_health(100)   func manage_health(damage): # Added @ Part 9 \thealth -= damage # Moved from _on_Player_enemy_hit() @ Part 9 \tprint(\"Health updated: \", health) # Moved from _on_Player_enemy_hit() @ Part 9 \thud.update_health(health) # Moved from _on_Player_enemy_hit() @ Part 9 \t# Added @ Part 9 \tif health  0: \tplayer.anim_player.play(\"die\") \tyield(player.anim_player, \"animation_finished\") \t#gameover.visible = true # Removed @ Part 10 \tvar gameover = load(\"res://UI/GameOver/GameOver.tscn\").instance() # Added @ Part 10 \tui_layer.add_child(gameover) # Added @ Part 10 \tprint(\"Game over screen is shown up.\") \tget_tree().paused = true \tprint(\"Scene tree paused: \", get_tree().paused)   おわりに 以上で Part 10 は完了だ。\n今回はゲームスタート画面とその次のプレイヤーキャラクター選択画面を実装した。スタート画面に比べて、キャラクター選択画面の方は難しく感じられたかもしれない。シングルトンという何やら聞き慣れない単語も出てきたが、複数のシーンで同じデータにアクセスしたい時などに非常に有効な手段であると実感いただけたなら幸いだ。ゲーム開発に限らず、あらゆるオブジェクト指向プログラミングで多用されるデザインパターンなので、知っておいて損はないだろう。\nさて、次回のチュートリアルでは、ゲームプレイ画面に背景テクスチャを追加し、カメラが移動するときに近景のタイルマップは早く動き、遠景の背景テクスチャはゆっくり動く、といういわゆるパララックスエフェクト（視差効果）を実装して、ユーザーエクスペリエンスを高めてみよう。\nでは次回もお楽しみに。\n",
  "wordCount" : "2038",
  "inLanguage": "ja",
  "image":"https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_10/img43.gif","datePublished": "2022-03-22T17:32:43+09:00",
  "dateModified": "2022-03-22T17:32:43+09:00",
  "author":{
    "@type": "Person",
    "name": "Masanao Sako"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_10/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Peanuts Code",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.peanuts-code.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.peanuts-code.com/ja/" accesskey="h" title="Peanuts Code (Alt + H)">
                <img src="/images/logomark.png" alt="logo" aria-label="logo"
                    height="35">Peanuts Code</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://www.peanuts-code.com/en/" title="English"
                            aria-label="English">En</a>
                    </li>
                </ul>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.peanuts-code.com/ja/" title="ホーム">
                    <span>ホーム</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/posts/" title="ブログ">
                    <span>ブログ</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/tutorials/" title="チュートリアル">
                    <span>チュートリアル</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/tags/" title="タグ">
                    <span>タグ</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/about/" title="アバウト">
                    <span>アバウト</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://www.peanuts-code.com/ja/">Home</a>&nbsp;»&nbsp;<a href="https://www.peanuts-code.com/ja/tutorials/">Tutorials</a>&nbsp;»&nbsp;<a href="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/">シリーズ：Godot で作るプラットフォーマー</a></div>
    <h1 class="post-title">
      Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！
    </h1>
    <div class="post-meta">2022-03-22&nbsp;·&nbsp;10 分&nbsp;·&nbsp;Masanao Sako
</div>
  </header> 
<figure class="entry-cover"><img loading="lazy" src="https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_10/img43.gif" alt="プラットフォーマー Part 10 サムネイル">
        
</figure><div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目次</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8b" aria-label="スタート画面を作る">スタート画面を作る</a><ul>
                        
                <li>
                    <a href="#%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e3%82%8b" aria-label="シーンを作る">シーンを作る</a></li>
                <li>
                    <a href="#%e3%82%b7%e3%83%bc%e3%83%b3%e3%83%84%e3%83%aa%e3%83%bc%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b" aria-label="シーンツリーを編集する">シーンツリーを編集する</a></li>
                <li>
                    <a href="#%e5%90%84%e3%83%8e%e3%83%bc%e3%83%89%e3%81%ae%e3%83%97%e3%83%ad%e3%83%91%e3%83%86%e3%82%a3%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b" aria-label="各ノードのプロパティを編集する">各ノードのプロパティを編集する</a><ul>
                        
                <li>
                    <a href="#gamestart" aria-label="GameStart">GameStart</a></li>
                <li>
                    <a href="#texturerect" aria-label="TextureRect">TextureRect</a></li>
                <li>
                    <a href="#vboxcontainer" aria-label="VBoxContainer">VBoxContainer</a></li>
                <li>
                    <a href="#titlelabel" aria-label="TitleLabel">TitleLabel</a></li>
                <li>
                    <a href="#startvbox" aria-label="StartVBox">StartVBox</a></li>
                <li>
                    <a href="#startbutton" aria-label="StartButton">StartButton</a></li>
                <li>
                    <a href="#startlabel" aria-label="StartLabel">StartLabel</a></li>
                <li>
                    <a href="#animationplayer" aria-label="AnimationPlayer">AnimationPlayer</a></li></ul>
                </li>
                <li>
                    <a href="#%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%82%92%e3%82%a2%e3%82%bf%e3%83%83%e3%83%81%e3%81%97%e3%81%a6%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b" aria-label="スクリプトをアタッチして編集する">スクリプトをアタッチして編集する</a></li></ul>
                </li>
                <li>
                    <a href="#%e3%83%97%e3%83%ac%e3%82%a4%e3%83%a4%e3%83%bc%e3%82%ad%e3%83%a3%e3%83%a9%e3%82%af%e3%82%bf%e3%83%bc%e3%81%ae%e7%a8%ae%e9%a1%9e%e3%82%92%e5%a2%97%e3%82%84%e3%81%99" aria-label="プレイヤーキャラクターの種類を増やす">プレイヤーキャラクターの種類を増やす</a><ul>
                        
                <li>
                    <a href="#spriteframes-%e3%83%aa%e3%82%bd%e3%83%bc%e3%82%b9%e3%82%92%e4%bd%9c%e6%88%90%e3%81%99%e3%82%8b" aria-label="SpriteFrames リソースを作成する">SpriteFrames リソースを作成する</a><ul>
                        
                <li>
                    <a href="#pinkman" aria-label="PinkMan">PinkMan</a></li>
                <li>
                    <a href="#maskdude" aria-label="MaskDude">MaskDude</a></li>
                <li>
                    <a href="#ninjafrog" aria-label="NinjaFrog">NinjaFrog</a></li>
                <li>
                    <a href="#virtualguy" aria-label="VirtualGuy">VirtualGuy</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e3%83%97%e3%83%ac%e3%82%a4%e3%83%a4%e3%83%bc%e3%82%ad%e3%83%a3%e3%83%a9%e3%82%af%e3%82%bf%e3%83%bc%e9%81%b8%e6%8a%9e%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8b" aria-label="プレイヤーキャラクター選択画面を作る">プレイヤーキャラクター選択画面を作る</a><ul>
                        
                <li>
                    <a href="#%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e3%82%8b-1" aria-label="シーンを作る">シーンを作る</a></li>
                <li>
                    <a href="#%e5%bf%85%e8%a6%81%e3%81%aa%e3%83%8e%e3%83%bc%e3%83%89%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b" aria-label="必要なノードを追加する">必要なノードを追加する</a></li>
                <li>
                    <a href="#%e5%90%84%e3%83%8e%e3%83%bc%e3%83%89%e3%81%ae%e3%83%97%e3%83%ad%e3%83%91%e3%83%86%e3%82%a3%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b-1" aria-label="各ノードのプロパティを編集する">各ノードのプロパティを編集する</a><ul>
                        
                <li>
                    <a href="#characterselect" aria-label="CharacterSelect">CharacterSelect</a></li>
                <li>
                    <a href="#texturerect-1" aria-label="TextureRect">TextureRect</a></li>
                <li>
                    <a href="#vboxcontainer-1" aria-label="VBoxContainer">VBoxContainer</a></li>
                <li>
                    <a href="#charactername" aria-label="CharacterName">CharacterName</a></li>
                <li>
                    <a href="#hboxcontainer" aria-label="HBoxContainer">HBoxContainer</a></li>
                <li>
                    <a href="#leftbutton" aria-label="LeftButton">LeftButton</a></li>
                <li>
                    <a href="#rightbutton" aria-label="RightButton">RightButton</a></li>
                <li>
                    <a href="#caption" aria-label="Caption">Caption</a></li>
                <li>
                    <a href="#animatedsprite" aria-label="AnimatedSprite">AnimatedSprite</a></li>
                <li>
                    <a href="#animationplayer-1" aria-label="AnimationPlayer">AnimationPlayer</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e3%82%b7%e3%83%b3%e3%82%b0%e3%83%ab%e3%83%88%e3%83%b3%e3%82%92%e4%bd%9c%e3%82%8b" aria-label="シングルトンを作る">シングルトンを作る</a><ul>
                        
                <li>
                    <a href="#%e3%82%b7%e3%83%b3%e3%82%b0%e3%83%ab%e3%83%88%e3%83%b3%e3%81%ae%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%82%92%e4%bd%9c%e3%82%8b" aria-label="シングルトンのスクリプトを作る">シングルトンのスクリプトを作る</a></li>
                <li>
                    <a href="#%e3%82%b7%e3%83%b3%e3%82%b0%e3%83%ab%e3%83%88%e3%83%b3%e3%81%ae%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b" aria-label="シングルトンのスクリプトを編集する">シングルトンのスクリプトを編集する</a></li></ul>
                </li>
                <li>
                    <a href="#characterselect-%e3%81%ab%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%82%92%e3%82%a2%e3%82%bf%e3%83%83%e3%83%81%e3%81%97%e3%81%a6%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b" aria-label="CharacterSelect にスクリプトをアタッチして編集する">CharacterSelect にスクリプトをアタッチして編集する</a></li>
                <li>
                    <a href="#game-%e3%82%b7%e3%83%bc%e3%83%b3%e3%81%ab-gamestart-%e3%82%b7%e3%83%bc%e3%83%b3%e3%81%a8-characterselect-%e3%82%b7%e3%83%bc%e3%83%b3%e3%81%ae%e3%82%a4%e3%83%b3%e3%82%b9%e3%82%bf%e3%83%b3%e3%82%b9%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b" aria-label="Game シーンに GameStart シーンと CharacterSelect シーンのインスタンスを追加する">Game シーンに GameStart シーンと CharacterSelect シーンのインスタンスを追加する</a><ul>
                        
                <li>
                    <a href="#game-%e3%82%b7%e3%83%bc%e3%83%b3%e3%83%84%e3%83%aa%e3%83%bc%e3%82%92%e6%95%b4%e7%90%86%e3%81%99%e3%82%8b" aria-label="Game シーンツリーを整理する">Game シーンツリーを整理する</a></li>
                <li>
                    <a href="#gamegd-%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%82%92%e6%9b%b4%e6%96%b0%e3%81%99%e3%82%8b" aria-label="Game.gd スクリプトを更新する">Game.gd スクリプトを更新する</a></li></ul>
                </li>
                <li>
                    <a href="#part-10-%e3%81%a7%e7%b7%a8%e9%9b%86%e3%81%97%e3%81%9f%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%81%ae%e3%82%b3%e3%83%bc%e3%83%89" aria-label="Part 10 で編集したスクリプトのコード">Part 10 で編集したスクリプトのコード</a></li>
                <li>
                    <a href="#%e3%81%8a%e3%82%8f%e3%82%8a%e3%81%ab" aria-label="おわりに">おわりに</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>第10回目の今回は、ゲーム開始時に表示されるスタート画面を作る。タイトル画面、スタートメニューとも言う。</p>
<p>それだけだと、前回と比べて簡単すぎるので、ゲーム開始時にプレイヤーキャラクターを選択できる仕組みも実装する。画面遷移のイメージは以下の通りだ。</p>
<ol>
<li>まずゲームを始めるとスタート画面が表示される。</li>
<li>スタートボタンを押すとプレイヤーキャラクター選択画面に遷移する。</li>
<li>プレイヤーキャラクターを選択するとゲームプレイ開始。</li>
</ol>
<p>ということで、今回の作業は以下の通りだ。</p>
<ul>
<li>スタート画面を作る</li>
<li>プレイヤーキャラクターの種類（スプライトのテクスチャのみ）を増やす</li>
<li>プレイヤーキャラクター選択画面を作る</li>
<li>スタート画面とプレイヤーキャラクター選択画面をゲームに紐付ける</li>
</ul>
<p>では順番にやっていこう。</p>
<blockquote>
<p><em><strong><span style="color:salmon">Memo：</span>
</strong><br>
過去のシリーズをまだご覧になっていない方は、そちらを先にご覧いただくことをおすすめします。<br>
<a href="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/" title="Godot で作るプラットフォーマー">Godot で作るプラットフォーマー</a>
</em></p>
</blockquote>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="スタート画面を作る">スタート画面を作る<a hidden class="anchor" aria-hidden="true" href="#スタート画面を作る">#</a></h1>
<h2 id="シーンを作る">シーンを作る<a hidden class="anchor" aria-hidden="true" href="#シーンを作る">#</a></h2>
<p>まずはスタート画面を作っていく。画面のレイアウトはゲームオーバー画面と似た感じにしてしまおう。そうすればゲームオーバー画面のシーンを流用できる。</p>
<p>ということで、新規シーンは作らずに、ファイルシステムドック内でゲームオーバー画面のシーンを複製するところから作業を始める。では下記の手順でスタート画面のシーンを作成しよう。</p>
<ol>
<li>ファイルシステムで「res://UI/GameOver/GameOver.tscn」を右クリック＞「複製」を選択する。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img1.png" alt="GameOver.tscnを複製"  />
</li>
<li>シーンの名前を「GameStart.tscn」とする。</li>
<li>ファイルシステムで「res://UI/」で右クリック＞「新規フォルダー」を選択し、フォルダーの名前を「GameStart」とする。</li>
<li>「res://UI/GameStart」に「GameStart.tscn」をドラッグして移動する<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img3.png" alt="GameStartフォルダ作成"  />
</li>
</ol>
<br>
<h2 id="シーンツリーを編集する">シーンツリーを編集する<a hidden class="anchor" aria-hidden="true" href="#シーンツリーを編集する">#</a></h2>
<p>「GameOver.tscn」から複製したばかりの「GameStart.tscn」を開いてみよう。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img4.png" alt="GameStartシーンツリー複製直後"  />
</p>
<p>見ての通り、「GameOver」シーンそのままの状態だ。これを以下の手順でスタート画面仕様に修正していく。</p>
<ol>
<li>「GameOver」ルートノードの名前を「GameStart」に変更する。</li>
<li>「GameStart」ノードを右クリック＞「スクリプトをデタッチ」する。</li>
<li>「GameOverLabel」ノードの名前を「TitleLabel」に変更する。</li>
<li>「RestartVBox」ノードの名前を「StartVBox」に変更する。</li>
<li>「RestartButton」ノードの名前を「StartButton」に変更する。</li>
<li>「RestartLabel」ノードの名前を「StartLabel」に変更する。</li>
<li>「StartVBox」ブランチを「ButtonsHBox」ノードから出して「VBoxContainer」の子にする（1階層上げる）</li>
<li>「ButtonsHBox」ブランチを削除する。</li>
<li>「ColorRect」ノードを削除する。</li>
<li>「ConfirmationDialog」ノードを削除する。</li>
<li>新たに「GameStart」ルートノードに「AnimationPlayer」ノードを追加する。</li>
</ol>
<p>以上の作業でシーンツリーは以下のスクリーンショットのようになったはずだ。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img5.png" alt="GameStartシーンツリー修正後"  />
</p>
<p>最後に「StartButton」ノードの「button_up()」シグナルを切断しておこう。</p>
<p>続いて、各ノードのプロパティを更新していく。</p>
<br>
<h2 id="各ノードのプロパティを編集する">各ノードのプロパティを編集する<a hidden class="anchor" aria-hidden="true" href="#各ノードのプロパティを編集する">#</a></h2>
<p>各ノードのプロパティの値も、シーンの複製元である「GameOver.tscn」の状態のままなのでスタート画面仕様に修正していく。シーンツリーの上から順番にやっていこう。</p>
<br>
<h3 id="gamestart">GameStart<a hidden class="anchor" aria-hidden="true" href="#gamestart">#</a></h3>
<p>「Pause Mode」プロパティは、「GameOver」シーンの名残で「Process」のままになっているので、「Inherit」にしておく。その他のプロパティも編集は不要だ。</p>
<br>
<h3 id="texturerect">TextureRect<a hidden class="anchor" aria-hidden="true" href="#texturerect">#</a></h3>
<p>「Texture」プロパティに割り当てるテクスチャ画像を差し替えて、ゲームオーバー画面と差別化する。ファイルシステムドックから「res://Assets/Background/Pink.png」をドラッグ&amp;ドロップして適用する。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img8.png" alt="Textureプロパティ"  />
</p>
<br>
<h3 id="vboxcontainer">VBoxContainer<a hidden class="anchor" aria-hidden="true" href="#vboxcontainer">#</a></h3>
<p>このノードのプロパティは編集不要だ。</p>
<br>
<h3 id="titlelabel">TitleLabel<a hidden class="anchor" aria-hidden="true" href="#titlelabel">#</a></h3>
<p>スタート画面は、ゲーム開始時に最初に表示される画面なので、ゲームのタイトルを大きめに表示させたい。また、文字の見た目も色を変えたりアウトラインをつけるなどして、ゲームオーバー画面と差別化する。</p>
<ol>
<li>「Text」プロパティに以下のゲームタイトルの文字列（改行あり）を入力する（あなたの好きなタイトルにしていただいて問題ない）。<br>
platformer<br>
tutorial</li>
<li>「Theme Overrides」＞「Fonts」＞「Font」で「新規 DynamicFont」を選択する。</li>
<li>「Font」＞「Settings」＞「Size」プロパティを 48 にする。</li>
<li>「Font」＞「Settings」＞「Outline Size」プロパティを 5 にする。</li>
<li>「Font」＞「Settings」＞「Outline Color」プロパティで色を # 302e3e （濃いグレー）にする。</li>
<li>「Font」＞「Font」＞「Font Data」に「res://fonts/connection_ii/ConnectionII.otf」を適用する。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img10.png" alt="TitleLabelプロパティ"  />
</li>
<li>「Visibility」＞「Modulate」プロパティで色を # 7ec8ff（水色）にする。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img11.png" alt="TitleLabelプロパティ"  />
</li>
</ol>
<br>
<h3 id="startvbox">StartVBox<a hidden class="anchor" aria-hidden="true" href="#startvbox">#</a></h3>
<p>このノードのプロパティは編集不要だ。</p>
<br>
<h3 id="startbutton">StartButton<a hidden class="anchor" aria-hidden="true" href="#startbutton">#</a></h3>
<p>ボタンのアイコンをゲームプレイを開始するイメージに近いテクスチャ画像に差し替える。</p>
<ol>
<li>「Textures」＞「Normal」プロパティにファイルシステムドックから「res://Assets/Menu/Buttons/Play.png」をドラッグ&amp;ドロップして画像を差し替える。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img13.png" alt="StartButtonプロパティ"  />
</li>
</ol>
<br>
<h3 id="startlabel">StartLabel<a hidden class="anchor" aria-hidden="true" href="#startlabel">#</a></h3>
<p>ボタンアイコンの説明書きがゲームオーバー画面仕様の「RESTART」になっているので「START」に更新する。</p>
<ol>
<li>「Text」プロパティに「press space or enter key」と入力する。</li>
</ol>
<br>
<h3 id="animationplayer">AnimationPlayer<a hidden class="anchor" aria-hidden="true" href="#animationplayer">#</a></h3>
<p>このノードは「Start」ボタンを押した時に、少し凹んだようなアニメーションを作るために用いる。インスペクターのプロパティはそのままで良い。</p>
<p>新規アニメーションを以下の内容で作成しよう。</p>
<ul>
<li>アニメーション名: press_start</li>
<li>アニメーションの長さ(秒): 0.1</li>
<li>アニメーションループ: 無効</li>
<li>トラック：
<ul>
<li>「StartButton」ノード ＞「modulate」プロパティ
<ul>
<li>Time: 0秒 / Value: # ffffff / Easing: 1.00</li>
<li>Time: 0.05秒 / Value: # c8c8c8 / Easing: 1.00</li>
<li>Time: 0.1秒 / Value: # ffffff / Easing: 1.00</li>
</ul>
</li>
<li>「StartButton」ノード ＞「rect_scale」プロパティ
<ul>
<li>Time: 0秒 / Value: (1, 1) / Easing: 1.00</li>
<li>Time: 0.05秒 / Value: (0.9, 0.9) / Easing: 1.00</li>
<li>Time: 0秒 / Value: (1, 1) / Easing: 1.00</li>
</ul>
</li>
</ul>
</li>
</ul>
<br>
<p>以上で、スタート画面のプロパティ編集作業は完了だ。一からシーンを作るよりは省エネで作業を終えられたのではないだろうか。ちなみに、シーンの見た目は以下のようになったはずだ。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img18.png" alt="GameStartシーンを実行"  />
</p>
<br>
<h2 id="スクリプトをアタッチして編集する">スクリプトをアタッチして編集する<a hidden class="anchor" aria-hidden="true" href="#スクリプトをアタッチして編集する">#</a></h2>
<p>続いて、スタート画面上のボタンをプレイヤーがクリックした時の動作をスクリプトで制御していく。</p>
<p>「GameStart」ルートノードに新しいスクリプトをアタッチする。この時、スクリプトのファイルパスを「res://UI/GameStart/GameStart.gd」として作成する。</p>
<p>スクリプトエディタで「GameStart.gd」スクリプトが開いたら、以下のように編集する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Control</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># StartButton ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> start_button <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">VBoxContainer</span><span style="color:#f92672">/</span>StartVBox<span style="color:#f92672">/</span>StartButton
</span></span><span style="display:flex;"><span><span style="color:#75715e"># AnimationPlayer ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> anim_player <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimationPlayer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># ゲーム開始時にアニメーションで変更されるプロパティを初期化</span>
</span></span><span style="display:flex;"><span>	start_button<span style="color:#f92672">.</span>modulate <span style="color:#f92672">=</span> <span style="color:#a6e22e">Color</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	start_button<span style="color:#f92672">.</span>rect_scale <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)
</span></span></code></pre></div><br>
<p>次にシグナルを接続しよう。「StartButton」ノードの「button_up()」シグナルを「GameStart.gd」スクリプトに接続する。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img19.png" alt="button_up()シグナル"  />
</p>
<p>スクリプトに<code>_on_StartButton_button_up</code>メソッドが生成されたら、以下のように編集する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Start ボタンをクリックした時のシグナルで呼ばれるメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_StartButton_button_up():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># デバッグ用</span>
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#34;_on_StartButton_button_up called.&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># AnimationPlayer の press_start アニメーションを再生</span>
</span></span><span style="display:flex;"><span>	anim_player<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;press_start&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># アニメーションが終わるまで待機</span>
</span></span><span style="display:flex;"><span>	yield(anim_player, <span style="color:#e6db74">&#34;animation_finished&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># このノードを解放（削除）する</span>
</span></span><span style="display:flex;"><span>	queue_free()
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># デバッグ用</span>
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#34;GameStart scene is now freed.&#34;</span>)
</span></span></code></pre></div><p>Start ボタンを押したら、次のプレイヤーキャラクター選択画面に遷移させる予定なので、この時点で「GameStart」シーンは用済みなので<code>queue_free</code>メソッドで解放している。</p>
<br>
<p>最後にキー入力での制御を実装しておく。インプットマップにデフォルトで登録されているアクション「ui_accept」に該当するスペースキー、またはエンターキーを押した時に、さっきシグナル接続で生成された<code>_on_StartButton_button_up</code>を実行するようにした。これでマウスでもキーボードでも同じ結果が得られるようになった。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _input(event):
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># スペースキーかエンターキーが押された場合</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> event<span style="color:#f92672">.</span>is_action_pressed(<span style="color:#e6db74">&#34;ui_accept&#34;</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># スタートボタンが押された時のメソッドを呼ぶ</span>
</span></span><span style="display:flex;"><span>		_on_StartButton_button_up()
</span></span></code></pre></div><br>
<p>「GameStart」シーンの作成はこれで完成なので、最後にシーンを実行して挙動を確認しておこう。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img20.gif" alt="GameStartシーンを実行"  />
</p>
<p>スタートボタンを押すと、ルートノードが解放されて何もノードが存在しない状態になるので、グレーの画面が表示されるのは正常な動作だ。なお、GIF画像ではアニメーションが若干不自然だが、実際にはもう少し短い時間で自然にアニメーションするはずだ。</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="プレイヤーキャラクターの種類を増やす">プレイヤーキャラクターの種類を増やす<a hidden class="anchor" aria-hidden="true" href="#プレイヤーキャラクターの種類を増やす">#</a></h1>
<p>ファイルシステムドックをご覧いただくと「res://Assets/Main Characters/」フォルダの中に4種類のプレイヤーキャラクターのアセットが見つかるだろう。ここまでのチュートリアルでは、4種類のうち「Pink Man」のスプライトシートのみを使ってきたが、ここで4種類全てのアセットを使用する時がきた。</p>
<p>とはいえ、4種類のプレイヤーキャラクターのシーンを作る必要はなく、「Player」シーン＞「AnimatedSprite」ノード＞「Frames」プロパティに適用する「SpriteFrames」クラスのリソースファイルを4種類作成するだけで良い。つまり、キャラクター選択時に、「AnimatedSprite」ノードのテクスチャだけ差し替える、という作戦だ。</p>
<p>（おさらいも兼ねて）事前確認として「Pink Man」以外のスプライトシートのアセットファイルにもしブラーがかかっていたら（ぼやけた感じがしたら）、ファイルシステムドックでファイルを選択して、インポートドックから「プリセット」＞「2D Pixel」を選択して「再インポート」をクリックしておこう。これでドット絵特有のエッジが効いた表示に更新される。</p>
<p>では順番にやっていこう。</p>
<br>
<h2 id="spriteframes-リソースを作成する">SpriteFrames リソースを作成する<a hidden class="anchor" aria-hidden="true" href="#spriteframes-リソースを作成する">#</a></h2>
<h3 id="pinkman">PinkMan<a hidden class="anchor" aria-hidden="true" href="#pinkman">#</a></h3>
<p>ほぼ作業不要の「PinkMan」から「SpriteFrames」クラスのリソースファイルを作成する。</p>
<ol>
<li>「Player.tscn」を開く。</li>
<li>「AnimatedSprite」ノードの「Frames」プロパティの値になっている「SpriteFrames」を右クリック＞「保存」を選択する。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img21.png" alt="リソースを保存"  />
</li>
<li>ファイルパスが「res://Player/PinkMan.tres」になるようにファイル名を「PinkMan.tres」として保存する。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img22.png" alt="リソースを保存"  />
</li>
</ol>
<p>PinkMan の場合はすでにアニメーションフレームが作成済みなので、リソースファイル作成はこれで完了だ。</p>
<br>
<h3 id="maskdude">MaskDude<a hidden class="anchor" aria-hidden="true" href="#maskdude">#</a></h3>
<p>次は「MaskDude」のリソースファイルを作成する。</p>
<ol>
<li>ファイルシステムドックで、先に作成したPinkManのリソース「res://Player/PinkMan.tres」を右クリック＞「複製」を選択する。</li>
<li>ファイル名を「MaskDude.tres」とする。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img23.png" alt="tresファイルを複製"  />
</li>
<li>ファイルシステムドックで作成した「MaskDude.tres」をダブルクリックしてスプライトフレームパネルを開く。</li>
<li>登録しているアニメーションを上から一つ選択する。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img25.png" alt="アニメーション選択"  />
</li>
<li>既存のアニメーションフレームを全て削除する。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img26.gif" alt="アニメーションフレームの削除"  />
</li>
<li>スプライトシートアイコンをクリックする。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img27.png" alt="スプライトシートアイコン"  />
</li>
<li>適切なスプライトシートのファイルを選択し、アニメーションフレームに反映すればOK。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img28.png" alt="スプライトシートの選択と割り当て"  />
</li>
<li>次のアニメーションを選択して同様の作業を行う。全てのアニメーションのアニメーションフレームが更新できたら、リソースファイルの作成は完了とする。</li>
</ol>
<br>
<h3 id="ninjafrog">NinjaFrog<a hidden class="anchor" aria-hidden="true" href="#ninjafrog">#</a></h3>
<p>作業は「MaskDude」シーンと同様だ。リソースのファイル名はもちろん「NinjaFrog.tres」にして保存する。</p>
<br>
<h3 id="virtualguy">VirtualGuy<a hidden class="anchor" aria-hidden="true" href="#virtualguy">#</a></h3>
<p>こちらも作業は「MaskDude」シーンと同様だ。リソースのファイル名はもちろん「VirtualGuy.tres」にして保存する。</p>
<p>「VirtualGuy.tres」の編集が終われば、プレイヤーキャラクター4種類のリソースファイルの完成だ。ここらで一度休憩を入れよう。</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="プレイヤーキャラクター選択画面を作る">プレイヤーキャラクター選択画面を作る<a hidden class="anchor" aria-hidden="true" href="#プレイヤーキャラクター選択画面を作る">#</a></h1>
<p>さて、ここからはプレイヤーキャラクターを選択する画面のシーンを作っていく。画面の仕様は以下のようにする。</p>
<ul>
<li>画面上部にプレイヤーキャラクターの名前を表示する。</li>
<li>画面中央にプレイヤーキャラクターのビジュアル（テクスチャ）をアニメーション付きで表示する。</li>
<li>キーボードの左右矢印キーか画面に表示されている矢印ボタンをクリックでキャラクターを切り替える。</li>
<li>キーボードのスペースキーまたはエンターキーでキャラクターを選択したらゲームプレイ開始。</li>
</ul>
<p>では例によって、シーンを作成するところから始めよう。</p>
<br>
<h2 id="シーンを作る-1">シーンを作る<a hidden class="anchor" aria-hidden="true" href="#シーンを作る-1">#</a></h2>
<p>以下の手順でプレイヤーキャラクター選択用のシーンを作っていく。</p>
<ol>
<li>「シーン」メニュー＞「新規シーン」を選択する。</li>
<li>「ルートノードの生成」で「ユーザーインターフェース」を選択して、「Control」クラスを選択する。</li>
<li>「Control」ルートノードが生成されたら、名前を「CharacterSelect」に変更する。</li>
<li>「res://UI」フォルダーに「CharacterSelect」フォルダーを新規作成し、ファイルパスを「res://UI/CharacterSelect/CharacterSelect.tscn」としてシーンを保存する。</li>
</ol>
<br>
<h2 id="必要なノードを追加する">必要なノードを追加する<a hidden class="anchor" aria-hidden="true" href="#必要なノードを追加する">#</a></h2>
<p>続いて、作成した「CharacterSelect」シーンに必要なノードを追加していこう。</p>
<ol>
<li>「CharacterSelect」ルートノードに「TextureRect」ノードを追加する。</li>
<li>「CharacterSelect」ルートノードに「VBoxContainer」ノードを追加する。</li>
<li>「VBoxContainer」ノードに「Label」ノードを追加し、名前を「CharacterName」に変更する。</li>
<li>「VBoxContainer」ノードに「HBoxContainer」ノードを追加する。</li>
<li>「HBoxContainer」ノードに、「TextureButton」ノードを 2 つ追加し、それぞれの名前を「LeftButton」、「RightButton」に変更する。</li>
<li>「VBoxContainer」ノードに「Label」ノードを追加し、名前を「Caption」に変更する。</li>
<li>「CharacterSelect」ノードに「AnimatedSprite」ノードを追加する。</li>
<li>「CharacterSelect」ノードに「AnimationPlayer」ノードを追加する。</li>
</ol>
<p>ここまででシーンツリーは以下のようになったはずだ。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img29.png" alt="スプライトシートの選択と割り当て"  />
</p>
<br>
<h2 id="各ノードのプロパティを編集する-1">各ノードのプロパティを編集する<a hidden class="anchor" aria-hidden="true" href="#各ノードのプロパティを編集する-1">#</a></h2>
<p>次に、インスペクターで各ノードのプロパティを編集して、プレイヤーキャラクター選択画面をデザインしていこう。</p>
<br>
<h3 id="characterselect">CharacterSelect<a hidden class="anchor" aria-hidden="true" href="#characterselect">#</a></h3>
<p>このルートノードは子ノードの入れ物として利用する。</p>
<ol>
<li>2Dワークスペースのツールバー＞「レイアウト」から「Rect全面」を選択して、ノードのサイズを前画面サイズに揃える。</li>
</ol>
<br>
<h3 id="texturerect-1">TextureRect<a hidden class="anchor" aria-hidden="true" href="#texturerect-1">#</a></h3>
<p>このノードは背景用に利用する。</p>
<ol>
<li>2Dワークスペースのツールバー＞「レイアウト」から「Rect全面」を選択して、画面全体に広げる。</li>
<li>「Texture」プロパティに、ファイルシステムから「res://Assets/Background/Yellow.png」をドラッグ&amp;ドロップして適用する。</li>
<li>「Stretch Mode」プロパティを「Tile」にする。</li>
</ol>
<p><img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img30.png" alt="TextureRectプロパティ編集後"  />
</p>
<br>
<h3 id="vboxcontainer-1">VBoxContainer<a hidden class="anchor" aria-hidden="true" href="#vboxcontainer-1">#</a></h3>
<p>このノードはプレイヤーキャラクター選択画面に表示されるキャラクター名やキャラクターのスプライト、選択ボタン、操作説明を縦に整列させるためのコンテナとして利用するだけなので、プロパティの編集は少ない。</p>
<ol>
<li>2Dワークスペースのツールバー＞「レイアウト」から「Rect全面」を選択して、ノードのサイズを前画面サイズに揃える。</li>
<li>インスペクターで「Alignment」を「Center」にする。</li>
<li>「Theme Overrides」＞「Constants」＞「Separation」ノードを 48 にする。</li>
</ol>
<br>
<h3 id="charactername">CharacterName<a hidden class="anchor" aria-hidden="true" href="#charactername">#</a></h3>
<p>このノードは、現在選択しているキャラクターの名前を表示するのに利用する。表示位置は画面の上部中央になる予定だが、他のノードの設定がまだなので現時点では中央にされる。後から徐々に意図した形になるはずなので、位置はそのままにしておくこと。</p>
<ol>
<li>インスペクターで「Text」プロパティは仮に「Mask Dude」と入力する。</li>
<li>「Align」プロパティを「Center」にする。</li>
<li>「Theme Overrides」＞「Fonts」＞「Font」で「新規 DynamicFont」を選択する。</li>
<li>「Font」＞「Settings」＞「Size」プロパティを 32 にする。</li>
<li>「Font」＞「Settings」＞「Outline Size」プロパティを 5 にする。</li>
<li>「Font」＞「Settings」＞「Outline Color」プロパティで色を # 302e3e （濃いグレー）にする。</li>
<li>「Font」＞「Font」＞「Font Data」に「res://fonts/connection_ii/ConnectionII.otf」を適用する。</li>
</ol>
<p><img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img31.png" alt="CharacterNameプロパティ編集後"  />
</p>
<br>
<h3 id="hboxcontainer">HBoxContainer<a hidden class="anchor" aria-hidden="true" href="#hboxcontainer">#</a></h3>
<p>このノードは水平方向に子ノードを横並びに配置するコンテナだ。左右の矢印ボタンアイコンを子ノードに持つので、それを横並びに配置する。またその左右の矢印ボタンの間に、プレイヤーキャラクターのスプライトを表示させたいので、ボタンとボタンの間をたっぷり目に空けておく必要がある。</p>
<ol>
<li>インスペクターで「Alignment」プロパティを「Center」にする。</li>
<li>「Theme Overrides」＞「Constants」＞「Separation」ノードを 156 にする。</li>
</ol>
<br>
<h3 id="leftbutton">LeftButton<a hidden class="anchor" aria-hidden="true" href="#leftbutton">#</a></h3>
<p>このノードは「TextureRect」クラスなので、ボタンにテクスチャ画像を割り当てることができる。名前の通り、左向き矢印ボタンを作るのに利用する。</p>
<ol>
<li>インスペクターで「Expand」プロパティをオンにする。</li>
<li>「Stretch Mode」プロパティを「Keep Aspect Centered」にする。</li>
<li>「Textures」＞「Normal」プロパティに、ファイルシステムドックから「res://Assets/Menu/Buttons/Previous.png」をドラッグ&amp;ドロップして適用する。</li>
<li>「Control」クラスの「Rect」＞「Min Size」プロパティを (42, 40) にする。</li>
</ol>
<p><img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img32.png" alt="LeftButtonプロパティ編集後"  />
</p>
<br>
<h3 id="rightbutton">RightButton<a hidden class="anchor" aria-hidden="true" href="#rightbutton">#</a></h3>
<p>このノードも「LeftButton」同様に「TextureRect」クラスで、右向き矢印ボタンを作るのに利用する。</p>
<ol>
<li>インスペクターで「Expand」プロパティをオンにする。</li>
<li>「Stretch Mode」プロパティを「Keep Aspect Centered」にする。</li>
<li>「Textures」＞「Normal」プロパティに、ファイルシステムドックから「res://Assets/Menu/Buttons/Next.png」をドラッグ&amp;ドロップして適用する。</li>
<li>「Control」クラスの「Rect」＞「Min Size」プロパティを (42, 40) にする。</li>
</ol>
<p><img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img33.png" alt="RightButtonプロパティ編集後"  />
</p>
<br>
<h3 id="caption">Caption<a hidden class="anchor" aria-hidden="true" href="#caption">#</a></h3>
<p>このノードは、単なる「Label」クラスのノードである。プレイヤーキャラクター選択画面での操作説明を画面下部に表示させるために利用する。</p>
<ol>
<li>インスペクターで「Text」プロパティに以下の開業を含む文字列を入力する。<br>
press left or right key to select a character<br>
press enter or space key to confirm</li>
<li>「Align」プロパティを「Center」にする。</li>
<li>「Uppercase」プロパティをオンにする。</li>
<li>「Theme Overrides」＞「Fonts」＞「Font」プロパティに、ファイルシステムドックから「res://fonts/poco/Poco.tres」をドラッグ&amp;ドロップして適用する。<br>
*<em>このリソースファイルは他のシーンでも利用しているのでリソースのプロパティはそのままにしておくこと。もし編集したい場合は必ずリソースを「ユニーク化」して他のノードのデザインに影響しないようにすること。</em></li>
<li>「CanvasItem」クラスの「Visibility」＞「Modulate」プロパティで色を # 000000（黒）にする。</li>
</ol>
<p><img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img34.png" alt="Captionプロパティ編集後"  />
</p>
<br>
<h3 id="animatedsprite">AnimatedSprite<a hidden class="anchor" aria-hidden="true" href="#animatedsprite">#</a></h3>
<p>このノードは、先に作成した 4 種類のプレイヤーキャラクターの「SpriteFrames」クラスのリソースファイルを「Frames」プロパティに適用させて、画面上に実際にキャラクターのスプライトを表示するために利用する。</p>
<ol>
<li>インスペクターで「Frames」プロパティに、ファイルシステムドックから先に作った「res://Player/MaskDude.tres」をドラッグ&amp;ドロップして適用させる。最初は「MaskDude」のスプライトで表示させるためだ。</li>
<li>「Animation」プロパティは「idle」を選択する。これが一番、2Dワークスペース上で位置を把握しやすいはずだ。</li>
<li>「Position」プロパティは (192, 124) にする。これがちょうど左右のボタンの中間にあたる位置だ。</li>
</ol>
<p><img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img35.png" alt="AnimatedSpriteプロパティ編集後"  />
</p>
<br>
<h3 id="animationplayer-1">AnimationPlayer<a hidden class="anchor" aria-hidden="true" href="#animationplayer-1">#</a></h3>
<p>このノードは「LeftButton」と「RightButton」をクリックした時に再生させる、ボタンが凹んだような簡単なアニメーションを作るのに利用する。</p>
<ol>
<li>インスペクターでのプロパティ編集は不要だ。</li>
<li>アニメーションパネルを開く。</li>
<li>まず左矢印ボタンのアニメーションを作成する。</li>
</ol>
<ul>
<li>アニメーション名: press_left</li>
<li>アニメーションの長さ(秒): 0.1</li>
<li>アニメーションループ: 無効</li>
<li>トラック:
<ul>
<li>「LeftButton」ノード ＞「modulate」プロパティ
<ul>
<li>Time: 0秒 / Value: # ffffff / Easing: 1.00</li>
<li>Time: 0.05秒 / Value: # c8c8c8 / Easing: 1.00</li>
<li>Time: 0.1秒 / Value: # ffffff / Easing: 1.00</li>
</ul>
</li>
<li>「LeftButton」ノード ＞「rect_scale」プロパティ
<ul>
<li>Time: 0秒 / Value: (1, 1) / Easing: 1.00</li>
<li>Time: 0.05秒 / Value: (0.9, 0.9) / Easing: 1.00</li>
<li>Time: 0.1秒 / Value: (1, 1) / Easing: 1.00</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol>
<li>次に右矢印ボタンのアニメーションを作成する。トラックのノードが違うこと以外は先に作成した「press_left」アニメーションとほとんど同じだ。</li>
</ol>
<ul>
<li>アニメーション名: press_right</li>
<li>アニメーションの長さ(秒): 0.1</li>
<li>アニメーションループ: 無効</li>
<li>トラック:
<ul>
<li>「RightButton」ノード ＞「modulate」プロパティ
<ul>
<li>Time: 0秒 / Value: # ffffff / Easing: 1.00</li>
<li>Time: 0.05秒 / Value: # c8c8c8 / Easing: 1.00</li>
<li>Time: 0.1秒 / Value: # ffffff / Easing: 1.00</li>
</ul>
</li>
<li>「RightButton」ノード ＞「rect_scale」プロパティ
<ul>
<li>Time: 0秒 / Value: (1, 1) / Easing: 1.00</li>
<li>Time: 0.05秒 / Value: (0.9, 0.9) / Easing: 1.00</li>
<li>Time: 0.1秒 / Value: (1, 1) / Easing: 1.00</li>
</ul>
</li>
</ul>
</li>
</ul>
<br>
<hr>
<h1 id="シングルトンを作る">シングルトンを作る<a hidden class="anchor" aria-hidden="true" href="#シングルトンを作る">#</a></h1>
<p>シングルトンというのはプログラミング用語で、インスタンスが1つしかないように設計されたクラスのことで、他の複数のクラスで何らかの共通したプロパティやメソッドを利用する必要がある場合に用いられる。詳しい定義や仕組み、使い方などは、以下のリンク先のリソースをご参照いただきたい。</p>
<blockquote>
<p><em><strong><span style="color:salmon">Memo:</span>
</strong><br>
<a href="https://ja.wikipedia.org/wiki/Singleton_%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3" target="_blank">Wikipedia - Singleton パターン</a>
<br>
<a href="https://docs.godotengine.org/ja/stable/tutorials/scripting/singletons_autoload.html" target="_blank">Godot 公式オンラインドキュメント - シングルトン(自動読み込み)</a>
</em></p>
</blockquote>
<p>このチュートリアルでシングルトンを使用する理由は、4種類のプレイヤーキャラクターの「SpriteFrames」のリソースをシングルトンのプロパティとして用意しておけば、「CharacterSelect」シーンの「AnimatedSprite」ノードにも、「Level」シーン＞「Player」＞「AnimatedSprite」ノードにもいつでも利用できるようになるからだ。</p>
<p>仮に、「CharacterSelect」ノードのプロパティとして「SpriteFrames」のリソースを用意することの弊害が一つある。それは「CharacterSelect」インスタンスノードは用済みになったら「Game」シーンから解放（削除）させる、ということだ。解放してしまうと、リソースの参照先を見失って、プレイヤーキャラクターのスプライトにテクスチャを割り当てることができなくなる。その結果、プレイヤーキャラクターは透明人間状態になってしまう。</p>
<p>一方、シングルトンのスクリプトで「SpriteFrames」リソースを定義しておけば、他の複数のノードからいつでもそれを参照することができる。</p>
<br>
<h2 id="シングルトンのスクリプトを作る">シングルトンのスクリプトを作る<a hidden class="anchor" aria-hidden="true" href="#シングルトンのスクリプトを作る">#</a></h2>
<p>説明が長くなったが、ここからは以下の手順でシングルトンを実際に作成していこう。</p>
<ol>
<li>ファイルシステムドックで「res://」フォルダを右クリック＞「新規スクリプト」を選択する。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img36.png" alt="新規スクリプト作成"  />
</li>
<li>「スクリプト作成」ダイアログが表示されたら、<strong>継承元を必ず「Node」にして</strong>、ファイル名を「Global.gd」として作成する。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img37.png" alt="スクリプト作成ダイアログ"  />
</li>
<li>「プロジェクト」メニュー＞「プロジェクト設定」を選択する。</li>
<li>「自動読み込み（AutoLoad）」タブを開きパス入力欄の右側にあるフォルダアイコンをクリックする（Global.gdのパスを直接打ち込んでも良い）。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img38.png" alt="自動読み込みタブ"  />
</li>
<li>「Global.gd」スクリプトを選択して開く。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img39.png" alt="global.gd選択"  />
</li>
<li>パス入力欄に「Global.gd」のファイルパスが入ったら右側の「追加」をクリックする。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img40.png" alt="追加ボタン"  />
</li>
<li>自動読み込みに追加されたことを確認したら、ウインドウを閉じる。ちなみに「グローバル変数」とは他のどのスクリプトのどのスコープからでもアクセスできる変数のことだが、これを利用したいので有効のままで良い。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img41.png" alt="追加後の画面"  />
</li>
</ol>
<p>以上の作業で、シングルトン「Global.gd」スクリプトがゲーム開始時に一番最初に読み込まれ、常にどのシーンのどのノードのスクリプトからでもシングルトンのプロパティやメソッドにアクセスできるようになった。ゲーム開始時に自動読み込みされる時、自動的に「Node」が作成され、これに「Global.gd」スクリプトがアタッチされる仕組みだ。つまり、このスクリプトに記述するプロパティにアクセスしたければ、この「Node」のプロパティを参照するようコーディングすれば良い。なお、「Node」は自動的にスクリプトと同じ「Global」という名前になるので、簡単にアクセスできる。</p>
<br>
<h2 id="シングルトンのスクリプトを編集する">シングルトンのスクリプトを編集する<a hidden class="anchor" aria-hidden="true" href="#シングルトンのスクリプトを編集する">#</a></h2>
<p>ではシングルトンの「Global.gd」スクリプトを開き、以下のコードを記述しよう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Node</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> spriteframes <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Player/MaskDude.tres&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Player/NinjaFrog.tres&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Player/PinkMan.tres&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Player/VirtualGuy.tres&#34;</span>)
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>プリロードされた4種類のプレイヤーキャラクターの「SpriteFrames」リソースを配列にまとめた。これで、プレイヤーキャラクターの4種類のリソースにどこからでも簡単にアクセスできる。</p>
<br>
<hr>
<h1 id="characterselect-にスクリプトをアタッチして編集する">CharacterSelect にスクリプトをアタッチして編集する<a hidden class="anchor" aria-hidden="true" href="#characterselect-にスクリプトをアタッチして編集する">#</a></h1>
<p>「CharacterSelect」ノードに新規スクリプトをアタッチしよう。ファイルパスは「res://UI/CharacterSelect/CharacterSelect.gd」となるようにする。</p>
<p>では作成したシングルトンを利用しつつ、コーディングしていこう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Control</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># カスタムシグナル、引数に SpriteFrames リソースの参照を渡す</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">signal</span> character_selected(sprite_frames)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 現在キャラクター選択中のフラグを立てる（true）</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> is_choosing <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span><span style="color:#75715e"># AnimatedSprite のアニメーションの現在のフレーム番号を保持</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> frames_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># キャラクターの名前の配列（要素の順番はシングルトンの SpriteFrames の配列に合わせる）</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> characters <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;Mask Dude&#34;</span>, <span style="color:#e6db74">&#34;Ninja Frog&#34;</span>, <span style="color:#e6db74">&#34;Pink Man&#34;</span>, <span style="color:#e6db74">&#34;Virtual Guy&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># シングルトンのノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> global <span style="color:#f92672">=</span> get_node(<span style="color:#e6db74">&#34;/root/Global&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># CharacterName ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> char_name <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">VBoxContainer</span><span style="color:#f92672">/</span>CharacterName
</span></span><span style="display:flex;"><span><span style="color:#75715e"># LeftButton ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> l_button <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">VBoxContainer</span><span style="color:#f92672">/</span><span style="color:#a6e22e">HBoxContainer</span><span style="color:#f92672">/</span>LeftButton
</span></span><span style="display:flex;"><span><span style="color:#75715e"># RightButton ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> r_button <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">VBoxContainer</span><span style="color:#f92672">/</span><span style="color:#a6e22e">HBoxContainer</span><span style="color:#f92672">/</span>RightButton
</span></span><span style="display:flex;"><span><span style="color:#75715e"># AnimatedSprite ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> sprite <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimatedSprite</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># AnimationPlayer ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> anim_player <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimationPlayer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 以下4行: AnimationPlayer のアニメーションで変更されるプロパティに初期値を設定</span>
</span></span><span style="display:flex;"><span>	l_button<span style="color:#f92672">.</span>modulate <span style="color:#f92672">=</span> <span style="color:#a6e22e">Color</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	l_button<span style="color:#f92672">.</span>rect_scale <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	r_button<span style="color:#f92672">.</span>modulate <span style="color:#f92672">=</span> <span style="color:#a6e22e">Color</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	r_button<span style="color:#f92672">.</span>rect_scale <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 以下のメソッドを呼ぶ（この後定義する）</span>
</span></span><span style="display:flex;"><span>	play_animations()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># _ready で呼ばれる: AnimatedSprite のアニメーションを制御する</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> play_animations():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># アニメーションの名前の配列（Array型を指定しないと PoolStringArray 型になる）</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> animations: <span style="color:#a6e22e">Array</span> <span style="color:#f92672">=</span> sprite<span style="color:#f92672">.</span>frames<span style="color:#f92672">.</span>get_animation_names()
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 現在再生中のアニメーションの上記配列内の順番</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> anim_index <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># アニメーションのループ回数をカウントするための変数</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># デバッグ用</span>
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#34;animations array is &#34;</span>, animations)
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># アニメーションの名前の配列から不要な要素を削除するため配列の要素でループ</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> anim <span style="color:#f92672">in</span> animations:
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># アニメーションが fall か jump の場合は配列から削除（フレームが1つしかなく面白くないため）</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> anim <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;fall&#34;</span> <span style="color:#f92672">or</span> anim <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;jump&#34;</span>:
</span></span><span style="display:flex;"><span>			animations<span style="color:#f92672">.</span>remove(animations<span style="color:#f92672">.</span>find(anim))
</span></span><span style="display:flex;"><span>			print(<span style="color:#e6db74">&#34;removed &#34;</span>, anim, <span style="color:#e6db74">&#34; from animations array.&#34;</span>)
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 現在キャラクター選択中のフラグが立っている間はループする</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> is_choosing:
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># アニメーションの名前の配列から現在の再生中のアニメーションを指定して再生</span>
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>play(animations[anim_index])
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># 最後のアニメーションフレーム終了まで待機</span>
</span></span><span style="display:flex;"><span>		yield(sprite, <span style="color:#e6db74">&#34;animation_finished&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># アニメーションを一度停止する</span>
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>stop()
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># アニメーションが 4 周するまで while ループ</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> count <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span>:
</span></span><span style="display:flex;"><span>			count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># アニメーションが 4 周したらカウントを 0 にする</span>
</span></span><span style="display:flex;"><span>		count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># 現在再生中のアニメーションの番号が、アニメーションの配列の要素数 - 1 より小さい場合は </span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> anim_index <span style="color:#f92672">&lt;</span> animations<span style="color:#f92672">.</span>size() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># アニメーションの番号に 1　を加えて、次のアニメーションを再生するように仕込む</span>
</span></span><span style="display:flex;"><span>			anim_index <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># 現在再生中のアニメーションの番号が、アニメーションの配列の要素数 - 1 になったら</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># 全てのアニメーションを再生したので、アニメーションの番号を 0 に戻して、最初のアニメーションに戻る</span>
</span></span><span style="display:flex;"><span>			anim_index <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><p>少しコードが長い印象を持たれたかもしれないが、やっていることは単に「AnimatedSprite」ノードに設定済みのアニメーションを自動的に順次再生させているだけである。アニメーションを4周再生したら、次のアニメーションを再生し、全てのアニメーションを4回ずつ再生したらまた最初のアニメーションの再生から始めるように<code>while</code>ループを利用して制御している。</p>
<br>
<p>次はキャラクターを切り替える左右のボタンを押した時の制御を実装する。これにはシグナルを利用する。「LeftButton」ノードおよび「RightButton」ノードの「pressed()」シグナルを今編集している「CharacterSelect.gd」スクリプトに接続しよう。</p>
<p>接続して自動生成されたメソッドを以下のように編集する。ちなみに左ボタンが逆送り、右ボタンが順送りでキャラクターを切り替えるように実装している。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_LeftButton_pressed():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># AnimationPlayer の press_left アニメーションを再生</span>
</span></span><span style="display:flex;"><span>	anim_player<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;press_left&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># シングルトンの SpriteFrames のリソースの配列から、</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 一つ前のキャラクターのものを AnimatedSprite ノードの frames プロパティに適用する</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># CharacterName の text プロパティにその SpriteFrames に合致したキャラクターの名前を入れる</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 今、配列の最初のリソースを適用している時は配列の最後のリソースを適用する</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> frames_num <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>		frames_num <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>frames <span style="color:#f92672">=</span> global<span style="color:#f92672">.</span>spriteframes[frames_num]
</span></span><span style="display:flex;"><span>		char_name<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> characters[frames_num]
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>frames <span style="color:#f92672">=</span> global<span style="color:#f92672">.</span>spriteframes[global<span style="color:#f92672">.</span>spriteframes<span style="color:#f92672">.</span>size() <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>		char_name<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> characters[characters<span style="color:#f92672">.</span>size() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>		frames_num <span style="color:#f92672">=</span> global<span style="color:#f92672">.</span>spriteframes<span style="color:#f92672">.</span>size() <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_RightButton_pressed():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># AnimationPlayer の press_right アニメーションを再生</span>
</span></span><span style="display:flex;"><span>	anim_player<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;press_right&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># シングルトンの SpriteFrames のリソースの配列から、</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 次のキャラクターのものを AnimatedSprite ノードの frames プロパティに適用する</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># CharacterName の text プロパティにその SpriteFrames に合致したキャラクターの名前を入れる</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 今、配列の最後のリソースを適用している時は配列の最初のリソースを適用する</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> frames_num <span style="color:#f92672">&lt;</span> global<span style="color:#f92672">.</span>spriteframes<span style="color:#f92672">.</span>size() <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>		frames_num <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>frames <span style="color:#f92672">=</span> global<span style="color:#f92672">.</span>spriteframes[frames_num]
</span></span><span style="display:flex;"><span>		char_name<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> characters[frames_num]
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>frames <span style="color:#f92672">=</span> global<span style="color:#f92672">.</span>spriteframes[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>		char_name<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> characters[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>		frames_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><p>キャラクターを切り替える操作のたびに「AnimatedSprite」の「Frames」プロパティに適切な「SpriteFrames」リソースを適用しているが、その時、シングルトンの「Global.gd」スクリプト内の配列<code>spriteframes</code> から当てはまる要素（SpriteFrames リソース）をピックアップして適用している。</p>
<br>
<p>最後にキーボードでの入力も受け付けられるようにコードを追加する。<code>_input</code>メソッドは GDScript の組み込み関数で、これを利用してあらゆる入力に対する制御を実装できる。引数の<code>event</code>は「InputEvent」クラスのオブジェクトで、キーボード入力やマウスクリックなどの入力イベントを指す。さまざまなメソッドが用意されているので、非常に便利である。</p>
<blockquote>
<p><em><strong><span style="color:salmon">公式オンラインドキュメント:</span>
</strong><br>
<a href="https://docs.godotengine.org/ja/stable/tutorials/inputs/inputevent.html" target="_blank">Using InputEvent</a>
<br>
<a href="https://docs.godotengine.org/ja/stable/classes/class_node.html#class-node-method-input" target="_blank">void _input ( InputEvent event ) virtual</a>
<br>
<a href="https://docs.godotengine.org/ja/stable/classes/class_inputevent.html?highlight=inputevent" target="_blank">InputEvent</a>
</em></p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _input(event):
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 左矢印キーを押したら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> event<span style="color:#f92672">.</span>is_action_pressed(<span style="color:#e6db74">&#34;ui_left&#34;</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># 左ボタンアイコンをクリックした時に呼ばれるメソッドを呼ぶ</span>
</span></span><span style="display:flex;"><span>		_on_LeftButton_pressed()
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 右矢印キーを押したら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">elif</span> event<span style="color:#f92672">.</span>is_action_pressed(<span style="color:#e6db74">&#34;ui_right&#34;</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># 右ボタンアイコンをクリックした時に呼ばれるメソッドを呼ぶ</span>
</span></span><span style="display:flex;"><span>		_on_RightButton_pressed()
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># スペースキーかエンターキーを押したら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">elif</span> event<span style="color:#f92672">.</span>is_action_released(<span style="color:#e6db74">&#34;ui_accept&#34;</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># キャラクター選択中のフラグを無効にする</span>
</span></span><span style="display:flex;"><span>		is_choosing <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span>		emit_signal(<span style="color:#e6db74">&#34;character_selected&#34;</span>, global<span style="color:#f92672">.</span>spriteframes[frames_num])
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;emitted signal: character_selected&#34;</span>)
</span></span><span style="display:flex;"><span>		queue_free()
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;CharacterSelect scene is now freed.&#34;</span>)
</span></span></code></pre></div><br>
<p>これで「CharacterSelect」シーンの作成は完了だ。</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="game-シーンに-gamestart-シーンと-characterselect-シーンのインスタンスを追加する">Game シーンに GameStart シーンと CharacterSelect シーンのインスタンスを追加する<a hidden class="anchor" aria-hidden="true" href="#game-シーンに-gamestart-シーンと-characterselect-シーンのインスタンスを追加する">#</a></h1>
<p>それではここまでで作成した「GameStart」シーンと「CharacterSelect」シーンをインスタンス化して「Game」シーンに追加しよう。</p>
<p>&hellip;といういつもの流れとは少し異なる手順で進める。</p>
<br>
<h2 id="game-シーンツリーを整理する">Game シーンツリーを整理する<a hidden class="anchor" aria-hidden="true" href="#game-シーンツリーを整理する">#</a></h2>
<p>一旦「Game」シーンツリーを整理しよう。</p>
<p>「Game」シーンに UI 系のブランチが多いと、各ブランチのスクリプトで制御している入力操作が同時に処理されてしまう可能性があり面倒だ。例えばスタート画面でキーボードのスペースキーでキャラクター選択画面に遷移させただけのつもりが、次の画面のキャラクター選択が同時に確定してしまい、キャラクターを選ぶ間もなく一気にゲームプレイ画面に遷移する、というような問題だ。</p>
<p>スクリプトのコードを工夫すれば対処可能だが、この問題を完全に回避する分かりやす方法は、必要なノード以外をシーンツリー上に存在させないことだ。そこで、最初の画面である「GameStart」シーンのインスタンス、および入力操作の影響を受けない「HUD」シーンのインスタンスのみを「Game」シーンツリーに追加しておき、他のシーンのインスタンスはスクリプトで、必要な時に作成&amp;追加することにする。</p>
<p>ということで、まずは「Game」シーンで、今回のチュートリアルで作成した「GameStart.tscn」のインスタンスを追加し、前回のチュートリアルで追加済みの「GameOver.tscn」のインスタンスノードを削除しよう。作業後の「Game」シーンツリーは以下のようになる。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img42.png" alt="Gameシーンツリー"  />
</p>
<br>
<h2 id="gamegd-スクリプトを更新する">Game.gd スクリプトを更新する<a hidden class="anchor" aria-hidden="true" href="#gamegd-スクリプトを更新する">#</a></h2>
<p>ここから「Game.gd」スクリプトで、不要になったノードを削除したり、必要になったノードを追加したり、選択されたキャラクターの「SpriteFrames」リソースを「Level」ブランチ内のプレイヤーキャラクターに適用したり、という処理を実装していく。若干複雑かもしれないが、頑張ってやっていこう。</p>
<p>それでは「Game.gd」スクリプトを開いてほしい。そして、まずはプロパティの定義と<code>_ready</code>メソッドまで見ていこう。「# 追加」や「# 削除」とコメントしている行が更新箇所だ。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Node</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">var</span> current_level <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">var</span> final_level <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> health: <span style="color:#a6e22e">float</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">100.0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> score: <span style="color:#a6e22e">int</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> level: <span style="color:#a6e22e">Node2D</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> player: <span style="color:#a6e22e">KinematicBody2D</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 選択されたキャラクターの SpriteFrames リソースの参照用</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> char_frames: <span style="color:#a6e22e">SpriteFrames</span> <span style="color:#75715e"># 追加</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># UI ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> ui_layer <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>UI <span style="color:#75715e"># 追加</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># GameStart ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> gamestart <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>UI<span style="color:#f92672">/</span>GameStart <span style="color:#75715e"># 追加</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> hud <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>UI<span style="color:#f92672">/</span>HUD
</span></span><span style="display:flex;"><span><span style="color:#75715e">#onready var gameover = $UI/GameOver # Added @ Part 9 # 削除: シーンツリーから削除した</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#gameover.visible = false # Added @ Part 9 # 削除: シーンツリーから削除した</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># GameStart ノードが解放された時に発信されるシグナルを _on_GameStart_tree_exited メソッドに接続</span>
</span></span><span style="display:flex;"><span>	gamestart<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#34;tree_exited&#34;</span>, self ,<span style="color:#e6db74">&#34;_on_GameStart_tree_exited&#34;</span>) <span style="color:#75715e"># 追加</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 以下 4 行：ゲーム開始時に呼ぶ必要がなくなったので別のメソッドへ移動</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#add_level()</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#hud.update_health(health)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#hud.update_score(score)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#hud.update_level(current_level)</span>
</span></span></code></pre></div><br>
<p>続いて、先にコード上で接続したシグナル「tree_exited()」の接続先メソッド<code>_on_GameStart_tree_exited</code>を定義しよう。なお、このシグナルは「GameStart」シーンが解放された時に発信される。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_GameStart_tree_exited():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># CharacterSelect ノードのインスタンスを作成</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> char_select <span style="color:#f92672">=</span> load(<span style="color:#e6db74">&#34;res://UI/CharacterSelect/CharacterSelect.tscn&#34;</span>)<span style="color:#f92672">.</span>instance()
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># CharacterSelect ノードの character_selected カスタムシグナルを _on_CharacterSelect_character_selected メソッドに接続</span>
</span></span><span style="display:flex;"><span>	char_select<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#34;character_selected&#34;</span>, self ,<span style="color:#e6db74">&#34;_on_CharacterSelect_character_selected&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># UI ノードの子として CharacterSelect インスタンスノードを追加</span>
</span></span><span style="display:flex;"><span>	ui_layer<span style="color:#f92672">.</span>add_child(char_select)
</span></span></code></pre></div><br>
<p>さらに、今しがた「CharacterSelect」ノードから「character_selected」シグナルを接続した<code>_on_CharacterSelect_character_selected</code>メソッドを編集していく。ちなみにこのシグナルは、キャラクター選択が確定したら発信される。このシグナルは自作したシグナルで、引数<code>sprite_frames</code>を持っている。これを接続先のメソッドの引数に渡す格好だ。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_CharacterSelect_character_selected(sprite_frames):
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># このスクリプトのプロパティ char_frames に選択したキャラクターの SpriteFrames リソースを渡す</span>
</span></span><span style="display:flex;"><span>	char_frames <span style="color:#f92672">=</span> sprite_frames
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 以下 4 行： _ready メソッドからこちらに移動させた</span>
</span></span><span style="display:flex;"><span>	add_level()
</span></span><span style="display:flex;"><span>	hud<span style="color:#f92672">.</span>update_health(health)
</span></span><span style="display:flex;"><span>	hud<span style="color:#f92672">.</span>update_score(score)
</span></span><span style="display:flex;"><span>	hud<span style="color:#f92672">.</span>update_level(current_level)
</span></span></code></pre></div><p>「CharacterSelect.gd」スクリプトでは、「character_selected」シグナル発信後、まもなく「CharacterSelect」ノードは解放される。ここでシングルトンを作成したおかげで、<code>char_frames</code>プロパティは「CharacterSelect」ノードからバトンパスされたかのように、シングルトンの「SpriteFrames」リソースを参照した状態になる。</p>
<p>キャラクター選択画面の次はゲームプレイの開始となるので、もともと<code>_ready</code>メソッドで実行していた<code>add_level</code>メソッドでの「Level」シーンのインスタンス追加や「HUD」ノードの各コンポーネントの初期設定メソッドをこのタイミングで実行させている。</p>
<br>
<p>ここで<code>add_level</code>メソッドに大事な 1 行を加えることを忘れてはいけない。「Level」ノード＞「Player」ノード＞「AnimatedSprite」ノードの「Frames」プロパティに、キャラクター選択画面で選択したキャラクターの「SpriteFrames」リソースを適用するための 1 行だ。これにより、ゲームプレイ画面のプレイヤーキャラクターが、キャラクター選択画面で選んだキャラクターと同じ見た目になるわけだ。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> add_level():
</span></span><span style="display:flex;"><span>	level <span style="color:#f92672">=</span> load(<span style="color:#e6db74">&#34;res://Levels/Level&#34;</span> <span style="color:#f92672">+</span> str(current_level) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.tscn&#34;</span>)<span style="color:#f92672">.</span>instance()
</span></span><span style="display:flex;"><span>	level<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#34;tree_exited&#34;</span>, self, <span style="color:#e6db74">&#34;change_level&#34;</span>)
</span></span><span style="display:flex;"><span>	level<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#34;player_dropped&#34;</span>, self, <span style="color:#e6db74">&#34;_on_Level_player_dropped&#34;</span>)
</span></span><span style="display:flex;"><span>	call_deferred(<span style="color:#e6db74">&#34;add_child&#34;</span>, level) <span style="color:#75715e"># エラー解消のため修正</span>
</span></span><span style="display:flex;"><span>	player <span style="color:#f92672">=</span> level<span style="color:#f92672">.</span>get_node(<span style="color:#e6db74">&#34;Player&#34;</span>)
</span></span><span style="display:flex;"><span>	player<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#34;enemy_hit&#34;</span>, self, <span style="color:#e6db74">&#34;_on_Player_enemy_hit&#34;</span>) 
</span></span><span style="display:flex;"><span>	player<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#34;item_hit&#34;</span>, self, <span style="color:#e6db74">&#34;_on_Player_item_hit&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># Player ノードの子 AnimatedSprite ノードに選択したキャラクターの SpriteFrames リソースを適用</span>
</span></span><span style="display:flex;"><span>	player<span style="color:#f92672">.</span>get_node(<span style="color:#e6db74">&#34;AnimatedSprite&#34;</span>)<span style="color:#f92672">.</span>frames <span style="color:#f92672">=</span> char_frames <span style="color:#75715e"># 追加</span>
</span></span></code></pre></div><br>
<p>このあと<code>manage_health</code>メソッドまでのコードは今までと変わりない。<code>manage_health</code>メソッドの変更内容を見ていこう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e"># 中略</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> manage_health(damage):
</span></span><span style="display:flex;"><span>	health <span style="color:#f92672">-=</span> damage <span style="color:#75715e"># Moved from _on_Player_enemy_hit()</span>
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#34;Health updated: &#34;</span>, health) <span style="color:#75715e"># Moved from _on_Player_enemy_hit()</span>
</span></span><span style="display:flex;"><span>	hud<span style="color:#f92672">.</span>update_health(health) <span style="color:#75715e"># Moved from _on_Player_enemy_hit()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> health <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>		player<span style="color:#f92672">.</span>anim_player<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;die&#34;</span>)
</span></span><span style="display:flex;"><span>		yield(player<span style="color:#f92672">.</span>anim_player, <span style="color:#e6db74">&#34;animation_finished&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">#gameover.visible = true # 削除: シーンツリーから削除しているため不要</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># GameOver シーンをインスタンス化</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> gameover <span style="color:#f92672">=</span> load(<span style="color:#e6db74">&#34;res://UI/GameOver/GameOver.tscn&#34;</span>)<span style="color:#f92672">.</span>instance() <span style="color:#75715e"># 追加</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># UI ノードに GameOver シーンのインスタンスノードを追加</span>
</span></span><span style="display:flex;"><span>		ui_layer<span style="color:#f92672">.</span>add_child(gameover) <span style="color:#75715e"># 追加</span>
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;Game over screen is shown up.&#34;</span>)
</span></span><span style="display:flex;"><span>		get_tree()<span style="color:#f92672">.</span>paused <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;Scene tree paused: &#34;</span>, get_tree()<span style="color:#f92672">.</span>paused)
</span></span></code></pre></div><p>これまでは「GameOver」シーンのインスタンスは最初から「Game」シーンツリーに追加してあったが、さっき削除したので、<code>visible</code>プロパティの有効化は不要となった。反対に「GameOver」シーンのインスタンスをスクリプト上で追加する必要があるので、そのためのコードを追加した。インスタンスを子ノードにする作業はたった 2 行のコードで実装できるのだ。（子ノードの順番の入れ替えが必要な場合はもう1行必要だ）。</p>
<br>
<p>以上で「Game.gd」スクリプトの編集は完了だ。</p>
<p>最後にプロジェクトを実行して、今回作成した「GameStart」シーンと「CharacterSelect」シーンがプロジェクトの中でうまく動作するか確認しておこう。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_10/img43.gif" alt="プロジェクトを実行"  />
</p>
<br>
<p>以下のポイントで問題なさそうなので、ここで今回の作業を終えよう。</p>
<ul>
<li>最初にスタート画面が表示された。</li>
<li>スペースキーを押すとプレイヤーキャラクター選択画面が表示された。</li>
<li>プレイヤーキャラクター選択画面で、マウスでの左右ボタンの操作、キーボードでの左右矢印キーの操作によって、キャラクターの名前とスプライトの見た目が順番に切り替わった。</li>
<li>プレイヤーキャラクター選択画面でキャラクターはアニメーションし続けた。</li>
<li>プレイヤーキャラクター選択画面でスペースキーを押すとゲームプレイ画面に遷移した。</li>
<li>ゲームプレイ画面にはプレイヤーキャラクター選択画面で最後に選択したキャラクターが登場した。</li>
</ul>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="part-10-で編集したスクリプトのコード">Part 10 で編集したスクリプトのコード<a hidden class="anchor" aria-hidden="true" href="#part-10-で編集したスクリプトのコード">#</a></h1>
<p>最後に今回の Part 10 で編集したスクリプトのコードを共有しておくので、必要に応じて確認してほしい。</p>
<details>
<summary>GameStart.gd の全コード</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Control</span> <span style="color:#75715e"># Added @ Part 10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> start_button <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">VBoxContainer</span><span style="color:#f92672">/</span>StartVBox<span style="color:#f92672">/</span>StartButton
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> anim_player <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimationPlayer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	start_button<span style="color:#f92672">.</span>modulate <span style="color:#f92672">=</span> <span style="color:#a6e22e">Color</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	start_button<span style="color:#f92672">.</span>rect_scale <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_StartButton_button_up():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#print(&#34;_on_StartButton_button_up called.&#34;)</span>
</span></span><span style="display:flex;"><span>	anim_player<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;press_start&#34;</span>)
</span></span><span style="display:flex;"><span>	yield(anim_player, <span style="color:#e6db74">&#34;animation_finished&#34;</span>)
</span></span><span style="display:flex;"><span>	queue_free()
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#34;GameStart scene is now freed.&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _input(event):
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> event<span style="color:#f92672">.</span>is_action_released(<span style="color:#e6db74">&#34;ui_accept&#34;</span>):
</span></span><span style="display:flex;"><span>		_on_StartButton_button_up()
</span></span></code></pre></div></details>
<br>
<details>
<summary>CharacterSelect.gd の全コード</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Control</span>  <span style="color:#75715e"># Added @ Part 10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">signal</span> character_selected(sprite_frames)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> is_choosing <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> frames_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> characters <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;Mask Dude&#34;</span>, <span style="color:#e6db74">&#34;Ninja Frog&#34;</span>, <span style="color:#e6db74">&#34;Pink Man&#34;</span>, <span style="color:#e6db74">&#34;Virtual Guy&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> global <span style="color:#f92672">=</span> get_node(<span style="color:#e6db74">&#34;/root/Global&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> char_name <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">VBoxContainer</span><span style="color:#f92672">/</span>CharacterName
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> l_button <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">VBoxContainer</span><span style="color:#f92672">/</span><span style="color:#a6e22e">HBoxContainer</span><span style="color:#f92672">/</span>LeftButton
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> r_button <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">VBoxContainer</span><span style="color:#f92672">/</span><span style="color:#a6e22e">HBoxContainer</span><span style="color:#f92672">/</span>RightButton
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> sprite <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimatedSprite</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> anim_player <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimationPlayer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	l_button<span style="color:#f92672">.</span>modulate <span style="color:#f92672">=</span> <span style="color:#a6e22e">Color</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	l_button<span style="color:#f92672">.</span>rect_scale <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	r_button<span style="color:#f92672">.</span>modulate <span style="color:#f92672">=</span> <span style="color:#a6e22e">Color</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	r_button<span style="color:#f92672">.</span>rect_scale <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	play_animations()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> play_animations():
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> animations: <span style="color:#a6e22e">Array</span> <span style="color:#f92672">=</span> sprite<span style="color:#f92672">.</span>frames<span style="color:#f92672">.</span>get_animation_names()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> anim_index <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#print(&#34;animations array is &#34;, animations)</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> anim <span style="color:#f92672">in</span> animations:
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> anim <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;fall&#34;</span> <span style="color:#f92672">or</span> anim <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;jump&#34;</span>:
</span></span><span style="display:flex;"><span>			animations<span style="color:#f92672">.</span>remove(animations<span style="color:#f92672">.</span>find(anim))
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">#print(&#34;removed &#34;, anim, &#34; from animations array.&#34;)</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> is_choosing:
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>play(animations[anim_index])
</span></span><span style="display:flex;"><span>		yield(sprite, <span style="color:#e6db74">&#34;animation_finished&#34;</span>)
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>stop()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> count <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span>:
</span></span><span style="display:flex;"><span>			count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">continue</span>	
</span></span><span style="display:flex;"><span>		count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> anim_index <span style="color:#f92672">&lt;</span> animations<span style="color:#f92672">.</span>size() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>			anim_index <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>			anim_index <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_LeftButton_pressed():
</span></span><span style="display:flex;"><span>	anim_player<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;press_left&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> frames_num <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>		frames_num <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>frames <span style="color:#f92672">=</span> global<span style="color:#f92672">.</span>spriteframes[frames_num]
</span></span><span style="display:flex;"><span>		char_name<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> characters[frames_num]
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>frames <span style="color:#f92672">=</span> global<span style="color:#f92672">.</span>spriteframes[global<span style="color:#f92672">.</span>spriteframes<span style="color:#f92672">.</span>size() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>		char_name<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> characters[characters<span style="color:#f92672">.</span>size() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>		frames_num <span style="color:#f92672">=</span> global<span style="color:#f92672">.</span>spriteframes<span style="color:#f92672">.</span>size() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_RightButton_pressed():
</span></span><span style="display:flex;"><span>	anim_player<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;press_right&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> frames_num <span style="color:#f92672">&lt;</span> global<span style="color:#f92672">.</span>spriteframes<span style="color:#f92672">.</span>size() <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>		frames_num <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>frames <span style="color:#f92672">=</span> global<span style="color:#f92672">.</span>spriteframes[frames_num]
</span></span><span style="display:flex;"><span>		char_name<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> characters[frames_num]
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>frames <span style="color:#f92672">=</span> global<span style="color:#f92672">.</span>spriteframes[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>		char_name<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> characters[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>		frames_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _input(event):
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> event<span style="color:#f92672">.</span>is_action_pressed(<span style="color:#e6db74">&#34;ui_left&#34;</span>):
</span></span><span style="display:flex;"><span>		_on_LeftButton_pressed()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">elif</span> event<span style="color:#f92672">.</span>is_action_pressed(<span style="color:#e6db74">&#34;ui_right&#34;</span>):
</span></span><span style="display:flex;"><span>		_on_RightButton_pressed()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">elif</span> event<span style="color:#f92672">.</span>is_action_released(<span style="color:#e6db74">&#34;ui_accept&#34;</span>):
</span></span><span style="display:flex;"><span>		is_choosing <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span>		emit_signal(<span style="color:#e6db74">&#34;character_selected&#34;</span>, global<span style="color:#f92672">.</span>spriteframes[frames_num])
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">#print(&#34;emitted signal: character_selected&#34;)</span>
</span></span><span style="display:flex;"><span>		queue_free()
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;CharacterSelect scene is now freed.&#34;</span>)
</span></span></code></pre></div></details>
<br>
<details>
<summary>Global.gd の全コード</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Node</span> <span style="color:#75715e"># Added @ Part 10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> spriteframes <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Player/MaskDude.tres&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Player/NinjaFrog.tres&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Player/PinkMan.tres&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Player/VirtualGuy.tres&#34;</span>)
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div></details>
<br>
<details>
<summary>Game.gd の全コード</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Node</span> <span style="color:#75715e"># Added @ Part 7</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">var</span> current_level <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">var</span> final_level <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> health: <span style="color:#a6e22e">float</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">100.0</span> <span style="color:#75715e"># Added @ Part 8</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> score: <span style="color:#a6e22e">int</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># Added @ Part 8</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> level: <span style="color:#a6e22e">Node2D</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> player: <span style="color:#a6e22e">KinematicBody2D</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> char_frames: <span style="color:#a6e22e">SpriteFrames</span> <span style="color:#75715e"># Added @ Part 10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> ui_layer <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>UI <span style="color:#75715e"># Added @ Part 10</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> gamestart <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>UI<span style="color:#f92672">/</span>GameStart <span style="color:#75715e"># Added @ Part 10</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> hud <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>UI<span style="color:#f92672">/</span>HUD <span style="color:#75715e"># Added @ Part 8</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#onready var gameover = $UI/GameOver # Added @ Part 9 # Removed @ Part 10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#gameover.visible = false # Added @ Part 9 # Removed @ Part 10</span>
</span></span><span style="display:flex;"><span>	gamestart<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#34;tree_exited&#34;</span>, self ,<span style="color:#e6db74">&#34;_on_GameStart_tree_exited&#34;</span>) <span style="color:#75715e"># Added @ Part 10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_GameStart_tree_exited(): <span style="color:#75715e"># Added @ Part 10</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> char_select <span style="color:#f92672">=</span> load(<span style="color:#e6db74">&#34;res://UI/CharacterSelect/CharacterSelect.tscn&#34;</span>)<span style="color:#f92672">.</span>instance()
</span></span><span style="display:flex;"><span>	char_select<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#34;character_selected&#34;</span>, self ,<span style="color:#e6db74">&#34;_on_CharacterSelect_character_selected&#34;</span>) <span style="color:#75715e"># Added @ Part 10</span>
</span></span><span style="display:flex;"><span>	ui_layer<span style="color:#f92672">.</span>add_child(char_select)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_CharacterSelect_character_selected(sprite_frames): <span style="color:#75715e"># Added @ Part 10</span>
</span></span><span style="display:flex;"><span>	char_frames <span style="color:#f92672">=</span> sprite_frames
</span></span><span style="display:flex;"><span>	add_level() <span style="color:#75715e"># Moved @ Part 10 # Modified @ Part 10</span>
</span></span><span style="display:flex;"><span>	hud<span style="color:#f92672">.</span>update_health(health) <span style="color:#75715e"># Added @ Part 8 # Moved @ Part 10</span>
</span></span><span style="display:flex;"><span>	hud<span style="color:#f92672">.</span>update_score(score) <span style="color:#75715e"># Added @ Part 8 # Moved @ Part 10</span>
</span></span><span style="display:flex;"><span>	hud<span style="color:#f92672">.</span>update_level(current_level) <span style="color:#75715e"># Added @ Part 8 # Moved @ Part 10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> add_level(): <span style="color:#75715e"># Modified @ Part 10</span>
</span></span><span style="display:flex;"><span>	level <span style="color:#f92672">=</span> load(<span style="color:#e6db74">&#34;res://Levels/Level&#34;</span> <span style="color:#f92672">+</span> str(current_level) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.tscn&#34;</span>)<span style="color:#f92672">.</span>instance()
</span></span><span style="display:flex;"><span>	level<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#34;tree_exited&#34;</span>, self, <span style="color:#e6db74">&#34;change_level&#34;</span>)
</span></span><span style="display:flex;"><span>	level<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#34;player_dropped&#34;</span>, self, <span style="color:#e6db74">&#34;_on_Level_player_dropped&#34;</span>) <span style="color:#75715e"># Added @ Part 9</span>
</span></span><span style="display:flex;"><span>	call_deferred(<span style="color:#e6db74">&#34;add_child&#34;</span>, level) <span style="color:#75715e"># Fixed error</span>
</span></span><span style="display:flex;"><span>	player <span style="color:#f92672">=</span> level<span style="color:#f92672">.</span>get_node(<span style="color:#e6db74">&#34;Player&#34;</span>) <span style="color:#75715e"># Added @ Part 8</span>
</span></span><span style="display:flex;"><span>	player<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#34;enemy_hit&#34;</span>, self, <span style="color:#e6db74">&#34;_on_Player_enemy_hit&#34;</span>) <span style="color:#75715e"># Added @ Part 8</span>
</span></span><span style="display:flex;"><span>	player<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#34;item_hit&#34;</span>, self, <span style="color:#e6db74">&#34;_on_Player_item_hit&#34;</span>) <span style="color:#75715e"># Added @ Part 8</span>
</span></span><span style="display:flex;"><span>	player<span style="color:#f92672">.</span>get_node(<span style="color:#e6db74">&#34;AnimatedSprite&#34;</span>)<span style="color:#f92672">.</span>frames <span style="color:#f92672">=</span> char_frames <span style="color:#75715e"># Added @ Part 10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> change_level():
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#34;change_level() called.&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> current_level <span style="color:#f92672">&lt;</span> final_level:
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;change to next level.&#34;</span>)
</span></span><span style="display:flex;"><span>		level<span style="color:#f92672">.</span>queue_free()
</span></span><span style="display:flex;"><span>		current_level <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>		hud<span style="color:#f92672">.</span>update_level(current_level) <span style="color:#75715e"># Added @ Part 8</span>
</span></span><span style="display:flex;"><span>		add_level()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;Game Clear! Congrats!&#34;</span>)
</span></span><span style="display:flex;"><span>		get_tree()<span style="color:#f92672">.</span>quit()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Player_enemy_hit(damage): <span style="color:#75715e"># Added @ Part 8</span>
</span></span><span style="display:flex;"><span>	manage_health(damage) <span style="color:#75715e"># Modified @ Part 9</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Player_item_hit(point): <span style="color:#75715e"># Added @ Part 8</span>
</span></span><span style="display:flex;"><span>	score <span style="color:#f92672">+=</span> point
</span></span><span style="display:flex;"><span>	hud<span style="color:#f92672">.</span>update_score(score)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Level_player_dropped(): <span style="color:#75715e"># Added @ Part 9</span>
</span></span><span style="display:flex;"><span>	manage_health(<span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> manage_health(damage): <span style="color:#75715e"># Added @ Part 9</span>
</span></span><span style="display:flex;"><span>	health <span style="color:#f92672">-=</span> damage <span style="color:#75715e"># Moved from _on_Player_enemy_hit() @ Part 9</span>
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#34;Health updated: &#34;</span>, health) <span style="color:#75715e"># Moved from _on_Player_enemy_hit() @ Part 9</span>
</span></span><span style="display:flex;"><span>	hud<span style="color:#f92672">.</span>update_health(health) <span style="color:#75715e"># Moved from _on_Player_enemy_hit() @ Part 9</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># Added @ Part 9</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> health <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>		player<span style="color:#f92672">.</span>anim_player<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;die&#34;</span>)
</span></span><span style="display:flex;"><span>		yield(player<span style="color:#f92672">.</span>anim_player, <span style="color:#e6db74">&#34;animation_finished&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">#gameover.visible = true # Removed @ Part 10</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> gameover <span style="color:#f92672">=</span> load(<span style="color:#e6db74">&#34;res://UI/GameOver/GameOver.tscn&#34;</span>)<span style="color:#f92672">.</span>instance() <span style="color:#75715e"># Added @ Part 10</span>
</span></span><span style="display:flex;"><span>		ui_layer<span style="color:#f92672">.</span>add_child(gameover) <span style="color:#75715e"># Added @ Part 10</span>
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;Game over screen is shown up.&#34;</span>)
</span></span><span style="display:flex;"><span>		get_tree()<span style="color:#f92672">.</span>paused <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;Scene tree paused: &#34;</span>, get_tree()<span style="color:#f92672">.</span>paused)
</span></span></code></pre></div></details>
<br>
<hr>
<h1 id="おわりに">おわりに<a hidden class="anchor" aria-hidden="true" href="#おわりに">#</a></h1>
<p>以上で Part 10 は完了だ。</p>
<p>今回はゲームスタート画面とその次のプレイヤーキャラクター選択画面を実装した。スタート画面に比べて、キャラクター選択画面の方は難しく感じられたかもしれない。シングルトンという何やら聞き慣れない単語も出てきたが、複数のシーンで同じデータにアクセスしたい時などに非常に有効な手段であると実感いただけたなら幸いだ。ゲーム開発に限らず、あらゆるオブジェクト指向プログラミングで多用されるデザインパターンなので、知っておいて損はないだろう。</p>
<p>さて、次回のチュートリアルでは、ゲームプレイ画面に背景テクスチャを追加し、カメラが移動するときに近景のタイルマップは早く動き、遠景の背景テクスチャはゆっくり動く、といういわゆるパララックスエフェクト（視差効果）を実装して、ユーザーエクスペリエンスを高めてみよう。</p>
<p>では次回もお楽しみに。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://www.peanuts-code.com/ja/tags/godot/">Godot</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/godotengine/">GodotEngine</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%82%B2%E3%83%BC%E3%83%A0%E9%96%8B%E7%99%BA/">ゲーム開発</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB/">チュートリアル</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E5%88%9D%E7%B4%9A/">初級</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/2d/">2D</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%BC/">プラットフォーマー</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B2%E3%83%BC%E3%83%A0/">アクションゲーム</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E6%A8%AA%E3%82%B9%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%AB/">横スクロール</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%88%E7%94%BB%E9%9D%A2/">スタート画面</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%82%BF%E3%82%A4%E3%83%88%E3%83%AB%E7%94%BB%E9%9D%A2/">タイトル画面</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%88%E3%83%A1%E3%83%8B%E3%83%A5%E3%83%BC/">スタートメニュー</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%BC%E9%81%B8%E6%8A%9E/">キャラクター選択</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%83%97%E3%83%AC%E3%82%A4%E3%83%A4%E3%83%BC%E9%81%B8%E6%8A%9E/">プレイヤー選択</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%82%B7%E3%83%B3%E3%82%B0%E3%83%AB%E3%83%88%E3%83%B3/">シングルトン</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_9/">
    <span class="title">« 前のページ</span>
    <br>
    <span>Godot で作るプラットフォーマー Part 9：ゲームオーバーの仕組みを作ろう！</span>
  </a>
  <a class="next" href="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_11/">
    <span class="title">次のページ »</span>
    <br>
    <span>Godot で作るプラットフォーマー Part 11：背景を作ろう！</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！ on twitter"
        href="https://twitter.com/intent/tweet/?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2010%ef%bc%9a%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_10%2f&amp;hashtags=Godot%2cGodotEngine%2c%e3%82%b2%e3%83%bc%e3%83%a0%e9%96%8b%e7%99%ba%2c%e3%83%81%e3%83%a5%e3%83%bc%e3%83%88%e3%83%aa%e3%82%a2%e3%83%ab%2c%e5%88%9d%e7%b4%9a%2c2D%2c%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%2c%e3%82%a2%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e3%82%b2%e3%83%bc%e3%83%a0%2c%e6%a8%aa%e3%82%b9%e3%82%af%e3%83%ad%e3%83%bc%e3%83%ab%2c%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e7%94%bb%e9%9d%a2%2c%e3%82%bf%e3%82%a4%e3%83%88%e3%83%ab%e7%94%bb%e9%9d%a2%2c%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e3%83%a1%e3%83%8b%e3%83%a5%e3%83%bc%2c%e3%82%ad%e3%83%a3%e3%83%a9%e3%82%af%e3%82%bf%e3%83%bc%e9%81%b8%e6%8a%9e%2c%e3%83%97%e3%83%ac%e3%82%a4%e3%83%a4%e3%83%bc%e9%81%b8%e6%8a%9e%2c%e3%82%b7%e3%83%b3%e3%82%b0%e3%83%ab%e3%83%88%e3%83%b3">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！ on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_10%2f&amp;title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2010%ef%bc%9a%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81&amp;summary=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2010%ef%bc%9a%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81&amp;source=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_10%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！ on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_10%2f&title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2010%ef%bc%9a%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！ on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_10%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！ on whatsapp"
        href="https://api.whatsapp.com/send?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2010%ef%bc%9a%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81%20-%20https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_10%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！ on telegram"
        href="https://telegram.me/share/url?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2010%ef%bc%9a%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_10%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://www.peanuts-code.com/ja/">Peanuts Code</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
