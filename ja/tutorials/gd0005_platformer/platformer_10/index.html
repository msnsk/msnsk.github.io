<!doctype html><html lang=ja dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！ | Peanuts Code</title>
<meta name=keywords content="GodotEngine,GameDev,2D,アクションゲーム,横スクロール,プラットフォーマー,スタート画面,キャラクター選択"><meta name=description content="第10回目の今回は、ゲーム開始時に表示されるスタート画面を作る。タイトル画面、スタートメニューとも言う。
それだけだと、前回と比べて簡単すぎるので、ゲーム開始時にプレイヤーキャラクターを選択できる仕組みも実装する。画面遷移のイメージは以下の通りだ。

まずゲームを始めるとスタート画面が表示される。
スタートボタンを押すとプレイヤーキャラクター選択画面に遷移する。
プレイヤーキャラクターを選択するとゲームプレイ開始。

ということで、今回の作業は以下の通りだ。"><meta name=author content="gobo"><link rel=canonical href=https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_10/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.peanuts-code.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.peanuts-code.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.peanuts-code.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.peanuts-code.com/apple-touch-icon.png><link rel=mask-icon href=https://www.peanuts-code.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ja href=https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_10/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！"><meta property="og:description" content="第10回目の今回は、ゲーム開始時に表示されるスタート画面を作る。タイトル画面、スタートメニューとも言う。
それだけだと、前回と比べて簡単すぎるので、ゲーム開始時にプレイヤーキャラクターを選択できる仕組みも実装する。画面遷移のイメージは以下の通りだ。

まずゲームを始めるとスタート画面が表示される。
スタートボタンを押すとプレイヤーキャラクター選択画面に遷移する。
プレイヤーキャラクターを選択するとゲームプレイ開始。

ということで、今回の作業は以下の通りだ。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_10/"><meta property="og:image" content="https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_10/img43.gif"><meta property="article:section" content="tutorials"><meta property="article:published_time" content="2022-03-22T17:32:43+09:00"><meta property="article:modified_time" content="2022-03-22T17:32:43+09:00"><meta property="og:site_name" content="Peanuts Code 🥜"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_10/img43.gif"><meta name=twitter:title content="Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！"><meta name=twitter:description content="第10回目の今回は、ゲーム開始時に表示されるスタート画面を作る。タイトル画面、スタートメニューとも言う。
それだけだと、前回と比べて簡単すぎるので、ゲーム開始時にプレイヤーキャラクターを選択できる仕組みも実装する。画面遷移のイメージは以下の通りだ。

まずゲームを始めるとスタート画面が表示される。
スタートボタンを押すとプレイヤーキャラクター選択画面に遷移する。
プレイヤーキャラクターを選択するとゲームプレイ開始。

ということで、今回の作業は以下の通りだ。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"🤖 チュート","item":"https://www.peanuts-code.com/ja/tutorials/"},{"@type":"ListItem","position":2,"name":"🤖 シリーズ：Godot で作るプラットフォーマー","item":"https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/"},{"@type":"ListItem","position":3,"name":"Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！","item":"https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_10/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！","name":"Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！","description":"第10回目の今回は、ゲーム開始時に表示されるスタート画面を作る。タイトル画面、スタートメニューとも言う。\nそれだけだと、前回と比べて簡単すぎるので、ゲーム開始時にプレイヤーキャラクターを選択できる仕組みも実装する。画面遷移のイメージは以下の通りだ。\nまずゲームを始めるとスタート画面が表示される。 スタートボタンを押すとプレイヤーキャラクター選択画面に遷移する。 プレイヤーキャラクターを選択するとゲームプレイ開始。 ということで、今回の作業は以下の通りだ。\n","keywords":["GodotEngine","GameDev","2D","アクションゲーム","横スクロール","プラットフォーマー","スタート画面","キャラクター選択"],"articleBody":"第10回目の今回は、ゲーム開始時に表示されるスタート画面を作る。タイトル画面、スタートメニューとも言う。\nそれだけだと、前回と比べて簡単すぎるので、ゲーム開始時にプレイヤーキャラクターを選択できる仕組みも実装する。画面遷移のイメージは以下の通りだ。\nまずゲームを始めるとスタート画面が表示される。 スタートボタンを押すとプレイヤーキャラクター選択画面に遷移する。 プレイヤーキャラクターを選択するとゲームプレイ開始。 ということで、今回の作業は以下の通りだ。\nスタート画面を作る プレイヤーキャラクターの種類（スプライトのテクスチャのみ）を増やす プレイヤーキャラクター選択画面を作る スタート画面とプレイヤーキャラクター選択画面をゲームに紐付ける では順番にやっていこう。\nMemo： 過去のシリーズをまだご覧になっていない方は、そちらを先にご覧いただくことをおすすめします。\nGodot で作るプラットフォーマー スタート画面を作る シーンを作る まずはスタート画面を作っていく。画面のレイアウトはゲームオーバー画面と似た感じにしてしまおう。そうすればゲームオーバー画面のシーンを流用できる。\nということで、新規シーンは作らずに、ファイルシステムドック内でゲームオーバー画面のシーンを複製するところから作業を始める。では下記の手順でスタート画面のシーンを作成しよう。\nファイルシステムで「res://UI/GameOver/GameOver.tscn」を右クリック＞「複製」を選択する。\nシーンの名前を「GameStart.tscn」とする。 ファイルシステムで「res://UI/」で右クリック＞「新規フォルダー」を選択し、フォルダーの名前を「GameStart」とする。 「res://UI/GameStart」に「GameStart.tscn」をドラッグして移動する\nシーンツリーを編集する 「GameOver.tscn」から複製したばかりの「GameStart.tscn」を開いてみよう。\n見ての通り、「GameOver」シーンそのままの状態だ。これを以下の手順でスタート画面仕様に修正していく。\n「GameOver」ルートノードの名前を「GameStart」に変更する。 「GameStart」ノードを右クリック＞「スクリプトをデタッチ」する。 「GameOverLabel」ノードの名前を「TitleLabel」に変更する。 「RestartVBox」ノードの名前を「StartVBox」に変更する。 「RestartButton」ノードの名前を「StartButton」に変更する。 「RestartLabel」ノードの名前を「StartLabel」に変更する。 「StartVBox」ブランチを「ButtonsHBox」ノードから出して「VBoxContainer」の子にする（1階層上げる） 「ButtonsHBox」ブランチを削除する。 「ColorRect」ノードを削除する。 「ConfirmationDialog」ノードを削除する。 新たに「GameStart」ルートノードに「AnimationPlayer」ノードを追加する。 以上の作業でシーンツリーは以下のスクリーンショットのようになったはずだ。\n最後に「StartButton」ノードの「button_up()」シグナルを切断しておこう。\n続いて、各ノードのプロパティを更新していく。\n各ノードのプロパティを編集する 各ノードのプロパティの値も、シーンの複製元である「GameOver.tscn」の状態のままなのでスタート画面仕様に修正していく。シーンツリーの上から順番にやっていこう。\nGameStart 「Pause Mode」プロパティは、「GameOver」シーンの名残で「Process」のままになっているので、「Inherit」にしておく。その他のプロパティも編集は不要だ。\nTextureRect 「Texture」プロパティに割り当てるテクスチャ画像を差し替えて、ゲームオーバー画面と差別化する。ファイルシステムドックから「res://Assets/Background/Pink.png」をドラッグ\u0026ドロップして適用する。\nVBoxContainer このノードのプロパティは編集不要だ。\nTitleLabel スタート画面は、ゲーム開始時に最初に表示される画面なので、ゲームのタイトルを大きめに表示させたい。また、文字の見た目も色を変えたりアウトラインをつけるなどして、ゲームオーバー画面と差別化する。\n「Text」プロパティに以下のゲームタイトルの文字列（改行あり）を入力する（あなたの好きなタイトルにしていただいて問題ない）。\nplatformer\ntutorial 「Theme Overrides」＞「Fonts」＞「Font」で「新規 DynamicFont」を選択する。 「Font」＞「Settings」＞「Size」プロパティを 48 にする。 「Font」＞「Settings」＞「Outline Size」プロパティを 5 にする。 「Font」＞「Settings」＞「Outline Color」プロパティで色を # 302e3e （濃いグレー）にする。 「Font」＞「Font」＞「Font Data」に「res://fonts/connection_ii/ConnectionII.otf」を適用する。\n「Visibility」＞「Modulate」プロパティで色を # 7ec8ff（水色）にする。\nStartVBox このノードのプロパティは編集不要だ。\nStartButton ボタンのアイコンをゲームプレイを開始するイメージに近いテクスチャ画像に差し替える。\n「Textures」＞「Normal」プロパティにファイルシステムドックから「res://Assets/Menu/Buttons/Play.png」をドラッグ\u0026ドロップして画像を差し替える。\nStartLabel ボタンアイコンの説明書きがゲームオーバー画面仕様の「RESTART」になっているので「START」に更新する。\n「Text」プロパティに「press space or enter key」と入力する。 AnimationPlayer このノードは「Start」ボタンを押した時に、少し凹んだようなアニメーションを作るために用いる。インスペクターのプロパティはそのままで良い。\n新規アニメーションを以下の内容で作成しよう。\nアニメーション名: press_start アニメーションの長さ(秒): 0.1 アニメーションループ: 無効 トラック： 「StartButton」ノード ＞「modulate」プロパティ Time: 0秒 / Value: # ffffff / Easing: 1.00 Time: 0.05秒 / Value: # c8c8c8 / Easing: 1.00 Time: 0.1秒 / Value: # ffffff / Easing: 1.00 「StartButton」ノード ＞「rect_scale」プロパティ Time: 0秒 / Value: (1, 1) / Easing: 1.00 Time: 0.05秒 / Value: (0.9, 0.9) / Easing: 1.00 Time: 0秒 / Value: (1, 1) / Easing: 1.00 以上で、スタート画面のプロパティ編集作業は完了だ。一からシーンを作るよりは省エネで作業を終えられたのではないだろうか。ちなみに、シーンの見た目は以下のようになったはずだ。\nスクリプトをアタッチして編集する 続いて、スタート画面上のボタンをプレイヤーがクリックした時の動作をスクリプトで制御していく。\n「GameStart」ルートノードに新しいスクリプトをアタッチする。この時、スクリプトのファイルパスを「res://UI/GameStart/GameStart.gd」として作成する。\nスクリプトエディタで「GameStart.gd」スクリプトが開いたら、以下のように編集する。\nextends Control # StartButton ノードの参照 onready var start_button = $VBoxContainer/StartVBox/StartButton # AnimationPlayer ノードの参照 onready var anim_player = $AnimationPlayer func _ready(): # ゲーム開始時にアニメーションで変更されるプロパティを初期化 start_button.modulate = Color(1, 1, 1, 1) start_button.rect_scale = Vector2(1, 1) 次にシグナルを接続しよう。「StartButton」ノードの「button_up()」シグナルを「GameStart.gd」スクリプトに接続する。\nスクリプトに_on_StartButton_button_upメソッドが生成されたら、以下のように編集する。\n# Start ボタンをクリックした時のシグナルで呼ばれるメソッド func _on_StartButton_button_up(): # デバッグ用 print(\"_on_StartButton_button_up called.\") # AnimationPlayer の press_start アニメーションを再生 anim_player.play(\"press_start\") # アニメーションが終わるまで待機 yield(anim_player, \"animation_finished\") # このノードを解放（削除）する queue_free() # デバッグ用 print(\"GameStart scene is now freed.\") Start ボタンを押したら、次のプレイヤーキャラクター選択画面に遷移させる予定なので、この時点で「GameStart」シーンは用済みなのでqueue_freeメソッドで解放している。\n最後にキー入力での制御を実装しておく。インプットマップにデフォルトで登録されているアクション「ui_accept」に該当するスペースキー、またはエンターキーを押した時に、さっきシグナル接続で生成された_on_StartButton_button_upを実行するようにした。これでマウスでもキーボードでも同じ結果が得られるようになった。\nfunc _input(event): # スペースキーかエンターキーが押された場合 if event.is_action_pressed(\"ui_accept\"): # スタートボタンが押された時のメソッドを呼ぶ _on_StartButton_button_up() 「GameStart」シーンの作成はこれで完成なので、最後にシーンを実行して挙動を確認しておこう。\nスタートボタンを押すと、ルートノードが解放されて何もノードが存在しない状態になるので、グレーの画面が表示されるのは正常な動作だ。なお、GIF画像ではアニメーションが若干不自然だが、実際にはもう少し短い時間で自然にアニメーションするはずだ。\nプレイヤーキャラクターの種類を増やす ファイルシステムドックをご覧いただくと「res://Assets/Main Characters/」フォルダの中に4種類のプレイヤーキャラクターのアセットが見つかるだろう。ここまでのチュートリアルでは、4種類のうち「Pink Man」のスプライトシートのみを使ってきたが、ここで4種類全てのアセットを使用する時がきた。\nとはいえ、4種類のプレイヤーキャラクターのシーンを作る必要はなく、「Player」シーン＞「AnimatedSprite」ノード＞「Frames」プロパティに適用する「SpriteFrames」クラスのリソースファイルを4種類作成するだけで良い。つまり、キャラクター選択時に、「AnimatedSprite」ノードのテクスチャだけ差し替える、という作戦だ。\n（おさらいも兼ねて）事前確認として「Pink Man」以外のスプライトシートのアセットファイルにもしブラーがかかっていたら（ぼやけた感じがしたら）、ファイルシステムドックでファイルを選択して、インポートドックから「プリセット」＞「2D Pixel」を選択して「再インポート」をクリックしておこう。これでドット絵特有のエッジが効いた表示に更新される。\nでは順番にやっていこう。\nSpriteFrames リソースを作成する PinkMan ほぼ作業不要の「PinkMan」から「SpriteFrames」クラスのリソースファイルを作成する。\n「Player.tscn」を開く。 「AnimatedSprite」ノードの「Frames」プロパティの値になっている「SpriteFrames」を右クリック＞「保存」を選択する。\nファイルパスが「res://Player/PinkMan.tres」になるようにファイル名を「PinkMan.tres」として保存する。\nPinkMan の場合はすでにアニメーションフレームが作成済みなので、リソースファイル作成はこれで完了だ。\nMaskDude 次は「MaskDude」のリソースファイルを作成する。\nファイルシステムドックで、先に作成したPinkManのリソース「res://Player/PinkMan.tres」を右クリック＞「複製」を選択する。 ファイル名を「MaskDude.tres」とする。\nファイルシステムドックで作成した「MaskDude.tres」をダブルクリックしてスプライトフレームパネルを開く。 登録しているアニメーションを上から一つ選択する。\n既存のアニメーションフレームを全て削除する。\nスプライトシートアイコンをクリックする。\n適切なスプライトシートのファイルを選択し、アニメーションフレームに反映すればOK。\n次のアニメーションを選択して同様の作業を行う。全てのアニメーションのアニメーションフレームが更新できたら、リソースファイルの作成は完了とする。 NinjaFrog 作業は「MaskDude」シーンと同様だ。リソースのファイル名はもちろん「NinjaFrog.tres」にして保存する。\nVirtualGuy こちらも作業は「MaskDude」シーンと同様だ。リソースのファイル名はもちろん「VirtualGuy.tres」にして保存する。\n「VirtualGuy.tres」の編集が終われば、プレイヤーキャラクター4種類のリソースファイルの完成だ。ここらで一度休憩を入れよう。\nプレイヤーキャラクター選択画面を作る さて、ここからはプレイヤーキャラクターを選択する画面のシーンを作っていく。画面の仕様は以下のようにする。\n画面上部にプレイヤーキャラクターの名前を表示する。 画面中央にプレイヤーキャラクターのビジュアル（テクスチャ）をアニメーション付きで表示する。 キーボードの左右矢印キーか画面に表示されている矢印ボタンをクリックでキャラクターを切り替える。 キーボードのスペースキーまたはエンターキーでキャラクターを選択したらゲームプレイ開始。 では例によって、シーンを作成するところから始めよう。\nシーンを作る 以下の手順でプレイヤーキャラクター選択用のシーンを作っていく。\n「シーン」メニュー＞「新規シーン」を選択する。 「ルートノードの生成」で「ユーザーインターフェース」を選択して、「Control」クラスを選択する。 「Control」ルートノードが生成されたら、名前を「CharacterSelect」に変更する。 「res://UI」フォルダーに「CharacterSelect」フォルダーを新規作成し、ファイルパスを「res://UI/CharacterSelect/CharacterSelect.tscn」としてシーンを保存する。 必要なノードを追加する 続いて、作成した「CharacterSelect」シーンに必要なノードを追加していこう。\n「CharacterSelect」ルートノードに「TextureRect」ノードを追加する。 「CharacterSelect」ルートノードに「VBoxContainer」ノードを追加する。 「VBoxContainer」ノードに「Label」ノードを追加し、名前を「CharacterName」に変更する。 「VBoxContainer」ノードに「HBoxContainer」ノードを追加する。 「HBoxContainer」ノードに、「TextureButton」ノードを 2 つ追加し、それぞれの名前を「LeftButton」、「RightButton」に変更する。 「VBoxContainer」ノードに「Label」ノードを追加し、名前を「Caption」に変更する。 「CharacterSelect」ノードに「AnimatedSprite」ノードを追加する。 「CharacterSelect」ノードに「AnimationPlayer」ノードを追加する。 ここまででシーンツリーは以下のようになったはずだ。\n各ノードのプロパティを編集する 次に、インスペクターで各ノードのプロパティを編集して、プレイヤーキャラクター選択画面をデザインしていこう。\nCharacterSelect このルートノードは子ノードの入れ物として利用する。\n2Dワークスペースのツールバー＞「レイアウト」から「Rect全面」を選択して、ノードのサイズを前画面サイズに揃える。 TextureRect このノードは背景用に利用する。\n2Dワークスペースのツールバー＞「レイアウト」から「Rect全面」を選択して、画面全体に広げる。 「Texture」プロパティに、ファイルシステムから「res://Assets/Background/Yellow.png」をドラッグ\u0026ドロップして適用する。 「Stretch Mode」プロパティを「Tile」にする。 VBoxContainer このノードはプレイヤーキャラクター選択画面に表示されるキャラクター名やキャラクターのスプライト、選択ボタン、操作説明を縦に整列させるためのコンテナとして利用するだけなので、プロパティの編集は少ない。\n2Dワークスペースのツールバー＞「レイアウト」から「Rect全面」を選択して、ノードのサイズを前画面サイズに揃える。 インスペクターで「Alignment」を「Center」にする。 「Theme Overrides」＞「Constants」＞「Separation」ノードを 48 にする。 CharacterName このノードは、現在選択しているキャラクターの名前を表示するのに利用する。表示位置は画面の上部中央になる予定だが、他のノードの設定がまだなので現時点では中央にされる。後から徐々に意図した形になるはずなので、位置はそのままにしておくこと。\nインスペクターで「Text」プロパティは仮に「Mask Dude」と入力する。 「Align」プロパティを「Center」にする。 「Theme Overrides」＞「Fonts」＞「Font」で「新規 DynamicFont」を選択する。 「Font」＞「Settings」＞「Size」プロパティを 32 にする。 「Font」＞「Settings」＞「Outline Size」プロパティを 5 にする。 「Font」＞「Settings」＞「Outline Color」プロパティで色を # 302e3e （濃いグレー）にする。 「Font」＞「Font」＞「Font Data」に「res://fonts/connection_ii/ConnectionII.otf」を適用する。 HBoxContainer このノードは水平方向に子ノードを横並びに配置するコンテナだ。左右の矢印ボタンアイコンを子ノードに持つので、それを横並びに配置する。またその左右の矢印ボタンの間に、プレイヤーキャラクターのスプライトを表示させたいので、ボタンとボタンの間をたっぷり目に空けておく必要がある。\nインスペクターで「Alignment」プロパティを「Center」にする。 「Theme Overrides」＞「Constants」＞「Separation」ノードを 156 にする。 LeftButton このノードは「TextureRect」クラスなので、ボタンにテクスチャ画像を割り当てることができる。名前の通り、左向き矢印ボタンを作るのに利用する。\nインスペクターで「Expand」プロパティをオンにする。 「Stretch Mode」プロパティを「Keep Aspect Centered」にする。 「Textures」＞「Normal」プロパティに、ファイルシステムドックから「res://Assets/Menu/Buttons/Previous.png」をドラッグ\u0026ドロップして適用する。 「Control」クラスの「Rect」＞「Min Size」プロパティを (42, 40) にする。 RightButton このノードも「LeftButton」同様に「TextureRect」クラスで、右向き矢印ボタンを作るのに利用する。\nインスペクターで「Expand」プロパティをオンにする。 「Stretch Mode」プロパティを「Keep Aspect Centered」にする。 「Textures」＞「Normal」プロパティに、ファイルシステムドックから「res://Assets/Menu/Buttons/Next.png」をドラッグ\u0026ドロップして適用する。 「Control」クラスの「Rect」＞「Min Size」プロパティを (42, 40) にする。 Caption このノードは、単なる「Label」クラスのノードである。プレイヤーキャラクター選択画面での操作説明を画面下部に表示させるために利用する。\nインスペクターで「Text」プロパティに以下の開業を含む文字列を入力する。\npress left or right key to select a character\npress enter or space key to confirm 「Align」プロパティを「Center」にする。 「Uppercase」プロパティをオンにする。 「Theme Overrides」＞「Fonts」＞「Font」プロパティに、ファイルシステムドックから「res://fonts/poco/Poco.tres」をドラッグ\u0026ドロップして適用する。\n*このリソースファイルは他のシーンでも利用しているのでリソースのプロパティはそのままにしておくこと。もし編集したい場合は必ずリソースを「ユニーク化」して他のノードのデザインに影響しないようにすること。 「CanvasItem」クラスの「Visibility」＞「Modulate」プロパティで色を # 000000（黒）にする。 AnimatedSprite このノードは、先に作成した 4 種類のプレイヤーキャラクターの「SpriteFrames」クラスのリソースファイルを「Frames」プロパティに適用させて、画面上に実際にキャラクターのスプライトを表示するために利用する。\nインスペクターで「Frames」プロパティに、ファイルシステムドックから先に作った「res://Player/MaskDude.tres」をドラッグ\u0026ドロップして適用させる。最初は「MaskDude」のスプライトで表示させるためだ。 「Animation」プロパティは「idle」を選択する。これが一番、2Dワークスペース上で位置を把握しやすいはずだ。 「Position」プロパティは (192, 124) にする。これがちょうど左右のボタンの中間にあたる位置だ。 AnimationPlayer このノードは「LeftButton」と「RightButton」をクリックした時に再生させる、ボタンが凹んだような簡単なアニメーションを作るのに利用する。\nインスペクターでのプロパティ編集は不要だ。 アニメーションパネルを開く。 まず左矢印ボタンのアニメーションを作成する。 アニメーション名: press_left アニメーションの長さ(秒): 0.1 アニメーションループ: 無効 トラック: 「LeftButton」ノード ＞「modulate」プロパティ Time: 0秒 / Value: # ffffff / Easing: 1.00 Time: 0.05秒 / Value: # c8c8c8 / Easing: 1.00 Time: 0.1秒 / Value: # ffffff / Easing: 1.00 「LeftButton」ノード ＞「rect_scale」プロパティ Time: 0秒 / Value: (1, 1) / Easing: 1.00 Time: 0.05秒 / Value: (0.9, 0.9) / Easing: 1.00 Time: 0.1秒 / Value: (1, 1) / Easing: 1.00 次に右矢印ボタンのアニメーションを作成する。トラックのノードが違うこと以外は先に作成した「press_left」アニメーションとほとんど同じだ。 アニメーション名: press_right アニメーションの長さ(秒): 0.1 アニメーションループ: 無効 トラック: 「RightButton」ノード ＞「modulate」プロパティ Time: 0秒 / Value: # ffffff / Easing: 1.00 Time: 0.05秒 / Value: # c8c8c8 / Easing: 1.00 Time: 0.1秒 / Value: # ffffff / Easing: 1.00 「RightButton」ノード ＞「rect_scale」プロパティ Time: 0秒 / Value: (1, 1) / Easing: 1.00 Time: 0.05秒 / Value: (0.9, 0.9) / Easing: 1.00 Time: 0.1秒 / Value: (1, 1) / Easing: 1.00 シングルトンを作る シングルトンというのはプログラミング用語で、インスタンスが1つしかないように設計されたクラスのことで、他の複数のクラスで何らかの共通したプロパティやメソッドを利用する必要がある場合に用いられる。詳しい定義や仕組み、使い方などは、以下のリンク先のリソースをご参照いただきたい。\nMemo: Wikipedia - Singleton パターン Godot 公式オンラインドキュメント - シングルトン(自動読み込み) このチュートリアルでシングルトンを使用する理由は、4種類のプレイヤーキャラクターの「SpriteFrames」のリソースをシングルトンのプロパティとして用意しておけば、「CharacterSelect」シーンの「AnimatedSprite」ノードにも、「Level」シーン＞「Player」＞「AnimatedSprite」ノードにもいつでも利用できるようになるからだ。\n仮に、「CharacterSelect」ノードのプロパティとして「SpriteFrames」のリソースを用意することの弊害が一つある。それは「CharacterSelect」インスタンスノードは用済みになったら「Game」シーンから解放（削除）させる、ということだ。解放してしまうと、リソースの参照先を見失って、プレイヤーキャラクターのスプライトにテクスチャを割り当てることができなくなる。その結果、プレイヤーキャラクターは透明人間状態になってしまう。\n一方、シングルトンのスクリプトで「SpriteFrames」リソースを定義しておけば、他の複数のノードからいつでもそれを参照することができる。\nシングルトンのスクリプトを作る 説明が長くなったが、ここからは以下の手順でシングルトンを実際に作成していこう。\nファイルシステムドックで「res://」フォルダを右クリック＞「新規スクリプト」を選択する。\n「スクリプト作成」ダイアログが表示されたら、継承元を必ず「Node」にして、ファイル名を「Global.gd」として作成する。\n「プロジェクト」メニュー＞「プロジェクト設定」を選択する。 「自動読み込み（AutoLoad）」タブを開きパス入力欄の右側にあるフォルダアイコンをクリックする（Global.gdのパスを直接打ち込んでも良い）。\n「Global.gd」スクリプトを選択して開く。\nパス入力欄に「Global.gd」のファイルパスが入ったら右側の「追加」をクリックする。\n自動読み込みに追加されたことを確認したら、ウインドウを閉じる。ちなみに「グローバル変数」とは他のどのスクリプトのどのスコープからでもアクセスできる変数のことだが、これを利用したいので有効のままで良い。\n以上の作業で、シングルトン「Global.gd」スクリプトがゲーム開始時に一番最初に読み込まれ、常にどのシーンのどのノードのスクリプトからでもシングルトンのプロパティやメソッドにアクセスできるようになった。ゲーム開始時に自動読み込みされる時、自動的に「Node」が作成され、これに「Global.gd」スクリプトがアタッチされる仕組みだ。つまり、このスクリプトに記述するプロパティにアクセスしたければ、この「Node」のプロパティを参照するようコーディングすれば良い。なお、「Node」は自動的にスクリプトと同じ「Global」という名前になるので、簡単にアクセスできる。\nシングルトンのスクリプトを編集する ではシングルトンの「Global.gd」スクリプトを開き、以下のコードを記述しよう。\nextends Node var spriteframes = [ preload(\"res://Player/MaskDude.tres\"), preload(\"res://Player/NinjaFrog.tres\"), preload(\"res://Player/PinkMan.tres\"), preload(\"res://Player/VirtualGuy.tres\") ] プリロードされた4種類のプレイヤーキャラクターの「SpriteFrames」リソースを配列にまとめた。これで、プレイヤーキャラクターの4種類のリソースにどこからでも簡単にアクセスできる。\nCharacterSelect にスクリプトをアタッチして編集する 「CharacterSelect」ノードに新規スクリプトをアタッチしよう。ファイルパスは「res://UI/CharacterSelect/CharacterSelect.gd」となるようにする。\nでは作成したシングルトンを利用しつつ、コーディングしていこう。\nextends Control # カスタムシグナル、引数に SpriteFrames リソースの参照を渡す signal character_selected(sprite_frames) # 現在キャラクター選択中のフラグを立てる（true） var is_choosing = true # AnimatedSprite のアニメーションの現在のフレーム番号を保持 var frames_num = 0 # キャラクターの名前の配列（要素の順番はシングルトンの SpriteFrames の配列に合わせる） var characters = [\"Mask Dude\", \"Ninja Frog\", \"Pink Man\", \"Virtual Guy\"] # シングルトンのノードの参照 onready var global = get_node(\"/root/Global\") # CharacterName ノードの参照 onready var char_name = $VBoxContainer/CharacterName # LeftButton ノードの参照 onready var l_button = $VBoxContainer/HBoxContainer/LeftButton # RightButton ノードの参照 onready var r_button = $VBoxContainer/HBoxContainer/RightButton # AnimatedSprite ノードの参照 onready var sprite = $AnimatedSprite # AnimationPlayer ノードの参照 onready var anim_player = $AnimationPlayer func _ready(): # 以下4行: AnimationPlayer のアニメーションで変更されるプロパティに初期値を設定 l_button.modulate = Color(1, 1, 1, 1) l_button.rect_scale = Vector2(1, 1) r_button.modulate = Color(1, 1, 1, 1) r_button.rect_scale = Vector2(1, 1) # 以下のメソッドを呼ぶ（この後定義する） play_animations() # _ready で呼ばれる: AnimatedSprite のアニメーションを制御する func play_animations(): # アニメーションの名前の配列（Array型を指定しないと PoolStringArray 型になる） var animations: Array = sprite.frames.get_animation_names() # 現在再生中のアニメーションの上記配列内の順番 var anim_index = 0 # アニメーションのループ回数をカウントするための変数 var count = 0 # デバッグ用 print(\"animations array is \", animations) # アニメーションの名前の配列から不要な要素を削除するため配列の要素でループ for anim in animations: # アニメーションが fall か jump の場合は配列から削除（フレームが1つしかなく面白くないため） if anim == \"fall\" or anim == \"jump\": animations.remove(animations.find(anim)) print(\"removed \", anim, \" from animations array.\") # 現在キャラクター選択中のフラグが立っている間はループする while is_choosing: # アニメーションの名前の配列から現在の再生中のアニメーションを指定して再生 sprite.play(animations[anim_index]) # 最後のアニメーションフレーム終了まで待機 yield(sprite, \"animation_finished\") # アニメーションを一度停止する sprite.stop() # アニメーションが 4 周するまで while ループ if count \u003c 4: count += 1 continue # アニメーションが 4 周したらカウントを 0 にする count = 0 # 現在再生中のアニメーションの番号が、アニメーションの配列の要素数 - 1 より小さい場合は if anim_index \u003c animations.size() - 1: # アニメーションの番号に 1　を加えて、次のアニメーションを再生するように仕込む anim_index += 1 # 現在再生中のアニメーションの番号が、アニメーションの配列の要素数 - 1 になったら else: # 全てのアニメーションを再生したので、アニメーションの番号を 0 に戻して、最初のアニメーションに戻る anim_index = 0 少しコードが長い印象を持たれたかもしれないが、やっていることは単に「AnimatedSprite」ノードに設定済みのアニメーションを自動的に順次再生させているだけである。アニメーションを4周再生したら、次のアニメーションを再生し、全てのアニメーションを4回ずつ再生したらまた最初のアニメーションの再生から始めるようにwhileループを利用して制御している。\n次はキャラクターを切り替える左右のボタンを押した時の制御を実装する。これにはシグナルを利用する。「LeftButton」ノードおよび「RightButton」ノードの「pressed()」シグナルを今編集している「CharacterSelect.gd」スクリプトに接続しよう。\n接続して自動生成されたメソッドを以下のように編集する。ちなみに左ボタンが逆送り、右ボタンが順送りでキャラクターを切り替えるように実装している。\nfunc _on_LeftButton_pressed(): # AnimationPlayer の press_left アニメーションを再生 anim_player.play(\"press_left\") # シングルトンの SpriteFrames のリソースの配列から、 # 一つ前のキャラクターのものを AnimatedSprite ノードの frames プロパティに適用する # CharacterName の text プロパティにその SpriteFrames に合致したキャラクターの名前を入れる # 今、配列の最初のリソースを適用している時は配列の最後のリソースを適用する if frames_num \u003e 0: frames_num -= 1 sprite.frames = global.spriteframes[frames_num] char_name.text = characters[frames_num] else: sprite.frames = global.spriteframes[global.spriteframes.size() -1] char_name.text = characters[characters.size() - 1] frames_num = global.spriteframes.size() -1 func _on_RightButton_pressed(): # AnimationPlayer の press_right アニメーションを再生 anim_player.play(\"press_right\") # シングルトンの SpriteFrames のリソースの配列から、 # 次のキャラクターのものを AnimatedSprite ノードの frames プロパティに適用する # CharacterName の text プロパティにその SpriteFrames に合致したキャラクターの名前を入れる # 今、配列の最後のリソースを適用している時は配列の最初のリソースを適用する if frames_num \u003c global.spriteframes.size() -1: frames_num += 1 sprite.frames = global.spriteframes[frames_num] char_name.text = characters[frames_num] else: sprite.frames = global.spriteframes[0] char_name.text = characters[0] frames_num = 0 キャラクターを切り替える操作のたびに「AnimatedSprite」の「Frames」プロパティに適切な「SpriteFrames」リソースを適用しているが、その時、シングルトンの「Global.gd」スクリプト内の配列spriteframes から当てはまる要素（SpriteFrames リソース）をピックアップして適用している。\n最後にキーボードでの入力も受け付けられるようにコードを追加する。_inputメソッドは GDScript の組み込み関数で、これを利用してあらゆる入力に対する制御を実装できる。引数のeventは「InputEvent」クラスのオブジェクトで、キーボード入力やマウスクリックなどの入力イベントを指す。さまざまなメソッドが用意されているので、非常に便利である。\n公式オンラインドキュメント: Using InputEvent void _input ( InputEvent event ) virtual InputEvent func _input(event): # 左矢印キーを押したら if event.is_action_pressed(\"ui_left\"): # 左ボタンアイコンをクリックした時に呼ばれるメソッドを呼ぶ _on_LeftButton_pressed() # 右矢印キーを押したら elif event.is_action_pressed(\"ui_right\"): # 右ボタンアイコンをクリックした時に呼ばれるメソッドを呼ぶ _on_RightButton_pressed() # スペースキーかエンターキーを押したら elif event.is_action_released(\"ui_accept\"): # キャラクター選択中のフラグを無効にする is_choosing = false emit_signal(\"character_selected\", global.spriteframes[frames_num]) print(\"emitted signal: character_selected\") queue_free() print(\"CharacterSelect scene is now freed.\") これで「CharacterSelect」シーンの作成は完了だ。\nGame シーンに GameStart シーンと CharacterSelect シーンのインスタンスを追加する それではここまでで作成した「GameStart」シーンと「CharacterSelect」シーンをインスタンス化して「Game」シーンに追加しよう。\n…といういつもの流れとは少し異なる手順で進める。\nGame シーンツリーを整理する 一旦「Game」シーンツリーを整理しよう。\n「Game」シーンに UI 系のブランチが多いと、各ブランチのスクリプトで制御している入力操作が同時に処理されてしまう可能性があり面倒だ。例えばスタート画面でキーボードのスペースキーでキャラクター選択画面に遷移させただけのつもりが、次の画面のキャラクター選択が同時に確定してしまい、キャラクターを選ぶ間もなく一気にゲームプレイ画面に遷移する、というような問題だ。\nスクリプトのコードを工夫すれば対処可能だが、この問題を完全に回避する分かりやす方法は、必要なノード以外をシーンツリー上に存在させないことだ。そこで、最初の画面である「GameStart」シーンのインスタンス、および入力操作の影響を受けない「HUD」シーンのインスタンスのみを「Game」シーンツリーに追加しておき、他のシーンのインスタンスはスクリプトで、必要な時に作成\u0026追加することにする。\nということで、まずは「Game」シーンで、今回のチュートリアルで作成した「GameStart.tscn」のインスタンスを追加し、前回のチュートリアルで追加済みの「GameOver.tscn」のインスタンスノードを削除しよう。作業後の「Game」シーンツリーは以下のようになる。\nGame.gd スクリプトを更新する ここから「Game.gd」スクリプトで、不要になったノードを削除したり、必要になったノードを追加したり、選択されたキャラクターの「SpriteFrames」リソースを「Level」ブランチ内のプレイヤーキャラクターに適用したり、という処理を実装していく。若干複雑かもしれないが、頑張ってやっていこう。\nそれでは「Game.gd」スクリプトを開いてほしい。そして、まずはプロパティの定義と_readyメソッドまで見ていこう。「# 追加」や「# 削除」とコメントしている行が更新箇所だ。\nextends Node export var current_level = 1 export var final_level = 2 var health: float = 100.0 var score: int = 0 var level: Node2D var player: KinematicBody2D # 選択されたキャラクターの SpriteFrames リソースの参照用 var char_frames: SpriteFrames # 追加 # UI ノードの参照 onready var ui_layer = $UI # 追加 # GameStart ノードの参照 onready var gamestart = $UI/GameStart # 追加 onready var hud = $UI/HUD #onready var gameover = $UI/GameOver # Added @ Part 9 # 削除: シーンツリーから削除した func _ready(): #gameover.visible = false # Added @ Part 9 # 削除: シーンツリーから削除した # GameStart ノードが解放された時に発信されるシグナルを _on_GameStart_tree_exited メソッドに接続 gamestart.connect(\"tree_exited\", self ,\"_on_GameStart_tree_exited\") # 追加 # 以下 4 行：ゲーム開始時に呼ぶ必要がなくなったので別のメソッドへ移動 #add_level() #hud.update_health(health) #hud.update_score(score) #hud.update_level(current_level) 続いて、先にコード上で接続したシグナル「tree_exited()」の接続先メソッド_on_GameStart_tree_exitedを定義しよう。なお、このシグナルは「GameStart」シーンが解放された時に発信される。\nfunc _on_GameStart_tree_exited(): # CharacterSelect ノードのインスタンスを作成 var char_select = load(\"res://UI/CharacterSelect/CharacterSelect.tscn\").instance() # CharacterSelect ノードの character_selected カスタムシグナルを _on_CharacterSelect_character_selected メソッドに接続 char_select.connect(\"character_selected\", self ,\"_on_CharacterSelect_character_selected\") # UI ノードの子として CharacterSelect インスタンスノードを追加 ui_layer.add_child(char_select) さらに、今しがた「CharacterSelect」ノードから「character_selected」シグナルを接続した_on_CharacterSelect_character_selectedメソッドを編集していく。ちなみにこのシグナルは、キャラクター選択が確定したら発信される。このシグナルは自作したシグナルで、引数sprite_framesを持っている。これを接続先のメソッドの引数に渡す格好だ。\nfunc _on_CharacterSelect_character_selected(sprite_frames): # このスクリプトのプロパティ char_frames に選択したキャラクターの SpriteFrames リソースを渡す char_frames = sprite_frames # 以下 4 行： _ready メソッドからこちらに移動させた add_level() hud.update_health(health) hud.update_score(score) hud.update_level(current_level) 「CharacterSelect.gd」スクリプトでは、「character_selected」シグナル発信後、まもなく「CharacterSelect」ノードは解放される。ここでシングルトンを作成したおかげで、char_framesプロパティは「CharacterSelect」ノードからバトンパスされたかのように、シングルトンの「SpriteFrames」リソースを参照した状態になる。\nキャラクター選択画面の次はゲームプレイの開始となるので、もともと_readyメソッドで実行していたadd_levelメソッドでの「Level」シーンのインスタンス追加や「HUD」ノードの各コンポーネントの初期設定メソッドをこのタイミングで実行させている。\nここでadd_levelメソッドに大事な 1 行を加えることを忘れてはいけない。「Level」ノード＞「Player」ノード＞「AnimatedSprite」ノードの「Frames」プロパティに、キャラクター選択画面で選択したキャラクターの「SpriteFrames」リソースを適用するための 1 行だ。これにより、ゲームプレイ画面のプレイヤーキャラクターが、キャラクター選択画面で選んだキャラクターと同じ見た目になるわけだ。\nfunc add_level(): level = load(\"res://Levels/Level\" + str(current_level) + \".tscn\").instance() level.connect(\"tree_exited\", self, \"change_level\") level.connect(\"player_dropped\", self, \"_on_Level_player_dropped\") call_deferred(\"add_child\", level) # エラー解消のため修正 player = level.get_node(\"Player\") player.connect(\"enemy_hit\", self, \"_on_Player_enemy_hit\") player.connect(\"item_hit\", self, \"_on_Player_item_hit\") # Player ノードの子 AnimatedSprite ノードに選択したキャラクターの SpriteFrames リソースを適用 player.get_node(\"AnimatedSprite\").frames = char_frames # 追加 このあとmanage_healthメソッドまでのコードは今までと変わりない。manage_healthメソッドの変更内容を見ていこう。\n# 中略 func manage_health(damage): health -= damage # Moved from _on_Player_enemy_hit() print(\"Health updated: \", health) # Moved from _on_Player_enemy_hit() hud.update_health(health) # Moved from _on_Player_enemy_hit() if health \u003c= 0: player.anim_player.play(\"die\") yield(player.anim_player, \"animation_finished\") #gameover.visible = true # 削除: シーンツリーから削除しているため不要 # GameOver シーンをインスタンス化 var gameover = load(\"res://UI/GameOver/GameOver.tscn\").instance() # 追加 # UI ノードに GameOver シーンのインスタンスノードを追加 ui_layer.add_child(gameover) # 追加 print(\"Game over screen is shown up.\") get_tree().paused = true print(\"Scene tree paused: \", get_tree().paused) これまでは「GameOver」シーンのインスタンスは最初から「Game」シーンツリーに追加してあったが、さっき削除したので、visibleプロパティの有効化は不要となった。反対に「GameOver」シーンのインスタンスをスクリプト上で追加する必要があるので、そのためのコードを追加した。インスタンスを子ノードにする作業はたった 2 行のコードで実装できるのだ。（子ノードの順番の入れ替えが必要な場合はもう1行必要だ）。\n以上で「Game.gd」スクリプトの編集は完了だ。\n最後にプロジェクトを実行して、今回作成した「GameStart」シーンと「CharacterSelect」シーンがプロジェクトの中でうまく動作するか確認しておこう。\n以下のポイントで問題なさそうなので、ここで今回の作業を終えよう。\n最初にスタート画面が表示された。 スペースキーを押すとプレイヤーキャラクター選択画面が表示された。 プレイヤーキャラクター選択画面で、マウスでの左右ボタンの操作、キーボードでの左右矢印キーの操作によって、キャラクターの名前とスプライトの見た目が順番に切り替わった。 プレイヤーキャラクター選択画面でキャラクターはアニメーションし続けた。 プレイヤーキャラクター選択画面でスペースキーを押すとゲームプレイ画面に遷移した。 ゲームプレイ画面にはプレイヤーキャラクター選択画面で最後に選択したキャラクターが登場した。 Part 10 で編集したスクリプトのコード 最後に今回の Part 10 で編集したスクリプトのコードを共有しておくので、必要に応じて確認してほしい。\nGameStart.gd の全コード extends Control # Added @ Part 10 onready var start_button = $VBoxContainer/StartVBox/StartButton onready var anim_player = $AnimationPlayer func _ready(): start_button.modulate = Color(1, 1, 1, 1) start_button.rect_scale = Vector2(1, 1) func _on_StartButton_button_up(): #print(\"_on_StartButton_button_up called.\") anim_player.play(\"press_start\") yield(anim_player, \"animation_finished\") queue_free() print(\"GameStart scene is now freed.\") func _input(event): if event.is_action_released(\"ui_accept\"): _on_StartButton_button_up() CharacterSelect.gd の全コード extends Control # Added @ Part 10 signal character_selected(sprite_frames) var is_choosing = true var frames_num = 0 var characters = [\"Mask Dude\", \"Ninja Frog\", \"Pink Man\", \"Virtual Guy\"] onready var global = get_node(\"/root/Global\") onready var char_name = $VBoxContainer/CharacterName onready var l_button = $VBoxContainer/HBoxContainer/LeftButton onready var r_button = $VBoxContainer/HBoxContainer/RightButton onready var sprite = $AnimatedSprite onready var anim_player = $AnimationPlayer func _ready(): l_button.modulate = Color(1, 1, 1, 1) l_button.rect_scale = Vector2(1, 1) r_button.modulate = Color(1, 1, 1, 1) r_button.rect_scale = Vector2(1, 1) play_animations() func play_animations(): var animations: Array = sprite.frames.get_animation_names() var anim_index = 0 var count = 0 #print(\"animations array is \", animations) for anim in animations: if anim == \"fall\" or anim == \"jump\": animations.remove(animations.find(anim)) #print(\"removed \", anim, \" from animations array.\") while is_choosing: sprite.play(animations[anim_index]) yield(sprite, \"animation_finished\") sprite.stop() if count \u003c 4: count += 1 continue\tcount = 0 if anim_index \u003c animations.size() - 1: anim_index += 1 else: anim_index = 0 func _on_LeftButton_pressed(): anim_player.play(\"press_left\") if frames_num \u003e 0: frames_num -= 1 sprite.frames = global.spriteframes[frames_num] char_name.text = characters[frames_num] else: sprite.frames = global.spriteframes[global.spriteframes.size() - 1] char_name.text = characters[characters.size() - 1] frames_num = global.spriteframes.size() - 1 func _on_RightButton_pressed(): anim_player.play(\"press_right\") if frames_num \u003c global.spriteframes.size() -1: frames_num += 1 sprite.frames = global.spriteframes[frames_num] char_name.text = characters[frames_num] else: sprite.frames = global.spriteframes[0] char_name.text = characters[0] frames_num = 0 func _input(event): if event.is_action_pressed(\"ui_left\"): _on_LeftButton_pressed() elif event.is_action_pressed(\"ui_right\"): _on_RightButton_pressed() elif event.is_action_released(\"ui_accept\"): is_choosing = false emit_signal(\"character_selected\", global.spriteframes[frames_num]) #print(\"emitted signal: character_selected\") queue_free() print(\"CharacterSelect scene is now freed.\") Global.gd の全コード extends Node # Added @ Part 10 var spriteframes = [ preload(\"res://Player/MaskDude.tres\"), preload(\"res://Player/NinjaFrog.tres\"), preload(\"res://Player/PinkMan.tres\"), preload(\"res://Player/VirtualGuy.tres\") ] Game.gd の全コード extends Node # Added @ Part 7 export var current_level = 1 export var final_level = 2 var health: float = 100.0 # Added @ Part 8 var score: int = 0 # Added @ Part 8 var level: Node2D var player: KinematicBody2D var char_frames: SpriteFrames # Added @ Part 10 onready var ui_layer = $UI # Added @ Part 10 onready var gamestart = $UI/GameStart # Added @ Part 10 onready var hud = $UI/HUD # Added @ Part 8 #onready var gameover = $UI/GameOver # Added @ Part 9 # Removed @ Part 10 func _ready(): #gameover.visible = false # Added @ Part 9 # Removed @ Part 10 gamestart.connect(\"tree_exited\", self ,\"_on_GameStart_tree_exited\") # Added @ Part 10 func _on_GameStart_tree_exited(): # Added @ Part 10 var char_select = load(\"res://UI/CharacterSelect/CharacterSelect.tscn\").instance() char_select.connect(\"character_selected\", self ,\"_on_CharacterSelect_character_selected\") # Added @ Part 10 ui_layer.add_child(char_select) func _on_CharacterSelect_character_selected(sprite_frames): # Added @ Part 10 char_frames = sprite_frames add_level() # Moved @ Part 10 # Modified @ Part 10 hud.update_health(health) # Added @ Part 8 # Moved @ Part 10 hud.update_score(score) # Added @ Part 8 # Moved @ Part 10 hud.update_level(current_level) # Added @ Part 8 # Moved @ Part 10 func add_level(): # Modified @ Part 10 level = load(\"res://Levels/Level\" + str(current_level) + \".tscn\").instance() level.connect(\"tree_exited\", self, \"change_level\") level.connect(\"player_dropped\", self, \"_on_Level_player_dropped\") # Added @ Part 9 call_deferred(\"add_child\", level) # Fixed error player = level.get_node(\"Player\") # Added @ Part 8 player.connect(\"enemy_hit\", self, \"_on_Player_enemy_hit\") # Added @ Part 8 player.connect(\"item_hit\", self, \"_on_Player_item_hit\") # Added @ Part 8 player.get_node(\"AnimatedSprite\").frames = char_frames # Added @ Part 10 func change_level(): if get_tree(): # Added @ Part 9 print(\"change_level() called.\") if current_level \u003c final_level: print(\"change to next level.\") level.queue_free() current_level += 1 hud.update_level(current_level) # Added @ Part 8 add_level() else: print(\"Game Clear! Congrats!\") get_tree().quit() func _on_Player_enemy_hit(damage): # Added @ Part 8 manage_health(damage) # Modified @ Part 9 func _on_Player_item_hit(point): # Added @ Part 8 score += point hud.update_score(score) func _on_Level_player_dropped(): # Added @ Part 9 manage_health(100) func manage_health(damage): # Added @ Part 9 health -= damage # Moved from _on_Player_enemy_hit() @ Part 9 print(\"Health updated: \", health) # Moved from _on_Player_enemy_hit() @ Part 9 hud.update_health(health) # Moved from _on_Player_enemy_hit() @ Part 9 # Added @ Part 9 if health \u003c= 0: player.anim_player.play(\"die\") yield(player.anim_player, \"animation_finished\") #gameover.visible = true # Removed @ Part 10 var gameover = load(\"res://UI/GameOver/GameOver.tscn\").instance() # Added @ Part 10 ui_layer.add_child(gameover) # Added @ Part 10 print(\"Game over screen is shown up.\") get_tree().paused = true print(\"Scene tree paused: \", get_tree().paused) おわりに 以上で Part 10 は完了だ。\n今回はゲームスタート画面とその次のプレイヤーキャラクター選択画面を実装した。スタート画面に比べて、キャラクター選択画面の方は難しく感じられたかもしれない。シングルトンという何やら聞き慣れない単語も出てきたが、複数のシーンで同じデータにアクセスしたい時などに非常に有効な手段であると実感いただけたなら幸いだ。ゲーム開発に限らず、あらゆるオブジェクト指向プログラミングで多用されるデザインパターンなので、知っておいて損はないだろう。\nさて、次回のチュートリアルでは、ゲームプレイ画面に背景テクスチャを追加し、カメラが移動するときに近景のタイルマップは早く動き、遠景の背景テクスチャはゆっくり動く、といういわゆるパララックスエフェクト（視差効果）を実装して、ユーザーエクスペリエンスを高めてみよう。\nでは次回もお楽しみに。\n","wordCount":"17191","inLanguage":"ja","image":"https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_10/img43.gif","datePublished":"2022-03-22T17:32:43+09:00","dateModified":"2022-03-22T17:32:43+09:00","author":{"@type":"Person","name":"gobo"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_10/"},"publisher":{"@type":"Organization","name":"Peanuts Code","logo":{"@type":"ImageObject","url":"https://www.peanuts-code.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.peanuts-code.com/ja/ accesskey=h title="Peanuts Code (Alt + H)"><img src=https://www.peanuts-code.com/images/logomark.png alt aria-label=logo height=35>Peanuts Code</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://www.peanuts-code.com/en/ title=English aria-label=🇬🇧English>🇬🇧English</a></li></ul></div></div><ul id=menu><li><a href=https://www.peanuts-code.com/ja/ title=ホーム><span>ホーム</span></a></li><li><a href=https://www.peanuts-code.com/ja/portfolio/ title=ゲーム><span>ゲーム</span></a></li><li><a href=https://www.peanuts-code.com/ja/posts/ title=ブログ><span>ブログ</span></a></li><li><a href=https://www.peanuts-code.com/ja/tutorials/ title=チュート><span>チュート</span></a></li><li><a href=https://www.peanuts-code.com/ja/about/ title=サイト紹介><span>サイト紹介</span></a></li><li><a href=https://www.peanuts-code.com/ja/search/ title="サイト内検索 (Alt + /)" accesskey=/><span>サイト内検索</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.peanuts-code.com/ja/>ホーム</a>&nbsp;»&nbsp;<a href=https://www.peanuts-code.com/ja/tutorials/>🤖 チュート</a>&nbsp;»&nbsp;<a href=https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/>🤖 シリーズ：Godot で作るプラットフォーマー</a></div><h1 class="post-title entry-hint-parent">Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！</h1><div class=post-meta><span title='2022-03-22 17:32:43 +0900 +0900'>2022-03-22</span>&nbsp;·&nbsp;35 分</div><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！ on x" href="https://x.com/intent/tweet/?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2010%ef%bc%9a%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_10%2f&amp;hashtags=GodotEngine%2cGameDev%2c2D%2c%e3%82%a2%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e3%82%b2%e3%83%bc%e3%83%a0%2c%e6%a8%aa%e3%82%b9%e3%82%af%e3%83%ad%e3%83%bc%e3%83%ab%2c%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%2c%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e7%94%bb%e9%9d%a2%2c%e3%82%ad%e3%83%a3%e3%83%a9%e3%82%af%e3%82%bf%e3%83%bc%e9%81%b8%e6%8a%9e"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！ on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_10%2f&title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2010%ef%bc%9a%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！ on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_10%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li></ul><ul class=post-tags><li><a href=https://www.peanuts-code.com/ja/tags/godotengine/>GodotEngine</a></li><li><a href=https://www.peanuts-code.com/ja/tags/gamedev/>GameDev</a></li><li><a href=https://www.peanuts-code.com/ja/tags/2d/>2D</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B2%E3%83%BC%E3%83%A0/>アクションゲーム</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E6%A8%AA%E3%82%B9%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%AB/>横スクロール</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%BC/>プラットフォーマー</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%88%E7%94%BB%E9%9D%A2/>スタート画面</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%BC%E9%81%B8%E6%8A%9E/>キャラクター選択</a></li></ul></header><figure class=entry-cover><img loading=eager src=https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_10/img43.gif alt="プラットフォーマー Part 10 サムネイル"></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目次</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#シーンを作る>シーンを作る</a></li><li><a href=#シーンツリーを編集する>シーンツリーを編集する</a></li><li><a href=#各ノードのプロパティを編集する>各ノードのプロパティを編集する</a><ul><li><a href=#gamestart>GameStart</a></li><li><a href=#texturerect>TextureRect</a></li><li><a href=#vboxcontainer>VBoxContainer</a></li><li><a href=#titlelabel>TitleLabel</a></li><li><a href=#startvbox>StartVBox</a></li><li><a href=#startbutton>StartButton</a></li><li><a href=#startlabel>StartLabel</a></li><li><a href=#animationplayer>AnimationPlayer</a></li></ul></li><li><a href=#スクリプトをアタッチして編集する>スクリプトをアタッチして編集する</a></li></ul><ul><li><a href=#spriteframes-リソースを作成する>SpriteFrames リソースを作成する</a><ul><li><a href=#pinkman>PinkMan</a></li><li><a href=#maskdude>MaskDude</a></li><li><a href=#ninjafrog>NinjaFrog</a></li><li><a href=#virtualguy>VirtualGuy</a></li></ul></li></ul><ul><li><a href=#シーンを作る-1>シーンを作る</a></li><li><a href=#必要なノードを追加する>必要なノードを追加する</a></li><li><a href=#各ノードのプロパティを編集する-1>各ノードのプロパティを編集する</a><ul><li><a href=#characterselect>CharacterSelect</a></li><li><a href=#texturerect-1>TextureRect</a></li><li><a href=#vboxcontainer-1>VBoxContainer</a></li><li><a href=#charactername>CharacterName</a></li><li><a href=#hboxcontainer>HBoxContainer</a></li><li><a href=#leftbutton>LeftButton</a></li><li><a href=#rightbutton>RightButton</a></li><li><a href=#caption>Caption</a></li><li><a href=#animatedsprite>AnimatedSprite</a></li><li><a href=#animationplayer-1>AnimationPlayer</a></li></ul></li></ul><ul><li><a href=#シングルトンのスクリプトを作る>シングルトンのスクリプトを作る</a></li><li><a href=#シングルトンのスクリプトを編集する>シングルトンのスクリプトを編集する</a></li></ul><ul><li><a href=#game-シーンツリーを整理する>Game シーンツリーを整理する</a></li><li><a href=#gamegd-スクリプトを更新する>Game.gd スクリプトを更新する</a></li></ul></nav></div></details></div><div class=post-content><p>第10回目の今回は、ゲーム開始時に表示されるスタート画面を作る。タイトル画面、スタートメニューとも言う。</p><p>それだけだと、前回と比べて簡単すぎるので、ゲーム開始時にプレイヤーキャラクターを選択できる仕組みも実装する。画面遷移のイメージは以下の通りだ。</p><ol><li>まずゲームを始めるとスタート画面が表示される。</li><li>スタートボタンを押すとプレイヤーキャラクター選択画面に遷移する。</li><li>プレイヤーキャラクターを選択するとゲームプレイ開始。</li></ol><p>ということで、今回の作業は以下の通りだ。</p><ul><li>スタート画面を作る</li><li>プレイヤーキャラクターの種類（スプライトのテクスチャのみ）を増やす</li><li>プレイヤーキャラクター選択画面を作る</li><li>スタート画面とプレイヤーキャラクター選択画面をゲームに紐付ける</li></ul><p>では順番にやっていこう。</p><blockquote><p><em><strong><span style=color:salmon>Memo：</span></strong><br>過去のシリーズをまだご覧になっていない方は、そちらを先にご覧いただくことをおすすめします。<br><a href=https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/ title="Godot で作るプラットフォーマー">Godot で作るプラットフォーマー</a></em></p></blockquote><br><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=スタート画面を作る>スタート画面を作る</h1><h2 id=シーンを作る>シーンを作る</h2><p>まずはスタート画面を作っていく。画面のレイアウトはゲームオーバー画面と似た感じにしてしまおう。そうすればゲームオーバー画面のシーンを流用できる。</p><p>ということで、新規シーンは作らずに、ファイルシステムドック内でゲームオーバー画面のシーンを複製するところから作業を始める。では下記の手順でスタート画面のシーンを作成しよう。</p><ol><li>ファイルシステムで「res://UI/GameOver/GameOver.tscn」を右クリック＞「複製」を選択する。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img1.png alt=GameOver.tscnを複製></li><li>シーンの名前を「GameStart.tscn」とする。</li><li>ファイルシステムで「res://UI/」で右クリック＞「新規フォルダー」を選択し、フォルダーの名前を「GameStart」とする。</li><li>「res://UI/GameStart」に「GameStart.tscn」をドラッグして移動する<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img3.png alt=GameStartフォルダ作成></li></ol><br><h2 id=シーンツリーを編集する>シーンツリーを編集する</h2><p>「GameOver.tscn」から複製したばかりの「GameStart.tscn」を開いてみよう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img4.png alt=GameStartシーンツリー複製直後></p><p>見ての通り、「GameOver」シーンそのままの状態だ。これを以下の手順でスタート画面仕様に修正していく。</p><ol><li>「GameOver」ルートノードの名前を「GameStart」に変更する。</li><li>「GameStart」ノードを右クリック＞「スクリプトをデタッチ」する。</li><li>「GameOverLabel」ノードの名前を「TitleLabel」に変更する。</li><li>「RestartVBox」ノードの名前を「StartVBox」に変更する。</li><li>「RestartButton」ノードの名前を「StartButton」に変更する。</li><li>「RestartLabel」ノードの名前を「StartLabel」に変更する。</li><li>「StartVBox」ブランチを「ButtonsHBox」ノードから出して「VBoxContainer」の子にする（1階層上げる）</li><li>「ButtonsHBox」ブランチを削除する。</li><li>「ColorRect」ノードを削除する。</li><li>「ConfirmationDialog」ノードを削除する。</li><li>新たに「GameStart」ルートノードに「AnimationPlayer」ノードを追加する。</li></ol><p>以上の作業でシーンツリーは以下のスクリーンショットのようになったはずだ。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img5.png alt=GameStartシーンツリー修正後></p><p>最後に「StartButton」ノードの「button_up()」シグナルを切断しておこう。</p><p>続いて、各ノードのプロパティを更新していく。</p><br><h2 id=各ノードのプロパティを編集する>各ノードのプロパティを編集する</h2><p>各ノードのプロパティの値も、シーンの複製元である「GameOver.tscn」の状態のままなのでスタート画面仕様に修正していく。シーンツリーの上から順番にやっていこう。</p><br><h3 id=gamestart>GameStart</h3><p>「Pause Mode」プロパティは、「GameOver」シーンの名残で「Process」のままになっているので、「Inherit」にしておく。その他のプロパティも編集は不要だ。</p><br><h3 id=texturerect>TextureRect</h3><p>「Texture」プロパティに割り当てるテクスチャ画像を差し替えて、ゲームオーバー画面と差別化する。ファイルシステムドックから「res://Assets/Background/Pink.png」をドラッグ&ドロップして適用する。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img8.png alt=Textureプロパティ></p><br><h3 id=vboxcontainer>VBoxContainer</h3><p>このノードのプロパティは編集不要だ。</p><br><h3 id=titlelabel>TitleLabel</h3><p>スタート画面は、ゲーム開始時に最初に表示される画面なので、ゲームのタイトルを大きめに表示させたい。また、文字の見た目も色を変えたりアウトラインをつけるなどして、ゲームオーバー画面と差別化する。</p><ol><li>「Text」プロパティに以下のゲームタイトルの文字列（改行あり）を入力する（あなたの好きなタイトルにしていただいて問題ない）。<br>platformer<br>tutorial</li><li>「Theme Overrides」＞「Fonts」＞「Font」で「新規 DynamicFont」を選択する。</li><li>「Font」＞「Settings」＞「Size」プロパティを 48 にする。</li><li>「Font」＞「Settings」＞「Outline Size」プロパティを 5 にする。</li><li>「Font」＞「Settings」＞「Outline Color」プロパティで色を # 302e3e （濃いグレー）にする。</li><li>「Font」＞「Font」＞「Font Data」に「res://fonts/connection_ii/ConnectionII.otf」を適用する。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img10.png alt=TitleLabelプロパティ></li><li>「Visibility」＞「Modulate」プロパティで色を # 7ec8ff（水色）にする。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img11.png alt=TitleLabelプロパティ></li></ol><br><h3 id=startvbox>StartVBox</h3><p>このノードのプロパティは編集不要だ。</p><br><h3 id=startbutton>StartButton</h3><p>ボタンのアイコンをゲームプレイを開始するイメージに近いテクスチャ画像に差し替える。</p><ol><li>「Textures」＞「Normal」プロパティにファイルシステムドックから「res://Assets/Menu/Buttons/Play.png」をドラッグ&ドロップして画像を差し替える。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img13.png alt=StartButtonプロパティ></li></ol><br><h3 id=startlabel>StartLabel</h3><p>ボタンアイコンの説明書きがゲームオーバー画面仕様の「RESTART」になっているので「START」に更新する。</p><ol><li>「Text」プロパティに「press space or enter key」と入力する。</li></ol><br><h3 id=animationplayer>AnimationPlayer</h3><p>このノードは「Start」ボタンを押した時に、少し凹んだようなアニメーションを作るために用いる。インスペクターのプロパティはそのままで良い。</p><p>新規アニメーションを以下の内容で作成しよう。</p><ul><li>アニメーション名: press_start</li><li>アニメーションの長さ(秒): 0.1</li><li>アニメーションループ: 無効</li><li>トラック：<ul><li>「StartButton」ノード ＞「modulate」プロパティ<ul><li>Time: 0秒 / Value: # ffffff / Easing: 1.00</li><li>Time: 0.05秒 / Value: # c8c8c8 / Easing: 1.00</li><li>Time: 0.1秒 / Value: # ffffff / Easing: 1.00</li></ul></li><li>「StartButton」ノード ＞「rect_scale」プロパティ<ul><li>Time: 0秒 / Value: (1, 1) / Easing: 1.00</li><li>Time: 0.05秒 / Value: (0.9, 0.9) / Easing: 1.00</li><li>Time: 0秒 / Value: (1, 1) / Easing: 1.00</li></ul></li></ul></li></ul><br><p>以上で、スタート画面のプロパティ編集作業は完了だ。一からシーンを作るよりは省エネで作業を終えられたのではないだろうか。ちなみに、シーンの見た目は以下のようになったはずだ。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img18.png alt=GameStartシーンを実行></p><br><h2 id=スクリプトをアタッチして編集する>スクリプトをアタッチして編集する</h2><p>続いて、スタート画面上のボタンをプレイヤーがクリックした時の動作をスクリプトで制御していく。</p><p>「GameStart」ルートノードに新しいスクリプトをアタッチする。この時、スクリプトのファイルパスを「res://UI/GameStart/GameStart.gd」として作成する。</p><p>スクリプトエディタで「GameStart.gd」スクリプトが開いたら、以下のように編集する。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>Control</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># StartButton ノードの参照</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>start_button</span> <span class=o>=</span> <span class=nx>$VBoxContainer/StartVBox/StartButton</span>
</span></span><span class=line><span class=cl><span class=c1># AnimationPlayer ノードの参照</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>anim_player</span> <span class=o>=</span> <span class=nx>$AnimationPlayer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=c1># ゲーム開始時にアニメーションで変更されるプロパティを初期化</span>
</span></span><span class=line><span class=cl>	<span class=n>start_button</span><span class=o>.</span><span class=n>modulate</span> <span class=o>=</span> <span class=nc>Color</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>start_button</span><span class=o>.</span><span class=n>rect_scale</span> <span class=o>=</span> <span class=nc>Vector2</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></div><br><p>次にシグナルを接続しよう。「StartButton」ノードの「button_up()」シグナルを「GameStart.gd」スクリプトに接続する。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img19.png alt=button_up()シグナル></p><p>スクリプトに<code>_on_StartButton_button_up</code>メソッドが生成されたら、以下のように編集する。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Start ボタンをクリックした時のシグナルで呼ばれるメソッド</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_StartButton_button_up</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=c1># デバッグ用</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;_on_StartButton_button_up called.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1># AnimationPlayer の press_start アニメーションを再生</span>
</span></span><span class=line><span class=cl>	<span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;press_start&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1># アニメーションが終わるまで待機</span>
</span></span><span class=line><span class=cl>	<span class=k>yield</span><span class=p>(</span><span class=n>anim_player</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1># このノードを解放（削除）する</span>
</span></span><span class=line><span class=cl>	<span class=nf>queue_free</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=c1># デバッグ用</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;GameStart scene is now freed.&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>Start ボタンを押したら、次のプレイヤーキャラクター選択画面に遷移させる予定なので、この時点で「GameStart」シーンは用済みなので<code>queue_free</code>メソッドで解放している。</p><br><p>最後にキー入力での制御を実装しておく。インプットマップにデフォルトで登録されているアクション「ui_accept」に該当するスペースキー、またはエンターキーを押した時に、さっきシグナル接続で生成された<code>_on_StartButton_button_up</code>を実行するようにした。これでマウスでもキーボードでも同じ結果が得られるようになった。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_input</span><span class=p>(</span><span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=c1># スペースキーかエンターキーが押された場合</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_pressed</span><span class=p>(</span><span class=s2>&#34;ui_accept&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=c1># スタートボタンが押された時のメソッドを呼ぶ</span>
</span></span><span class=line><span class=cl>		<span class=nf>_on_StartButton_button_up</span><span class=p>()</span>
</span></span></code></pre></div><br><p>「GameStart」シーンの作成はこれで完成なので、最後にシーンを実行して挙動を確認しておこう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img20.gif alt=GameStartシーンを実行></p><p>スタートボタンを押すと、ルートノードが解放されて何もノードが存在しない状態になるので、グレーの画面が表示されるのは正常な動作だ。なお、GIF画像ではアニメーションが若干不自然だが、実際にはもう少し短い時間で自然にアニメーションするはずだ。</p><br><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=プレイヤーキャラクターの種類を増やす>プレイヤーキャラクターの種類を増やす</h1><p>ファイルシステムドックをご覧いただくと「res://Assets/Main Characters/」フォルダの中に4種類のプレイヤーキャラクターのアセットが見つかるだろう。ここまでのチュートリアルでは、4種類のうち「Pink Man」のスプライトシートのみを使ってきたが、ここで4種類全てのアセットを使用する時がきた。</p><p>とはいえ、4種類のプレイヤーキャラクターのシーンを作る必要はなく、「Player」シーン＞「AnimatedSprite」ノード＞「Frames」プロパティに適用する「SpriteFrames」クラスのリソースファイルを4種類作成するだけで良い。つまり、キャラクター選択時に、「AnimatedSprite」ノードのテクスチャだけ差し替える、という作戦だ。</p><p>（おさらいも兼ねて）事前確認として「Pink Man」以外のスプライトシートのアセットファイルにもしブラーがかかっていたら（ぼやけた感じがしたら）、ファイルシステムドックでファイルを選択して、インポートドックから「プリセット」＞「2D Pixel」を選択して「再インポート」をクリックしておこう。これでドット絵特有のエッジが効いた表示に更新される。</p><p>では順番にやっていこう。</p><br><h2 id=spriteframes-リソースを作成する>SpriteFrames リソースを作成する</h2><h3 id=pinkman>PinkMan</h3><p>ほぼ作業不要の「PinkMan」から「SpriteFrames」クラスのリソースファイルを作成する。</p><ol><li>「Player.tscn」を開く。</li><li>「AnimatedSprite」ノードの「Frames」プロパティの値になっている「SpriteFrames」を右クリック＞「保存」を選択する。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img21.png alt=リソースを保存></li><li>ファイルパスが「res://Player/PinkMan.tres」になるようにファイル名を「PinkMan.tres」として保存する。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img22.png alt=リソースを保存></li></ol><p>PinkMan の場合はすでにアニメーションフレームが作成済みなので、リソースファイル作成はこれで完了だ。</p><br><h3 id=maskdude>MaskDude</h3><p>次は「MaskDude」のリソースファイルを作成する。</p><ol><li>ファイルシステムドックで、先に作成したPinkManのリソース「res://Player/PinkMan.tres」を右クリック＞「複製」を選択する。</li><li>ファイル名を「MaskDude.tres」とする。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img23.png alt=tresファイルを複製></li><li>ファイルシステムドックで作成した「MaskDude.tres」をダブルクリックしてスプライトフレームパネルを開く。</li><li>登録しているアニメーションを上から一つ選択する。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img25.png alt=アニメーション選択></li><li>既存のアニメーションフレームを全て削除する。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img26.gif alt=アニメーションフレームの削除></li><li>スプライトシートアイコンをクリックする。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img27.png alt=スプライトシートアイコン></li><li>適切なスプライトシートのファイルを選択し、アニメーションフレームに反映すればOK。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img28.png alt=スプライトシートの選択と割り当て></li><li>次のアニメーションを選択して同様の作業を行う。全てのアニメーションのアニメーションフレームが更新できたら、リソースファイルの作成は完了とする。</li></ol><br><h3 id=ninjafrog>NinjaFrog</h3><p>作業は「MaskDude」シーンと同様だ。リソースのファイル名はもちろん「NinjaFrog.tres」にして保存する。</p><br><h3 id=virtualguy>VirtualGuy</h3><p>こちらも作業は「MaskDude」シーンと同様だ。リソースのファイル名はもちろん「VirtualGuy.tres」にして保存する。</p><p>「VirtualGuy.tres」の編集が終われば、プレイヤーキャラクター4種類のリソースファイルの完成だ。ここらで一度休憩を入れよう。</p><br><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=プレイヤーキャラクター選択画面を作る>プレイヤーキャラクター選択画面を作る</h1><p>さて、ここからはプレイヤーキャラクターを選択する画面のシーンを作っていく。画面の仕様は以下のようにする。</p><ul><li>画面上部にプレイヤーキャラクターの名前を表示する。</li><li>画面中央にプレイヤーキャラクターのビジュアル（テクスチャ）をアニメーション付きで表示する。</li><li>キーボードの左右矢印キーか画面に表示されている矢印ボタンをクリックでキャラクターを切り替える。</li><li>キーボードのスペースキーまたはエンターキーでキャラクターを選択したらゲームプレイ開始。</li></ul><p>では例によって、シーンを作成するところから始めよう。</p><br><h2 id=シーンを作る-1>シーンを作る</h2><p>以下の手順でプレイヤーキャラクター選択用のシーンを作っていく。</p><ol><li>「シーン」メニュー＞「新規シーン」を選択する。</li><li>「ルートノードの生成」で「ユーザーインターフェース」を選択して、「Control」クラスを選択する。</li><li>「Control」ルートノードが生成されたら、名前を「CharacterSelect」に変更する。</li><li>「res://UI」フォルダーに「CharacterSelect」フォルダーを新規作成し、ファイルパスを「res://UI/CharacterSelect/CharacterSelect.tscn」としてシーンを保存する。</li></ol><br><h2 id=必要なノードを追加する>必要なノードを追加する</h2><p>続いて、作成した「CharacterSelect」シーンに必要なノードを追加していこう。</p><ol><li>「CharacterSelect」ルートノードに「TextureRect」ノードを追加する。</li><li>「CharacterSelect」ルートノードに「VBoxContainer」ノードを追加する。</li><li>「VBoxContainer」ノードに「Label」ノードを追加し、名前を「CharacterName」に変更する。</li><li>「VBoxContainer」ノードに「HBoxContainer」ノードを追加する。</li><li>「HBoxContainer」ノードに、「TextureButton」ノードを 2 つ追加し、それぞれの名前を「LeftButton」、「RightButton」に変更する。</li><li>「VBoxContainer」ノードに「Label」ノードを追加し、名前を「Caption」に変更する。</li><li>「CharacterSelect」ノードに「AnimatedSprite」ノードを追加する。</li><li>「CharacterSelect」ノードに「AnimationPlayer」ノードを追加する。</li></ol><p>ここまででシーンツリーは以下のようになったはずだ。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img29.png alt=スプライトシートの選択と割り当て></p><br><h2 id=各ノードのプロパティを編集する-1>各ノードのプロパティを編集する</h2><p>次に、インスペクターで各ノードのプロパティを編集して、プレイヤーキャラクター選択画面をデザインしていこう。</p><br><h3 id=characterselect>CharacterSelect</h3><p>このルートノードは子ノードの入れ物として利用する。</p><ol><li>2Dワークスペースのツールバー＞「レイアウト」から「Rect全面」を選択して、ノードのサイズを前画面サイズに揃える。</li></ol><br><h3 id=texturerect-1>TextureRect</h3><p>このノードは背景用に利用する。</p><ol><li>2Dワークスペースのツールバー＞「レイアウト」から「Rect全面」を選択して、画面全体に広げる。</li><li>「Texture」プロパティに、ファイルシステムから「res://Assets/Background/Yellow.png」をドラッグ&ドロップして適用する。</li><li>「Stretch Mode」プロパティを「Tile」にする。</li></ol><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img30.png alt=TextureRectプロパティ編集後></p><br><h3 id=vboxcontainer-1>VBoxContainer</h3><p>このノードはプレイヤーキャラクター選択画面に表示されるキャラクター名やキャラクターのスプライト、選択ボタン、操作説明を縦に整列させるためのコンテナとして利用するだけなので、プロパティの編集は少ない。</p><ol><li>2Dワークスペースのツールバー＞「レイアウト」から「Rect全面」を選択して、ノードのサイズを前画面サイズに揃える。</li><li>インスペクターで「Alignment」を「Center」にする。</li><li>「Theme Overrides」＞「Constants」＞「Separation」ノードを 48 にする。</li></ol><br><h3 id=charactername>CharacterName</h3><p>このノードは、現在選択しているキャラクターの名前を表示するのに利用する。表示位置は画面の上部中央になる予定だが、他のノードの設定がまだなので現時点では中央にされる。後から徐々に意図した形になるはずなので、位置はそのままにしておくこと。</p><ol><li>インスペクターで「Text」プロパティは仮に「Mask Dude」と入力する。</li><li>「Align」プロパティを「Center」にする。</li><li>「Theme Overrides」＞「Fonts」＞「Font」で「新規 DynamicFont」を選択する。</li><li>「Font」＞「Settings」＞「Size」プロパティを 32 にする。</li><li>「Font」＞「Settings」＞「Outline Size」プロパティを 5 にする。</li><li>「Font」＞「Settings」＞「Outline Color」プロパティで色を # 302e3e （濃いグレー）にする。</li><li>「Font」＞「Font」＞「Font Data」に「res://fonts/connection_ii/ConnectionII.otf」を適用する。</li></ol><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img31.png alt=CharacterNameプロパティ編集後></p><br><h3 id=hboxcontainer>HBoxContainer</h3><p>このノードは水平方向に子ノードを横並びに配置するコンテナだ。左右の矢印ボタンアイコンを子ノードに持つので、それを横並びに配置する。またその左右の矢印ボタンの間に、プレイヤーキャラクターのスプライトを表示させたいので、ボタンとボタンの間をたっぷり目に空けておく必要がある。</p><ol><li>インスペクターで「Alignment」プロパティを「Center」にする。</li><li>「Theme Overrides」＞「Constants」＞「Separation」ノードを 156 にする。</li></ol><br><h3 id=leftbutton>LeftButton</h3><p>このノードは「TextureRect」クラスなので、ボタンにテクスチャ画像を割り当てることができる。名前の通り、左向き矢印ボタンを作るのに利用する。</p><ol><li>インスペクターで「Expand」プロパティをオンにする。</li><li>「Stretch Mode」プロパティを「Keep Aspect Centered」にする。</li><li>「Textures」＞「Normal」プロパティに、ファイルシステムドックから「res://Assets/Menu/Buttons/Previous.png」をドラッグ&ドロップして適用する。</li><li>「Control」クラスの「Rect」＞「Min Size」プロパティを (42, 40) にする。</li></ol><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img32.png alt=LeftButtonプロパティ編集後></p><br><h3 id=rightbutton>RightButton</h3><p>このノードも「LeftButton」同様に「TextureRect」クラスで、右向き矢印ボタンを作るのに利用する。</p><ol><li>インスペクターで「Expand」プロパティをオンにする。</li><li>「Stretch Mode」プロパティを「Keep Aspect Centered」にする。</li><li>「Textures」＞「Normal」プロパティに、ファイルシステムドックから「res://Assets/Menu/Buttons/Next.png」をドラッグ&ドロップして適用する。</li><li>「Control」クラスの「Rect」＞「Min Size」プロパティを (42, 40) にする。</li></ol><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img33.png alt=RightButtonプロパティ編集後></p><br><h3 id=caption>Caption</h3><p>このノードは、単なる「Label」クラスのノードである。プレイヤーキャラクター選択画面での操作説明を画面下部に表示させるために利用する。</p><ol><li>インスペクターで「Text」プロパティに以下の開業を含む文字列を入力する。<br>press left or right key to select a character<br>press enter or space key to confirm</li><li>「Align」プロパティを「Center」にする。</li><li>「Uppercase」プロパティをオンにする。</li><li>「Theme Overrides」＞「Fonts」＞「Font」プロパティに、ファイルシステムドックから「res://fonts/poco/Poco.tres」をドラッグ&ドロップして適用する。<br>*<em>このリソースファイルは他のシーンでも利用しているのでリソースのプロパティはそのままにしておくこと。もし編集したい場合は必ずリソースを「ユニーク化」して他のノードのデザインに影響しないようにすること。</em></li><li>「CanvasItem」クラスの「Visibility」＞「Modulate」プロパティで色を # 000000（黒）にする。</li></ol><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img34.png alt=Captionプロパティ編集後></p><br><h3 id=animatedsprite>AnimatedSprite</h3><p>このノードは、先に作成した 4 種類のプレイヤーキャラクターの「SpriteFrames」クラスのリソースファイルを「Frames」プロパティに適用させて、画面上に実際にキャラクターのスプライトを表示するために利用する。</p><ol><li>インスペクターで「Frames」プロパティに、ファイルシステムドックから先に作った「res://Player/MaskDude.tres」をドラッグ&ドロップして適用させる。最初は「MaskDude」のスプライトで表示させるためだ。</li><li>「Animation」プロパティは「idle」を選択する。これが一番、2Dワークスペース上で位置を把握しやすいはずだ。</li><li>「Position」プロパティは (192, 124) にする。これがちょうど左右のボタンの中間にあたる位置だ。</li></ol><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img35.png alt=AnimatedSpriteプロパティ編集後></p><br><h3 id=animationplayer-1>AnimationPlayer</h3><p>このノードは「LeftButton」と「RightButton」をクリックした時に再生させる、ボタンが凹んだような簡単なアニメーションを作るのに利用する。</p><ol><li>インスペクターでのプロパティ編集は不要だ。</li><li>アニメーションパネルを開く。</li><li>まず左矢印ボタンのアニメーションを作成する。</li></ol><ul><li>アニメーション名: press_left</li><li>アニメーションの長さ(秒): 0.1</li><li>アニメーションループ: 無効</li><li>トラック:<ul><li>「LeftButton」ノード ＞「modulate」プロパティ<ul><li>Time: 0秒 / Value: # ffffff / Easing: 1.00</li><li>Time: 0.05秒 / Value: # c8c8c8 / Easing: 1.00</li><li>Time: 0.1秒 / Value: # ffffff / Easing: 1.00</li></ul></li><li>「LeftButton」ノード ＞「rect_scale」プロパティ<ul><li>Time: 0秒 / Value: (1, 1) / Easing: 1.00</li><li>Time: 0.05秒 / Value: (0.9, 0.9) / Easing: 1.00</li><li>Time: 0.1秒 / Value: (1, 1) / Easing: 1.00</li></ul></li></ul></li></ul><ol><li>次に右矢印ボタンのアニメーションを作成する。トラックのノードが違うこと以外は先に作成した「press_left」アニメーションとほとんど同じだ。</li></ol><ul><li>アニメーション名: press_right</li><li>アニメーションの長さ(秒): 0.1</li><li>アニメーションループ: 無効</li><li>トラック:<ul><li>「RightButton」ノード ＞「modulate」プロパティ<ul><li>Time: 0秒 / Value: # ffffff / Easing: 1.00</li><li>Time: 0.05秒 / Value: # c8c8c8 / Easing: 1.00</li><li>Time: 0.1秒 / Value: # ffffff / Easing: 1.00</li></ul></li><li>「RightButton」ノード ＞「rect_scale」プロパティ<ul><li>Time: 0秒 / Value: (1, 1) / Easing: 1.00</li><li>Time: 0.05秒 / Value: (0.9, 0.9) / Easing: 1.00</li><li>Time: 0.1秒 / Value: (1, 1) / Easing: 1.00</li></ul></li></ul></li></ul><br><hr><h1 id=シングルトンを作る>シングルトンを作る</h1><p>シングルトンというのはプログラミング用語で、インスタンスが1つしかないように設計されたクラスのことで、他の複数のクラスで何らかの共通したプロパティやメソッドを利用する必要がある場合に用いられる。詳しい定義や仕組み、使い方などは、以下のリンク先のリソースをご参照いただきたい。</p><blockquote><p><em><strong><span style=color:salmon>Memo:</span></strong><br><a href=https://ja.wikipedia.org/wiki/Singleton_%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3 target=_blank>Wikipedia - Singleton パターン</a><br><a href=https://docs.godotengine.org/ja/stable/tutorials/scripting/singletons_autoload.html target=_blank>Godot 公式オンラインドキュメント - シングルトン(自動読み込み)</a></em></p></blockquote><p>このチュートリアルでシングルトンを使用する理由は、4種類のプレイヤーキャラクターの「SpriteFrames」のリソースをシングルトンのプロパティとして用意しておけば、「CharacterSelect」シーンの「AnimatedSprite」ノードにも、「Level」シーン＞「Player」＞「AnimatedSprite」ノードにもいつでも利用できるようになるからだ。</p><p>仮に、「CharacterSelect」ノードのプロパティとして「SpriteFrames」のリソースを用意することの弊害が一つある。それは「CharacterSelect」インスタンスノードは用済みになったら「Game」シーンから解放（削除）させる、ということだ。解放してしまうと、リソースの参照先を見失って、プレイヤーキャラクターのスプライトにテクスチャを割り当てることができなくなる。その結果、プレイヤーキャラクターは透明人間状態になってしまう。</p><p>一方、シングルトンのスクリプトで「SpriteFrames」リソースを定義しておけば、他の複数のノードからいつでもそれを参照することができる。</p><br><h2 id=シングルトンのスクリプトを作る>シングルトンのスクリプトを作る</h2><p>説明が長くなったが、ここからは以下の手順でシングルトンを実際に作成していこう。</p><ol><li>ファイルシステムドックで「res://」フォルダを右クリック＞「新規スクリプト」を選択する。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img36.png alt=新規スクリプト作成></li><li>「スクリプト作成」ダイアログが表示されたら、<strong>継承元を必ず「Node」にして</strong>、ファイル名を「Global.gd」として作成する。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img37.png alt=スクリプト作成ダイアログ></li><li>「プロジェクト」メニュー＞「プロジェクト設定」を選択する。</li><li>「自動読み込み（AutoLoad）」タブを開きパス入力欄の右側にあるフォルダアイコンをクリックする（Global.gdのパスを直接打ち込んでも良い）。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img38.png alt=自動読み込みタブ></li><li>「Global.gd」スクリプトを選択して開く。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img39.png alt=global.gd選択></li><li>パス入力欄に「Global.gd」のファイルパスが入ったら右側の「追加」をクリックする。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img40.png alt=追加ボタン></li><li>自動読み込みに追加されたことを確認したら、ウインドウを閉じる。ちなみに「グローバル変数」とは他のどのスクリプトのどのスコープからでもアクセスできる変数のことだが、これを利用したいので有効のままで良い。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img41.png alt=追加後の画面></li></ol><p>以上の作業で、シングルトン「Global.gd」スクリプトがゲーム開始時に一番最初に読み込まれ、常にどのシーンのどのノードのスクリプトからでもシングルトンのプロパティやメソッドにアクセスできるようになった。ゲーム開始時に自動読み込みされる時、自動的に「Node」が作成され、これに「Global.gd」スクリプトがアタッチされる仕組みだ。つまり、このスクリプトに記述するプロパティにアクセスしたければ、この「Node」のプロパティを参照するようコーディングすれば良い。なお、「Node」は自動的にスクリプトと同じ「Global」という名前になるので、簡単にアクセスできる。</p><br><h2 id=シングルトンのスクリプトを編集する>シングルトンのスクリプトを編集する</h2><p>ではシングルトンの「Global.gd」スクリプトを開き、以下のコードを記述しよう。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>Node</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>spriteframes</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>	<span class=nb>preload</span><span class=p>(</span><span class=s2>&#34;res://Player/MaskDude.tres&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=nb>preload</span><span class=p>(</span><span class=s2>&#34;res://Player/NinjaFrog.tres&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=nb>preload</span><span class=p>(</span><span class=s2>&#34;res://Player/PinkMan.tres&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=nb>preload</span><span class=p>(</span><span class=s2>&#34;res://Player/VirtualGuy.tres&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>プリロードされた4種類のプレイヤーキャラクターの「SpriteFrames」リソースを配列にまとめた。これで、プレイヤーキャラクターの4種類のリソースにどこからでも簡単にアクセスできる。</p><br><hr><h1 id=characterselect-にスクリプトをアタッチして編集する>CharacterSelect にスクリプトをアタッチして編集する</h1><p>「CharacterSelect」ノードに新規スクリプトをアタッチしよう。ファイルパスは「res://UI/CharacterSelect/CharacterSelect.gd」となるようにする。</p><p>では作成したシングルトンを利用しつつ、コーディングしていこう。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>Control</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># カスタムシグナル、引数に SpriteFrames リソースの参照を渡す</span>
</span></span><span class=line><span class=cl><span class=kd>signal</span> <span class=nf>character_selected</span><span class=p>(</span><span class=n>sprite_frames</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 現在キャラクター選択中のフラグを立てる（true）</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>is_choosing</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=c1># AnimatedSprite のアニメーションの現在のフレーム番号を保持</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>frames_num</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=c1># キャラクターの名前の配列（要素の順番はシングルトンの SpriteFrames の配列に合わせる）</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>characters</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;Mask Dude&#34;</span><span class=p>,</span> <span class=s2>&#34;Ninja Frog&#34;</span><span class=p>,</span> <span class=s2>&#34;Pink Man&#34;</span><span class=p>,</span> <span class=s2>&#34;Virtual Guy&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># シングルトンのノードの参照</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>global</span> <span class=o>=</span> <span class=nf>get_node</span><span class=p>(</span><span class=s2>&#34;/root/Global&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># CharacterName ノードの参照</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>char_name</span> <span class=o>=</span> <span class=nx>$VBoxContainer/CharacterName</span>
</span></span><span class=line><span class=cl><span class=c1># LeftButton ノードの参照</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>l_button</span> <span class=o>=</span> <span class=nx>$VBoxContainer/HBoxContainer/LeftButton</span>
</span></span><span class=line><span class=cl><span class=c1># RightButton ノードの参照</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>r_button</span> <span class=o>=</span> <span class=nx>$VBoxContainer/HBoxContainer/RightButton</span>
</span></span><span class=line><span class=cl><span class=c1># AnimatedSprite ノードの参照</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sprite</span> <span class=o>=</span> <span class=nx>$AnimatedSprite</span>
</span></span><span class=line><span class=cl><span class=c1># AnimationPlayer ノードの参照</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>anim_player</span> <span class=o>=</span> <span class=nx>$AnimationPlayer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=c1># 以下4行: AnimationPlayer のアニメーションで変更されるプロパティに初期値を設定</span>
</span></span><span class=line><span class=cl>	<span class=n>l_button</span><span class=o>.</span><span class=n>modulate</span> <span class=o>=</span> <span class=nc>Color</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>l_button</span><span class=o>.</span><span class=n>rect_scale</span> <span class=o>=</span> <span class=nc>Vector2</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>r_button</span><span class=o>.</span><span class=n>modulate</span> <span class=o>=</span> <span class=nc>Color</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>r_button</span><span class=o>.</span><span class=n>rect_scale</span> <span class=o>=</span> <span class=nc>Vector2</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1># 以下のメソッドを呼ぶ（この後定義する）</span>
</span></span><span class=line><span class=cl>	<span class=nf>play_animations</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># _ready で呼ばれる: AnimatedSprite のアニメーションを制御する</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>play_animations</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=c1># アニメーションの名前の配列（Array型を指定しないと PoolStringArray 型になる）</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=n>animations</span><span class=p>:</span> <span class=nc>Array</span> <span class=o>=</span> <span class=n>sprite</span><span class=o>.</span><span class=n>frames</span><span class=o>.</span><span class=nf>get_animation_names</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=c1># 現在再生中のアニメーションの上記配列内の順番</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=n>anim_index</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=c1># アニメーションのループ回数をカウントするための変数</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=n>count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>	<span class=c1># デバッグ用</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;animations array is &#34;</span><span class=p>,</span> <span class=n>animations</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=c1># アニメーションの名前の配列から不要な要素を削除するため配列の要素でループ</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=n>anim</span> <span class=ow>in</span> <span class=n>animations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=c1># アニメーションが fall か jump の場合は配列から削除（フレームが1つしかなく面白くないため）</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>anim</span> <span class=o>==</span> <span class=s2>&#34;fall&#34;</span> <span class=ow>or</span> <span class=n>anim</span> <span class=o>==</span> <span class=s2>&#34;jump&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>animations</span><span class=o>.</span><span class=nf>remove</span><span class=p>(</span><span class=n>animations</span><span class=o>.</span><span class=nf>find</span><span class=p>(</span><span class=n>anim</span><span class=p>))</span>
</span></span><span class=line><span class=cl>			<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;removed &#34;</span><span class=p>,</span> <span class=n>anim</span><span class=p>,</span> <span class=s2>&#34; from animations array.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=c1># 現在キャラクター選択中のフラグが立っている間はループする</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span> <span class=n>is_choosing</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=c1># アニメーションの名前の配列から現在の再生中のアニメーションを指定して再生</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=n>animations</span><span class=p>[</span><span class=n>anim_index</span><span class=p>])</span>
</span></span><span class=line><span class=cl>		<span class=c1># 最後のアニメーションフレーム終了まで待機</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>sprite</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=c1># アニメーションを一度停止する</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=nf>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=c1># アニメーションが 4 周するまで while ループ</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>count</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>			<span class=k>continue</span>
</span></span><span class=line><span class=cl>		<span class=c1># アニメーションが 4 周したらカウントを 0 にする</span>
</span></span><span class=line><span class=cl>		<span class=n>count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>		<span class=c1># 現在再生中のアニメーションの番号が、アニメーションの配列の要素数 - 1 より小さい場合は </span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>anim_index</span> <span class=o>&lt;</span> <span class=n>animations</span><span class=o>.</span><span class=nf>size</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=c1># アニメーションの番号に 1　を加えて、次のアニメーションを再生するように仕込む</span>
</span></span><span class=line><span class=cl>			<span class=n>anim_index</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>		<span class=c1># 現在再生中のアニメーションの番号が、アニメーションの配列の要素数 - 1 になったら</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=c1># 全てのアニメーションを再生したので、アニメーションの番号を 0 に戻して、最初のアニメーションに戻る</span>
</span></span><span class=line><span class=cl>			<span class=n>anim_index</span> <span class=o>=</span> <span class=mi>0</span>
</span></span></code></pre></div><p>少しコードが長い印象を持たれたかもしれないが、やっていることは単に「AnimatedSprite」ノードに設定済みのアニメーションを自動的に順次再生させているだけである。アニメーションを4周再生したら、次のアニメーションを再生し、全てのアニメーションを4回ずつ再生したらまた最初のアニメーションの再生から始めるように<code>while</code>ループを利用して制御している。</p><br><p>次はキャラクターを切り替える左右のボタンを押した時の制御を実装する。これにはシグナルを利用する。「LeftButton」ノードおよび「RightButton」ノードの「pressed()」シグナルを今編集している「CharacterSelect.gd」スクリプトに接続しよう。</p><p>接続して自動生成されたメソッドを以下のように編集する。ちなみに左ボタンが逆送り、右ボタンが順送りでキャラクターを切り替えるように実装している。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_LeftButton_pressed</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=c1># AnimationPlayer の press_left アニメーションを再生</span>
</span></span><span class=line><span class=cl>	<span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;press_left&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1># シングルトンの SpriteFrames のリソースの配列から、</span>
</span></span><span class=line><span class=cl>	<span class=c1># 一つ前のキャラクターのものを AnimatedSprite ノードの frames プロパティに適用する</span>
</span></span><span class=line><span class=cl>	<span class=c1># CharacterName の text プロパティにその SpriteFrames に合致したキャラクターの名前を入れる</span>
</span></span><span class=line><span class=cl>	<span class=c1># 今、配列の最初のリソースを適用している時は配列の最後のリソースを適用する</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>frames_num</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>frames_num</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=n>frames</span> <span class=o>=</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=p>[</span><span class=n>frames_num</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>char_name</span><span class=o>.</span><span class=n>text</span> <span class=o>=</span> <span class=n>characters</span><span class=p>[</span><span class=n>frames_num</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=n>frames</span> <span class=o>=</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=p>[</span><span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=o>.</span><span class=nf>size</span><span class=p>()</span> <span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>char_name</span><span class=o>.</span><span class=n>text</span> <span class=o>=</span> <span class=n>characters</span><span class=p>[</span><span class=n>characters</span><span class=o>.</span><span class=nf>size</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>frames_num</span> <span class=o>=</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=o>.</span><span class=nf>size</span><span class=p>()</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_RightButton_pressed</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=c1># AnimationPlayer の press_right アニメーションを再生</span>
</span></span><span class=line><span class=cl>	<span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;press_right&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1># シングルトンの SpriteFrames のリソースの配列から、</span>
</span></span><span class=line><span class=cl>	<span class=c1># 次のキャラクターのものを AnimatedSprite ノードの frames プロパティに適用する</span>
</span></span><span class=line><span class=cl>	<span class=c1># CharacterName の text プロパティにその SpriteFrames に合致したキャラクターの名前を入れる</span>
</span></span><span class=line><span class=cl>	<span class=c1># 今、配列の最後のリソースを適用している時は配列の最初のリソースを適用する</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>frames_num</span> <span class=o>&lt;</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=o>.</span><span class=nf>size</span><span class=p>()</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>frames_num</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=n>frames</span> <span class=o>=</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=p>[</span><span class=n>frames_num</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>char_name</span><span class=o>.</span><span class=n>text</span> <span class=o>=</span> <span class=n>characters</span><span class=p>[</span><span class=n>frames_num</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=n>frames</span> <span class=o>=</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>char_name</span><span class=o>.</span><span class=n>text</span> <span class=o>=</span> <span class=n>characters</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>frames_num</span> <span class=o>=</span> <span class=mi>0</span>
</span></span></code></pre></div><p>キャラクターを切り替える操作のたびに「AnimatedSprite」の「Frames」プロパティに適切な「SpriteFrames」リソースを適用しているが、その時、シングルトンの「Global.gd」スクリプト内の配列<code>spriteframes</code> から当てはまる要素（SpriteFrames リソース）をピックアップして適用している。</p><br><p>最後にキーボードでの入力も受け付けられるようにコードを追加する。<code>_input</code>メソッドは GDScript の組み込み関数で、これを利用してあらゆる入力に対する制御を実装できる。引数の<code>event</code>は「InputEvent」クラスのオブジェクトで、キーボード入力やマウスクリックなどの入力イベントを指す。さまざまなメソッドが用意されているので、非常に便利である。</p><blockquote><p><em><strong><span style=color:salmon>公式オンラインドキュメント:</span></strong><br><a href=https://docs.godotengine.org/ja/stable/tutorials/inputs/inputevent.html target=_blank>Using InputEvent</a><br><a href=https://docs.godotengine.org/ja/stable/classes/class_node.html#class-node-method-input target=_blank>void _input ( InputEvent event ) virtual</a><br><a href="https://docs.godotengine.org/ja/stable/classes/class_inputevent.html?highlight=inputevent" target=_blank>InputEvent</a></em></p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_input</span><span class=p>(</span><span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=c1># 左矢印キーを押したら</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_pressed</span><span class=p>(</span><span class=s2>&#34;ui_left&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=c1># 左ボタンアイコンをクリックした時に呼ばれるメソッドを呼ぶ</span>
</span></span><span class=line><span class=cl>		<span class=nf>_on_LeftButton_pressed</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=c1># 右矢印キーを押したら</span>
</span></span><span class=line><span class=cl>	<span class=k>elif</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_pressed</span><span class=p>(</span><span class=s2>&#34;ui_right&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=c1># 右ボタンアイコンをクリックした時に呼ばれるメソッドを呼ぶ</span>
</span></span><span class=line><span class=cl>		<span class=nf>_on_RightButton_pressed</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=c1># スペースキーかエンターキーを押したら</span>
</span></span><span class=line><span class=cl>	<span class=k>elif</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_released</span><span class=p>(</span><span class=s2>&#34;ui_accept&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=c1># キャラクター選択中のフラグを無効にする</span>
</span></span><span class=line><span class=cl>		<span class=n>is_choosing</span> <span class=o>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>		<span class=nf>emit_signal</span><span class=p>(</span><span class=s2>&#34;character_selected&#34;</span><span class=p>,</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=p>[</span><span class=n>frames_num</span><span class=p>])</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;emitted signal: character_selected&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nf>queue_free</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;CharacterSelect scene is now freed.&#34;</span><span class=p>)</span>
</span></span></code></pre></div><br><p>これで「CharacterSelect」シーンの作成は完了だ。</p><br><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=game-シーンに-gamestart-シーンと-characterselect-シーンのインスタンスを追加する>Game シーンに GameStart シーンと CharacterSelect シーンのインスタンスを追加する</h1><p>それではここまでで作成した「GameStart」シーンと「CharacterSelect」シーンをインスタンス化して「Game」シーンに追加しよう。</p><p>&mldr;といういつもの流れとは少し異なる手順で進める。</p><br><h2 id=game-シーンツリーを整理する>Game シーンツリーを整理する</h2><p>一旦「Game」シーンツリーを整理しよう。</p><p>「Game」シーンに UI 系のブランチが多いと、各ブランチのスクリプトで制御している入力操作が同時に処理されてしまう可能性があり面倒だ。例えばスタート画面でキーボードのスペースキーでキャラクター選択画面に遷移させただけのつもりが、次の画面のキャラクター選択が同時に確定してしまい、キャラクターを選ぶ間もなく一気にゲームプレイ画面に遷移する、というような問題だ。</p><p>スクリプトのコードを工夫すれば対処可能だが、この問題を完全に回避する分かりやす方法は、必要なノード以外をシーンツリー上に存在させないことだ。そこで、最初の画面である「GameStart」シーンのインスタンス、および入力操作の影響を受けない「HUD」シーンのインスタンスのみを「Game」シーンツリーに追加しておき、他のシーンのインスタンスはスクリプトで、必要な時に作成&追加することにする。</p><p>ということで、まずは「Game」シーンで、今回のチュートリアルで作成した「GameStart.tscn」のインスタンスを追加し、前回のチュートリアルで追加済みの「GameOver.tscn」のインスタンスノードを削除しよう。作業後の「Game」シーンツリーは以下のようになる。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img42.png alt=Gameシーンツリー></p><br><h2 id=gamegd-スクリプトを更新する>Game.gd スクリプトを更新する</h2><p>ここから「Game.gd」スクリプトで、不要になったノードを削除したり、必要になったノードを追加したり、選択されたキャラクターの「SpriteFrames」リソースを「Level」ブランチ内のプレイヤーキャラクターに適用したり、という処理を実装していく。若干複雑かもしれないが、頑張ってやっていこう。</p><p>それでは「Game.gd」スクリプトを開いてほしい。そして、まずはプロパティの定義と<code>_ready</code>メソッドまで見ていこう。「# 追加」や「# 削除」とコメントしている行が更新箇所だ。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>Node</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>current_level</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>final_level</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>health</span><span class=p>:</span> <span class=kt>float</span> <span class=o>=</span> <span class=mf>100.0</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>score</span><span class=p>:</span> <span class=kt>int</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>level</span><span class=p>:</span> <span class=nc>Node2D</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>player</span><span class=p>:</span> <span class=n>KinematicBody2D</span>
</span></span><span class=line><span class=cl><span class=c1># 選択されたキャラクターの SpriteFrames リソースの参照用</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>char_frames</span><span class=p>:</span> <span class=nc>SpriteFrames</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl><span class=c1># UI ノードの参照</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>ui_layer</span> <span class=o>=</span> <span class=nx>$UI</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl><span class=c1># GameStart ノードの参照</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>gamestart</span> <span class=o>=</span> <span class=nx>$UI/GameStart</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>hud</span> <span class=o>=</span> <span class=nx>$UI/HUD</span>
</span></span><span class=line><span class=cl><span class=c1>#onready var gameover = $UI/GameOver # Added @ Part 9 # 削除: シーンツリーから削除した</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=c1>#gameover.visible = false # Added @ Part 9 # 削除: シーンツリーから削除した</span>
</span></span><span class=line><span class=cl>	<span class=c1># GameStart ノードが解放された時に発信されるシグナルを _on_GameStart_tree_exited メソッドに接続</span>
</span></span><span class=line><span class=cl>	<span class=n>gamestart</span><span class=o>.</span><span class=nf>connect</span><span class=p>(</span><span class=s2>&#34;tree_exited&#34;</span><span class=p>,</span> <span class=bp>self</span> <span class=p>,</span><span class=s2>&#34;_on_GameStart_tree_exited&#34;</span><span class=p>)</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>	<span class=c1># 以下 4 行：ゲーム開始時に呼ぶ必要がなくなったので別のメソッドへ移動</span>
</span></span><span class=line><span class=cl>	<span class=c1>#add_level()</span>
</span></span><span class=line><span class=cl>	<span class=c1>#hud.update_health(health)</span>
</span></span><span class=line><span class=cl>	<span class=c1>#hud.update_score(score)</span>
</span></span><span class=line><span class=cl>	<span class=c1>#hud.update_level(current_level)</span>
</span></span></code></pre></div><br><p>続いて、先にコード上で接続したシグナル「tree_exited()」の接続先メソッド<code>_on_GameStart_tree_exited</code>を定義しよう。なお、このシグナルは「GameStart」シーンが解放された時に発信される。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_GameStart_tree_exited</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=c1># CharacterSelect ノードのインスタンスを作成</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=n>char_select</span> <span class=o>=</span> <span class=nb>load</span><span class=p>(</span><span class=s2>&#34;res://UI/CharacterSelect/CharacterSelect.tscn&#34;</span><span class=p>)</span><span class=o>.</span><span class=nf>instance</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=c1># CharacterSelect ノードの character_selected カスタムシグナルを _on_CharacterSelect_character_selected メソッドに接続</span>
</span></span><span class=line><span class=cl>	<span class=n>char_select</span><span class=o>.</span><span class=nf>connect</span><span class=p>(</span><span class=s2>&#34;character_selected&#34;</span><span class=p>,</span> <span class=bp>self</span> <span class=p>,</span><span class=s2>&#34;_on_CharacterSelect_character_selected&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1># UI ノードの子として CharacterSelect インスタンスノードを追加</span>
</span></span><span class=line><span class=cl>	<span class=n>ui_layer</span><span class=o>.</span><span class=nf>add_child</span><span class=p>(</span><span class=n>char_select</span><span class=p>)</span>
</span></span></code></pre></div><br><p>さらに、今しがた「CharacterSelect」ノードから「character_selected」シグナルを接続した<code>_on_CharacterSelect_character_selected</code>メソッドを編集していく。ちなみにこのシグナルは、キャラクター選択が確定したら発信される。このシグナルは自作したシグナルで、引数<code>sprite_frames</code>を持っている。これを接続先のメソッドの引数に渡す格好だ。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_CharacterSelect_character_selected</span><span class=p>(</span><span class=n>sprite_frames</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=c1># このスクリプトのプロパティ char_frames に選択したキャラクターの SpriteFrames リソースを渡す</span>
</span></span><span class=line><span class=cl>	<span class=n>char_frames</span> <span class=o>=</span> <span class=n>sprite_frames</span>
</span></span><span class=line><span class=cl>	<span class=c1># 以下 4 行： _ready メソッドからこちらに移動させた</span>
</span></span><span class=line><span class=cl>	<span class=nf>add_level</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=n>hud</span><span class=o>.</span><span class=nf>update_health</span><span class=p>(</span><span class=n>health</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>hud</span><span class=o>.</span><span class=nf>update_score</span><span class=p>(</span><span class=n>score</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>hud</span><span class=o>.</span><span class=nf>update_level</span><span class=p>(</span><span class=n>current_level</span><span class=p>)</span>
</span></span></code></pre></div><p>「CharacterSelect.gd」スクリプトでは、「character_selected」シグナル発信後、まもなく「CharacterSelect」ノードは解放される。ここでシングルトンを作成したおかげで、<code>char_frames</code>プロパティは「CharacterSelect」ノードからバトンパスされたかのように、シングルトンの「SpriteFrames」リソースを参照した状態になる。</p><p>キャラクター選択画面の次はゲームプレイの開始となるので、もともと<code>_ready</code>メソッドで実行していた<code>add_level</code>メソッドでの「Level」シーンのインスタンス追加や「HUD」ノードの各コンポーネントの初期設定メソッドをこのタイミングで実行させている。</p><br><p>ここで<code>add_level</code>メソッドに大事な 1 行を加えることを忘れてはいけない。「Level」ノード＞「Player」ノード＞「AnimatedSprite」ノードの「Frames」プロパティに、キャラクター選択画面で選択したキャラクターの「SpriteFrames」リソースを適用するための 1 行だ。これにより、ゲームプレイ画面のプレイヤーキャラクターが、キャラクター選択画面で選んだキャラクターと同じ見た目になるわけだ。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>func</span> <span class=nf>add_level</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>level</span> <span class=o>=</span> <span class=nb>load</span><span class=p>(</span><span class=s2>&#34;res://Levels/Level&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>current_level</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;.tscn&#34;</span><span class=p>)</span><span class=o>.</span><span class=nf>instance</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=n>level</span><span class=o>.</span><span class=nf>connect</span><span class=p>(</span><span class=s2>&#34;tree_exited&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=s2>&#34;change_level&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>level</span><span class=o>.</span><span class=nf>connect</span><span class=p>(</span><span class=s2>&#34;player_dropped&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=s2>&#34;_on_Level_player_dropped&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>call_deferred</span><span class=p>(</span><span class=s2>&#34;add_child&#34;</span><span class=p>,</span> <span class=n>level</span><span class=p>)</span> <span class=c1># エラー解消のため修正</span>
</span></span><span class=line><span class=cl>	<span class=n>player</span> <span class=o>=</span> <span class=n>level</span><span class=o>.</span><span class=nf>get_node</span><span class=p>(</span><span class=s2>&#34;Player&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>player</span><span class=o>.</span><span class=nf>connect</span><span class=p>(</span><span class=s2>&#34;enemy_hit&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=s2>&#34;_on_Player_enemy_hit&#34;</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>	<span class=n>player</span><span class=o>.</span><span class=nf>connect</span><span class=p>(</span><span class=s2>&#34;item_hit&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=s2>&#34;_on_Player_item_hit&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1># Player ノードの子 AnimatedSprite ノードに選択したキャラクターの SpriteFrames リソースを適用</span>
</span></span><span class=line><span class=cl>	<span class=n>player</span><span class=o>.</span><span class=nf>get_node</span><span class=p>(</span><span class=s2>&#34;AnimatedSprite&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>frames</span> <span class=o>=</span> <span class=n>char_frames</span> <span class=c1># 追加</span>
</span></span></code></pre></div><br><p>このあと<code>manage_health</code>メソッドまでのコードは今までと変わりない。<code>manage_health</code>メソッドの変更内容を見ていこう。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1># 中略</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>manage_health</span><span class=p>(</span><span class=n>damage</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>health</span> <span class=o>-=</span> <span class=n>damage</span> <span class=c1># Moved from _on_Player_enemy_hit()</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Health updated: &#34;</span><span class=p>,</span> <span class=n>health</span><span class=p>)</span> <span class=c1># Moved from _on_Player_enemy_hit()</span>
</span></span><span class=line><span class=cl>	<span class=n>hud</span><span class=o>.</span><span class=nf>update_health</span><span class=p>(</span><span class=n>health</span><span class=p>)</span> <span class=c1># Moved from _on_Player_enemy_hit()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>health</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>player</span><span class=o>.</span><span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;die&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>player</span><span class=o>.</span><span class=n>anim_player</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=c1>#gameover.visible = true # 削除: シーンツリーから削除しているため不要</span>
</span></span><span class=line><span class=cl>		<span class=c1># GameOver シーンをインスタンス化</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=n>gameover</span> <span class=o>=</span> <span class=nb>load</span><span class=p>(</span><span class=s2>&#34;res://UI/GameOver/GameOver.tscn&#34;</span><span class=p>)</span><span class=o>.</span><span class=nf>instance</span><span class=p>()</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>		<span class=c1># UI ノードに GameOver シーンのインスタンスノードを追加</span>
</span></span><span class=line><span class=cl>		<span class=n>ui_layer</span><span class=o>.</span><span class=nf>add_child</span><span class=p>(</span><span class=n>gameover</span><span class=p>)</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Game over screen is shown up.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nf>get_tree</span><span class=p>()</span><span class=o>.</span><span class=n>paused</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Scene tree paused: &#34;</span><span class=p>,</span> <span class=nf>get_tree</span><span class=p>()</span><span class=o>.</span><span class=n>paused</span><span class=p>)</span>
</span></span></code></pre></div><p>これまでは「GameOver」シーンのインスタンスは最初から「Game」シーンツリーに追加してあったが、さっき削除したので、<code>visible</code>プロパティの有効化は不要となった。反対に「GameOver」シーンのインスタンスをスクリプト上で追加する必要があるので、そのためのコードを追加した。インスタンスを子ノードにする作業はたった 2 行のコードで実装できるのだ。（子ノードの順番の入れ替えが必要な場合はもう1行必要だ）。</p><br><p>以上で「Game.gd」スクリプトの編集は完了だ。</p><p>最後にプロジェクトを実行して、今回作成した「GameStart」シーンと「CharacterSelect」シーンがプロジェクトの中でうまく動作するか確認しておこう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_10/img43.gif alt=プロジェクトを実行></p><br><p>以下のポイントで問題なさそうなので、ここで今回の作業を終えよう。</p><ul><li>最初にスタート画面が表示された。</li><li>スペースキーを押すとプレイヤーキャラクター選択画面が表示された。</li><li>プレイヤーキャラクター選択画面で、マウスでの左右ボタンの操作、キーボードでの左右矢印キーの操作によって、キャラクターの名前とスプライトの見た目が順番に切り替わった。</li><li>プレイヤーキャラクター選択画面でキャラクターはアニメーションし続けた。</li><li>プレイヤーキャラクター選択画面でスペースキーを押すとゲームプレイ画面に遷移した。</li><li>ゲームプレイ画面にはプレイヤーキャラクター選択画面で最後に選択したキャラクターが登場した。</li></ul><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=part-10-で編集したスクリプトのコード>Part 10 で編集したスクリプトのコード</h1><p>最後に今回の Part 10 で編集したスクリプトのコードを共有しておくので、必要に応じて確認してほしい。</p><details><summary>GameStart.gd の全コード</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>Control</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>start_button</span> <span class=o>=</span> <span class=nx>$VBoxContainer/StartVBox/StartButton</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>anim_player</span> <span class=o>=</span> <span class=nx>$AnimationPlayer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>start_button</span><span class=o>.</span><span class=n>modulate</span> <span class=o>=</span> <span class=nc>Color</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>start_button</span><span class=o>.</span><span class=n>rect_scale</span> <span class=o>=</span> <span class=nc>Vector2</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_StartButton_button_up</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=c1>#print(&#34;_on_StartButton_button_up called.&#34;)</span>
</span></span><span class=line><span class=cl>	<span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;press_start&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>yield</span><span class=p>(</span><span class=n>anim_player</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>queue_free</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;GameStart scene is now freed.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_input</span><span class=p>(</span><span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_released</span><span class=p>(</span><span class=s2>&#34;ui_accept&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=nf>_on_StartButton_button_up</span><span class=p>()</span>
</span></span></code></pre></div></details><br><details><summary>CharacterSelect.gd の全コード</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>Control</span>  <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>signal</span> <span class=nf>character_selected</span><span class=p>(</span><span class=n>sprite_frames</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>is_choosing</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>frames_num</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>characters</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;Mask Dude&#34;</span><span class=p>,</span> <span class=s2>&#34;Ninja Frog&#34;</span><span class=p>,</span> <span class=s2>&#34;Pink Man&#34;</span><span class=p>,</span> <span class=s2>&#34;Virtual Guy&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>global</span> <span class=o>=</span> <span class=nf>get_node</span><span class=p>(</span><span class=s2>&#34;/root/Global&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>char_name</span> <span class=o>=</span> <span class=nx>$VBoxContainer/CharacterName</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>l_button</span> <span class=o>=</span> <span class=nx>$VBoxContainer/HBoxContainer/LeftButton</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>r_button</span> <span class=o>=</span> <span class=nx>$VBoxContainer/HBoxContainer/RightButton</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sprite</span> <span class=o>=</span> <span class=nx>$AnimatedSprite</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>anim_player</span> <span class=o>=</span> <span class=nx>$AnimationPlayer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>l_button</span><span class=o>.</span><span class=n>modulate</span> <span class=o>=</span> <span class=nc>Color</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>l_button</span><span class=o>.</span><span class=n>rect_scale</span> <span class=o>=</span> <span class=nc>Vector2</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>r_button</span><span class=o>.</span><span class=n>modulate</span> <span class=o>=</span> <span class=nc>Color</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>r_button</span><span class=o>.</span><span class=n>rect_scale</span> <span class=o>=</span> <span class=nc>Vector2</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>play_animations</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>play_animations</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=n>animations</span><span class=p>:</span> <span class=nc>Array</span> <span class=o>=</span> <span class=n>sprite</span><span class=o>.</span><span class=n>frames</span><span class=o>.</span><span class=nf>get_animation_names</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=n>anim_index</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=n>count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>	<span class=c1>#print(&#34;animations array is &#34;, animations)</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=n>anim</span> <span class=ow>in</span> <span class=n>animations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>anim</span> <span class=o>==</span> <span class=s2>&#34;fall&#34;</span> <span class=ow>or</span> <span class=n>anim</span> <span class=o>==</span> <span class=s2>&#34;jump&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>animations</span><span class=o>.</span><span class=nf>remove</span><span class=p>(</span><span class=n>animations</span><span class=o>.</span><span class=nf>find</span><span class=p>(</span><span class=n>anim</span><span class=p>))</span>
</span></span><span class=line><span class=cl>			<span class=c1>#print(&#34;removed &#34;, anim, &#34; from animations array.&#34;)</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=k>while</span> <span class=n>is_choosing</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=n>animations</span><span class=p>[</span><span class=n>anim_index</span><span class=p>])</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>sprite</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=nf>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>count</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>			<span class=k>continue</span>	
</span></span><span class=line><span class=cl>		<span class=n>count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>anim_index</span> <span class=o>&lt;</span> <span class=n>animations</span><span class=o>.</span><span class=nf>size</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>anim_index</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>anim_index</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_LeftButton_pressed</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;press_left&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>frames_num</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>frames_num</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=n>frames</span> <span class=o>=</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=p>[</span><span class=n>frames_num</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>char_name</span><span class=o>.</span><span class=n>text</span> <span class=o>=</span> <span class=n>characters</span><span class=p>[</span><span class=n>frames_num</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=n>frames</span> <span class=o>=</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=p>[</span><span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=o>.</span><span class=nf>size</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>char_name</span><span class=o>.</span><span class=n>text</span> <span class=o>=</span> <span class=n>characters</span><span class=p>[</span><span class=n>characters</span><span class=o>.</span><span class=nf>size</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>frames_num</span> <span class=o>=</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=o>.</span><span class=nf>size</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_RightButton_pressed</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;press_right&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>frames_num</span> <span class=o>&lt;</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=o>.</span><span class=nf>size</span><span class=p>()</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>frames_num</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=n>frames</span> <span class=o>=</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=p>[</span><span class=n>frames_num</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>char_name</span><span class=o>.</span><span class=n>text</span> <span class=o>=</span> <span class=n>characters</span><span class=p>[</span><span class=n>frames_num</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=n>frames</span> <span class=o>=</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>char_name</span><span class=o>.</span><span class=n>text</span> <span class=o>=</span> <span class=n>characters</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>frames_num</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_input</span><span class=p>(</span><span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_pressed</span><span class=p>(</span><span class=s2>&#34;ui_left&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=nf>_on_LeftButton_pressed</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>elif</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_pressed</span><span class=p>(</span><span class=s2>&#34;ui_right&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=nf>_on_RightButton_pressed</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>elif</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_released</span><span class=p>(</span><span class=s2>&#34;ui_accept&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=n>is_choosing</span> <span class=o>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>		<span class=nf>emit_signal</span><span class=p>(</span><span class=s2>&#34;character_selected&#34;</span><span class=p>,</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=p>[</span><span class=n>frames_num</span><span class=p>])</span>
</span></span><span class=line><span class=cl>		<span class=c1>#print(&#34;emitted signal: character_selected&#34;)</span>
</span></span><span class=line><span class=cl>		<span class=nf>queue_free</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;CharacterSelect scene is now freed.&#34;</span><span class=p>)</span>
</span></span></code></pre></div></details><br><details><summary>Global.gd の全コード</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>Node</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>spriteframes</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>	<span class=nb>preload</span><span class=p>(</span><span class=s2>&#34;res://Player/MaskDude.tres&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=nb>preload</span><span class=p>(</span><span class=s2>&#34;res://Player/NinjaFrog.tres&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=nb>preload</span><span class=p>(</span><span class=s2>&#34;res://Player/PinkMan.tres&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=nb>preload</span><span class=p>(</span><span class=s2>&#34;res://Player/VirtualGuy.tres&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div></details><br><details><summary>Game.gd の全コード</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>Node</span> <span class=c1># Added @ Part 7</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>current_level</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>final_level</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>health</span><span class=p>:</span> <span class=kt>float</span> <span class=o>=</span> <span class=mf>100.0</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>score</span><span class=p>:</span> <span class=kt>int</span> <span class=o>=</span> <span class=mi>0</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>level</span><span class=p>:</span> <span class=nc>Node2D</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>player</span><span class=p>:</span> <span class=n>KinematicBody2D</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>char_frames</span><span class=p>:</span> <span class=nc>SpriteFrames</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>ui_layer</span> <span class=o>=</span> <span class=nx>$UI</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>gamestart</span> <span class=o>=</span> <span class=nx>$UI/GameStart</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>hud</span> <span class=o>=</span> <span class=nx>$UI/HUD</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl><span class=c1>#onready var gameover = $UI/GameOver # Added @ Part 9 # Removed @ Part 10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=c1>#gameover.visible = false # Added @ Part 9 # Removed @ Part 10</span>
</span></span><span class=line><span class=cl>	<span class=n>gamestart</span><span class=o>.</span><span class=nf>connect</span><span class=p>(</span><span class=s2>&#34;tree_exited&#34;</span><span class=p>,</span> <span class=bp>self</span> <span class=p>,</span><span class=s2>&#34;_on_GameStart_tree_exited&#34;</span><span class=p>)</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_GameStart_tree_exited</span><span class=p>():</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=n>char_select</span> <span class=o>=</span> <span class=nb>load</span><span class=p>(</span><span class=s2>&#34;res://UI/CharacterSelect/CharacterSelect.tscn&#34;</span><span class=p>)</span><span class=o>.</span><span class=nf>instance</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=n>char_select</span><span class=o>.</span><span class=nf>connect</span><span class=p>(</span><span class=s2>&#34;character_selected&#34;</span><span class=p>,</span> <span class=bp>self</span> <span class=p>,</span><span class=s2>&#34;_on_CharacterSelect_character_selected&#34;</span><span class=p>)</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>	<span class=n>ui_layer</span><span class=o>.</span><span class=nf>add_child</span><span class=p>(</span><span class=n>char_select</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_CharacterSelect_character_selected</span><span class=p>(</span><span class=n>sprite_frames</span><span class=p>):</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>	<span class=n>char_frames</span> <span class=o>=</span> <span class=n>sprite_frames</span>
</span></span><span class=line><span class=cl>	<span class=nf>add_level</span><span class=p>()</span> <span class=c1># Moved @ Part 10 # Modified @ Part 10</span>
</span></span><span class=line><span class=cl>	<span class=n>hud</span><span class=o>.</span><span class=nf>update_health</span><span class=p>(</span><span class=n>health</span><span class=p>)</span> <span class=c1># Added @ Part 8 # Moved @ Part 10</span>
</span></span><span class=line><span class=cl>	<span class=n>hud</span><span class=o>.</span><span class=nf>update_score</span><span class=p>(</span><span class=n>score</span><span class=p>)</span> <span class=c1># Added @ Part 8 # Moved @ Part 10</span>
</span></span><span class=line><span class=cl>	<span class=n>hud</span><span class=o>.</span><span class=nf>update_level</span><span class=p>(</span><span class=n>current_level</span><span class=p>)</span> <span class=c1># Added @ Part 8 # Moved @ Part 10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>add_level</span><span class=p>():</span> <span class=c1># Modified @ Part 10</span>
</span></span><span class=line><span class=cl>	<span class=n>level</span> <span class=o>=</span> <span class=nb>load</span><span class=p>(</span><span class=s2>&#34;res://Levels/Level&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>current_level</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;.tscn&#34;</span><span class=p>)</span><span class=o>.</span><span class=nf>instance</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=n>level</span><span class=o>.</span><span class=nf>connect</span><span class=p>(</span><span class=s2>&#34;tree_exited&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=s2>&#34;change_level&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>level</span><span class=o>.</span><span class=nf>connect</span><span class=p>(</span><span class=s2>&#34;player_dropped&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=s2>&#34;_on_Level_player_dropped&#34;</span><span class=p>)</span> <span class=c1># Added @ Part 9</span>
</span></span><span class=line><span class=cl>	<span class=nf>call_deferred</span><span class=p>(</span><span class=s2>&#34;add_child&#34;</span><span class=p>,</span> <span class=n>level</span><span class=p>)</span> <span class=c1># Fixed error</span>
</span></span><span class=line><span class=cl>	<span class=n>player</span> <span class=o>=</span> <span class=n>level</span><span class=o>.</span><span class=nf>get_node</span><span class=p>(</span><span class=s2>&#34;Player&#34;</span><span class=p>)</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl>	<span class=n>player</span><span class=o>.</span><span class=nf>connect</span><span class=p>(</span><span class=s2>&#34;enemy_hit&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=s2>&#34;_on_Player_enemy_hit&#34;</span><span class=p>)</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl>	<span class=n>player</span><span class=o>.</span><span class=nf>connect</span><span class=p>(</span><span class=s2>&#34;item_hit&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=s2>&#34;_on_Player_item_hit&#34;</span><span class=p>)</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl>	<span class=n>player</span><span class=o>.</span><span class=nf>get_node</span><span class=p>(</span><span class=s2>&#34;AnimatedSprite&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>frames</span> <span class=o>=</span> <span class=n>char_frames</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>change_level</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nf>get_tree</span><span class=p>():</span> <span class=c1># Added @ Part 9</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;change_level() called.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>current_level</span> <span class=o>&lt;</span> <span class=n>final_level</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;change to next level.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=n>level</span><span class=o>.</span><span class=nf>queue_free</span><span class=p>()</span>
</span></span><span class=line><span class=cl>			<span class=n>current_level</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>			<span class=n>hud</span><span class=o>.</span><span class=nf>update_level</span><span class=p>(</span><span class=n>current_level</span><span class=p>)</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl>			<span class=nf>add_level</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Game Clear! Congrats!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=nf>get_tree</span><span class=p>()</span><span class=o>.</span><span class=nf>quit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_Player_enemy_hit</span><span class=p>(</span><span class=n>damage</span><span class=p>):</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl>	<span class=nf>manage_health</span><span class=p>(</span><span class=n>damage</span><span class=p>)</span> <span class=c1># Modified @ Part 9</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_Player_item_hit</span><span class=p>(</span><span class=n>point</span><span class=p>):</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl>	<span class=n>score</span> <span class=o>+=</span> <span class=n>point</span>
</span></span><span class=line><span class=cl>	<span class=n>hud</span><span class=o>.</span><span class=nf>update_score</span><span class=p>(</span><span class=n>score</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_Level_player_dropped</span><span class=p>():</span> <span class=c1># Added @ Part 9</span>
</span></span><span class=line><span class=cl>	<span class=nf>manage_health</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>manage_health</span><span class=p>(</span><span class=n>damage</span><span class=p>):</span> <span class=c1># Added @ Part 9</span>
</span></span><span class=line><span class=cl>	<span class=n>health</span> <span class=o>-=</span> <span class=n>damage</span> <span class=c1># Moved from _on_Player_enemy_hit() @ Part 9</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Health updated: &#34;</span><span class=p>,</span> <span class=n>health</span><span class=p>)</span> <span class=c1># Moved from _on_Player_enemy_hit() @ Part 9</span>
</span></span><span class=line><span class=cl>	<span class=n>hud</span><span class=o>.</span><span class=nf>update_health</span><span class=p>(</span><span class=n>health</span><span class=p>)</span> <span class=c1># Moved from _on_Player_enemy_hit() @ Part 9</span>
</span></span><span class=line><span class=cl>	<span class=c1># Added @ Part 9</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>health</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>player</span><span class=o>.</span><span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;die&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>player</span><span class=o>.</span><span class=n>anim_player</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=c1>#gameover.visible = true # Removed @ Part 10</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=n>gameover</span> <span class=o>=</span> <span class=nb>load</span><span class=p>(</span><span class=s2>&#34;res://UI/GameOver/GameOver.tscn&#34;</span><span class=p>)</span><span class=o>.</span><span class=nf>instance</span><span class=p>()</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>		<span class=n>ui_layer</span><span class=o>.</span><span class=nf>add_child</span><span class=p>(</span><span class=n>gameover</span><span class=p>)</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Game over screen is shown up.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nf>get_tree</span><span class=p>()</span><span class=o>.</span><span class=n>paused</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Scene tree paused: &#34;</span><span class=p>,</span> <span class=nf>get_tree</span><span class=p>()</span><span class=o>.</span><span class=n>paused</span><span class=p>)</span>
</span></span></code></pre></div></details><br><hr><h1 id=おわりに>おわりに</h1><p>以上で Part 10 は完了だ。</p><p>今回はゲームスタート画面とその次のプレイヤーキャラクター選択画面を実装した。スタート画面に比べて、キャラクター選択画面の方は難しく感じられたかもしれない。シングルトンという何やら聞き慣れない単語も出てきたが、複数のシーンで同じデータにアクセスしたい時などに非常に有効な手段であると実感いただけたなら幸いだ。ゲーム開発に限らず、あらゆるオブジェクト指向プログラミングで多用されるデザインパターンなので、知っておいて損はないだろう。</p><p>さて、次回のチュートリアルでは、ゲームプレイ画面に背景テクスチャを追加し、カメラが移動するときに近景のタイルマップは早く動き、遠景の背景テクスチャはゆっくり動く、といういわゆるパララックスエフェクト（視差効果）を実装して、ユーザーエクスペリエンスを高めてみよう。</p><p>では次回もお楽しみに。</p><hr></div><footer class=post-footer><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！ on x" href="https://x.com/intent/tweet/?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2010%ef%bc%9a%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_10%2f&amp;hashtags=GodotEngine%2cGameDev%2c2D%2c%e3%82%a2%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e3%82%b2%e3%83%bc%e3%83%a0%2c%e6%a8%aa%e3%82%b9%e3%82%af%e3%83%ad%e3%83%bc%e3%83%ab%2c%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%2c%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e7%94%bb%e9%9d%a2%2c%e3%82%ad%e3%83%a3%e3%83%a9%e3%82%af%e3%82%bf%e3%83%bc%e9%81%b8%e6%8a%9e"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！ on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_10%2f&title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2010%ef%bc%9a%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 10：スタート画面を作ろう！ on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_10%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li></ul><ul class=post-tags><li><a href=https://www.peanuts-code.com/ja/tags/godotengine/>GodotEngine</a></li><li><a href=https://www.peanuts-code.com/ja/tags/gamedev/>GameDev</a></li><li><a href=https://www.peanuts-code.com/ja/tags/2d/>2D</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B2%E3%83%BC%E3%83%A0/>アクションゲーム</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E6%A8%AA%E3%82%B9%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%AB/>横スクロール</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%BC/>プラットフォーマー</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%88%E7%94%BB%E9%9D%A2/>スタート画面</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BF%E3%83%BC%E9%81%B8%E6%8A%9E/>キャラクター選択</a></li></ul><nav class=paginav><a class=prev href=https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_11/><span class=title>« 前へ</span><br><span>Godot で作るプラットフォーマー Part 11：背景を作ろう！</span>
</a><a class=next href=https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_9/><span class=title>次へ »</span><br><span>Godot で作るプラットフォーマー Part 9：ゲームオーバーの仕組みを作ろう！</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://www.peanuts-code.com/ja/>Peanuts Code</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="コピー";function s(){t.innerHTML="コピーされました!",setTimeout(()=>{t.innerHTML="コピー"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>