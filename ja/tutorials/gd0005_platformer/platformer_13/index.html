<!doctype html><html lang=ja dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Godot で作るプラットフォーマー Part 13：サウンドを追加しよう！ | Peanuts Code</title>
<meta name=keywords content="GodotEngine,GameDev,2D,アクションゲーム,横スクロール,プラットフォーマー,BGM,サウンドエフェクト"><meta name=description content="第13回目の今回は、ゲームにサウンドを追加する。ゲームに使われるサウンドというのは、大きく分けて2種類ある。バックグラウンドミュージック（BGM）と効果音（サウンドエフェクト：SFX）だ。Godot Engine ではどちらも追加する方法に大きな違いはない。素材さえ用意すれば、追加するのは比較的簡単だ。特定のタイミングでサウンドを鳴らしたい時、例えば、プレイヤーキャラクターがジャンプした時にジャンプの効果音を鳴らしたい場合などには、プログラミングして制御する必要があるが、複雑なコードにはならないので安心してほしい。"><meta name=author content="gobo"><link rel=canonical href=https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_13/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.peanuts-code.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.peanuts-code.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.peanuts-code.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.peanuts-code.com/apple-touch-icon.png><link rel=mask-icon href=https://www.peanuts-code.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ja href=https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_13/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Godot で作るプラットフォーマー Part 13：サウンドを追加しよう！"><meta property="og:description" content="第13回目の今回は、ゲームにサウンドを追加する。ゲームに使われるサウンドというのは、大きく分けて2種類ある。バックグラウンドミュージック（BGM）と効果音（サウンドエフェクト：SFX）だ。Godot Engine ではどちらも追加する方法に大きな違いはない。素材さえ用意すれば、追加するのは比較的簡単だ。特定のタイミングでサウンドを鳴らしたい時、例えば、プレイヤーキャラクターがジャンプした時にジャンプの効果音を鳴らしたい場合などには、プログラミングして制御する必要があるが、複雑なコードにはならないので安心してほしい。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_13/"><meta property="og:image" content="https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_13/img0.gif"><meta property="article:section" content="tutorials"><meta property="article:published_time" content="2022-04-08T19:42:19+09:00"><meta property="article:modified_time" content="2022-04-16T00:00:00+00:00"><meta property="og:site_name" content="Peanuts Code 🥜"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_13/img0.gif"><meta name=twitter:title content="Godot で作るプラットフォーマー Part 13：サウンドを追加しよう！"><meta name=twitter:description content="第13回目の今回は、ゲームにサウンドを追加する。ゲームに使われるサウンドというのは、大きく分けて2種類ある。バックグラウンドミュージック（BGM）と効果音（サウンドエフェクト：SFX）だ。Godot Engine ではどちらも追加する方法に大きな違いはない。素材さえ用意すれば、追加するのは比較的簡単だ。特定のタイミングでサウンドを鳴らしたい時、例えば、プレイヤーキャラクターがジャンプした時にジャンプの効果音を鳴らしたい場合などには、プログラミングして制御する必要があるが、複雑なコードにはならないので安心してほしい。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"🤖 チュート","item":"https://www.peanuts-code.com/ja/tutorials/"},{"@type":"ListItem","position":2,"name":"🤖 シリーズ：Godot で作るプラットフォーマー","item":"https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/"},{"@type":"ListItem","position":3,"name":"Godot で作るプラットフォーマー Part 13：サウンドを追加しよう！","item":"https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_13/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Godot で作るプラットフォーマー Part 13：サウンドを追加しよう！","name":"Godot で作るプラットフォーマー Part 13：サウンドを追加しよう！","description":"第13回目の今回は、ゲームにサウンドを追加する。ゲームに使われるサウンドというのは、大きく分けて2種類ある。バックグラウンドミュージック（BGM）と効果音（サウンドエフェクト：SFX）だ。Godot Engine ではどちらも追加する方法に大きな違いはない。素材さえ用意すれば、追加するのは比較的簡単だ。特定のタイミングでサウンドを鳴らしたい時、例えば、プレイヤーキャラクターがジャンプした時にジャンプの効果音を鳴らしたい場合などには、プログラミングして制御する必要があるが、複雑なコードにはならないので安心してほしい。\n","keywords":["GodotEngine","GameDev","2D","アクションゲーム","横スクロール","プラットフォーマー","BGM","サウンドエフェクト"],"articleBody":"第13回目の今回は、ゲームにサウンドを追加する。ゲームに使われるサウンドというのは、大きく分けて2種類ある。バックグラウンドミュージック（BGM）と効果音（サウンドエフェクト：SFX）だ。Godot Engine ではどちらも追加する方法に大きな違いはない。素材さえ用意すれば、追加するのは比較的簡単だ。特定のタイミングでサウンドを鳴らしたい時、例えば、プレイヤーキャラクターがジャンプした時にジャンプの効果音を鳴らしたい場合などには、プログラミングして制御する必要があるが、複雑なコードにはならないので安心してほしい。\n今回のチュートリアルには GIF 画像ではなく mp4 フォーマットの動画を載せている。この記事の閲覧環境は様々だと思われるため、デフォルトではサウンドをミュートしている。動画のコントローラでミュート解除していただきつつ、確認いただきたい。\nMemo： 過去のシリーズをまだご覧になっていない方は、そちらを先にご覧いただくことをおすすめします。\nGodot で作るプラットフォーマー 以下の公式オンラインドキュメントのページに、サウンド関係のリンクがまとまっている。今回このチュートリアルで扱う内容以外の有益な情報も含まれるので、併せて目を通していただくとよりわかりやすいだろう。\n公式オンラインドキュメント： オーディオ サウンドの素材を準備する サウンドの素材をファイルシステムに追加する ゲームにサウンドを追加するには、まずサウンドの素材を用意する必要がある。ご自身で作曲する場合もあれば、アセットストアなどで誰かが作曲したものをダウンロードする場合もあるだろう。\n今回はチュートリアル用に音源ファイルを用意しているので、以下のリンクから「Audio.zip」をダウンロードしてほしい。\nDownload Asset: Dropboxの共有フォルダ ＞ Audio.zip ダウンロードできたら、.zip ファイルを展開して中の「Audio」フォルダを取り出してほしい。プロジェクトのファイルシステムドックで「res://Assets/」フォルダを選択した状態にし、そのフォルダ目掛けて「Audio」フォルダごとドラッグ\u0026ドロップで追加しよう。\nなお、2022/04/06 以降に Part 1 でアセットをダウンロードされた方は、Godot のファイルシステムの「res://Assets/」のフォルダに各種オーディオファイルを格納した「Audio」フォルダが最初から入っているはずだ。\nBGM 用の素材のループ設定を調整する SFX は、特定のタイミングで都度、一回サウンドを鳴らすだけだが、BGM に関しては曲が最後まで終わったらまた頭から再生する、つまりループさせる必要がある。\n.ogg や .mp3 フォーマットのリソースだと、デフォルトでループの設定が有効になっており、.wav フォーマットだとループは無効になっているようだ。\nゲームのサウンドに関しては一般的に、BGM 用の曲は長いので、ファイルサイズの関係から、圧縮した .ogg または .mp3 が推奨されている。一方、SFX 用のサウンドは短いので、非圧縮形式の .wav フォーマットであることが多い。ループのデフォルトの設定は、この背景に由来する仕様だと考えられる。\n先ほど追加していただいたこのチュートリアル用のサウンド素材についても、BGM 用は .ogg フォーマット、SFX 用は .wav フォーマットにしているので、どれがどっちの素材かはファイル名の拡張子を見ればすぐに判別していただけるだろう。\n具体的に、それぞれのサウンド素材のループの設定を確認する手順は以下の通りだ。\nファイルシステムドックで音源ファイルを選択する\nそのままインポートドックでループの設定を確認する BGM 用 .ogg ファイルの場合：\nSFX 用 .wav ファイルの場合：\nもしループの設定がおかしい（BGM 用なのにループが無効、または SFX 用なのにループが有効）場合は、ループの設定のチェックを切り替えて、「再インポート」ボタンをクリックすれば、設定が変更された状態で素材ファイルが再インポートされる。\n公式オンラインドキュメント： オーディオサンプルのインポート ところで、今回インポートしていただいた素材のうち、BGM 用のサウンド素材で 1 つだけループ開始位置を編集する必要がある。「Level1」シーンで使用する予定の「Land.ogg」だ。イントロは初回のみ再生され、それ以降ループされて再生位置が前に戻るときは、曲の頭ではなくイントロ部分を省いた位置から再生されるようにしたい。これも Godot エディタ上で調整できる。以下の手順で実際に編集しよう。\nファイルシステムドックで「res://Assets/Audio/Land.ogg」を選択し、インポートドックを開く 「Loop Offset」のパラメータをイントロが終わる秒数「9.142」に設定して、「再インポート」ボタンをクリック\nちなみに、今後、ご自身で作曲される場合に役立つのでループ開始位置の計算方法もお伝えしておく。\nまず曲全体の長さを確認する。Godot エディタ上で確認する場合は、ファイルシステムで該当のファイルをダブルクリックすると、インスペクターにファイルの情報が表示される。この時、一番右下に表示されている秒数が曲の長さだ。「Land.ogg」の場合は 32.00 秒となっている（単位の s は seconds の略）。\n「曲の長さ」÷「曲全体の小節数」=「1小節の長さ」が求められる。 「1小節の長さ」×「イントロの小節数」でイントロの長さが求められる。 「Land.ogg」の場合「曲全体の小節数」は 28 小節「イントロの小節数」は 8 小節なので\n32.00 ÷ 28 × 8 = 9.142…\nと、割り切れない場合は、小数点以下第3位までで切り捨て、または小数点以下第4位で四捨五入する。0.001秒の差はほとんど気にならないからどちらでも大丈夫だ。 さて、これでサウンド素材の下準備は完了だ。ここからの全体的な作業の流れとしては、先にゲームのパーツになる SFX のみ必要なシーン（「Player」や「Item」など）から編集し、そのあと画面を構成する大きなシーン（「GameStart」や「Level1」など）に BGM、SFX を追加していく。\nシーンごとの作業は以下の順番で進めていこう。\nノードの追加 ノードのプロパティの編集 スクリプトのアタッチ＆コーディング Player シーン それではまずはじめに「Player.tscn」を開いてサウンドを追加していこう。このシーンに必要な SFX は、以下の4種類だ。\nプレイヤーキャラクターの足音 プレイヤーキャラクターがジャンプする音 プレイヤーキャラクターが敵に当たってダメージを受けた時の音 プレイヤーキャラクターのヘルスがゼロになった時の音 AudioStreamPlayer2D ノードを追加する 「Player」ルートノードに「AudioStreamPlayer2D」クラスのノードを4つ追加して、それぞれ「StepSFX」「JumpSFX」「DamageSFX」「DieSFX」という名前にそれぞれ変更しよう。これらのノードは先述した 4 つの効果音ごとに分けて利用する。\nなお、「AudioStreamPlayer」は位置に関係なくサウンドを再生するが、「AudioStreamPlayer2D」は画面上の位置を利用して、カメラとの距離が遠ければ音量を小さくするなどできる。このチュートリアルではその辺りの細かな演出をする機会はないが、画面上に配置するオブジェクトのシーンであれば「AudioStreamPlayer2D」を利用するという認識を持っておいて良いだろう。\n公式オンラインドキュメント： AudioStreamPlayer2D AudioStreamPlayer AudioStreamPlayer2D ノードを編集する 以下のノードとリソースの組み合わせで、それぞれのノードの「Stream」プロパティに適切なサウンドリソースを適用しよう。ファイルシステムドックから下記のリソースファイルをインスペクター上の「Stream」プロパティめがけてドラッグ\u0026ドロップする。\n「StepSFX」ノード：res://Assets/Audio/FootStep.wav 「JumpSFX」ノード：res://Assets/Audio/Jump.wav 「DamageSFX」ノード：res://Assets/Audio/TakeDamage.wav 「DieSFX」ノード：res://Assets/Audio/Die.wav この「Player」シーンを含めて、基本的に「Stream」プロパティ以外の編集が不要なシーンが多いが、音量が大きすぎる、または小さすぎると感じる場合は、適宜「Volume Db」プロパティの値で調整して欲しい。音量の確認は「Stream」プロパティの適用済みリソースをクリックし、インスペクター下部の再生/停止ボタンを利用するのが良いだろう。\nスクリプトを編集して SFX の再生を制御する 「Player.gd」スクリプトを編集してサウンド再生を制御する。\nまずは以下の 4 つの「AudioStreamPlayer2D」ノードを参照するプロパティを定義する。\nonready var step_sfx = $StepSFX # 追加 onready var jump_sfx = $JumpSFX # 追加 onready var damage_sfx = $DamageSFX # 追加 onready var die_sfx = $DieSFX # 追加 足音 まずはプレイヤーキャラクターが走っている時の足音から追加しよう。\n「StepSFX」のサウンドは、「AnimatedSprite」ノードの「run」アニメーションでキャラクターのテクスチャの足が地面についたタイミングでだけ再生したい。アニメーションを確認すると、Frame 4 と 10 がそれに該当することがわかる。\nこれを実現するには、Frame が変わるたびに発信されるシグナルを利用し、if構文で「run」アニメーション再生時の Frame の数を指定すれば良い。\nさっそくシグナルの接続を行おう。「AnimatedSprite」ノードの「frame_changed()」シグナルを「Player.gd」スクリプトに接続すればOKだ。\nスクリプトに_on_AnimatedSprite_frame_changedメソッドが追加されたら、それを以下のように編集しよう。\nfunc _on_AnimatedSprite_frame_changed(): if sprite.animation == \"run\": if sprite.frame == 4 or sprite.frame == 10: step_sfx.play() これで足音の SFX が追加できたはずだ。「Level1」シーンで確認してみよう。\nYour browser does not support the video tag. ジャンプする音 次はプレイヤーキャラクターがジャンプした時の音を追加する。これには_physics_processメソッド内でジャンプを制御しているコードの箇所にサウンド再生のコードを追加すれば良い。以下のコードの「# 追加」のコメントがあるたった 1 行が更新箇所だ。\nfunc _physics_process(delta): velocity.y += gravity * delta var x_input = Input.get_action_strength(\"move_right\") - Input.get_action_strength(\"move_left\") if x_input != 0: velocity.x += x_input * acceleration if Input.is_action_pressed(\"dash\"): velocity.x = clamp(velocity.x, -max_dash_speed, max_dash_speed) else: velocity.x = clamp(velocity.x, -max_speed, max_speed) sprite.flip_h = x_input \u003c 0 if is_on_floor(): if x_input == 0: sprite.play(\"idle\") velocity.x = lerp(velocity.x, 0, friction) else: sprite.play(\"run\") if Input.is_action_just_pressed(\"jump\"): sprite.play(\"jump\") velocity.y = -jump_force # JumpSFXノードのサウンドを再生する（ジャンプ音） jump_sfx.play() # 追加 else: if x_input == 0: velocity.x = lerp(velocity.x, 0, air_resistance) if Input.is_action_just_released(\"jump\") and velocity.y \u003c -jump_force / 2: velocity.y = -jump_force / 2 velocity = move_and_slide(velocity, Vector2.UP) # Added @ Part 3 if position.x \u003c 16: position.x = 16 「Level1」シーンで確認してみよう。\nYour browser does not support the video tag. 敵に当たってダメージを受けた時の音 続いて、プレイヤーキャラクターが敵キャラクターに当たってダメージを受けた時のサウンド再生を制御する。これは既存の_on_HitBox_body_enteredメソッドにサウンド再生のコードを少し足すだけだ。このメソッドは「HitBox」ノードのコリジョン形状に敵キャラクターを含む物理ボディが当たったら呼ばれる。\n# HitBox ノードのコリジョン形状に物理ボディが当たった時に呼ばれるメソッド func _on_HitBox_body_entered(body): if body.is_in_group(\"Enemies\"): print(\"Enemy hit player. Damage is \", body.damage) emit_signal(\"enemy_hit\", body.damage) sprite.play(\"hit\") # DamageSFX ノードのサウンドを再生する damage_sfx.play() # 追加 「Level1」シーンで確認してみよう。\nYour browser does not support the video tag. ヘルスがゼロになって死んだ時の音 プレイヤーキャラクターに実装する最後の SFX は死亡した時のサウンドだ。敵に当たるか、画面下へ落下してヘルスバーが 0 になった場合に再生されるようにする。ヘルスバーの制御は「Game.gd」スクリプトの方でやっているので、そちらを編集しよう。\n「Game.gd」スクリプトを開いたらmanage_healthメソッドに 1 行追加するだけだ。「# 追加」のコメントをしている箇所だ。\nfunc manage_health(damage): health -= damage print(\"Health updated: \", health) hud.update_health(health) if health \u003c= 0: player.anim_player.play(\"die\") # Player インスタンスノードの DieSFX ノードのサウンドを再生 player.die_sfx.play() # 追加 yield(player.anim_player, \"animation_finished\") var gameover = load(\"res://UI/GameOver/GameOver.tscn\").instance() ui_layer.add_child(gameover) print(\"Game over screen is shown up.\") get_tree().paused = true print(\"Scene tree paused: \", get_tree().paused) ヘルスが 0 以下になった時に「die」アニメーションと同時に SFX も再生される。そして、再生が終了するまで待機してからゲームオーバー画面に遷移する。\nでは実際にプロジェクトを実行して挙動を確認しておこう。\nYour browser does not support the video tag. Enemy シーン 続いて敵キャラクターのサウンドを実装する。敵キャラクターのサウンドはプレイヤーキャラクターに踏まれた時の SFX のみだ。では「Enemy.tscn」シーンファイルを開いて編集していこう。\nAudioStreamPlayer2D ノードを追加してプロパティを編集する 「Enemy」ルートノードに「AudioStreamPlayer2D」クラスのノードを 1 つ追加しよう。同じクラスのノードは他にないので、名前はそのままにしておこう。\n「AudioStreamPlayer2D」ノードの「Stream」プロパティに「res://Assets/Audio/HitEnemy.wav」を適用しよう。必要に応じて「Volume Db」プロパティで音量を調整してほしい。\nスクリプトを編集して SFX の再生を制御する 「Enemy.gd」スクリプトを開いて、編集していこう。SFX の再生を制御する。\nまずはこれまで同様、「AudioStreamPlayer2D」ノードを参照するプロパティを定義しよう。\n# AudioStreamPlayer2D ノードの参照 onready var audio_player = $AudioStreamPlayer2D 続けて、プレイヤーキャラクターを含む物理ボディが、「HitBox」のコリジョン形状に入った時に呼ばれる_on_HitBox_body_enteredメソッドを更新する。「# 追加」とコメントしている行が更新箇所だ。\n# 物理ボディが HitBox に入ったら呼ばれるメソッド func _on_HitBox_body_entered(body): if body.is_in_group(\"Players\"): print(\"Player entered in \", self.name) sprite.play(\"hit\") # AudioStreamPlayer2D ノードのサウンドを再生 audio_player.play() # 追加 yield(sprite, \"animation_finished\") # AudioStreamPlayer2D のサウンド再生が終了するまで待機 yield(audio_player, \"finished\") # 追加 queue_free() print(self.name, \" died\") これで、プレイヤーキャラクターが敵キャラクターを踏んづけた時に、SFX が再生され、再生が終了してからqueue_freeメソッドにて敵キャラクターオブジェクトが解放される。\nでは「Level1」シーンを実行して動作確認をしておこう。\nYour browser does not support the video tag. Item シーン 続いてアイテムのサウンドを実装する。アイテムのサウンドはプレイヤーキャラクターが当たった時の SFX のみだ。ちょうどスーパーマリオがコインを取った時の「キラン」という SFX と同様の演出だ。では「Item.tscn」シーンファイルを開いて編集していこう。\nAudioStreamPlayer2D ノードを追加してプロパティを編集する 「Item」ルートノードに「AudioStreamPlayer2D」クラスのノードを1つ追加しよう。同じクラスのノードは他にないので、今回も名前はそのままだ。\n「AudioStreamPlayer2D」ノードの「Stream」プロパティに「res://Assets/Audio/GetItem.wav」を適用しよう。必要に応じて「Volume Db」プロパティで音量を調整しよう。\nスクリプトを編集して SFX の再生を制御する では「Item.gd」スクリプトを編集して SFX を制御していく。\n例によって、まずは「AudioStreamPlayer2D」ノードを参照するプロパティを定義しよう。\n# AudioStreamPlayer2D ノードの参照 onready var audio_player = $AudioStreamPlayer2D # 追加 続けて、プレイヤーキャラクターを含む物理ボディが、「Item」のコリジョン形状に入った時に呼ばれるメソッドを更新する。「# 追加」とコメントしている行が更新箇所だ。\nfunc hit(body): print(\"Got \", point, \" point.\") body.emit_signal(\"item_hit\", point) anim_player.play(\"hit\") # AudioStreamPlayer2D ノードのサウンドを再生する audio_player.play() # 追加 yield(anim_player, \"animation_finished\") # AudioStreamPlayer2D のサウンド再生が終了するまで待機 yield(audio_player, \"finished\") # 追加 queue_free() これで、アイテムを取ったら、SFX が再生されてからアイテムが解放されるようになったはずだ。\nこのまま続けて「BrokenBox」シーンのサウンドも追加していこう。\nBrokenBox シーン アイテムボックスに追加するサウンドは、壊れた時の SFX だ。「ItemBox.tscn」シーンファイルを編集したいところだが、一番簡単なのは、壊れた時に「ItemBox」シーンツリーにそのインスタンスが追加される「BrokenBox.tscn」の方だ。ではこのシーンを開いて編集していこう。\nAudioStreamPlayer2D ノードを追加してプロパティを編集する 「BrokenBox」ルートノードに「AudioStreamPlayer2D」ノードを追加しよう。\n追加した「AudioStreamPlayer2D」ノードにの「Stream」プロパティにリソース「res://Assets/Audio/BreakBox.wav」を適用しよう。\nスクリプトを編集して SFX の再生を制御する 続けて「BrokenBox.gd」スクリプトを以下のように編集する。\nまずは「AudioStreamPlayer2D」ノードを参照するプロパティを定義。\n# AudioStreamPlayer2D ノードの参照 onready var audio_player = $AudioStreamPlayer2D 次に_readyメソッド内にサウンド再生のコードを追加し、シーンが読み込まれたらサウンを再生するようにする。\nfunc _ready(): emitting = true # ノードが読み込まれたら AudioStreamPlayer2D ノードのサウンドを再生 audio_player.play() これで箱が壊れた瞬間にこのシーンが読み込まれ、同時に SFX が再生されるはずだ。\nではアイテムを取った時の音とアイテムボックスが壊れた時の音がそれぞれ正しく再生されるか、「Level1」シーンでまとめて確認してみよう。\nYour browser does not support the video tag. StartPoint シーン スタートポイントはそれぞれのレベルでプレイヤーキャラクターが最初に降り立つ場所に設置している市松模様の台と右向き矢印の標識がテクスチャのシーンだ。市松模様の台の上にコリジョン形状を設定しているので、そこに乗ったら、適当な SFX が鳴るようにする。\nでは「StartPoint.tscn」シーンファイルを開いて編集していこう。\nAudioStreamPlayer ノードを追加してプロパティを編集する 「StartPoint」ルートノードに「AudioStreamPlayer2D」クラスのノードを1つ追加しよう。同じクラスのノードは他にないので、名前はそのままでも良いだろう。\n次に、インスペクタードックで「AudioStreamPlayer2D」ノードのプロパティを編集する。「Stream」プロパティにリソースファイル「res://Assets/Audio/StartPoint.wav」を適用しよう。\nスクリプトを編集して SFX の再生を制御する 「StartPoing.gd」スクリプトを編集してサウンド再生を制御する。\nまずは「AudioStreamPlayer2D」ノードを参照するプロパティを定義する。\n# AudioStreamPlayer2D ノードの参照 onready var audio_player = $AudioStreamPlayer2D # 追加 次に以下のメソッドを更新しよう。「# 追加」のコメントの行が更新箇所だ。\n# 物理ボディが Area2D ノードのコリジョン形状に入ったら呼ばれるメソッド func _on_StartPoint_body_entered(body): if body.name == \"Player\": sprite.play(\"moving\") # AudioStreamPlayer2D ノードのサウンドを再生 audio_player.play() # 追加 これで、スタートポイントの台にプレイヤーキャラクターが乗ったら SFX が再生されるようになったはずだ。\n「Level1」シーンを再生して確認してみよう。\nYour browser does not support the video tag. Checkpoint シーン チェックポイントは、各レベルの真ん中くらいに設置している通過点で、最初はただのポールだが、プレイヤーキャラクターが当たるとポールに市松模様のフラグがつく。これも当たった時に適当な SFX が鳴るようにする。\nでは「Checkpoint.tscn」シーンファイルを開いてサウンドを追加していこう。\nAudioStreamPlayer2D ノードを追加してプロパティを編集する 「Checkpoint」ルートノードに「AudioStreamPlayer2D」クラスのノードを1つ追加しよう。\n続けて「AudioStreamPlayer2D」ノードの「Stream」プロパティにリソース「res://Assets/Audio/Checkpoint.wav」を適用する。\nスクリプトを編集して SFX の再生を制御する 「Checkpoint.gd」スクリプトを編集してサウンド再生を制御する。\nまずは以下のプロパティを追加する。\n# AudioStreamPlayer2D ノードの参照 onready var audio_player = $AudioStreamPlayer2D # 追加 次に以下のメソッドを更新しよう。\n# 物理ボディがコリジョン形状に入ったら呼ばれるメソッド func _on_Checkpoint_body_entered(body): if body.name == \"Player\" and not is_checked: sprite.play(\"flag_out\") # AudioStreamPlayer2D ノードのサウンドを再生 audio_player.play() # 追加 yield(sprite, \"animation_finished\") sprite.play(\"flag_idle\") is_checked = true これで、プレイヤーキャラクターがチェックポイントのフラグに当たると SFX が再生されるはずだ。これも「Level1」シーンで確認してみよう。\nYour browser does not support the video tag. EndPoint シーン エンドポイントは各レベルのゴールとして用意している、優勝カップのようなテクスチャのオブジェクトだ。このカップにプレイヤーキャラクターが入ると次のシーンにワープするような演出のアニメーションが再生される。これに合わせるようにして、ワープっぽい SFX を同時に再生させよう。\nでは「EndPoint.tscn」シーンファイルを開いて編集していく。\nAudioStreamPlayer2D ノードを追加してプロパティを編集する 「EndPoint」ルートノードに「AudioStreamPlayer2D」クラスのノードを1つ追加しよう。\n「AudioStreamPlayer2D」ノードの「Stream」プロパティにリソース「res://Assets/Audio/Warp2.wav」を適用しよう。ただ、ワープ用の SFX リソースを 3 つ用意している。「Warp2.wav」が（個人的には）一番しっくりくるので、このチュートリアルではこれを採用するが、あなたのお好みのものを適用していただければOKだ。\nスクリプトを編集して SFX の再生を制御する 「EndPoint.gd」スクリプトを編集してサウンド再生を制御する。\nまずはこれまで同様「AudioStreamPlayer2D」ノードの参照プロパティを定義する。\n# AudioStreamPlayer2D ノードの参照 onready var audio_player = $AudioStreamPlayer2D # 追加 そして、プレイヤーキャラクターを含む物理ボディが当たったら呼ばれるメソッド内で、サウンドの再生と再生が終了するまで待つコードを追加する。「# 追加」のコメントがある行だ。\n# 物理ボディがコリジョン形状に入ったら呼ばれるメソッド func _on_EndPoint_body_entered(body): if body.name == \"Player\": anim_player.play(\"clear\") yield(anim_player, \"animation_finished\") particle.emitting = true body.anim_player.play(\"clear\") # AudioStreamPlayer2D ノードのサウンドを再生 audio_player.play() # 追加 yield(body.anim_player, \"animation_finished\") # AudioStreamPlayer2D ノードのサウンド再生が終了するまで待機 yield(audio_player, \"finished\") # 追加 print(\"Moving to the next level!\") get_parent().queue_free() これでプレイヤーキャラクターがエンドポイントの優勝カップに入ったら、ワープのアニメーションとともにワープっぽい SFX が再生され、アニメーションとサウンドが終了次第、現在のレベルシーンが解放され、次のレベルシーンに画面遷移する。\n「Level1」シーンで SFX の再生と再生後の「Level1」シーンの解放まで確認しよう。最後までプレイするのが面倒なので、「EndPoint2」インスタンスノードを「Level1」ルートノードに追加してスタートポイント付近に設置してテストするのが手っ取り早い。テストが終わったら追加したインスタンスノードを削除すればOKだ。\nYour browser does not support the video tag. ここまででパーツ的なシーンのサウンド追加作業は完了だ。少し休憩しよう。休憩後は BGM が必要なシーンを順番に編集していく。\nGameStart シーン ここからは BGM の追加が必要なシーンを編集していく。\nまずはスタート画面から編集する。「GameStart.tscn」シーンが読み込まれた瞬間から BGM を流したい。ゲームの一番最初に流れる BGM だ。そして、ゲームを開始するためにスペースキーやエンターキーを押した時に再生される SFX も追加しよう。\nAudioStreamPlayer ノードを追加する 「GameStart」ルートノードに「AudioStreamPlayer」クラスのノードを2つ追加して、それぞれ「BGMPlayer」「SFXPlayer」という名前に変更しよう。その名の通り、BGM を鳴らすためのノードと SFX を鳴らすためのノードを別々で追加した。理由は、後ろで BGM が鳴っている間に効果音を鳴らす必要があるからだ。\nBGMPlayer ノードを編集する 「BGMPlayer」ノードのプロパティを以下の手順で編集していこう。\nインスペクターの「Stream」プロパティへファイルシステムドックから「res://Assets/Audio/TitleScreen.ogg」をドラッグ\u0026ドロップして素材を追加しよう。 最後に「Autoplay」プロパティをオンにしよう。シーンが読み込まれた瞬間からBGM が自動的に再生されるようにするためだ。\nSFXPlayer ノードを編集する 次は「SFXPlayer」ノードのプロパティを同様の手順で編集していこう。\nインスペクターの「Stream」プロパティへファイルシステムドックから「res://Assets/Audio/PressEnter.wav」をドラッグ\u0026ドロップして素材を追加しよう。 もし音量が大きすぎる、または小さすぎると感じる場合は「Volume Db」プロパティの値を調整しよう。 「Autoplay」プロパティは オフ にしておく。SFX の再生のタイミングはスクリプトで制御するからだ。\nスクリプトを編集して SFX の再生を制御する では SFX の再生をスクリプトで制御する。「GameStart.gd」スクリプトを開いて編集していこう。\nまずは「SFXPlayer」ノードを参照するプロパティを追加する。\n# SFXPlayer ノードの参照 onready var sfx_player = $SFXPlayer 続いて_on_StartButton_button_upメソッドを編集する。「# 追加」とコメントしている行が更新した箇所だ。\nfunc _on_StartButton_button_up(): #print(\"_on_StartButton_button_up called.\") anim_player.play(\"press_start\") sfx_player.play() # 追加 yield(anim_player, \"animation_finished\") yield(sfx_player, \"finished\") # 追加 queue_free() print(\"GameStart scene is now freed.\") 「SFXPlayer」ノードのplayメソッドで「Stream」プロパティにセットされている音源を再生する。yield関数により、その SFX の再生が終了するまで待機する。そのあとqueue_freeメソッドによりスタート画面のインスタンスノードが解放される流れだ。\nこれで、スタート画面でスタートボタンをクリック、またはスペースキーまたはエンターキーを押したら、SFX が再生されるようになったはずだ。\nシーンを再生して動作確認をしておこう。下の動画では次の項目を確認している。\nシーンが読み込まれて BGM が自動再生されるか BGM がループ再生されるか スペースキーを押して SFX が再生されるか Your browser does not support the video tag. CharacterSelect シーン 次はプレイヤーキャラクター選択画面だ。\n「CharacterSelect.tscn」シーンでも、画面が読み込まれた瞬間から BGM を流したい。いよいよゲームが始まるぞ、とワクワクする感じのドラムマーチ的な音楽を適用しよう。\n一方、この画面上の操作に合わせて SFX も追加したい。まず必要なのは、左右矢印キー（または画面上のアイコンをクリック）で、キャラクターを切り替える時の SFX 。それに、好きなキャラクターを選んだあと、スペースキーかエンターキーを押して確定させた時の SFX。これはスタート画面と同じ SFX で良いだろう。\nでは「CharacterSelect.tscn」シーンファイルを開いてサウンドを追加していこう。\nAudioStreamPlayer ノードを追加する 「CharacterSelect」ルートノードに「AudioStreamPlayer」クラスのノードを2つ追加して、それぞれ「BGMPlayer」「SFXPlayer」という名前に変更しよう。\nBGMPlayer ノードを編集する 「BGMPlayer」ノードのプロパティを編集する。\nインスペクターの「Stream」プロパティへファイルシステムドックから「res://Assets/Audio/CharacterSelect.ogg」をドラッグ\u0026ドロップして素材を追加する。 必要に応じて、音量を「Volume Db」プロパティの値を上げ下げして調節する。この音源の場合 -5 ~ -10 くらいがちょうど良いかもしれない。 「Autoplay」プロパティをオンにする。 SFXPlayer ノードを編集する 次に「SFXPlayer」ノードのプロパティ編集だが、インスペクターで編集することは特にない。今までリソースファイルを適用していた「Stream」プロパティの値も今回は[空]にしておいて良い。このあとスクリプトで特定のタイミングで適切なリソースファイルを適用するようにコーディングする。\nスクリプトを編集して SFX の再生を制御する では「CharacterSelect.gd」スクリプトを編集して SFX を制御していく。\nまずはプロパティを 2 つ追加する。\n# SFXPlayer ノードの参照 onready var sfx_player = $SFXPlayer # 追加 # SFXPlayer の Stream プロパティに適用する2種類の音源リソースを辞書型データにして定義 onready var sfx_res = { \"select\": preload(\"res://Assets/Audio/PressSelect.wav\"), \"enter\": preload(\"res://Assets/Audio/PressEnter.wav\") } # 追加 まず「SFXPlayer」ノードを参照するプロパティsfx_playerを定義している。\nもう一つのプロパティsfx_resは辞書型データで、2種類の音源リソースファイルのpreloadデータを格納する。sfx_resには左右の矢印キーを押した時のサウンドと確定キー（スペースキー、エンターキー）を押した時のサウンドの2種類が格納されている。それぞれselectおよびonreadyのキーで辞書内の値を呼び出すことができる。\nそして、以下の3つのメソッド内に適切な音源リソースを「SFXPlayer」ノードの「Stream」プロパティに割り当てて、再生するためのコードを追加した。\nfunc _on_LeftButton_pressed(): anim_player.play(\"press_left\") print(sfx_res[\"select\"]) # SFXPlayer ノードの Stream プロパティに res://Assets/Audio/PressSelect.wav を適用 sfx_player.stream = sfx_res[\"select\"] # 追加 # SFXPlayer のサウンドを再生 sfx_player.play() # 追加 if frames_num \u003e 0: # 以下省略 func _on_RightButton_pressed(): anim_player.play(\"press_right\") # SFXPlayer ノードの Stream プロパティに res://Assets/Audio/PressSelect.wav を適用 sfx_player.stream = sfx_res[\"select\"] # 追加 # SFXPlayer のサウンドを再生 sfx_player.play() # 追加 if frames_num \u003c global.spriteframes.size() -1: # 以下省略 unc _input(event): if event.is_action_pressed(\"ui_left\"): _on_LeftButton_pressed() elif event.is_action_pressed(\"ui_right\"): _on_RightButton_pressed() elif event.is_action_released(\"ui_accept\"): is_choosing = false # SFXPlayer ノードの Stream プロパティに res://Assets/Audio/PressEnter.wav を適用 sfx_player.stream = sfx_res[\"enter\"] # 追加 # SFXPlayer のサウンドを再生 sfx_player.play() # 追加 # SFXPlayer ノードのサウンドの再生が終了するまで待機 yield(sfx_player, \"finished\") # 追加 emit_signal(\"character_selected\", global.spriteframes[frames_num]) #print(\"emitted signal: character_selected\") queue_free() print(\"CharacterSelect scene is now freed.\") 「SFXPlayer」ノードは一つだが、スクリプトでサウンドリソースを切り替えることで 2 つの SFX の再生をカバーしている。もちろん、AudioStreamPlayer2D ノードを複数用意してそれぞれに別々のリソースを割り当てても良い。特に今回のチュートリアルのように少ないサウンドリソースしか使わない場合は、ノードを必要数追加する方法の方がわかりやすいかもしれない。もっと大きなプロジェクトで大量の音を扱うことがあれば、シーンツリーをスッキリさせるために、スクリプトで切り替える方法を採用するのも一つだ。\nさて、これで左右矢印ボタンアイコンをクリックまたはキーボードの左右矢印キーを押した時はプレイヤーキャラクターが切り替わると同時に「res://Assets/Audio/PressSelect.wav」を再生し、スペースキーまたはエンターキーを押した時は使用キャラクター確定と同時に「res://Assets/Audio/PressEnter.wav」を再生するようになった。\nそれではシーンを再生して動作確認をしておこう。下の動画では次の項目を確認している。\nシーンが読み込まれて BGM が自動再生されるか BGM がループ再生されるか 左右矢印キーを押してキャラクター選択の SFX が再生されるか スペースキーを押してキャラクター確定の SFX が再生されるか Your browser does not support the video tag. GameOver シーン 続いてゲームオーバー画面のサウンドを追加する。ゲームオーバー画面も表示された瞬間から BGM を流したい。ちょっと暗い残念な感じの曲を長そう。\nSFX としては、以下の 3 種類が必要だ。\nRestart か Quit かを切り替える音（キャラクター選択時と同じで良い） 選択を確定する音（これまでの確定の音と同じで良い） 確定した選択をキャンセルする音（これは新しく追加） では「GameOver.tscn」シーンファイルを開いてそれぞれのサウンドを追加しよう。\nAudioStreamPlayer ノードを追加する 「GameOver」ルートノードに「AudioStreamPlayer」クラスのノードを2つ追加して、それぞれ「BGMPlayer」「SFXPlayer」という名前に変更しよう。\nBGMPlayer ノードを編集する これまでと同様の手順で「BGMPlayer」ノードのプロパティを編集する。\nインスペクターの「Stream」プロパティへファイルシステムドックから「res://Assets/Audio/GameOver.ogg」をドラッグ\u0026ドロップして素材を追加する。 必要に応じて、音量を「Volume Db」プロパティの値を上げ下げして調節する。 「Autoplay」プロパティをオンにする。 SFXPlayer ノードを編集する 続けて「SFXPlayer」ノードのプロパティを編集しよう。\n「Stream」プロパティの値は[空]のままにしておく。 もし音量が大きすぎたり小さすぎる場合は「Volume Db」プロパティの値を調整する。 「Autoplay」プロパティは オフ にしておく。 スクリプトを編集して SFX の再生を制御する では「GameOver.gd」スクリプトを開いて編集していく。\nまずは、プロパティから定義しよう。\n# SFXPlayer ノードの参照 onready var sfx_player = $SFXPlayer # 追加 # SFXPlayer の Stream プロパティに適用する3種類の音源リソースを辞書型データにして定義 onready var sfx_res = { \"select\": preload(\"res://Assets/Audio/PressSelect.wav\"), \"enter\": preload(\"res://Assets/Audio/PressEnter.wav\"), \"cancel\": preload(\"res://Assets/Audio/PressCancel.wav\") } # 追加 次に、4 つのメソッド内に SFX 再生のコードを追加しよう。「# 追加」と記載している行が今回追加した箇所だ。\n# Restart ボタンまたは Quit ボタンを押した時に呼ばれるメソッド func work_at_button_up(option): # SFXPlayer の Stream プロパティに res://Assets/Audio/PressEnter.wav を適用 sfx_player.stream = sfx_res[\"enter\"] # 追加 # SFXPlayer のサウンドを再生 sfx_player.play() # 追加 selected_option = option color_rect.visible = true if selected_option == RESTART: confirmation.dialog_text = restart_text elif selected_option == QUIT: confirmation.dialog_text = quit_text confirmation.popup_centered() # 確認ダイアログで OK ボタンを押して確定した時に呼ばれるメソッド func _on_ConfirmationDialog_confirmed(): # SFXPlayer の Stream プロパティに res://Assets/Audio/PressEnter.wav を適用 sfx_player.stream = sfx_res[\"enter\"] # 追加 # SFXPlayer のサウンドを再生 sfx_player.play() # 追加 # SFXPlayer のサウンド再生が終了するまで待機 yield(sfx_player, \"finished\") # 追加 if selected_option == RESTART: get_tree().paused = false print(\"Scene tree paused: \", get_tree().paused) get_tree().change_scene(\"res://Game/Game.tscn\") print(\"The game is restarted.\") elif selected_option == QUIT: get_tree().quit() print(\"The game is quited.\") # 確認ダイアログが非表示になった時に呼ばれるメソッド func _on_ConfirmationDialog_popup_hide(): # SFXPlayer の Stream プロパティに res://Assets/Audio/PressCancel.wav を適用 sfx_player.stream = sfx_res[\"cancel\"] # 追加 # SFXPlayer のサウンドを再生 sfx_player.play() # 追加 selected_option = null confirmation.dialog_text = \"\" color_rect.visible = false # キーボードやマウスのインプット操作を行った時に呼ばれるメソッド func _input(event): if visible: if event.is_action_released(\"ui_left\"): # SFXPlayer の Stream プロパティに res://Assets/Audio/PressSelect.wav を適用 sfx_player.stream = sfx_res[\"select\"] # 追加 # SFXPlayer のサウンドを再生 sfx_player.play() # 追加 line2d.position = square_pos[0] elif event.is_action_released(\"ui_right\"): # SFXPlayer の Stream プロパティに res://Assets/Audio/PressSelect.wav を適用 sfx_player.stream = sfx_res[\"select\"] # 追加 # SFXPlayer のサウンドを再生 sfx_player.play() # 追加 line2d.position = square_pos[1] elif event.is_action_released(\"ui_accept\") and not color_rect.visible: if line2d.position == square_pos[0]: _on_RestartButton_button_up() elif line2d.position == square_pos[1]: _on_QuitButton_button_up() 「SFXPlayer」ノードは一つだが、スクリプトで音源リソースを切り替えることで 3 つの SFX の再生をカバーしている。\nこれで以下の場面で SFX が再生されるようになったはずだ。\n「Restart」と「Quit」を選択する際に「PressSelect.wav」が再生される 「Restart」と「Quit」どちらかの選択を確定したら「PressEnter.wav」が再生される 確認ダイアログで「OK」を押して確定した時も「「PressEnter.wav」が再生される 確認ダイアログで「Cancel」を押した時に「PressCancel.wav」が再生される 上記内容に加えて、BGM の音源が正しく再生されるか、正しくループするかも併せて、実際にシーンを実行してみよう。\nYour browser does not support the video tag. Level1 シーン いよいよゲームプレイ中の BGM の追加だ。「Level1」シーンは外なので明るいややアップテンポの曲が最適だ。「Level1.tscn」シーンファイルを開いてサウンドを追加しよう。ちなみにこのシーンに SFX は不要なので、スクリプトの編集も不要だ。1分で作業を終えられるかもしれない。\nAudioStreamPlayer ノードを追加する 「Level1」ルートノードに「AudioStreamPlayer」クラスのノードを1つ追加して「BGMPlayer」という名前に変更しよう。\nBGMPlayer ノードを編集する 「BGMPlayer」ノードのプロパティを編集する。\nインスペクターの「Stream」プロパティへファイルシステムドックから「res://Assets/Audio/Land.ogg」をドラッグ\u0026ドロップして素材を追加する。 必要に応じて、音量を「Volume Db」プロパティの値を上げ下げして調節する。 「Autoplay」プロパティをオンにする。 では BGM の自動再生とループを確認しておこう。なお、このリソースのみループ開始位置を調整しているので、開始位置に戻った時に違和感がないかはよく聴いて確認する必要がある。以下の動画では 0:31 のタイミングでループ開始位置に戻っている。\nYour browser does not support the video tag. Level2 シーン ようやく最後のシーンだ。「Level2」シーンはジメジメした（キノコが大量に生息する）ダンジョンの中なので、少しおどろおどろしい（ややホラーっぽい）曲が似合うはずだ。「Level2.tscn」シーンファイルを開いてサウンドを追加しよう。このシーンも SFX は不要なので、「Level1.tscn」の編集とほとんど同じ作業だ。\nAudioStreamPlayer ノードを追加する 「Level2」ルートノードに「AudioStreamPlayer」クラスのノードを1つ追加して「BGMPlayer」という名前に変更しよう。\nBGMPlayer ノードを編集する 「BGMPlayer」ノードのプロパティを編集する。\nインスペクターの「Stream」プロパティへファイルシステムドックから「res://Assets/Audio/Dungeon.ogg」をドラッグ\u0026ドロップして素材を追加する。 必要に応じて、音量を「Volume Db」プロパティの値を上げ下げして調節する。 「Autoplay」プロパティをオンにする。 では BGM の自動再生とループを確認しておこう。以下の動画では 0:49 のタイミングでループ開始位置に戻っている。\nYour browser does not support the video tag. これでサウンドの追加が必要なシーンの編集作業は完了した。最後にプロジェクト全体を通して音の確認をして今回の作業を終えよう。\nYour browser does not support the video tag. Part 13 で編集したスクリプトのコード 最後に今回の Part 13 で編集したスクリプトのコードを共有しておくので、必要に応じて確認してほしい。\nPlayer.gd の全コード extends KinematicBody2D # Created @ Part 1 signal enemy_hit(damage) # Added @ Part 8 signal item_hit(point) # Added @ Part 8 export var acceleration = 256 export var max_speed = 64 export var max_dash_speed = 200 export var friction = 0.1 export var gravity = 512 export var jump_force = 224 export var air_resistance = 0.02 var velocity = Vector2() onready var sprite = $AnimatedSprite onready var anim_player = $AnimationPlayer # Added @ Part 7 onready var step_sfx = $StepSFX # Added @ Part 13 onready var jump_sfx = $JumpSFX # Added @ Part 13 onready var damage_sfx = $DamageSFX # Added @ Part 13 onready var die_sfx = $DieSFX # Added @ Part 13 func _ready(): # Added @ Part 7 sprite.position = Vector2(0, 0) sprite.scale = Vector2(1, 1) sprite.modulate = Color(1, 1, 1, 1) func _physics_process(delta): velocity.y += gravity * delta var x_input = Input.get_action_strength(\"move_right\") - Input.get_action_strength(\"move_left\") if x_input != 0: velocity.x += x_input * acceleration if Input.is_action_pressed(\"dash\"): velocity.x = clamp(velocity.x, -max_dash_speed, max_dash_speed) else: velocity.x = clamp(velocity.x, -max_speed, max_speed) sprite.flip_h = x_input \u003c 0 if is_on_floor(): if x_input == 0: sprite.play(\"idle\") velocity.x = lerp(velocity.x, 0, friction) else: sprite.play(\"run\") if Input.is_action_just_pressed(\"jump\"): sprite.play(\"jump\") velocity.y = -jump_force jump_sfx.play() # Added @ Part 13 else: if x_input == 0: velocity.x = lerp(velocity.x, 0, air_resistance) if Input.is_action_just_released(\"jump\") and velocity.y \u003c -jump_force / 2: velocity.y = -jump_force / 2 velocity = move_and_slide(velocity, Vector2.UP) # Added @ Part 3 if position.x \u003c 16: position.x = 16 func _on_HitBox_body_entered(body): # Added @ Part 8 if body.is_in_group(\"Enemies\"): print(\"Enemy hit player. Damage is \", body.damage) emit_signal(\"enemy_hit\", body.damage) sprite.play(\"hit\") damage_sfx.play() # Added @ Part 13 func _on_AnimatedSprite_frame_changed(): # Added @ Part 13 if sprite.animation == \"run\": if sprite.frame == 4 or sprite.frame == 10: step_sfx.play() Game.gd の全コード extends Node # Added @ Part 7 export var current_level = 1 export var final_level = 2 var health: float = 100.0 # Added @ Part 8 var score: int = 0 # Added @ Part 8 var level: Node2D var player: KinematicBody2D var char_frames: SpriteFrames # Added @ Part 10 onready var ui_layer = $UI # Added @ Part 10 onready var gamestart = $UI/GameStart # Added @ Part 10 onready var hud = $UI/HUD # Added @ Part 8 #onready var gameover = $UI/GameOver # Added @ Part 9 # Removed @ Part 10 func _ready(): #gameover.visible = false # Added @ Part 9 # Removed @ Part 10 gamestart.connect(\"tree_exited\", self ,\"_on_GameStart_tree_exited\") # Added @ Part 10 func _on_GameStart_tree_exited(): # Added @ Part 10 var char_select = load(\"res://UI/CharacterSelect/CharacterSelect.tscn\").instance() char_select.connect(\"character_selected\", self ,\"_on_CharacterSelect_character_selected\") # Added @ Part 10 ui_layer.add_child(char_select) func _on_CharacterSelect_character_selected(sprite_frames): # Added @ Part 10 char_frames = sprite_frames add_level() # Moved @ Part 10 # Modified @ Part 10 hud.update_health(health) # Added @ Part 8 # Moved @ Part 10 hud.update_score(score) # Added @ Part 8 # Moved @ Part 10 hud.update_level(current_level) # Added @ Part 8 # Moved @ Part 10 func add_level(): # Modified @ Part 10 level = load(\"res://Levels/Level\" + str(current_level) + \".tscn\").instance() level.connect(\"tree_exited\", self, \"change_level\") level.connect(\"player_dropped\", self, \"_on_Level_player_dropped\") # Added @ Part 9 call_deferred(\"add_child\", level) # Fixed error player = level.get_node(\"Player\") # Added @ Part 8 player.connect(\"enemy_hit\", self, \"_on_Player_enemy_hit\") # Added @ Part 8 player.connect(\"item_hit\", self, \"_on_Player_item_hit\") # Added @ Part 8 player.get_node(\"AnimatedSprite\").frames = char_frames # Added @ Part 10 func change_level(): if get_tree(): # Added @ Part 9 print(\"change_level() called.\") if current_level \u003c final_level: print(\"change to next level.\") level.queue_free() current_level += 1 hud.update_level(current_level) # Added @ Part 8 add_level() else: print(\"Game Clear! Congrats!\") get_tree().quit() func _on_Player_enemy_hit(damage): # Added @ Part 8 manage_health(damage) # Modified @ Part 9 func _on_Player_item_hit(point): # Added @ Part 8 score += point hud.update_score(score) func _on_Level_player_dropped(): # Added @ Part 9 manage_health(100) func manage_health(damage): # Added @ Part 9 health -= damage # Moved from _on_Player_enemy_hit() @ Part 9 print(\"Health updated: \", health) # Moved from _on_Player_enemy_hit() @ Part 9 hud.update_health(health) # Moved from _on_Player_enemy_hit() @ Part 9 # Added @ Part 9 if health \u003c= 0: player.anim_player.play(\"die\") player.die_sfx.play() # Added @ Part 13 yield(player.anim_player, \"animation_finished\") #gameover.visible = true # Removed @ Part 10 var gameover = load(\"res://UI/GameOver/GameOver.tscn\").instance() # Added @ Part 10 ui_layer.add_child(gameover) # Added @ Part 10 print(\"Game over screen is shown up.\") get_tree().paused = true print(\"Scene tree paused: \", get_tree().paused) .Enemygd の全コード extends KinematicBody2D # Added @ Part 4 export var gravity: int export var speed: int export var damage: float # Added @ Part 8 var velocity = Vector2() onready var sprite = $AnimatedSprite onready var audio_player = $AudioStreamPlayer2D func _ready(): set_physics_process(false) func _on_HitBox_body_entered(body): if body.is_in_group(\"Players\"): print(\"Player entered in \", self.name) sprite.play(\"hit\") audio_player.play() # Added @ Part 13 yield(sprite, \"animation_finished\") yield(audio_player, \"finished\") # Added @ Part 13 queue_free() print(self.name, \" died\") func _on_VisibilityEnabler2D_screen_entered(): set_physics_process(true) func _on_VisibilityEnabler2D_screen_exited(): set_physics_process(false) Item.gd の全コード extends Area2D # Added @ Part 6 export var point = 100 onready var sprite = $AnimatedSprite onready var label = $Label onready var anim_player = $AnimationPlayer onready var audio_player = $AudioStreamPlayer2D # Added @ Part 13 func _ready(): sprite.modulate = Color(1, 1, 1, 1) sprite.position = Vector2.ZERO sprite.scale = Vector2.ONE label.modulate = Color(1, 1, 1, 0) label.rect_position = Vector2(-32, -20) label.text = str(point) func _on_Item_body_entered(body): if body.name == \"Player\": print(\"Player hit Item\") hit(body) # Modified @ Part 8 func hit(body): # Modified @ Part 8 print(\"Got \", point, \" point.\") body.emit_signal(\"item_hit\", point) # Added @ Part 8 anim_player.play(\"hit\") audio_player.play() # Added @ Part 13 yield(anim_player, \"animation_finished\") yield(audio_player, \"finished\") # Added @ Part 13 queue_free() BrokenBox.gd の全コード extends Particles2D # Added @ Part 6 onready var audio_player = $AudioStreamPlayer2D func _ready(): emitting = true audio_player.play() func _process(delta): if not emitting: queue_free() print(\"BrokenBox removed.\") StartPoint.gd の全コード extends Area2D # Added @ Part 7 onready var sprite = $AnimatedSprite onready var audio_player = $AudioStreamPlayer2D # Added @ Part 13 func _ready(): sprite.play(\"idle\") func _on_StartPoint_body_entered(body): if body.name == \"Player\": sprite.play(\"moving\") audio_player.play() # Added @ Part 13 func _on_StartPoint_body_exited(body): if body.name == \"Player\": sprite.play(\"idle\") Checkpoint.gd の全コード extends Area2D # Added @ Part 7 var is_checked = false onready var sprite = $AnimatedSprite onready var audio_player = $AudioStreamPlayer2D # Added @ Part 13 func _ready(): sprite.play(\"no_flag\") func _on_Checkpoint_body_entered(body): if body.name == \"Player\" and not is_checked: sprite.play(\"flag_out\") audio_player.play() # Added @ Part 13 yield(sprite, \"animation_finished\") sprite.play(\"flag_idle\") is_checked = true EndPoint.gd の全コード extends Area2D # Added @ Part 7 onready var particle = $Particles2D onready var sprite = $AnimatedSprite onready var polygon = $StaticBody2D/CollisionPolygon2D onready var anim_player = $AnimationPlayer onready var audio_player = $AudioStreamPlayer2D # Added @ Part 13 func _ready(): particle.emitting = false sprite.play(\"idle\") polygon.position = Vector2(0, -4) func _on_EndPoint_body_entered(body): if body.name == \"Player\": anim_player.play(\"clear\") yield(anim_player, \"animation_finished\") particle.emitting = true body.anim_player.play(\"clear\") audio_player.play() # Added @ Part 13 yield(body.anim_player, \"animation_finished\") yield(audio_player, \"finished\") # Added @ Part 13 print(\"Moving to the next level!\") get_parent().queue_free() GameStart.gd の全コード extends Control # Added @ Part 10 onready var start_button = $VBoxContainer/StartVBox/StartButton onready var anim_player = $AnimationPlayer onready var sfx_player = $SFXPlayer # Added @ Part 13 func _ready(): start_button.modulate = Color(1, 1, 1, 1) start_button.rect_scale = Vector2(1, 1) func _on_StartButton_button_up(): #print(\"_on_StartButton_button_up called.\") anim_player.play(\"press_start\") sfx_player.play() # Added @ Part 13 yield(anim_player, \"animation_finished\") yield(sfx_player, \"finished\") # Added @ Part 13 queue_free() print(\"GameStart scene is now freed.\") func _input(event): if event.is_action_released(\"ui_accept\"): _on_StartButton_button_up() CharacterSelect.gd の全コード extends Control # Added @ Part 10 signal character_selected(sprite_frames) var is_choosing = true var frames_num = 0 var characters = [\"Mask Dude\", \"Ninja Frog\", \"Pink Man\", \"Virtual Guy\"] onready var global = get_node(\"/root/Global\") onready var char_name = $VBoxContainer/CharacterName onready var l_button = $VBoxContainer/HBoxContainer/LeftButton onready var r_button = $VBoxContainer/HBoxContainer/RightButton onready var sprite = $AnimatedSprite onready var anim_player = $AnimationPlayer onready var sfx_player = $SFXPlayer # Added @ Part 13 onready var sfx_res = { \"select\": preload(\"res://Assets/Audio/PressSelect.wav\"), \"enter\": preload(\"res://Assets/Audio/PressEnter.wav\") } # Added @ Part 13 func _ready(): l_button.modulate = Color(1, 1, 1, 1) l_button.rect_scale = Vector2(1, 1) r_button.modulate = Color(1, 1, 1, 1) r_button.rect_scale = Vector2(1, 1) play_animations() func play_animations(): var animations: Array = sprite.frames.get_animation_names() var anim_index = 0 var count = 0 #print(\"animations array is \", animations) for anim in animations: if anim == \"fall\" or anim == \"jump\": animations.remove(animations.find(anim)) #print(\"removed \", anim, \" from animations array.\") while is_choosing: sprite.play(animations[anim_index]) yield(sprite, \"animation_finished\") sprite.stop() if count \u003c 4: count += 1 continue\tcount = 0 if anim_index \u003c animations.size() - 1: anim_index += 1 else: anim_index = 0 func _on_LeftButton_pressed(): anim_player.play(\"press_left\") print(sfx_res[\"select\"]) sfx_player.stream = sfx_res[\"select\"] # Added @ Part 13 sfx_player.play() # Added @ Part 13 if frames_num \u003e 0: frames_num -= 1 sprite.frames = global.spriteframes[frames_num] char_name.text = characters[frames_num] else: sprite.frames = global.spriteframes[global.spriteframes.size() - 1] char_name.text = characters[characters.size() - 1] frames_num = global.spriteframes.size() - 1 func _on_RightButton_pressed(): anim_player.play(\"press_right\") sfx_player.stream = sfx_res[\"select\"] # Added @ Part 13 sfx_player.play() # Added @ Part 13 if frames_num \u003c global.spriteframes.size() -1: frames_num += 1 sprite.frames = global.spriteframes[frames_num] char_name.text = characters[frames_num] else: sprite.frames = global.spriteframes[0] char_name.text = characters[0] frames_num = 0 func _input(event): if event.is_action_pressed(\"ui_left\"): _on_LeftButton_pressed() elif event.is_action_pressed(\"ui_right\"): _on_RightButton_pressed() elif event.is_action_released(\"ui_accept\"): is_choosing = false sfx_player.stream = sfx_res[\"enter\"] # Added @ Part 13 sfx_player.play() # Added @ Part 13 yield(sfx_player, \"finished\") # Added @ Part 13 emit_signal(\"character_selected\", global.spriteframes[frames_num]) #print(\"emitted signal: character_selected\") queue_free() print(\"CharacterSelect scene is now freed.\") GameOver.gd の全コード extends Control # Added @ Part 9 enum { RESTART, QUIT, } # Added @ Part 9 after var square_pos = [ Vector2(108, 128), Vector2(212, 128) ] var selected_option = null var restart_text = \"Do you really want to restart the game?\" var quit_text = \"Do you really want to quit the game?\" onready var restart_btn = $VBoxContainer/ButtonsHBox/RestartVBox/RestartButton onready var quit_btn = $VBoxContainer/ButtonsHBox/QuitVBox/QuitButton onready var color_rect = $ColorRect onready var confirmation = $ConfirmationDialog onready var line2d = $Line2D # Added @ Part 9 after onready var anim_player = $Line2D/AnimationPlayer # Added @ Part 9 after onready var sfx_player = $SFXPlayer # Added @ Part 13 onready var sfx_res = { \"select\": preload(\"res://Assets/Audio/PressSelect.wav\"), \"enter\": preload(\"res://Assets/Audio/PressEnter.wav\"), \"cancel\": preload(\"res://Assets/Audio/PressCancel.wav\") } # Added @ Part 13 func _ready(): color_rect.visible = false anim_player.play(\"blink_square\") # Added @ Part 9 after func _on_RestartButton_mouse_entered(): line2d.position = square_pos[0] func _on_QuitButton_mouse_entered(): line2d.position = square_pos[1] func _on_RestartButton_button_up(): work_at_button_up(RESTART) func _on_QuitButton_button_up(): work_at_button_up(QUIT) func work_at_button_up(option): sfx_player.stream = sfx_res[\"enter\"] # Added @ Part 13 sfx_player.play() # Added @ Part 13 selected_option = option color_rect.visible = true if selected_option == RESTART: confirmation.dialog_text = restart_text elif selected_option == QUIT: confirmation.dialog_text = quit_text confirmation.popup_centered() func _on_ConfirmationDialog_confirmed(): sfx_player.stream = sfx_res[\"enter\"] # Added @ Part 13 sfx_player.play() # Added @ Part 13 yield(sfx_player, \"finished\") # Added @ Part 13 if selected_option == RESTART: get_tree().paused = false print(\"Scene tree paused: \", get_tree().paused) get_tree().change_scene(\"res://Game/Game.tscn\") print(\"The game is restarted.\") elif selected_option == QUIT: get_tree().quit() print(\"The game is quited.\") func _on_ConfirmationDialog_popup_hide(): sfx_player.stream = sfx_res[\"cancel\"] # Added @ Part 13 sfx_player.play() # Added @ Part 13 selected_option = null confirmation.dialog_text = \"\" color_rect.visible = false func _input(event): # Added @ Part 9 after if visible: if event.is_action_released(\"ui_left\"): sfx_player.stream = sfx_res[\"select\"] # Added @ Part 13 sfx_player.play() # Added @ Part 13 line2d.position = square_pos[0] elif event.is_action_released(\"ui_right\"): sfx_player.stream = sfx_res[\"select\"] # Added @ Part 13 sfx_player.play() # Added @ Part 13 line2d.position = square_pos[1] elif event.is_action_released(\"ui_accept\") and not color_rect.visible: if line2d.position == square_pos[0]: _on_RestartButton_button_up() elif line2d.position == square_pos[1]: _on_QuitButton_button_up() おわりに 以上で Part 13 は完了だ。\n今回はゲームに BGM や SFX のサウンドを追加した。「AudioStreamPlayer」の基本的なプロパティ、例えば「Stream」、「Volume Db」、「Autoplay」などの編集や、スクリプトでのサウンドリソースの割り当て、サウンドの再生を経験した。\n「AudioStreamPlayer」系クラスのノードは、一つのサウンドリソースしか割り当てられない。そのため、最初から複数のノードを追加しておくべきか、スクリプトでリソースを都度切り替えて割り当てるべきか、ちょっと悩ましい。スクリプトが苦手な方は無理をせず、最初はノードを複数追加し、それぞれに異なるサウンドリソースを割り当てる方法で問題ない。今後、ゲーム開発の腕が上がり、一つのシーンで大量のサウンドリソースを扱うようなプロジェクトの開発をすることがあれば、その時はスクリプトでの制御が有効かもしれない。\nところで今回、私自身このチュートリアルのために初めて BGM の作曲を試みた。気に入っていただけたら幸いだ。\nさて、次回のチュートリアルでは、キャラクターのアクションをアップデートする予定だ。例えば、ジャンプして落下する時は別のアニメーションを再生したり、2段ジャンプや壁ジャンプをしたり、走っている時は砂埃がまったり、ゴーストエフェクト（残像）を追加したり、といった内容だ。\nそれでは次回もお楽しみに。\nUPDATE:\n2022/04/16　画面下落下時にゲームオーバー画面に遷移しない問題の修正のため Game.gd スクリプトのmanage_healthメソッドからyield(player.die_sfx, \"finished\") の行を削除\n","wordCount":"17735","inLanguage":"ja","image":"https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_13/img0.gif","datePublished":"2022-04-08T19:42:19+09:00","dateModified":"2022-04-16T00:00:00Z","author":{"@type":"Person","name":"gobo"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_13/"},"publisher":{"@type":"Organization","name":"Peanuts Code","logo":{"@type":"ImageObject","url":"https://www.peanuts-code.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.peanuts-code.com/ja/ accesskey=h title="Peanuts Code (Alt + H)"><img src=https://www.peanuts-code.com/images/logomark.png alt aria-label=logo height=35>Peanuts Code</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://www.peanuts-code.com/en/ title=English aria-label=🇬🇧English>🇬🇧English</a></li></ul></div></div><ul id=menu><li><a href=https://www.peanuts-code.com/ja/ title=ホーム><span>ホーム</span></a></li><li><a href=https://www.peanuts-code.com/ja/portfolio/ title=ゲーム><span>ゲーム</span></a></li><li><a href=https://www.peanuts-code.com/ja/posts/ title=ブログ><span>ブログ</span></a></li><li><a href=https://www.peanuts-code.com/ja/tutorials/ title=チュート><span>チュート</span></a></li><li><a href=https://www.peanuts-code.com/ja/about/ title=サイト紹介><span>サイト紹介</span></a></li><li><a href=https://www.peanuts-code.com/ja/search/ title="サイト内検索 (Alt + /)" accesskey=/><span>サイト内検索</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.peanuts-code.com/ja/>ホーム</a>&nbsp;»&nbsp;<a href=https://www.peanuts-code.com/ja/tutorials/>🤖 チュート</a>&nbsp;»&nbsp;<a href=https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/>🤖 シリーズ：Godot で作るプラットフォーマー</a></div><h1 class="post-title entry-hint-parent">Godot で作るプラットフォーマー Part 13：サウンドを追加しよう！</h1><div class=post-meta><span title='2022-04-08 19:42:19 +0900 +0900'>2022-04-08</span>&nbsp;·&nbsp;36 分</div><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 13：サウンドを追加しよう！ on x" href="https://x.com/intent/tweet/?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2013%ef%bc%9a%e3%82%b5%e3%82%a6%e3%83%b3%e3%83%89%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%97%e3%82%88%e3%81%86%ef%bc%81&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_13%2f&amp;hashtags=GodotEngine%2cGameDev%2c2D%2c%e3%82%a2%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e3%82%b2%e3%83%bc%e3%83%a0%2c%e6%a8%aa%e3%82%b9%e3%82%af%e3%83%ad%e3%83%bc%e3%83%ab%2c%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%2cBGM%2c%e3%82%b5%e3%82%a6%e3%83%b3%e3%83%89%e3%82%a8%e3%83%95%e3%82%a7%e3%82%af%e3%83%88"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 13：サウンドを追加しよう！ on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_13%2f&title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2013%ef%bc%9a%e3%82%b5%e3%82%a6%e3%83%b3%e3%83%89%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%97%e3%82%88%e3%81%86%ef%bc%81"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 13：サウンドを追加しよう！ on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_13%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li></ul><ul class=post-tags><li><a href=https://www.peanuts-code.com/ja/tags/godotengine/>GodotEngine</a></li><li><a href=https://www.peanuts-code.com/ja/tags/gamedev/>GameDev</a></li><li><a href=https://www.peanuts-code.com/ja/tags/2d/>2D</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B2%E3%83%BC%E3%83%A0/>アクションゲーム</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E6%A8%AA%E3%82%B9%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%AB/>横スクロール</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%BC/>プラットフォーマー</a></li><li><a href=https://www.peanuts-code.com/ja/tags/bgm/>BGM</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E3%82%B5%E3%82%A6%E3%83%B3%E3%83%89%E3%82%A8%E3%83%95%E3%82%A7%E3%82%AF%E3%83%88/>サウンドエフェクト</a></li></ul></header><figure class=entry-cover><img loading=eager src=https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_13/img0.gif alt="プラットフォーマー Part 13 サムネイル"></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目次</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#サウンドの素材をファイルシステムに追加する>サウンドの素材をファイルシステムに追加する</a></li><li><a href=#bgm-用の素材のループ設定を調整する>BGM 用の素材のループ設定を調整する</a></li></ul><ul><li><a href=#audiostreamplayer2d-ノードを追加する>AudioStreamPlayer2D ノードを追加する</a></li><li><a href=#audiostreamplayer2d-ノードを編集する>AudioStreamPlayer2D ノードを編集する</a></li><li><a href=#スクリプトを編集して-sfx-の再生を制御する>スクリプトを編集して SFX の再生を制御する</a><ul><li><a href=#足音>足音</a></li><li><a href=#ジャンプする音>ジャンプする音</a></li><li><a href=#敵に当たってダメージを受けた時の音>敵に当たってダメージを受けた時の音</a></li><li><a href=#ヘルスがゼロになって死んだ時の音>ヘルスがゼロになって死んだ時の音</a></li></ul></li></ul><ul><li><a href=#audiostreamplayer2d-ノードを追加してプロパティを編集する>AudioStreamPlayer2D ノードを追加してプロパティを編集する</a></li><li><a href=#スクリプトを編集して-sfx-の再生を制御する-1>スクリプトを編集して SFX の再生を制御する</a></li></ul><ul><li><a href=#audiostreamplayer2d-ノードを追加してプロパティを編集する-1>AudioStreamPlayer2D ノードを追加してプロパティを編集する</a></li><li><a href=#スクリプトを編集して-sfx-の再生を制御する-2>スクリプトを編集して SFX の再生を制御する</a></li></ul><ul><li><a href=#audiostreamplayer2d-ノードを追加してプロパティを編集する-2>AudioStreamPlayer2D ノードを追加してプロパティを編集する</a></li><li><a href=#スクリプトを編集して-sfx-の再生を制御する-3>スクリプトを編集して SFX の再生を制御する</a></li></ul><ul><li><a href=#audiostreamplayer-ノードを追加してプロパティを編集する>AudioStreamPlayer ノードを追加してプロパティを編集する</a></li><li><a href=#スクリプトを編集して-sfx-の再生を制御する-4>スクリプトを編集して SFX の再生を制御する</a></li></ul><ul><li><a href=#audiostreamplayer2d-ノードを追加してプロパティを編集する-3>AudioStreamPlayer2D ノードを追加してプロパティを編集する</a></li><li><a href=#スクリプトを編集して-sfx-の再生を制御する-5>スクリプトを編集して SFX の再生を制御する</a></li></ul><ul><li><a href=#audiostreamplayer2d-ノードを追加してプロパティを編集する-4>AudioStreamPlayer2D ノードを追加してプロパティを編集する</a></li><li><a href=#スクリプトを編集して-sfx-の再生を制御する-6>スクリプトを編集して SFX の再生を制御する</a></li></ul><ul><li><a href=#audiostreamplayer-ノードを追加する>AudioStreamPlayer ノードを追加する</a></li><li><a href=#bgmplayer-ノードを編集する>BGMPlayer ノードを編集する</a></li><li><a href=#sfxplayer-ノードを編集する>SFXPlayer ノードを編集する</a></li><li><a href=#スクリプトを編集して-sfx-の再生を制御する-7>スクリプトを編集して SFX の再生を制御する</a></li></ul><ul><li><a href=#audiostreamplayer-ノードを追加する-1>AudioStreamPlayer ノードを追加する</a></li><li><a href=#bgmplayer-ノードを編集する-1>BGMPlayer ノードを編集する</a></li><li><a href=#sfxplayer-ノードを編集する-1>SFXPlayer ノードを編集する</a></li><li><a href=#スクリプトを編集して-sfx-の再生を制御する-8>スクリプトを編集して SFX の再生を制御する</a></li></ul><ul><li><a href=#audiostreamplayer-ノードを追加する-2>AudioStreamPlayer ノードを追加する</a></li><li><a href=#bgmplayer-ノードを編集する-2>BGMPlayer ノードを編集する</a></li><li><a href=#sfxplayer-ノードを編集する-2>SFXPlayer ノードを編集する</a></li><li><a href=#スクリプトを編集して-sfx-の再生を制御する-9>スクリプトを編集して SFX の再生を制御する</a></li></ul><ul><li><a href=#audiostreamplayer-ノードを追加する-3>AudioStreamPlayer ノードを追加する</a></li><li><a href=#bgmplayer-ノードを編集する-3>BGMPlayer ノードを編集する</a></li></ul><ul><li><a href=#audiostreamplayer-ノードを追加する-4>AudioStreamPlayer ノードを追加する</a></li><li><a href=#bgmplayer-ノードを編集する-4>BGMPlayer ノードを編集する</a></li></ul></nav></div></details></div><div class=post-content><p>第13回目の今回は、ゲームにサウンドを追加する。ゲームに使われるサウンドというのは、大きく分けて2種類ある。バックグラウンドミュージック（BGM）と効果音（サウンドエフェクト：SFX）だ。Godot Engine ではどちらも追加する方法に大きな違いはない。素材さえ用意すれば、追加するのは比較的簡単だ。特定のタイミングでサウンドを鳴らしたい時、例えば、プレイヤーキャラクターがジャンプした時にジャンプの効果音を鳴らしたい場合などには、プログラミングして制御する必要があるが、複雑なコードにはならないので安心してほしい。</p><p>今回のチュートリアルには GIF 画像ではなく mp4 フォーマットの動画を載せている。この記事の閲覧環境は様々だと思われるため、デフォルトではサウンドをミュートしている。動画のコントローラでミュート解除していただきつつ、確認いただきたい。</p><blockquote><p><em><strong><span style=color:salmon>Memo：</span></strong><br>過去のシリーズをまだご覧になっていない方は、そちらを先にご覧いただくことをおすすめします。<br><a href=https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/ title="Godot で作るプラットフォーマー">Godot で作るプラットフォーマー</a></em></p></blockquote><br><p>以下の公式オンラインドキュメントのページに、サウンド関係のリンクがまとまっている。今回このチュートリアルで扱う内容以外の有益な情報も含まれるので、併せて目を通していただくとよりわかりやすいだろう。</p><blockquote><p><em><strong><span style=color:salmon>公式オンラインドキュメント：</span></strong><br><a href=https://docs.godotengine.org/ja/stable/tutorials/audio/index.html target=_blank>オーディオ</a></em></p></blockquote><br><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=サウンドの素材を準備する>サウンドの素材を準備する</h1><br><h2 id=サウンドの素材をファイルシステムに追加する>サウンドの素材をファイルシステムに追加する</h2><p>ゲームにサウンドを追加するには、まずサウンドの素材を用意する必要がある。ご自身で作曲する場合もあれば、アセットストアなどで誰かが作曲したものをダウンロードする場合もあるだろう。</p><p>今回はチュートリアル用に音源ファイルを用意しているので、以下のリンクから「Audio.zip」をダウンロードしてほしい。</p><blockquote><p><em><strong><span style=color:salmon>Download Asset:</span></strong><br><a href="https://www.dropbox.com/s/kcmzfhahkbrus3y/Audio.zip?dl=0" target=_blank>Dropboxの共有フォルダ ＞ Audio.zip</a></em></p></blockquote><p>ダウンロードできたら、.zip ファイルを展開して中の「Audio」フォルダを取り出してほしい。プロジェクトのファイルシステムドックで「res://Assets/」フォルダを選択した状態にし、そのフォルダ目掛けて「Audio」フォルダごとドラッグ&ドロップで追加しよう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img1.png alt=Audioフォルダを追加></p><p>なお、2022/04/06 以降に Part 1 でアセットをダウンロードされた方は、Godot のファイルシステムの「res://Assets/」のフォルダに各種オーディオファイルを格納した「Audio」フォルダが最初から入っているはずだ。</p><br><h2 id=bgm-用の素材のループ設定を調整する>BGM 用の素材のループ設定を調整する</h2><p>SFX は、特定のタイミングで都度、一回サウンドを鳴らすだけだが、BGM に関しては曲が最後まで終わったらまた頭から再生する、つまりループさせる必要がある。</p><p>.ogg や .mp3 フォーマットのリソースだと、デフォルトでループの設定が有効になっており、.wav フォーマットだとループは無効になっているようだ。</p><p>ゲームのサウンドに関しては一般的に、BGM 用の曲は長いので、ファイルサイズの関係から、圧縮した .ogg または .mp3 が推奨されている。一方、SFX 用のサウンドは短いので、非圧縮形式の .wav フォーマットであることが多い。ループのデフォルトの設定は、この背景に由来する仕様だと考えられる。</p><p>先ほど追加していただいたこのチュートリアル用のサウンド素材についても、BGM 用は .ogg フォーマット、SFX 用は .wav フォーマットにしているので、どれがどっちの素材かはファイル名の拡張子を見ればすぐに判別していただけるだろう。</p><p>具体的に、それぞれのサウンド素材のループの設定を確認する手順は以下の通りだ。</p><ol><li>ファイルシステムドックで音源ファイルを選択する<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img2.png alt=ファイルシステムドックで音源ファイル選択></li><li>そのままインポートドックでループの設定を確認する<ul><li>BGM 用 .ogg ファイルの場合：<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img3.png alt=".ogg のループの設定を確認"></li><li>SFX 用 .wav ファイルの場合：<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img4.png alt=".wav のループの設定を確認"></li></ul></li><li>もしループの設定がおかしい（BGM 用なのにループが無効、または SFX 用なのにループが有効）場合は、ループの設定のチェックを切り替えて、「再インポート」ボタンをクリックすれば、設定が変更された状態で素材ファイルが再インポートされる。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img5.png alt=".wav のループの設定を確認"></li></ol><br><blockquote><p><em><strong><span style=color:salmon>公式オンラインドキュメント：</span></strong><br><a href=https://docs.godotengine.org/ja/stable/tutorials/assets_pipeline/importing_audio_samples.html#doc-importing-audio-samples target=_blank>オーディオサンプルのインポート</a></em></p></blockquote><br><p>ところで、今回インポートしていただいた素材のうち、BGM 用のサウンド素材で 1 つだけループ開始位置を編集する必要がある。「Level1」シーンで使用する予定の「Land.ogg」だ。イントロは初回のみ再生され、それ以降ループされて再生位置が前に戻るときは、曲の頭ではなくイントロ部分を省いた位置から再生されるようにしたい。これも Godot エディタ上で調整できる。以下の手順で実際に編集しよう。</p><ol><li>ファイルシステムドックで「res://Assets/Audio/Land.ogg」を選択し、インポートドックを開く</li><li>「Loop Offset」のパラメータをイントロが終わる秒数「9.142」に設定して、「再インポート」ボタンをクリック<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img6.png alt="Loop Offset の編集"></li></ol><br><p>ちなみに、今後、ご自身で作曲される場合に役立つのでループ開始位置の計算方法もお伝えしておく。</p><ol><li>まず曲全体の長さを確認する。Godot エディタ上で確認する場合は、ファイルシステムで該当のファイルをダブルクリックすると、インスペクターにファイルの情報が表示される。この時、一番右下に表示されている秒数が曲の長さだ。「Land.ogg」の場合は 32.00 秒となっている（単位の s は seconds の略）。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img7.png alt=曲の長さ></li><li>「曲の長さ」÷「曲全体の小節数」=「1小節の長さ」が求められる。</li><li>「1小節の長さ」×「イントロの小節数」でイントロの長さが求められる。</li><li>「Land.ogg」の場合「曲全体の小節数」は 28 小節「イントロの小節数」は 8 小節なので<br>32.00 ÷ 28 × 8 = 9.142&mldr;<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img8.png alt=電卓計算結果><br>と、割り切れない場合は、小数点以下第3位までで切り捨て、または小数点以下第4位で四捨五入する。0.001秒の差はほとんど気にならないからどちらでも大丈夫だ。</li></ol><br><p>さて、これでサウンド素材の下準備は完了だ。ここからの全体的な作業の流れとしては、先にゲームのパーツになる SFX のみ必要なシーン（「Player」や「Item」など）から編集し、そのあと画面を構成する大きなシーン（「GameStart」や「Level1」など）に BGM、SFX を追加していく。</p><p>シーンごとの作業は以下の順番で進めていこう。</p><ol><li>ノードの追加</li><li>ノードのプロパティの編集</li><li>スクリプトのアタッチ＆コーディング</li></ol><br><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=player-シーン>Player シーン</h1><p>それではまずはじめに「Player.tscn」を開いてサウンドを追加していこう。このシーンに必要な SFX は、以下の4種類だ。</p><ul><li>プレイヤーキャラクターの足音</li><li>プレイヤーキャラクターがジャンプする音</li><li>プレイヤーキャラクターが敵に当たってダメージを受けた時の音</li><li>プレイヤーキャラクターのヘルスがゼロになった時の音</li></ul><br><h2 id=audiostreamplayer2d-ノードを追加する>AudioStreamPlayer2D ノードを追加する</h2><p>「Player」ルートノードに「AudioStreamPlayer2D」クラスのノードを4つ追加して、それぞれ「StepSFX」「JumpSFX」「DamageSFX」「DieSFX」という名前にそれぞれ変更しよう。これらのノードは先述した 4 つの効果音ごとに分けて利用する。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img24.1.png alt=AudioStreamPlayer2Dを追加></p><p>なお、「AudioStreamPlayer」は位置に関係なくサウンドを再生するが、「AudioStreamPlayer2D」は画面上の位置を利用して、カメラとの距離が遠ければ音量を小さくするなどできる。このチュートリアルではその辺りの細かな演出をする機会はないが、画面上に配置するオブジェクトのシーンであれば「AudioStreamPlayer2D」を利用するという認識を持っておいて良いだろう。</p><blockquote><p><em><strong><span style=color:salmon>公式オンラインドキュメント：</span></strong><br><a href=https://docs.godotengine.org/ja/stable/classes/class_audiostreamplayer2d.html#class-audiostreamplayer2d target=_blank>AudioStreamPlayer2D</a><br><a href=https://docs.godotengine.org/ja/stable/classes/class_audiostreamplayer.html target=_blank>AudioStreamPlayer</a></em></p></blockquote><br><h2 id=audiostreamplayer2d-ノードを編集する>AudioStreamPlayer2D ノードを編集する</h2><p>以下のノードとリソースの組み合わせで、それぞれのノードの「Stream」プロパティに適切なサウンドリソースを適用しよう。ファイルシステムドックから下記のリソースファイルをインスペクター上の「Stream」プロパティめがけてドラッグ&ドロップする。</p><ul><li>「StepSFX」ノード：res://Assets/Audio/FootStep.wav</li><li>「JumpSFX」ノード：res://Assets/Audio/Jump.wav</li><li>「DamageSFX」ノード：res://Assets/Audio/TakeDamage.wav</li><li>「DieSFX」ノード：res://Assets/Audio/Die.wav</li></ul><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img24.1.1.png alt=Streamプロパティ></p><p>この「Player」シーンを含めて、基本的に「Stream」プロパティ以外の編集が不要なシーンが多いが、音量が大きすぎる、または小さすぎると感じる場合は、適宜「Volume Db」プロパティの値で調整して欲しい。音量の確認は「Stream」プロパティの適用済みリソースをクリックし、インスペクター下部の再生/停止ボタンを利用するのが良いだろう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img24.1.2.png alt=Streamプロパティ></p><p><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img24.1.3.png alt=Streamプロパティ></p><br><h2 id=スクリプトを編集して-sfx-の再生を制御する>スクリプトを編集して SFX の再生を制御する</h2><p>「Player.gd」スクリプトを編集してサウンド再生を制御する。</p><p>まずは以下の 4 つの「AudioStreamPlayer2D」ノードを参照するプロパティを定義する。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>step_sfx</span> <span class=o>=</span> <span class=nx>$StepSFX</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>jump_sfx</span> <span class=o>=</span> <span class=nx>$JumpSFX</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>damage_sfx</span> <span class=o>=</span> <span class=nx>$DamageSFX</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>die_sfx</span> <span class=o>=</span> <span class=nx>$DieSFX</span> <span class=c1># 追加</span>
</span></span></code></pre></div><br><h3 id=足音>足音</h3><p>まずはプレイヤーキャラクターが走っている時の足音から追加しよう。</p><p>「StepSFX」のサウンドは、「AnimatedSprite」ノードの「run」アニメーションでキャラクターのテクスチャの足が地面についたタイミングでだけ再生したい。アニメーションを確認すると、Frame 4 と 10 がそれに該当することがわかる。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img24.2.png alt=AnimatedSpriteのrunアニメーション></p><p>これを実現するには、Frame が変わるたびに発信されるシグナルを利用し、<code>if</code>構文で「run」アニメーション再生時の Frame の数を指定すれば良い。</p><p>さっそくシグナルの接続を行おう。「AnimatedSprite」ノードの「frame_changed()」シグナルを「Player.gd」スクリプトに接続すればOKだ。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img24.3.png alt=AnimatedSpriteのrunアニメーション></p><p>スクリプトに<code>_on_AnimatedSprite_frame_changed</code>メソッドが追加されたら、それを以下のように編集しよう。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_AnimatedSprite_frame_changed</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>sprite</span><span class=o>.</span><span class=n>animation</span> <span class=o>==</span> <span class=s2>&#34;run&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>sprite</span><span class=o>.</span><span class=n>frame</span> <span class=o>==</span> <span class=mi>4</span>  <span class=ow>or</span> <span class=n>sprite</span><span class=o>.</span><span class=n>frame</span> <span class=o>==</span> <span class=mi>10</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>step_sfx</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span>
</span></span></code></pre></div><p>これで足音の SFX が追加できたはずだ。「Level1」シーンで確認してみよう。</p><div><video controls autoplay loop muted playsinline aria-label=FootStepサウンド確認 style=width:100%;height:auto>
<source src=/images/tutorials/gd0005_platformer/platformer_13/img24.4.mp4 type=video/mp4>Your browser does not support the video tag.</video></div><br><h3 id=ジャンプする音>ジャンプする音</h3><p>次はプレイヤーキャラクターがジャンプした時の音を追加する。これには<code>_physics_process</code>メソッド内でジャンプを制御しているコードの箇所にサウンド再生のコードを追加すれば良い。以下のコードの「# 追加」のコメントがあるたった 1 行が更新箇所だ。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_physics_process</span><span class=p>(</span><span class=n>delta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>velocity</span><span class=o>.</span><span class=n>y</span> <span class=o>+=</span> <span class=n>gravity</span> <span class=o>*</span> <span class=n>delta</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=n>x_input</span> <span class=o>=</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>get_action_strength</span><span class=p>(</span><span class=s2>&#34;move_right&#34;</span><span class=p>)</span> <span class=o>-</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>get_action_strength</span><span class=p>(</span><span class=s2>&#34;move_left&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>x_input</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>+=</span> <span class=n>x_input</span> <span class=o>*</span> <span class=n>acceleration</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>is_action_pressed</span><span class=p>(</span><span class=s2>&#34;dash&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=nb>clamp</span><span class=p>(</span><span class=n>velocity</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=o>-</span><span class=n>max_dash_speed</span><span class=p>,</span> <span class=n>max_dash_speed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=nb>clamp</span><span class=p>(</span><span class=n>velocity</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=o>-</span><span class=n>max_speed</span><span class=p>,</span> <span class=n>max_speed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=n>flip_h</span> <span class=o>=</span> <span class=n>x_input</span> <span class=o>&lt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nf>is_on_floor</span><span class=p>():</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>x_input</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;idle&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=nb>lerp</span><span class=p>(</span><span class=n>velocity</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>friction</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;run&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>is_action_just_pressed</span><span class=p>(</span><span class=s2>&#34;jump&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>			<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;jump&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>y</span> <span class=o>=</span> <span class=o>-</span><span class=n>jump_force</span>
</span></span><span class=line><span class=cl>			<span class=c1># JumpSFXノードのサウンドを再生する（ジャンプ音）</span>
</span></span><span class=line><span class=cl>			<span class=n>jump_sfx</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>x_input</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=nb>lerp</span><span class=p>(</span><span class=n>velocity</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>air_resistance</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>is_action_just_released</span><span class=p>(</span><span class=s2>&#34;jump&#34;</span><span class=p>)</span> <span class=ow>and</span> <span class=n>velocity</span><span class=o>.</span><span class=n>y</span> <span class=o>&lt;</span> <span class=o>-</span><span class=n>jump_force</span> <span class=o>/</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>y</span> <span class=o>=</span> <span class=o>-</span><span class=n>jump_force</span> <span class=o>/</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>velocity</span> <span class=o>=</span> <span class=nf>move_and_slide</span><span class=p>(</span><span class=n>velocity</span><span class=p>,</span> <span class=nc>Vector2</span><span class=o>.</span><span class=n>UP</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1># Added @ Part 3</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>position</span><span class=o>.</span><span class=n>x</span> <span class=o>&lt;</span> <span class=mi>16</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>position</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=mi>16</span>
</span></span></code></pre></div><br><p>「Level1」シーンで確認してみよう。</p><p><div><video controls autoplay loop muted playsinline aria-label=Jumpサウンド確認 style=width:100%;height:auto>
<source src=/images/tutorials/gd0005_platformer/platformer_13/img24.5.mp4 type=video/mp4>Your browser does not support the video tag.</video></div><br><br></p><h3 id=敵に当たってダメージを受けた時の音>敵に当たってダメージを受けた時の音</h3><p>続いて、プレイヤーキャラクターが敵キャラクターに当たってダメージを受けた時のサウンド再生を制御する。これは既存の<code>_on_HitBox_body_entered</code>メソッドにサウンド再生のコードを少し足すだけだ。このメソッドは「HitBox」ノードのコリジョン形状に敵キャラクターを含む物理ボディが当たったら呼ばれる。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1># HitBox ノードのコリジョン形状に物理ボディが当たった時に呼ばれるメソッド</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_HitBox_body_entered</span><span class=p>(</span><span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>body</span><span class=o>.</span><span class=nf>is_in_group</span><span class=p>(</span><span class=s2>&#34;Enemies&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Enemy hit player. Damage is &#34;</span><span class=p>,</span> <span class=n>body</span><span class=o>.</span><span class=n>damage</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nf>emit_signal</span><span class=p>(</span><span class=s2>&#34;enemy_hit&#34;</span><span class=p>,</span> <span class=n>body</span><span class=o>.</span><span class=n>damage</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;hit&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=c1># DamageSFX ノードのサウンドを再生する</span>
</span></span><span class=line><span class=cl>		<span class=n>damage_sfx</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># 追加</span>
</span></span></code></pre></div><br><p>「Level1」シーンで確認してみよう。</p><p><div><video controls autoplay loop muted playsinline aria-label=Damageサウンド確認 style=width:100%;height:auto>
<source src=/images/tutorials/gd0005_platformer/platformer_13/img24.6.mp4 type=video/mp4>Your browser does not support the video tag.</video></div><br><br></p><h3 id=ヘルスがゼロになって死んだ時の音>ヘルスがゼロになって死んだ時の音</h3><p>プレイヤーキャラクターに実装する最後の SFX は死亡した時のサウンドだ。敵に当たるか、画面下へ落下してヘルスバーが 0 になった場合に再生されるようにする。ヘルスバーの制御は「Game.gd」スクリプトの方でやっているので、そちらを編集しよう。</p><p>「Game.gd」スクリプトを開いたら<code>manage_health</code>メソッドに 1 行追加するだけだ。「# 追加」のコメントをしている箇所だ。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>func</span> <span class=nf>manage_health</span><span class=p>(</span><span class=n>damage</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>health</span> <span class=o>-=</span> <span class=n>damage</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Health updated: &#34;</span><span class=p>,</span> <span class=n>health</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>hud</span><span class=o>.</span><span class=nf>update_health</span><span class=p>(</span><span class=n>health</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>health</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>player</span><span class=o>.</span><span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;die&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=c1># Player インスタンスノードの DieSFX ノードのサウンドを再生</span>
</span></span><span class=line><span class=cl>		<span class=n>player</span><span class=o>.</span><span class=n>die_sfx</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>player</span><span class=o>.</span><span class=n>anim_player</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=n>gameover</span> <span class=o>=</span> <span class=nb>load</span><span class=p>(</span><span class=s2>&#34;res://UI/GameOver/GameOver.tscn&#34;</span><span class=p>)</span><span class=o>.</span><span class=nf>instance</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=n>ui_layer</span><span class=o>.</span><span class=nf>add_child</span><span class=p>(</span><span class=n>gameover</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Game over screen is shown up.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nf>get_tree</span><span class=p>()</span><span class=o>.</span><span class=n>paused</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Scene tree paused: &#34;</span><span class=p>,</span> <span class=nf>get_tree</span><span class=p>()</span><span class=o>.</span><span class=n>paused</span><span class=p>)</span>
</span></span></code></pre></div><p>ヘルスが 0 以下になった時に「die」アニメーションと同時に SFX も再生される。そして、再生が終了するまで待機してからゲームオーバー画面に遷移する。</p><p>では実際にプロジェクトを実行して挙動を確認しておこう。</p><p><div><video controls autoplay loop muted playsinline aria-label=Dieサウンド確認 style=width:100%;height:auto>
<source src=/images/tutorials/gd0005_platformer/platformer_13/img24.7.mp4 type=video/mp4>Your browser does not support the video tag.</video></div><br><br></p><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=enemy-シーン>Enemy シーン</h1><p>続いて敵キャラクターのサウンドを実装する。敵キャラクターのサウンドはプレイヤーキャラクターに踏まれた時の SFX のみだ。では「Enemy.tscn」シーンファイルを開いて編集していこう。</p><br><h2 id=audiostreamplayer2d-ノードを追加してプロパティを編集する>AudioStreamPlayer2D ノードを追加してプロパティを編集する</h2><p>「Enemy」ルートノードに「AudioStreamPlayer2D」クラスのノードを 1 つ追加しよう。同じクラスのノードは他にないので、名前はそのままにしておこう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img24.8.1.png alt=AudioStreamPlayer2Dを追加></p><br><p>「AudioStreamPlayer2D」ノードの「Stream」プロパティに「res://Assets/Audio/HitEnemy.wav」を適用しよう。必要に応じて「Volume Db」プロパティで音量を調整してほしい。</p><br><h2 id=スクリプトを編集して-sfx-の再生を制御する-1>スクリプトを編集して SFX の再生を制御する</h2><p>「Enemy.gd」スクリプトを開いて、編集していこう。SFX の再生を制御する。</p><p>まずはこれまで同様、「AudioStreamPlayer2D」ノードを参照するプロパティを定義しよう。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1># AudioStreamPlayer2D ノードの参照</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>audio_player</span> <span class=o>=</span> <span class=nx>$AudioStreamPlayer2D</span>
</span></span></code></pre></div><br><p>続けて、プレイヤーキャラクターを含む物理ボディが、「HitBox」のコリジョン形状に入った時に呼ばれる<code>_on_HitBox_body_entered</code>メソッドを更新する。「# 追加」とコメントしている行が更新箇所だ。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1># 物理ボディが HitBox に入ったら呼ばれるメソッド</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_HitBox_body_entered</span><span class=p>(</span><span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>body</span><span class=o>.</span><span class=nf>is_in_group</span><span class=p>(</span><span class=s2>&#34;Players&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Player entered in &#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;hit&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=c1># AudioStreamPlayer2D ノードのサウンドを再生</span>
</span></span><span class=line><span class=cl>		<span class=n>audio_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>sprite</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=c1># AudioStreamPlayer2D のサウンド再生が終了するまで待機</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>audio_player</span><span class=p>,</span> <span class=s2>&#34;finished&#34;</span><span class=p>)</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>		<span class=nf>queue_free</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=s2>&#34; died&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>これで、プレイヤーキャラクターが敵キャラクターを踏んづけた時に、SFX が再生され、再生が終了してから<code>queue_free</code>メソッドにて敵キャラクターオブジェクトが解放される。</p><p>では「Level1」シーンを実行して動作確認をしておこう。</p><p><div><video controls autoplay loop muted playsinline aria-label=HitEnemyサウンド確認 style=width:100%;height:auto>
<source src=/images/tutorials/gd0005_platformer/platformer_13/img24.8.2.mp4 type=video/mp4>Your browser does not support the video tag.</video></div><br><br></p><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=item-シーン>Item シーン</h1><p>続いてアイテムのサウンドを実装する。アイテムのサウンドはプレイヤーキャラクターが当たった時の SFX のみだ。ちょうどスーパーマリオがコインを取った時の「キラン」という SFX と同様の演出だ。では「Item.tscn」シーンファイルを開いて編集していこう。</p><br><h2 id=audiostreamplayer2d-ノードを追加してプロパティを編集する-1>AudioStreamPlayer2D ノードを追加してプロパティを編集する</h2><p>「Item」ルートノードに「AudioStreamPlayer2D」クラスのノードを1つ追加しよう。同じクラスのノードは他にないので、今回も名前はそのままだ。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img24.8.3.png alt=AudioStreamPlayer2Dを追加></p><br><p>「AudioStreamPlayer2D」ノードの「Stream」プロパティに「res://Assets/Audio/GetItem.wav」を適用しよう。必要に応じて「Volume Db」プロパティで音量を調整しよう。</p><br><h2 id=スクリプトを編集して-sfx-の再生を制御する-2>スクリプトを編集して SFX の再生を制御する</h2><p>では「Item.gd」スクリプトを編集して SFX を制御していく。</p><p>例によって、まずは「AudioStreamPlayer2D」ノードを参照するプロパティを定義しよう。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1># AudioStreamPlayer2D ノードの参照</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>audio_player</span> <span class=o>=</span> <span class=nx>$AudioStreamPlayer2D</span> <span class=c1># 追加</span>
</span></span></code></pre></div><br><p>続けて、プレイヤーキャラクターを含む物理ボディが、「Item」のコリジョン形状に入った時に呼ばれるメソッドを更新する。「# 追加」とコメントしている行が更新箇所だ。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>func</span> <span class=nf>hit</span><span class=p>(</span><span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Got &#34;</span><span class=p>,</span> <span class=n>point</span><span class=p>,</span> <span class=s2>&#34; point.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>body</span><span class=o>.</span><span class=nf>emit_signal</span><span class=p>(</span><span class=s2>&#34;item_hit&#34;</span><span class=p>,</span> <span class=n>point</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;hit&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1># AudioStreamPlayer2D ノードのサウンドを再生する</span>
</span></span><span class=line><span class=cl>	<span class=n>audio_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>	<span class=k>yield</span><span class=p>(</span><span class=n>anim_player</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1># AudioStreamPlayer2D のサウンド再生が終了するまで待機</span>
</span></span><span class=line><span class=cl>	<span class=k>yield</span><span class=p>(</span><span class=n>audio_player</span><span class=p>,</span> <span class=s2>&#34;finished&#34;</span><span class=p>)</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>	<span class=nf>queue_free</span><span class=p>()</span>
</span></span></code></pre></div><p>これで、アイテムを取ったら、SFX が再生されてからアイテムが解放されるようになったはずだ。</p><p>このまま続けて「BrokenBox」シーンのサウンドも追加していこう。</p><hr><h1 id=brokenbox-シーン>BrokenBox シーン</h1><p>アイテムボックスに追加するサウンドは、壊れた時の SFX だ。「ItemBox.tscn」シーンファイルを編集したいところだが、一番簡単なのは、壊れた時に「ItemBox」シーンツリーにそのインスタンスが追加される「BrokenBox.tscn」の方だ。ではこのシーンを開いて編集していこう。</p><br><h2 id=audiostreamplayer2d-ノードを追加してプロパティを編集する-2>AudioStreamPlayer2D ノードを追加してプロパティを編集する</h2><p>「BrokenBox」ルートノードに「AudioStreamPlayer2D」ノードを追加しよう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img24.8.4.png alt=AudioStreamPlayer2Dを追加></p><p>追加した「AudioStreamPlayer2D」ノードにの「Stream」プロパティにリソース「res://Assets/Audio/BreakBox.wav」を適用しよう。</p><br><h2 id=スクリプトを編集して-sfx-の再生を制御する-3>スクリプトを編集して SFX の再生を制御する</h2><p>続けて「BrokenBox.gd」スクリプトを以下のように編集する。</p><p>まずは「AudioStreamPlayer2D」ノードを参照するプロパティを定義。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1># AudioStreamPlayer2D ノードの参照</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>audio_player</span> <span class=o>=</span> <span class=nx>$AudioStreamPlayer2D</span>
</span></span></code></pre></div><br><p>次に<code>_ready</code>メソッド内にサウンド再生のコードを追加し、シーンが読み込まれたらサウンを再生するようにする。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>emitting</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>	<span class=c1># ノードが読み込まれたら AudioStreamPlayer2D ノードのサウンドを再生</span>
</span></span><span class=line><span class=cl>	<span class=n>audio_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span>
</span></span></code></pre></div><p>これで箱が壊れた瞬間にこのシーンが読み込まれ、同時に SFX が再生されるはずだ。</p><p>ではアイテムを取った時の音とアイテムボックスが壊れた時の音がそれぞれ正しく再生されるか、「Level1」シーンでまとめて確認してみよう。</p><p><div><video controls autoplay loop muted playsinline aria-label=Dieサウンド確認 style=width:100%;height:auto>
<source src=/images/tutorials/gd0005_platformer/platformer_13/img24.8.5.mp4 type=video/mp4>Your browser does not support the video tag.</video></div><br><br></p><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=startpoint-シーン>StartPoint シーン</h1><p>スタートポイントはそれぞれのレベルでプレイヤーキャラクターが最初に降り立つ場所に設置している市松模様の台と右向き矢印の標識がテクスチャのシーンだ。市松模様の台の上にコリジョン形状を設定しているので、そこに乗ったら、適当な SFX が鳴るようにする。</p><p>では「StartPoint.tscn」シーンファイルを開いて編集していこう。</p><h2 id=audiostreamplayer-ノードを追加してプロパティを編集する>AudioStreamPlayer ノードを追加してプロパティを編集する</h2><p>「StartPoint」ルートノードに「AudioStreamPlayer2D」クラスのノードを1つ追加しよう。同じクラスのノードは他にないので、名前はそのままでも良いだろう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img25.png alt=AudioStreamPlayerを追加></p><p>次に、インスペクタードックで「AudioStreamPlayer2D」ノードのプロパティを編集する。「Stream」プロパティにリソースファイル「res://Assets/Audio/StartPoint.wav」を適用しよう。</p><br><h2 id=スクリプトを編集して-sfx-の再生を制御する-4>スクリプトを編集して SFX の再生を制御する</h2><p>「StartPoing.gd」スクリプトを編集してサウンド再生を制御する。</p><p>まずは「AudioStreamPlayer2D」ノードを参照するプロパティを定義する。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1># AudioStreamPlayer2D ノードの参照</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>audio_player</span> <span class=o>=</span> <span class=nx>$AudioStreamPlayer2D</span> <span class=c1># 追加</span>
</span></span></code></pre></div><br><p>次に以下のメソッドを更新しよう。「# 追加」のコメントの行が更新箇所だ。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1># 物理ボディが Area2D ノードのコリジョン形状に入ったら呼ばれるメソッド</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_StartPoint_body_entered</span><span class=p>(</span><span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>body</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=s2>&#34;Player&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;moving&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=c1># AudioStreamPlayer2D ノードのサウンドを再生</span>
</span></span><span class=line><span class=cl>		<span class=n>audio_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># 追加</span>
</span></span></code></pre></div><p>これで、スタートポイントの台にプレイヤーキャラクターが乗ったら SFX が再生されるようになったはずだ。</p><p>「Level1」シーンを再生して確認してみよう。</p><p><div><video controls autoplay loop muted playsinline aria-label=Level1シーンを再生してStartPointシーンのサウンド確認 style=width:100%;height:auto>
<source src=/images/tutorials/gd0005_platformer/platformer_13/img26.mp4 type=video/mp4>Your browser does not support the video tag.</video></div><br><br></p><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=checkpoint-シーン>Checkpoint シーン</h1><p>チェックポイントは、各レベルの真ん中くらいに設置している通過点で、最初はただのポールだが、プレイヤーキャラクターが当たるとポールに市松模様のフラグがつく。これも当たった時に適当な SFX が鳴るようにする。</p><p>では「Checkpoint.tscn」シーンファイルを開いてサウンドを追加していこう。</p><br><h2 id=audiostreamplayer2d-ノードを追加してプロパティを編集する-3>AudioStreamPlayer2D ノードを追加してプロパティを編集する</h2><p>「Checkpoint」ルートノードに「AudioStreamPlayer2D」クラスのノードを1つ追加しよう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img27.png alt=AudioStreamPlayerを追加></p><p>続けて「AudioStreamPlayer2D」ノードの「Stream」プロパティにリソース「res://Assets/Audio/Checkpoint.wav」を適用する。</p><br><h2 id=スクリプトを編集して-sfx-の再生を制御する-5>スクリプトを編集して SFX の再生を制御する</h2><p>「Checkpoint.gd」スクリプトを編集してサウンド再生を制御する。</p><p>まずは以下のプロパティを追加する。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1># AudioStreamPlayer2D ノードの参照</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>audio_player</span> <span class=o>=</span> <span class=nx>$AudioStreamPlayer2D</span> <span class=c1># 追加</span>
</span></span></code></pre></div><br><p>次に以下のメソッドを更新しよう。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1># 物理ボディがコリジョン形状に入ったら呼ばれるメソッド</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_Checkpoint_body_entered</span><span class=p>(</span><span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>body</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=s2>&#34;Player&#34;</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>is_checked</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;flag_out&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=c1># AudioStreamPlayer2D ノードのサウンドを再生</span>
</span></span><span class=line><span class=cl>		<span class=n>audio_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>sprite</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;flag_idle&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>is_checked</span> <span class=o>=</span> <span class=kc>true</span>
</span></span></code></pre></div><p>これで、プレイヤーキャラクターがチェックポイントのフラグに当たると SFX が再生されるはずだ。これも「Level1」シーンで確認してみよう。</p><p><div><video controls autoplay loop muted playsinline aria-label=Level1シーンを再生してStartPointシーンのサウンド確認 style=width:100%;height:auto>
<source src=/images/tutorials/gd0005_platformer/platformer_13/img28.mp4 type=video/mp4>Your browser does not support the video tag.</video></div><br><br></p><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=endpoint-シーン>EndPoint シーン</h1><p>エンドポイントは各レベルのゴールとして用意している、優勝カップのようなテクスチャのオブジェクトだ。このカップにプレイヤーキャラクターが入ると次のシーンにワープするような演出のアニメーションが再生される。これに合わせるようにして、ワープっぽい SFX を同時に再生させよう。</p><p>では「EndPoint.tscn」シーンファイルを開いて編集していく。</p><br><h2 id=audiostreamplayer2d-ノードを追加してプロパティを編集する-4>AudioStreamPlayer2D ノードを追加してプロパティを編集する</h2><p>「EndPoint」ルートノードに「AudioStreamPlayer2D」クラスのノードを1つ追加しよう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img29.png alt=AudioStreamPlayerを追加></p><p>「AudioStreamPlayer2D」ノードの「Stream」プロパティにリソース「res://Assets/Audio/Warp2.wav」を適用しよう。ただ、ワープ用の SFX リソースを 3 つ用意している。「Warp2.wav」が（個人的には）一番しっくりくるので、このチュートリアルではこれを採用するが、あなたのお好みのものを適用していただければOKだ。</p><br><h2 id=スクリプトを編集して-sfx-の再生を制御する-6>スクリプトを編集して SFX の再生を制御する</h2><p>「EndPoint.gd」スクリプトを編集してサウンド再生を制御する。</p><p>まずはこれまで同様「AudioStreamPlayer2D」ノードの参照プロパティを定義する。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1># AudioStreamPlayer2D ノードの参照</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>audio_player</span> <span class=o>=</span> <span class=nx>$AudioStreamPlayer2D</span> <span class=c1># 追加</span>
</span></span></code></pre></div><br><p>そして、プレイヤーキャラクターを含む物理ボディが当たったら呼ばれるメソッド内で、サウンドの再生と再生が終了するまで待つコードを追加する。「# 追加」のコメントがある行だ。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1># 物理ボディがコリジョン形状に入ったら呼ばれるメソッド</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_EndPoint_body_entered</span><span class=p>(</span><span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>body</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=s2>&#34;Player&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;clear&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>anim_player</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>particle</span><span class=o>.</span><span class=n>emitting</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>		<span class=n>body</span><span class=o>.</span><span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;clear&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=c1># AudioStreamPlayer2D ノードのサウンドを再生</span>
</span></span><span class=line><span class=cl>		<span class=n>audio_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>body</span><span class=o>.</span><span class=n>anim_player</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=c1># AudioStreamPlayer2D ノードのサウンド再生が終了するまで待機</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>audio_player</span><span class=p>,</span> <span class=s2>&#34;finished&#34;</span><span class=p>)</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Moving to the next level!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nf>get_parent</span><span class=p>()</span><span class=o>.</span><span class=nf>queue_free</span><span class=p>()</span>
</span></span></code></pre></div><p>これでプレイヤーキャラクターがエンドポイントの優勝カップに入ったら、ワープのアニメーションとともにワープっぽい SFX が再生され、アニメーションとサウンドが終了次第、現在のレベルシーンが解放され、次のレベルシーンに画面遷移する。</p><p>「Level1」シーンで SFX の再生と再生後の「Level1」シーンの解放まで確認しよう。最後までプレイするのが面倒なので、「EndPoint2」インスタンスノードを「Level1」ルートノードに追加してスタートポイント付近に設置してテストするのが手っ取り早い。テストが終わったら追加したインスタンスノードを削除すればOKだ。</p><p><div><video controls autoplay loop muted playsinline aria-label=Level1シーンを再生してStartPointシーンのサウンド確認 style=width:100%;height:auto>
<source src=/images/tutorials/gd0005_platformer/platformer_13/img30.mp4 type=video/mp4>Your browser does not support the video tag.</video></div><br><br></p><p>ここまででパーツ的なシーンのサウンド追加作業は完了だ。少し休憩しよう。休憩後は BGM が必要なシーンを順番に編集していく。</p><br><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=gamestart-シーン>GameStart シーン</h1><p>ここからは BGM の追加が必要なシーンを編集していく。</p><p>まずはスタート画面から編集する。「GameStart.tscn」シーンが読み込まれた瞬間から BGM を流したい。ゲームの一番最初に流れる BGM だ。そして、ゲームを開始するためにスペースキーやエンターキーを押した時に再生される SFX も追加しよう。</p><br><h2 id=audiostreamplayer-ノードを追加する>AudioStreamPlayer ノードを追加する</h2><p>「GameStart」ルートノードに「AudioStreamPlayer」クラスのノードを2つ追加して、それぞれ「BGMPlayer」「SFXPlayer」という名前に変更しよう。その名の通り、BGM を鳴らすためのノードと SFX を鳴らすためのノードを別々で追加した。理由は、後ろで BGM が鳴っている間に効果音を鳴らす必要があるからだ。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img9.png alt=AudioStreamPlayerを追加></p><br><h2 id=bgmplayer-ノードを編集する>BGMPlayer ノードを編集する</h2><p>「BGMPlayer」ノードのプロパティを以下の手順で編集していこう。</p><ol><li>インスペクターの「Stream」プロパティへファイルシステムドックから「res://Assets/Audio/TitleScreen.ogg」をドラッグ&ドロップして素材を追加しよう。</li><li>最後に「Autoplay」プロパティをオンにしよう。シーンが読み込まれた瞬間からBGM が自動的に再生されるようにするためだ。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img13.png alt=Autoplayプロパティ></li></ol><br><h2 id=sfxplayer-ノードを編集する>SFXPlayer ノードを編集する</h2><p>次は「SFXPlayer」ノードのプロパティを同様の手順で編集していこう。</p><ol><li>インスペクターの「Stream」プロパティへファイルシステムドックから「res://Assets/Audio/PressEnter.wav」をドラッグ&ドロップして素材を追加しよう。</li><li>もし音量が大きすぎる、または小さすぎると感じる場合は「Volume Db」プロパティの値を調整しよう。</li><li>「Autoplay」プロパティは <strong>オフ</strong> にしておく。SFX の再生のタイミングはスクリプトで制御するからだ。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img14.png alt=Autoplayプロパティ></li></ol><br><h2 id=スクリプトを編集して-sfx-の再生を制御する-7>スクリプトを編集して SFX の再生を制御する</h2><p>では SFX の再生をスクリプトで制御する。「GameStart.gd」スクリプトを開いて編集していこう。</p><p>まずは「SFXPlayer」ノードを参照するプロパティを追加する。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1># SFXPlayer ノードの参照</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sfx_player</span> <span class=o>=</span> <span class=nx>$SFXPlayer</span>
</span></span></code></pre></div><p>続いて<code>_on_StartButton_button_up</code>メソッドを編集する。「# 追加」とコメントしている行が更新した箇所だ。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_StartButton_button_up</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=c1>#print(&#34;_on_StartButton_button_up called.&#34;)</span>
</span></span><span class=line><span class=cl>	<span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;press_start&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>	<span class=k>yield</span><span class=p>(</span><span class=n>anim_player</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>yield</span><span class=p>(</span><span class=n>sfx_player</span><span class=p>,</span> <span class=s2>&#34;finished&#34;</span><span class=p>)</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>	<span class=nf>queue_free</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;GameStart scene is now freed.&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>「SFXPlayer」ノードの<code>play</code>メソッドで「Stream」プロパティにセットされている音源を再生する。<code>yield</code>関数により、その SFX の再生が終了するまで待機する。そのあと<code>queue_free</code>メソッドによりスタート画面のインスタンスノードが解放される流れだ。</p><p>これで、スタート画面でスタートボタンをクリック、またはスペースキーまたはエンターキーを押したら、SFX が再生されるようになったはずだ。</p><p>シーンを再生して動作確認をしておこう。下の動画では次の項目を確認している。</p><ul><li>シーンが読み込まれて BGM が自動再生されるか</li><li>BGM がループ再生されるか</li><li>スペースキーを押して SFX が再生されるか</li></ul><p><div><video controls autoplay loop muted playsinline aria-label=GameStartシーンを再生 style=width:100%;height:auto>
<source src=/images/tutorials/gd0005_platformer/platformer_13/img15.mp4 type=video/mp4>Your browser does not support the video tag.</video></div><br><br></p><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=characterselect-シーン>CharacterSelect シーン</h1><p>次はプレイヤーキャラクター選択画面だ。</p><p>「CharacterSelect.tscn」シーンでも、画面が読み込まれた瞬間から BGM を流したい。いよいよゲームが始まるぞ、とワクワクする感じのドラムマーチ的な音楽を適用しよう。</p><p>一方、この画面上の操作に合わせて SFX も追加したい。まず必要なのは、左右矢印キー（または画面上のアイコンをクリック）で、キャラクターを切り替える時の SFX 。それに、好きなキャラクターを選んだあと、スペースキーかエンターキーを押して確定させた時の SFX。これはスタート画面と同じ SFX で良いだろう。</p><p>では「CharacterSelect.tscn」シーンファイルを開いてサウンドを追加していこう。</p><br><h2 id=audiostreamplayer-ノードを追加する-1>AudioStreamPlayer ノードを追加する</h2><p>「CharacterSelect」ルートノードに「AudioStreamPlayer」クラスのノードを2つ追加して、それぞれ「BGMPlayer」「SFXPlayer」という名前に変更しよう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img16.png alt=AudioStreamPlayerを追加></p><br><h2 id=bgmplayer-ノードを編集する-1>BGMPlayer ノードを編集する</h2><p>「BGMPlayer」ノードのプロパティを編集する。</p><ol><li>インスペクターの「Stream」プロパティへファイルシステムドックから「res://Assets/Audio/CharacterSelect.ogg」をドラッグ&ドロップして素材を追加する。</li><li>必要に応じて、音量を「Volume Db」プロパティの値を上げ下げして調節する。この音源の場合 -5 ~ -10 くらいがちょうど良いかもしれない。</li><li>「Autoplay」プロパティをオンにする。</li></ol><br><h2 id=sfxplayer-ノードを編集する-1>SFXPlayer ノードを編集する</h2><p>次に「SFXPlayer」ノードのプロパティ編集だが、インスペクターで編集することは特にない。今までリソースファイルを適用していた「Stream」プロパティの値も今回は[空]にしておいて良い。このあとスクリプトで特定のタイミングで適切なリソースファイルを適用するようにコーディングする。</p><br><h2 id=スクリプトを編集して-sfx-の再生を制御する-8>スクリプトを編集して SFX の再生を制御する</h2><p>では「CharacterSelect.gd」スクリプトを編集して SFX を制御していく。</p><p>まずはプロパティを 2 つ追加する。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1># SFXPlayer ノードの参照</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sfx_player</span> <span class=o>=</span> <span class=nx>$SFXPlayer</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl><span class=c1># SFXPlayer の Stream プロパティに適用する2種類の音源リソースを辞書型データにして定義</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sfx_res</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;select&#34;</span><span class=p>:</span> <span class=nb>preload</span><span class=p>(</span><span class=s2>&#34;res://Assets/Audio/PressSelect.wav&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;enter&#34;</span><span class=p>:</span> <span class=nb>preload</span><span class=p>(</span><span class=s2>&#34;res://Assets/Audio/PressEnter.wav&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=c1># 追加</span>
</span></span></code></pre></div><p>まず「SFXPlayer」ノードを参照するプロパティ<code>sfx_player</code>を定義している。</p><p>もう一つのプロパティ<code>sfx_res</code>は辞書型データで、2種類の音源リソースファイルの<code>preload</code>データを格納する。<code>sfx_res</code>には左右の矢印キーを押した時のサウンドと確定キー（スペースキー、エンターキー）を押した時のサウンドの2種類が格納されている。それぞれ<code>select</code>および<code>onready</code>のキーで辞書内の値を呼び出すことができる。</p><br><p>そして、以下の3つのメソッド内に適切な音源リソースを「SFXPlayer」ノードの「Stream」プロパティに割り当てて、再生するためのコードを追加した。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_LeftButton_pressed</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;press_left&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span><span class=p>(</span><span class=n>sfx_res</span><span class=p>[</span><span class=s2>&#34;select&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>	<span class=c1># SFXPlayer ノードの Stream プロパティに res://Assets/Audio/PressSelect.wav を適用</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=n>stream</span> <span class=o>=</span> <span class=n>sfx_res</span><span class=p>[</span><span class=s2>&#34;select&#34;</span><span class=p>]</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>	<span class=c1># SFXPlayer のサウンドを再生</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>frames_num</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=c1># 以下省略</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_RightButton_pressed</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;press_right&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1># SFXPlayer ノードの Stream プロパティに res://Assets/Audio/PressSelect.wav を適用</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=n>stream</span> <span class=o>=</span> <span class=n>sfx_res</span><span class=p>[</span><span class=s2>&#34;select&#34;</span><span class=p>]</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>	<span class=c1># SFXPlayer のサウンドを再生</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>frames_num</span> <span class=o>&lt;</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=o>.</span><span class=nf>size</span><span class=p>()</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=c1># 以下省略</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>unc</span> <span class=nf>_input</span><span class=p>(</span><span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_pressed</span><span class=p>(</span><span class=s2>&#34;ui_left&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=nf>_on_LeftButton_pressed</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>elif</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_pressed</span><span class=p>(</span><span class=s2>&#34;ui_right&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=nf>_on_RightButton_pressed</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>elif</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_released</span><span class=p>(</span><span class=s2>&#34;ui_accept&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=n>is_choosing</span> <span class=o>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>		<span class=c1># SFXPlayer ノードの Stream プロパティに res://Assets/Audio/PressEnter.wav を適用</span>
</span></span><span class=line><span class=cl>		<span class=n>sfx_player</span><span class=o>.</span><span class=n>stream</span> <span class=o>=</span> <span class=n>sfx_res</span><span class=p>[</span><span class=s2>&#34;enter&#34;</span><span class=p>]</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>		<span class=c1># SFXPlayer のサウンドを再生 </span>
</span></span><span class=line><span class=cl>		<span class=n>sfx_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>		<span class=c1># SFXPlayer ノードのサウンドの再生が終了するまで待機</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>sfx_player</span><span class=p>,</span> <span class=s2>&#34;finished&#34;</span><span class=p>)</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>		<span class=nf>emit_signal</span><span class=p>(</span><span class=s2>&#34;character_selected&#34;</span><span class=p>,</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=p>[</span><span class=n>frames_num</span><span class=p>])</span>
</span></span><span class=line><span class=cl>		<span class=c1>#print(&#34;emitted signal: character_selected&#34;)</span>
</span></span><span class=line><span class=cl>		<span class=nf>queue_free</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;CharacterSelect scene is now freed.&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>「SFXPlayer」ノードは一つだが、スクリプトでサウンドリソースを切り替えることで 2 つの SFX の再生をカバーしている。もちろん、AudioStreamPlayer2D ノードを複数用意してそれぞれに別々のリソースを割り当てても良い。特に今回のチュートリアルのように少ないサウンドリソースしか使わない場合は、ノードを必要数追加する方法の方がわかりやすいかもしれない。もっと大きなプロジェクトで大量の音を扱うことがあれば、シーンツリーをスッキリさせるために、スクリプトで切り替える方法を採用するのも一つだ。</p><p>さて、これで左右矢印ボタンアイコンをクリックまたはキーボードの左右矢印キーを押した時はプレイヤーキャラクターが切り替わると同時に「res://Assets/Audio/PressSelect.wav」を再生し、スペースキーまたはエンターキーを押した時は使用キャラクター確定と同時に「res://Assets/Audio/PressEnter.wav」を再生するようになった。</p><p>それではシーンを再生して動作確認をしておこう。下の動画では次の項目を確認している。</p><ul><li>シーンが読み込まれて BGM が自動再生されるか</li><li>BGM がループ再生されるか</li><li>左右矢印キーを押してキャラクター選択の SFX が再生されるか</li><li>スペースキーを押してキャラクター確定の SFX が再生されるか</li></ul><div><video controls autoplay loop muted playsinline aria-label=CharacterSelectシーンを再生 style=width:100%;height:auto>
<source src=/images/tutorials/gd0005_platformer/platformer_13/img18.mp4 type=video/mp4>Your browser does not support the video tag.</video></div><br><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=gameover-シーン>GameOver シーン</h1><p>続いてゲームオーバー画面のサウンドを追加する。ゲームオーバー画面も表示された瞬間から BGM を流したい。ちょっと暗い残念な感じの曲を長そう。</p><p>SFX としては、以下の 3 種類が必要だ。</p><ul><li>Restart か Quit かを切り替える音（キャラクター選択時と同じで良い）</li><li>選択を確定する音（これまでの確定の音と同じで良い）</li><li>確定した選択をキャンセルする音（これは新しく追加）</li></ul><p>では「GameOver.tscn」シーンファイルを開いてそれぞれのサウンドを追加しよう。</p><br><h2 id=audiostreamplayer-ノードを追加する-2>AudioStreamPlayer ノードを追加する</h2><p>「GameOver」ルートノードに「AudioStreamPlayer」クラスのノードを2つ追加して、それぞれ「BGMPlayer」「SFXPlayer」という名前に変更しよう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img19.png alt=AudioStreamPlayerを追加></p><br><h2 id=bgmplayer-ノードを編集する-2>BGMPlayer ノードを編集する</h2><p>これまでと同様の手順で「BGMPlayer」ノードのプロパティを編集する。</p><ol><li>インスペクターの「Stream」プロパティへファイルシステムドックから「res://Assets/Audio/GameOver.ogg」をドラッグ&ドロップして素材を追加する。</li><li>必要に応じて、音量を「Volume Db」プロパティの値を上げ下げして調節する。</li><li>「Autoplay」プロパティをオンにする。</li></ol><br><h2 id=sfxplayer-ノードを編集する-2>SFXPlayer ノードを編集する</h2><p>続けて「SFXPlayer」ノードのプロパティを編集しよう。</p><ol><li>「Stream」プロパティの値は[空]のままにしておく。</li><li>もし音量が大きすぎたり小さすぎる場合は「Volume Db」プロパティの値を調整する。</li><li>「Autoplay」プロパティは <strong>オフ</strong> にしておく。</li></ol><br><h2 id=スクリプトを編集して-sfx-の再生を制御する-9>スクリプトを編集して SFX の再生を制御する</h2><p>では「GameOver.gd」スクリプトを開いて編集していく。</p><p>まずは、プロパティから定義しよう。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1># SFXPlayer ノードの参照</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sfx_player</span> <span class=o>=</span> <span class=nx>$SFXPlayer</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl><span class=c1># SFXPlayer の Stream プロパティに適用する3種類の音源リソースを辞書型データにして定義</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sfx_res</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;select&#34;</span><span class=p>:</span> <span class=nb>preload</span><span class=p>(</span><span class=s2>&#34;res://Assets/Audio/PressSelect.wav&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;enter&#34;</span><span class=p>:</span> <span class=nb>preload</span><span class=p>(</span><span class=s2>&#34;res://Assets/Audio/PressEnter.wav&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;cancel&#34;</span><span class=p>:</span> <span class=nb>preload</span><span class=p>(</span><span class=s2>&#34;res://Assets/Audio/PressCancel.wav&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=c1># 追加</span>
</span></span></code></pre></div><br><p>次に、4 つのメソッド内に SFX 再生のコードを追加しよう。「# 追加」と記載している行が今回追加した箇所だ。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1># Restart ボタンまたは Quit ボタンを押した時に呼ばれるメソッド</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>work_at_button_up</span><span class=p>(</span><span class=n>option</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=c1># SFXPlayer の Stream プロパティに res://Assets/Audio/PressEnter.wav を適用</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=n>stream</span> <span class=o>=</span> <span class=n>sfx_res</span><span class=p>[</span><span class=s2>&#34;enter&#34;</span><span class=p>]</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>	<span class=c1># SFXPlayer のサウンドを再生</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>	<span class=n>selected_option</span> <span class=o>=</span> <span class=n>option</span>
</span></span><span class=line><span class=cl>	<span class=n>color_rect</span><span class=o>.</span><span class=n>visible</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>selected_option</span> <span class=o>==</span> <span class=n>RESTART</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>confirmation</span><span class=o>.</span><span class=n>dialog_text</span> <span class=o>=</span> <span class=n>restart_text</span>
</span></span><span class=line><span class=cl>	<span class=k>elif</span> <span class=n>selected_option</span> <span class=o>==</span> <span class=n>QUIT</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>confirmation</span><span class=o>.</span><span class=n>dialog_text</span> <span class=o>=</span> <span class=n>quit_text</span>
</span></span><span class=line><span class=cl>	<span class=n>confirmation</span><span class=o>.</span><span class=nf>popup_centered</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 確認ダイアログで OK ボタンを押して確定した時に呼ばれるメソッド</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_ConfirmationDialog_confirmed</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=c1># SFXPlayer の Stream プロパティに res://Assets/Audio/PressEnter.wav を適用</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=n>stream</span> <span class=o>=</span> <span class=n>sfx_res</span><span class=p>[</span><span class=s2>&#34;enter&#34;</span><span class=p>]</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>	<span class=c1># SFXPlayer のサウンドを再生</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>	<span class=c1># SFXPlayer のサウンド再生が終了するまで待機</span>
</span></span><span class=line><span class=cl>	<span class=k>yield</span><span class=p>(</span><span class=n>sfx_player</span><span class=p>,</span> <span class=s2>&#34;finished&#34;</span><span class=p>)</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>selected_option</span> <span class=o>==</span> <span class=n>RESTART</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=nf>get_tree</span><span class=p>()</span><span class=o>.</span><span class=n>paused</span> <span class=o>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Scene tree paused: &#34;</span><span class=p>,</span> <span class=nf>get_tree</span><span class=p>()</span><span class=o>.</span><span class=n>paused</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nf>get_tree</span><span class=p>()</span><span class=o>.</span><span class=nf>change_scene</span><span class=p>(</span><span class=s2>&#34;res://Game/Game.tscn&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;The game is restarted.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>elif</span> <span class=n>selected_option</span> <span class=o>==</span> <span class=n>QUIT</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=nf>get_tree</span><span class=p>()</span><span class=o>.</span><span class=nf>quit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;The game is quited.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 確認ダイアログが非表示になった時に呼ばれるメソッド</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_ConfirmationDialog_popup_hide</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=c1># SFXPlayer の Stream プロパティに res://Assets/Audio/PressCancel.wav を適用</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=n>stream</span> <span class=o>=</span> <span class=n>sfx_res</span><span class=p>[</span><span class=s2>&#34;cancel&#34;</span><span class=p>]</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>	<span class=c1># SFXPlayer のサウンドを再生</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>	<span class=n>selected_option</span> <span class=o>=</span> <span class=kt>null</span>
</span></span><span class=line><span class=cl>	<span class=n>confirmation</span><span class=o>.</span><span class=n>dialog_text</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>	<span class=n>color_rect</span><span class=o>.</span><span class=n>visible</span> <span class=o>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># キーボードやマウスのインプット操作を行った時に呼ばれるメソッド</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_input</span><span class=p>(</span><span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>visible</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_released</span><span class=p>(</span><span class=s2>&#34;ui_left&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>			<span class=c1># SFXPlayer の Stream プロパティに res://Assets/Audio/PressSelect.wav を適用</span>
</span></span><span class=line><span class=cl>			<span class=n>sfx_player</span><span class=o>.</span><span class=n>stream</span> <span class=o>=</span> <span class=n>sfx_res</span><span class=p>[</span><span class=s2>&#34;select&#34;</span><span class=p>]</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>			<span class=c1># SFXPlayer のサウンドを再生</span>
</span></span><span class=line><span class=cl>			<span class=n>sfx_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>			<span class=n>line2d</span><span class=o>.</span><span class=n>position</span> <span class=o>=</span> <span class=n>square_pos</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=k>elif</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_released</span><span class=p>(</span><span class=s2>&#34;ui_right&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>			<span class=c1># SFXPlayer の Stream プロパティに res://Assets/Audio/PressSelect.wav を適用</span>
</span></span><span class=line><span class=cl>			<span class=n>sfx_player</span><span class=o>.</span><span class=n>stream</span> <span class=o>=</span> <span class=n>sfx_res</span><span class=p>[</span><span class=s2>&#34;select&#34;</span><span class=p>]</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>			<span class=c1># SFXPlayer のサウンドを再生</span>
</span></span><span class=line><span class=cl>			<span class=n>sfx_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># 追加</span>
</span></span><span class=line><span class=cl>			<span class=n>line2d</span><span class=o>.</span><span class=n>position</span> <span class=o>=</span> <span class=n>square_pos</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=k>elif</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_released</span><span class=p>(</span><span class=s2>&#34;ui_accept&#34;</span><span class=p>)</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>color_rect</span><span class=o>.</span><span class=n>visible</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=n>line2d</span><span class=o>.</span><span class=n>position</span> <span class=o>==</span> <span class=n>square_pos</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>				<span class=nf>_on_RestartButton_button_up</span><span class=p>()</span>
</span></span><span class=line><span class=cl>			<span class=k>elif</span> <span class=n>line2d</span><span class=o>.</span><span class=n>position</span> <span class=o>==</span> <span class=n>square_pos</span><span class=p>[</span><span class=mi>1</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>				<span class=nf>_on_QuitButton_button_up</span><span class=p>()</span>
</span></span></code></pre></div><p>「SFXPlayer」ノードは一つだが、スクリプトで音源リソースを切り替えることで 3 つの SFX の再生をカバーしている。</p><p>これで以下の場面で SFX が再生されるようになったはずだ。</p><ul><li>「Restart」と「Quit」を選択する際に「PressSelect.wav」が再生される</li><li>「Restart」と「Quit」どちらかの選択を確定したら「PressEnter.wav」が再生される</li><li>確認ダイアログで「OK」を押して確定した時も「「PressEnter.wav」が再生される</li><li>確認ダイアログで「Cancel」を押した時に「PressCancel.wav」が再生される</li></ul><p>上記内容に加えて、BGM の音源が正しく再生されるか、正しくループするかも併せて、実際にシーンを実行してみよう。</p><p><div><video controls autoplay loop muted playsinline aria-label=GameOverシーンを再生 style=width:100%;height:auto>
<source src=/images/tutorials/gd0005_platformer/platformer_13/img20.mp4 type=video/mp4>Your browser does not support the video tag.</video></div><br><br></p><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=level1-シーン>Level1 シーン</h1><p>いよいよゲームプレイ中の BGM の追加だ。「Level1」シーンは外なので明るいややアップテンポの曲が最適だ。「Level1.tscn」シーンファイルを開いてサウンドを追加しよう。ちなみにこのシーンに SFX は不要なので、スクリプトの編集も不要だ。1分で作業を終えられるかもしれない。</p><br><h2 id=audiostreamplayer-ノードを追加する-3>AudioStreamPlayer ノードを追加する</h2><p>「Level1」ルートノードに「AudioStreamPlayer」クラスのノードを1つ追加して「BGMPlayer」という名前に変更しよう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img21.png alt=AudioStreamPlayerを追加></p><br><h2 id=bgmplayer-ノードを編集する-3>BGMPlayer ノードを編集する</h2><p>「BGMPlayer」ノードのプロパティを編集する。</p><ol><li>インスペクターの「Stream」プロパティへファイルシステムドックから「res://Assets/Audio/Land.ogg」をドラッグ&ドロップして素材を追加する。</li><li>必要に応じて、音量を「Volume Db」プロパティの値を上げ下げして調節する。</li><li>「Autoplay」プロパティをオンにする。</li></ol><br><p>では BGM の自動再生とループを確認しておこう。なお、このリソースのみループ開始位置を調整しているので、開始位置に戻った時に違和感がないかはよく聴いて確認する必要がある。以下の動画では 0:31 のタイミングでループ開始位置に戻っている。</p><p><div><video controls autoplay loop muted playsinline aria-label=Level1シーンを再生 style=width:100%;height:auto>
<source src=/images/tutorials/gd0005_platformer/platformer_13/img22.mp4 type=video/mp4>Your browser does not support the video tag.</video></div><br><br></p><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=level2-シーン>Level2 シーン</h1><p>ようやく最後のシーンだ。「Level2」シーンはジメジメした（キノコが大量に生息する）ダンジョンの中なので、少しおどろおどろしい（ややホラーっぽい）曲が似合うはずだ。「Level2.tscn」シーンファイルを開いてサウンドを追加しよう。このシーンも SFX は不要なので、「Level1.tscn」の編集とほとんど同じ作業だ。</p><br><h2 id=audiostreamplayer-ノードを追加する-4>AudioStreamPlayer ノードを追加する</h2><p>「Level2」ルートノードに「AudioStreamPlayer」クラスのノードを1つ追加して「BGMPlayer」という名前に変更しよう。<br><img loading=lazy src=/images/tutorials/gd0005_platformer/platformer_13/img23.png alt=AudioStreamPlayerを追加></p><br><h2 id=bgmplayer-ノードを編集する-4>BGMPlayer ノードを編集する</h2><p>「BGMPlayer」ノードのプロパティを編集する。</p><ol><li>インスペクターの「Stream」プロパティへファイルシステムドックから「res://Assets/Audio/Dungeon.ogg」をドラッグ&ドロップして素材を追加する。</li><li>必要に応じて、音量を「Volume Db」プロパティの値を上げ下げして調節する。</li><li>「Autoplay」プロパティをオンにする。</li></ol><br><p>では BGM の自動再生とループを確認しておこう。以下の動画では 0:49 のタイミングでループ開始位置に戻っている。</p><p><div><video controls autoplay loop muted playsinline aria-label=Level1シーンを再生 style=width:100%;height:auto>
<source src=/images/tutorials/gd0005_platformer/platformer_13/img24.mp4 type=video/mp4>Your browser does not support the video tag.</video></div><br><br></p><p>これでサウンドの追加が必要なシーンの編集作業は完了した。最後にプロジェクト全体を通して音の確認をして今回の作業を終えよう。</p><p><div><video controls autoplay loop muted playsinline aria-label=GameOverシーンを再生 style=width:100%;height:auto>
<source src=/images/tutorials/gd0005_platformer/platformer_13/img31.mp4 type=video/mp4>Your browser does not support the video tag.</video></div><br><br></p><br><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=part-13-で編集したスクリプトのコード>Part 13 で編集したスクリプトのコード</h1><p>最後に今回の Part 13 で編集したスクリプトのコードを共有しておくので、必要に応じて確認してほしい。</p><details><summary>Player.gd の全コード</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>KinematicBody2D</span> <span class=c1># Created @ Part 1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>signal</span> <span class=nf>enemy_hit</span><span class=p>(</span><span class=n>damage</span><span class=p>)</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl><span class=kd>signal</span> <span class=nf>item_hit</span><span class=p>(</span><span class=n>point</span><span class=p>)</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>acceleration</span> <span class=o>=</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>max_speed</span> <span class=o>=</span> <span class=mi>64</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>max_dash_speed</span> <span class=o>=</span> <span class=mi>200</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>friction</span> <span class=o>=</span> <span class=mf>0.1</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>gravity</span> <span class=o>=</span> <span class=mi>512</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>jump_force</span> <span class=o>=</span> <span class=mi>224</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>air_resistance</span> <span class=o>=</span> <span class=mf>0.02</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>velocity</span> <span class=o>=</span> <span class=nc>Vector2</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sprite</span> <span class=o>=</span> <span class=nx>$AnimatedSprite</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>anim_player</span> <span class=o>=</span> <span class=nx>$AnimationPlayer</span> <span class=c1># Added @ Part 7</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>step_sfx</span> <span class=o>=</span> <span class=nx>$StepSFX</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>jump_sfx</span> <span class=o>=</span> <span class=nx>$JumpSFX</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>damage_sfx</span> <span class=o>=</span> <span class=nx>$DamageSFX</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>die_sfx</span> <span class=o>=</span> <span class=nx>$DieSFX</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span> <span class=c1># Added @ Part 7</span>
</span></span><span class=line><span class=cl>	<span class=n>sprite</span><span class=o>.</span><span class=n>position</span> <span class=o>=</span> <span class=nc>Vector2</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>sprite</span><span class=o>.</span><span class=n>scale</span> <span class=o>=</span> <span class=nc>Vector2</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>sprite</span><span class=o>.</span><span class=n>modulate</span> <span class=o>=</span> <span class=nc>Color</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_physics_process</span><span class=p>(</span><span class=n>delta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>velocity</span><span class=o>.</span><span class=n>y</span> <span class=o>+=</span> <span class=n>gravity</span> <span class=o>*</span> <span class=n>delta</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=n>x_input</span> <span class=o>=</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>get_action_strength</span><span class=p>(</span><span class=s2>&#34;move_right&#34;</span><span class=p>)</span> <span class=o>-</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>get_action_strength</span><span class=p>(</span><span class=s2>&#34;move_left&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>x_input</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>+=</span> <span class=n>x_input</span> <span class=o>*</span> <span class=n>acceleration</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>is_action_pressed</span><span class=p>(</span><span class=s2>&#34;dash&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=nb>clamp</span><span class=p>(</span><span class=n>velocity</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=o>-</span><span class=n>max_dash_speed</span><span class=p>,</span> <span class=n>max_dash_speed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=nb>clamp</span><span class=p>(</span><span class=n>velocity</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=o>-</span><span class=n>max_speed</span><span class=p>,</span> <span class=n>max_speed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=n>flip_h</span> <span class=o>=</span> <span class=n>x_input</span> <span class=o>&lt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nf>is_on_floor</span><span class=p>():</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>x_input</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;idle&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=nb>lerp</span><span class=p>(</span><span class=n>velocity</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>friction</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;run&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>is_action_just_pressed</span><span class=p>(</span><span class=s2>&#34;jump&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>			<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;jump&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>y</span> <span class=o>=</span> <span class=o>-</span><span class=n>jump_force</span>
</span></span><span class=line><span class=cl>			<span class=n>jump_sfx</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>x_input</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=nb>lerp</span><span class=p>(</span><span class=n>velocity</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>air_resistance</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>is_action_just_released</span><span class=p>(</span><span class=s2>&#34;jump&#34;</span><span class=p>)</span> <span class=ow>and</span> <span class=n>velocity</span><span class=o>.</span><span class=n>y</span> <span class=o>&lt;</span> <span class=o>-</span><span class=n>jump_force</span> <span class=o>/</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>velocity</span><span class=o>.</span><span class=n>y</span> <span class=o>=</span> <span class=o>-</span><span class=n>jump_force</span> <span class=o>/</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>velocity</span> <span class=o>=</span> <span class=nf>move_and_slide</span><span class=p>(</span><span class=n>velocity</span><span class=p>,</span> <span class=nc>Vector2</span><span class=o>.</span><span class=n>UP</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1># Added @ Part 3</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>position</span><span class=o>.</span><span class=n>x</span> <span class=o>&lt;</span> <span class=mi>16</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>position</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_HitBox_body_entered</span><span class=p>(</span><span class=n>body</span><span class=p>):</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>body</span><span class=o>.</span><span class=nf>is_in_group</span><span class=p>(</span><span class=s2>&#34;Enemies&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Enemy hit player. Damage is &#34;</span><span class=p>,</span> <span class=n>body</span><span class=o>.</span><span class=n>damage</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nf>emit_signal</span><span class=p>(</span><span class=s2>&#34;enemy_hit&#34;</span><span class=p>,</span> <span class=n>body</span><span class=o>.</span><span class=n>damage</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;hit&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>damage_sfx</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_AnimatedSprite_frame_changed</span><span class=p>():</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>sprite</span><span class=o>.</span><span class=n>animation</span> <span class=o>==</span> <span class=s2>&#34;run&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>sprite</span><span class=o>.</span><span class=n>frame</span> <span class=o>==</span> <span class=mi>4</span>  <span class=ow>or</span> <span class=n>sprite</span><span class=o>.</span><span class=n>frame</span> <span class=o>==</span> <span class=mi>10</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>step_sfx</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span>
</span></span></code></pre></div></details><br><details><summary>Game.gd の全コード</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>Node</span> <span class=c1># Added @ Part 7</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>current_level</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>final_level</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>health</span><span class=p>:</span> <span class=kt>float</span> <span class=o>=</span> <span class=mf>100.0</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>score</span><span class=p>:</span> <span class=kt>int</span> <span class=o>=</span> <span class=mi>0</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>level</span><span class=p>:</span> <span class=nc>Node2D</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>player</span><span class=p>:</span> <span class=n>KinematicBody2D</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>char_frames</span><span class=p>:</span> <span class=nc>SpriteFrames</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>ui_layer</span> <span class=o>=</span> <span class=nx>$UI</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>gamestart</span> <span class=o>=</span> <span class=nx>$UI/GameStart</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>hud</span> <span class=o>=</span> <span class=nx>$UI/HUD</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl><span class=c1>#onready var gameover = $UI/GameOver # Added @ Part 9 # Removed @ Part 10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=c1>#gameover.visible = false # Added @ Part 9 # Removed @ Part 10</span>
</span></span><span class=line><span class=cl>	<span class=n>gamestart</span><span class=o>.</span><span class=nf>connect</span><span class=p>(</span><span class=s2>&#34;tree_exited&#34;</span><span class=p>,</span> <span class=bp>self</span> <span class=p>,</span><span class=s2>&#34;_on_GameStart_tree_exited&#34;</span><span class=p>)</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_GameStart_tree_exited</span><span class=p>():</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=n>char_select</span> <span class=o>=</span> <span class=nb>load</span><span class=p>(</span><span class=s2>&#34;res://UI/CharacterSelect/CharacterSelect.tscn&#34;</span><span class=p>)</span><span class=o>.</span><span class=nf>instance</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=n>char_select</span><span class=o>.</span><span class=nf>connect</span><span class=p>(</span><span class=s2>&#34;character_selected&#34;</span><span class=p>,</span> <span class=bp>self</span> <span class=p>,</span><span class=s2>&#34;_on_CharacterSelect_character_selected&#34;</span><span class=p>)</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>	<span class=n>ui_layer</span><span class=o>.</span><span class=nf>add_child</span><span class=p>(</span><span class=n>char_select</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_CharacterSelect_character_selected</span><span class=p>(</span><span class=n>sprite_frames</span><span class=p>):</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>	<span class=n>char_frames</span> <span class=o>=</span> <span class=n>sprite_frames</span>
</span></span><span class=line><span class=cl>	<span class=nf>add_level</span><span class=p>()</span> <span class=c1># Moved @ Part 10 # Modified @ Part 10</span>
</span></span><span class=line><span class=cl>	<span class=n>hud</span><span class=o>.</span><span class=nf>update_health</span><span class=p>(</span><span class=n>health</span><span class=p>)</span> <span class=c1># Added @ Part 8 # Moved @ Part 10</span>
</span></span><span class=line><span class=cl>	<span class=n>hud</span><span class=o>.</span><span class=nf>update_score</span><span class=p>(</span><span class=n>score</span><span class=p>)</span> <span class=c1># Added @ Part 8 # Moved @ Part 10</span>
</span></span><span class=line><span class=cl>	<span class=n>hud</span><span class=o>.</span><span class=nf>update_level</span><span class=p>(</span><span class=n>current_level</span><span class=p>)</span> <span class=c1># Added @ Part 8 # Moved @ Part 10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>add_level</span><span class=p>():</span> <span class=c1># Modified @ Part 10</span>
</span></span><span class=line><span class=cl>	<span class=n>level</span> <span class=o>=</span> <span class=nb>load</span><span class=p>(</span><span class=s2>&#34;res://Levels/Level&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>current_level</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;.tscn&#34;</span><span class=p>)</span><span class=o>.</span><span class=nf>instance</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=n>level</span><span class=o>.</span><span class=nf>connect</span><span class=p>(</span><span class=s2>&#34;tree_exited&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=s2>&#34;change_level&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>level</span><span class=o>.</span><span class=nf>connect</span><span class=p>(</span><span class=s2>&#34;player_dropped&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=s2>&#34;_on_Level_player_dropped&#34;</span><span class=p>)</span> <span class=c1># Added @ Part 9</span>
</span></span><span class=line><span class=cl>	<span class=nf>call_deferred</span><span class=p>(</span><span class=s2>&#34;add_child&#34;</span><span class=p>,</span> <span class=n>level</span><span class=p>)</span> <span class=c1># Fixed error</span>
</span></span><span class=line><span class=cl>	<span class=n>player</span> <span class=o>=</span> <span class=n>level</span><span class=o>.</span><span class=nf>get_node</span><span class=p>(</span><span class=s2>&#34;Player&#34;</span><span class=p>)</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl>	<span class=n>player</span><span class=o>.</span><span class=nf>connect</span><span class=p>(</span><span class=s2>&#34;enemy_hit&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=s2>&#34;_on_Player_enemy_hit&#34;</span><span class=p>)</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl>	<span class=n>player</span><span class=o>.</span><span class=nf>connect</span><span class=p>(</span><span class=s2>&#34;item_hit&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=p>,</span> <span class=s2>&#34;_on_Player_item_hit&#34;</span><span class=p>)</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl>	<span class=n>player</span><span class=o>.</span><span class=nf>get_node</span><span class=p>(</span><span class=s2>&#34;AnimatedSprite&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>frames</span> <span class=o>=</span> <span class=n>char_frames</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>change_level</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nf>get_tree</span><span class=p>():</span> <span class=c1># Added @ Part 9</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;change_level() called.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>current_level</span> <span class=o>&lt;</span> <span class=n>final_level</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;change to next level.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=n>level</span><span class=o>.</span><span class=nf>queue_free</span><span class=p>()</span>
</span></span><span class=line><span class=cl>			<span class=n>current_level</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>			<span class=n>hud</span><span class=o>.</span><span class=nf>update_level</span><span class=p>(</span><span class=n>current_level</span><span class=p>)</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl>			<span class=nf>add_level</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Game Clear! Congrats!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=nf>get_tree</span><span class=p>()</span><span class=o>.</span><span class=nf>quit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_Player_enemy_hit</span><span class=p>(</span><span class=n>damage</span><span class=p>):</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl>	<span class=nf>manage_health</span><span class=p>(</span><span class=n>damage</span><span class=p>)</span> <span class=c1># Modified @ Part 9</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_Player_item_hit</span><span class=p>(</span><span class=n>point</span><span class=p>):</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl>	<span class=n>score</span> <span class=o>+=</span> <span class=n>point</span>
</span></span><span class=line><span class=cl>	<span class=n>hud</span><span class=o>.</span><span class=nf>update_score</span><span class=p>(</span><span class=n>score</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_Level_player_dropped</span><span class=p>():</span> <span class=c1># Added @ Part 9</span>
</span></span><span class=line><span class=cl>	<span class=nf>manage_health</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>manage_health</span><span class=p>(</span><span class=n>damage</span><span class=p>):</span> <span class=c1># Added @ Part 9</span>
</span></span><span class=line><span class=cl>	<span class=n>health</span> <span class=o>-=</span> <span class=n>damage</span> <span class=c1># Moved from _on_Player_enemy_hit() @ Part 9</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Health updated: &#34;</span><span class=p>,</span> <span class=n>health</span><span class=p>)</span> <span class=c1># Moved from _on_Player_enemy_hit() @ Part 9</span>
</span></span><span class=line><span class=cl>	<span class=n>hud</span><span class=o>.</span><span class=nf>update_health</span><span class=p>(</span><span class=n>health</span><span class=p>)</span> <span class=c1># Moved from _on_Player_enemy_hit() @ Part 9</span>
</span></span><span class=line><span class=cl>	<span class=c1># Added @ Part 9</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>health</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>player</span><span class=o>.</span><span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;die&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>player</span><span class=o>.</span><span class=n>die_sfx</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>player</span><span class=o>.</span><span class=n>anim_player</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=c1>#gameover.visible = true # Removed @ Part 10</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=n>gameover</span> <span class=o>=</span> <span class=nb>load</span><span class=p>(</span><span class=s2>&#34;res://UI/GameOver/GameOver.tscn&#34;</span><span class=p>)</span><span class=o>.</span><span class=nf>instance</span><span class=p>()</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>		<span class=n>ui_layer</span><span class=o>.</span><span class=nf>add_child</span><span class=p>(</span><span class=n>gameover</span><span class=p>)</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Game over screen is shown up.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nf>get_tree</span><span class=p>()</span><span class=o>.</span><span class=n>paused</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Scene tree paused: &#34;</span><span class=p>,</span> <span class=nf>get_tree</span><span class=p>()</span><span class=o>.</span><span class=n>paused</span><span class=p>)</span>
</span></span></code></pre></div></details><br><details><summary>.Enemygd の全コード</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>KinematicBody2D</span> <span class=c1># Added @ Part 4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>gravity</span><span class=p>:</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>speed</span><span class=p>:</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>damage</span><span class=p>:</span> <span class=kt>float</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>velocity</span> <span class=o>=</span> <span class=nc>Vector2</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sprite</span> <span class=o>=</span> <span class=nx>$AnimatedSprite</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>audio_player</span> <span class=o>=</span> <span class=nx>$AudioStreamPlayer2D</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=nf>set_physics_process</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_HitBox_body_entered</span><span class=p>(</span><span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>body</span><span class=o>.</span><span class=nf>is_in_group</span><span class=p>(</span><span class=s2>&#34;Players&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Player entered in &#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;hit&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>audio_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>sprite</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>audio_player</span><span class=p>,</span> <span class=s2>&#34;finished&#34;</span><span class=p>)</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>		<span class=nf>queue_free</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=s2>&#34; died&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_VisibilityEnabler2D_screen_entered</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=nf>set_physics_process</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_VisibilityEnabler2D_screen_exited</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=nf>set_physics_process</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span></code></pre></div></details><br><details><summary>Item.gd の全コード</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>Area2D</span> <span class=c1># Added @ Part 6</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=kd>var</span> <span class=n>point</span> <span class=o>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sprite</span> <span class=o>=</span> <span class=nx>$AnimatedSprite</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>label</span> <span class=o>=</span> <span class=nx>$Label</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>anim_player</span> <span class=o>=</span> <span class=nx>$AnimationPlayer</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>audio_player</span> <span class=o>=</span> <span class=nx>$AudioStreamPlayer2D</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>sprite</span><span class=o>.</span><span class=n>modulate</span> <span class=o>=</span> <span class=nc>Color</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>sprite</span><span class=o>.</span><span class=n>position</span> <span class=o>=</span> <span class=nc>Vector2</span><span class=o>.</span><span class=n>ZERO</span>
</span></span><span class=line><span class=cl>	<span class=n>sprite</span><span class=o>.</span><span class=n>scale</span> <span class=o>=</span> <span class=nc>Vector2</span><span class=o>.</span><span class=n>ONE</span>
</span></span><span class=line><span class=cl>	<span class=n>label</span><span class=o>.</span><span class=n>modulate</span> <span class=o>=</span> <span class=nc>Color</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>label</span><span class=o>.</span><span class=n>rect_position</span> <span class=o>=</span> <span class=nc>Vector2</span><span class=p>(</span><span class=o>-</span><span class=mi>32</span><span class=p>,</span> <span class=o>-</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>label</span><span class=o>.</span><span class=n>text</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>point</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_Item_body_entered</span><span class=p>(</span><span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>body</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=s2>&#34;Player&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Player hit Item&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nf>hit</span><span class=p>(</span><span class=n>body</span><span class=p>)</span> <span class=c1># Modified @ Part 8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>hit</span><span class=p>(</span><span class=n>body</span><span class=p>):</span> <span class=c1># Modified @ Part 8</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Got &#34;</span><span class=p>,</span> <span class=n>point</span><span class=p>,</span> <span class=s2>&#34; point.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>body</span><span class=o>.</span><span class=nf>emit_signal</span><span class=p>(</span><span class=s2>&#34;item_hit&#34;</span><span class=p>,</span> <span class=n>point</span><span class=p>)</span> <span class=c1># Added @ Part 8</span>
</span></span><span class=line><span class=cl>	<span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;hit&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>audio_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>	<span class=k>yield</span><span class=p>(</span><span class=n>anim_player</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>yield</span><span class=p>(</span><span class=n>audio_player</span><span class=p>,</span> <span class=s2>&#34;finished&#34;</span><span class=p>)</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>	<span class=nf>queue_free</span><span class=p>()</span>
</span></span></code></pre></div></details><br><details><summary>BrokenBox.gd の全コード</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>Particles2D</span> <span class=c1># Added @ Part 6</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>audio_player</span> <span class=o>=</span> <span class=nx>$AudioStreamPlayer2D</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>emitting</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>	<span class=n>audio_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_process</span><span class=p>(</span><span class=n>delta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=ow>not</span> <span class=n>emitting</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=nf>queue_free</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;BrokenBox removed.&#34;</span><span class=p>)</span>
</span></span></code></pre></div></details><br><details><summary>StartPoint.gd の全コード</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>Area2D</span> <span class=c1># Added @ Part 7</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sprite</span> <span class=o>=</span> <span class=nx>$AnimatedSprite</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>audio_player</span> <span class=o>=</span> <span class=nx>$AudioStreamPlayer2D</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;idle&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_StartPoint_body_entered</span><span class=p>(</span><span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>body</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=s2>&#34;Player&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;moving&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>audio_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_StartPoint_body_exited</span><span class=p>(</span><span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>body</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=s2>&#34;Player&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;idle&#34;</span><span class=p>)</span>
</span></span></code></pre></div></details><br><details><summary>Checkpoint.gd の全コード</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>Area2D</span> <span class=c1># Added @ Part 7</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>is_checked</span> <span class=o>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sprite</span> <span class=o>=</span> <span class=nx>$AnimatedSprite</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>audio_player</span> <span class=o>=</span> <span class=nx>$AudioStreamPlayer2D</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;no_flag&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_Checkpoint_body_entered</span><span class=p>(</span><span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>body</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=s2>&#34;Player&#34;</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>is_checked</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;flag_out&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>audio_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>sprite</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;flag_idle&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>is_checked</span> <span class=o>=</span> <span class=kc>true</span>
</span></span></code></pre></div></details><br><details><summary>EndPoint.gd の全コード</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>Area2D</span> <span class=c1># Added @ Part 7</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>particle</span> <span class=o>=</span> <span class=nx>$Particles2D</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sprite</span> <span class=o>=</span> <span class=nx>$AnimatedSprite</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>polygon</span> <span class=o>=</span> <span class=nx>$StaticBody2D/CollisionPolygon2D</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>anim_player</span> <span class=o>=</span> <span class=nx>$AnimationPlayer</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>audio_player</span> <span class=o>=</span> <span class=nx>$AudioStreamPlayer2D</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>particle</span><span class=o>.</span><span class=n>emitting</span> <span class=o>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>	<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;idle&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>polygon</span><span class=o>.</span><span class=n>position</span> <span class=o>=</span> <span class=nc>Vector2</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>-</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_EndPoint_body_entered</span><span class=p>(</span><span class=n>body</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>body</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=s2>&#34;Player&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;clear&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>anim_player</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>particle</span><span class=o>.</span><span class=n>emitting</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>		<span class=n>body</span><span class=o>.</span><span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;clear&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>audio_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>body</span><span class=o>.</span><span class=n>anim_player</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>audio_player</span><span class=p>,</span> <span class=s2>&#34;finished&#34;</span><span class=p>)</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Moving to the next level!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nf>get_parent</span><span class=p>()</span><span class=o>.</span><span class=nf>queue_free</span><span class=p>()</span>
</span></span></code></pre></div></details><br><details><summary>GameStart.gd の全コード</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>Control</span> <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>start_button</span> <span class=o>=</span> <span class=nx>$VBoxContainer/StartVBox/StartButton</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>anim_player</span> <span class=o>=</span> <span class=nx>$AnimationPlayer</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sfx_player</span> <span class=o>=</span> <span class=nx>$SFXPlayer</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>start_button</span><span class=o>.</span><span class=n>modulate</span> <span class=o>=</span> <span class=nc>Color</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>start_button</span><span class=o>.</span><span class=n>rect_scale</span> <span class=o>=</span> <span class=nc>Vector2</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_StartButton_button_up</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=c1>#print(&#34;_on_StartButton_button_up called.&#34;)</span>
</span></span><span class=line><span class=cl>	<span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;press_start&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>	<span class=k>yield</span><span class=p>(</span><span class=n>anim_player</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>yield</span><span class=p>(</span><span class=n>sfx_player</span><span class=p>,</span> <span class=s2>&#34;finished&#34;</span><span class=p>)</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>	<span class=nf>queue_free</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;GameStart scene is now freed.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_input</span><span class=p>(</span><span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_released</span><span class=p>(</span><span class=s2>&#34;ui_accept&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=nf>_on_StartButton_button_up</span><span class=p>()</span>
</span></span></code></pre></div></details><br><details><summary>CharacterSelect.gd の全コード</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>Control</span>  <span class=c1># Added @ Part 10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>signal</span> <span class=nf>character_selected</span><span class=p>(</span><span class=n>sprite_frames</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>is_choosing</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>frames_num</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>characters</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;Mask Dude&#34;</span><span class=p>,</span> <span class=s2>&#34;Ninja Frog&#34;</span><span class=p>,</span> <span class=s2>&#34;Pink Man&#34;</span><span class=p>,</span> <span class=s2>&#34;Virtual Guy&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>global</span> <span class=o>=</span> <span class=nf>get_node</span><span class=p>(</span><span class=s2>&#34;/root/Global&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>char_name</span> <span class=o>=</span> <span class=nx>$VBoxContainer/CharacterName</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>l_button</span> <span class=o>=</span> <span class=nx>$VBoxContainer/HBoxContainer/LeftButton</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>r_button</span> <span class=o>=</span> <span class=nx>$VBoxContainer/HBoxContainer/RightButton</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sprite</span> <span class=o>=</span> <span class=nx>$AnimatedSprite</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>anim_player</span> <span class=o>=</span> <span class=nx>$AnimationPlayer</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sfx_player</span> <span class=o>=</span> <span class=nx>$SFXPlayer</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sfx_res</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;select&#34;</span><span class=p>:</span> <span class=nb>preload</span><span class=p>(</span><span class=s2>&#34;res://Assets/Audio/PressSelect.wav&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;enter&#34;</span><span class=p>:</span> <span class=nb>preload</span><span class=p>(</span><span class=s2>&#34;res://Assets/Audio/PressEnter.wav&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>l_button</span><span class=o>.</span><span class=n>modulate</span> <span class=o>=</span> <span class=nc>Color</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>l_button</span><span class=o>.</span><span class=n>rect_scale</span> <span class=o>=</span> <span class=nc>Vector2</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>r_button</span><span class=o>.</span><span class=n>modulate</span> <span class=o>=</span> <span class=nc>Color</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>r_button</span><span class=o>.</span><span class=n>rect_scale</span> <span class=o>=</span> <span class=nc>Vector2</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>play_animations</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>play_animations</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=n>animations</span><span class=p>:</span> <span class=nc>Array</span> <span class=o>=</span> <span class=n>sprite</span><span class=o>.</span><span class=n>frames</span><span class=o>.</span><span class=nf>get_animation_names</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=n>anim_index</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=n>count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>	<span class=c1>#print(&#34;animations array is &#34;, animations)</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=n>anim</span> <span class=ow>in</span> <span class=n>animations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>anim</span> <span class=o>==</span> <span class=s2>&#34;fall&#34;</span> <span class=ow>or</span> <span class=n>anim</span> <span class=o>==</span> <span class=s2>&#34;jump&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>animations</span><span class=o>.</span><span class=nf>remove</span><span class=p>(</span><span class=n>animations</span><span class=o>.</span><span class=nf>find</span><span class=p>(</span><span class=n>anim</span><span class=p>))</span>
</span></span><span class=line><span class=cl>			<span class=c1>#print(&#34;removed &#34;, anim, &#34; from animations array.&#34;)</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=k>while</span> <span class=n>is_choosing</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=n>animations</span><span class=p>[</span><span class=n>anim_index</span><span class=p>])</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>sprite</span><span class=p>,</span> <span class=s2>&#34;animation_finished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=nf>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>count</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>			<span class=k>continue</span>	
</span></span><span class=line><span class=cl>		<span class=n>count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>anim_index</span> <span class=o>&lt;</span> <span class=n>animations</span><span class=o>.</span><span class=nf>size</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>anim_index</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>anim_index</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_LeftButton_pressed</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;press_left&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span><span class=p>(</span><span class=n>sfx_res</span><span class=p>[</span><span class=s2>&#34;select&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=n>stream</span> <span class=o>=</span> <span class=n>sfx_res</span><span class=p>[</span><span class=s2>&#34;select&#34;</span><span class=p>]</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>frames_num</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>frames_num</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=n>frames</span> <span class=o>=</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=p>[</span><span class=n>frames_num</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>char_name</span><span class=o>.</span><span class=n>text</span> <span class=o>=</span> <span class=n>characters</span><span class=p>[</span><span class=n>frames_num</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=n>frames</span> <span class=o>=</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=p>[</span><span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=o>.</span><span class=nf>size</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>char_name</span><span class=o>.</span><span class=n>text</span> <span class=o>=</span> <span class=n>characters</span><span class=p>[</span><span class=n>characters</span><span class=o>.</span><span class=nf>size</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>frames_num</span> <span class=o>=</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=o>.</span><span class=nf>size</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_RightButton_pressed</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;press_right&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=n>stream</span> <span class=o>=</span> <span class=n>sfx_res</span><span class=p>[</span><span class=s2>&#34;select&#34;</span><span class=p>]</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>frames_num</span> <span class=o>&lt;</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=o>.</span><span class=nf>size</span><span class=p>()</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>frames_num</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=n>frames</span> <span class=o>=</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=p>[</span><span class=n>frames_num</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>char_name</span><span class=o>.</span><span class=n>text</span> <span class=o>=</span> <span class=n>characters</span><span class=p>[</span><span class=n>frames_num</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=n>frames</span> <span class=o>=</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>char_name</span><span class=o>.</span><span class=n>text</span> <span class=o>=</span> <span class=n>characters</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=n>frames_num</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_input</span><span class=p>(</span><span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_pressed</span><span class=p>(</span><span class=s2>&#34;ui_left&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=nf>_on_LeftButton_pressed</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>elif</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_pressed</span><span class=p>(</span><span class=s2>&#34;ui_right&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=nf>_on_RightButton_pressed</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>elif</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_released</span><span class=p>(</span><span class=s2>&#34;ui_accept&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=n>is_choosing</span> <span class=o>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>		<span class=n>sfx_player</span><span class=o>.</span><span class=n>stream</span> <span class=o>=</span> <span class=n>sfx_res</span><span class=p>[</span><span class=s2>&#34;enter&#34;</span><span class=p>]</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>		<span class=n>sfx_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>		<span class=k>yield</span><span class=p>(</span><span class=n>sfx_player</span><span class=p>,</span> <span class=s2>&#34;finished&#34;</span><span class=p>)</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>		<span class=nf>emit_signal</span><span class=p>(</span><span class=s2>&#34;character_selected&#34;</span><span class=p>,</span> <span class=n>global</span><span class=o>.</span><span class=n>spriteframes</span><span class=p>[</span><span class=n>frames_num</span><span class=p>])</span>
</span></span><span class=line><span class=cl>		<span class=c1>#print(&#34;emitted signal: character_selected&#34;)</span>
</span></span><span class=line><span class=cl>		<span class=nf>queue_free</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;CharacterSelect scene is now freed.&#34;</span><span class=p>)</span>
</span></span></code></pre></div></details><br><details><summary>GameOver.gd の全コード</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>Control</span> <span class=c1># Added @ Part 9</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>enum</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=n>RESTART</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>QUIT</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1># Added @ Part 9 after</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>square_pos</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>	<span class=nc>Vector2</span><span class=p>(</span><span class=mi>108</span><span class=p>,</span> <span class=mi>128</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=nc>Vector2</span><span class=p>(</span><span class=mi>212</span><span class=p>,</span> <span class=mi>128</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>selected_option</span> <span class=o>=</span> <span class=kt>null</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>restart_text</span> <span class=o>=</span> <span class=s2>&#34;Do you really want to restart the game?&#34;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>quit_text</span> <span class=o>=</span> <span class=s2>&#34;Do you really want to quit the game?&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>restart_btn</span> <span class=o>=</span> <span class=nx>$VBoxContainer/ButtonsHBox/RestartVBox/RestartButton</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>quit_btn</span> <span class=o>=</span> <span class=nx>$VBoxContainer/ButtonsHBox/QuitVBox/QuitButton</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>color_rect</span> <span class=o>=</span> <span class=nx>$ColorRect</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>confirmation</span> <span class=o>=</span> <span class=nx>$ConfirmationDialog</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>line2d</span> <span class=o>=</span> <span class=nx>$Line2D</span> <span class=c1># Added @ Part 9 after</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>anim_player</span> <span class=o>=</span> <span class=nx>$Line2D/AnimationPlayer</span> <span class=c1># Added @ Part 9 after</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sfx_player</span> <span class=o>=</span> <span class=nx>$SFXPlayer</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sfx_res</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;select&#34;</span><span class=p>:</span> <span class=nb>preload</span><span class=p>(</span><span class=s2>&#34;res://Assets/Audio/PressSelect.wav&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;enter&#34;</span><span class=p>:</span> <span class=nb>preload</span><span class=p>(</span><span class=s2>&#34;res://Assets/Audio/PressEnter.wav&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;cancel&#34;</span><span class=p>:</span> <span class=nb>preload</span><span class=p>(</span><span class=s2>&#34;res://Assets/Audio/PressCancel.wav&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>color_rect</span><span class=o>.</span><span class=n>visible</span> <span class=o>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>	<span class=n>anim_player</span><span class=o>.</span><span class=nf>play</span><span class=p>(</span><span class=s2>&#34;blink_square&#34;</span><span class=p>)</span> <span class=c1># Added @ Part 9 after</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_RestartButton_mouse_entered</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>line2d</span><span class=o>.</span><span class=n>position</span> <span class=o>=</span> <span class=n>square_pos</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_QuitButton_mouse_entered</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>line2d</span><span class=o>.</span><span class=n>position</span> <span class=o>=</span> <span class=n>square_pos</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_RestartButton_button_up</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=nf>work_at_button_up</span><span class=p>(</span><span class=n>RESTART</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_QuitButton_button_up</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=nf>work_at_button_up</span><span class=p>(</span><span class=n>QUIT</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>work_at_button_up</span><span class=p>(</span><span class=n>option</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=n>stream</span> <span class=o>=</span> <span class=n>sfx_res</span><span class=p>[</span><span class=s2>&#34;enter&#34;</span><span class=p>]</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>	<span class=n>selected_option</span> <span class=o>=</span> <span class=n>option</span>
</span></span><span class=line><span class=cl>	<span class=n>color_rect</span><span class=o>.</span><span class=n>visible</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>selected_option</span> <span class=o>==</span> <span class=n>RESTART</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>confirmation</span><span class=o>.</span><span class=n>dialog_text</span> <span class=o>=</span> <span class=n>restart_text</span>
</span></span><span class=line><span class=cl>	<span class=k>elif</span> <span class=n>selected_option</span> <span class=o>==</span> <span class=n>QUIT</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>confirmation</span><span class=o>.</span><span class=n>dialog_text</span> <span class=o>=</span> <span class=n>quit_text</span>
</span></span><span class=line><span class=cl>	<span class=n>confirmation</span><span class=o>.</span><span class=nf>popup_centered</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_ConfirmationDialog_confirmed</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=n>stream</span> <span class=o>=</span> <span class=n>sfx_res</span><span class=p>[</span><span class=s2>&#34;enter&#34;</span><span class=p>]</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>	<span class=k>yield</span><span class=p>(</span><span class=n>sfx_player</span><span class=p>,</span> <span class=s2>&#34;finished&#34;</span><span class=p>)</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>selected_option</span> <span class=o>==</span> <span class=n>RESTART</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=nf>get_tree</span><span class=p>()</span><span class=o>.</span><span class=n>paused</span> <span class=o>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Scene tree paused: &#34;</span><span class=p>,</span> <span class=nf>get_tree</span><span class=p>()</span><span class=o>.</span><span class=n>paused</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nf>get_tree</span><span class=p>()</span><span class=o>.</span><span class=nf>change_scene</span><span class=p>(</span><span class=s2>&#34;res://Game/Game.tscn&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;The game is restarted.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>elif</span> <span class=n>selected_option</span> <span class=o>==</span> <span class=n>QUIT</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=nf>get_tree</span><span class=p>()</span><span class=o>.</span><span class=nf>quit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=nb>print</span><span class=p>(</span><span class=s2>&#34;The game is quited.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_ConfirmationDialog_popup_hide</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=n>stream</span> <span class=o>=</span> <span class=n>sfx_res</span><span class=p>[</span><span class=s2>&#34;cancel&#34;</span><span class=p>]</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>	<span class=n>sfx_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>	<span class=n>selected_option</span> <span class=o>=</span> <span class=kt>null</span>
</span></span><span class=line><span class=cl>	<span class=n>confirmation</span><span class=o>.</span><span class=n>dialog_text</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>	<span class=n>color_rect</span><span class=o>.</span><span class=n>visible</span> <span class=o>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_input</span><span class=p>(</span><span class=n>event</span><span class=p>):</span> <span class=c1># Added @ Part 9 after</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>visible</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_released</span><span class=p>(</span><span class=s2>&#34;ui_left&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>			<span class=n>sfx_player</span><span class=o>.</span><span class=n>stream</span> <span class=o>=</span> <span class=n>sfx_res</span><span class=p>[</span><span class=s2>&#34;select&#34;</span><span class=p>]</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>			<span class=n>sfx_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>			<span class=n>line2d</span><span class=o>.</span><span class=n>position</span> <span class=o>=</span> <span class=n>square_pos</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=k>elif</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_released</span><span class=p>(</span><span class=s2>&#34;ui_right&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>			<span class=n>sfx_player</span><span class=o>.</span><span class=n>stream</span> <span class=o>=</span> <span class=n>sfx_res</span><span class=p>[</span><span class=s2>&#34;select&#34;</span><span class=p>]</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>			<span class=n>sfx_player</span><span class=o>.</span><span class=nf>play</span><span class=p>()</span> <span class=c1># Added @ Part 13</span>
</span></span><span class=line><span class=cl>			<span class=n>line2d</span><span class=o>.</span><span class=n>position</span> <span class=o>=</span> <span class=n>square_pos</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>		<span class=k>elif</span> <span class=n>event</span><span class=o>.</span><span class=nf>is_action_released</span><span class=p>(</span><span class=s2>&#34;ui_accept&#34;</span><span class=p>)</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>color_rect</span><span class=o>.</span><span class=n>visible</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=n>line2d</span><span class=o>.</span><span class=n>position</span> <span class=o>==</span> <span class=n>square_pos</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>				<span class=nf>_on_RestartButton_button_up</span><span class=p>()</span>
</span></span><span class=line><span class=cl>			<span class=k>elif</span> <span class=n>line2d</span><span class=o>.</span><span class=n>position</span> <span class=o>==</span> <span class=n>square_pos</span><span class=p>[</span><span class=mi>1</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>				<span class=nf>_on_QuitButton_button_up</span><span class=p>()</span>
</span></span></code></pre></div></details><br><hr><h1 id=おわりに>おわりに</h1><p>以上で Part 13 は完了だ。</p><p>今回はゲームに BGM や SFX のサウンドを追加した。「AudioStreamPlayer」の基本的なプロパティ、例えば「Stream」、「Volume Db」、「Autoplay」などの編集や、スクリプトでのサウンドリソースの割り当て、サウンドの再生を経験した。</p><p>「AudioStreamPlayer」系クラスのノードは、一つのサウンドリソースしか割り当てられない。そのため、最初から複数のノードを追加しておくべきか、スクリプトでリソースを都度切り替えて割り当てるべきか、ちょっと悩ましい。スクリプトが苦手な方は無理をせず、最初はノードを複数追加し、それぞれに異なるサウンドリソースを割り当てる方法で問題ない。今後、ゲーム開発の腕が上がり、一つのシーンで大量のサウンドリソースを扱うようなプロジェクトの開発をすることがあれば、その時はスクリプトでの制御が有効かもしれない。</p><p>ところで今回、私自身このチュートリアルのために初めて BGM の作曲を試みた。気に入っていただけたら幸いだ。</p><p>さて、次回のチュートリアルでは、キャラクターのアクションをアップデートする予定だ。例えば、ジャンプして落下する時は別のアニメーションを再生したり、2段ジャンプや壁ジャンプをしたり、走っている時は砂埃がまったり、ゴーストエフェクト（残像）を追加したり、といった内容だ。</p><p>それでは次回もお楽しみに。</p><p><strong>UPDATE:</strong><br>2022/04/16　画面下落下時にゲームオーバー画面に遷移しない問題の修正のため Game.gd スクリプトの<code>manage_health</code>メソッドから<code>yield(player.die_sfx, "finished") </code>の行を削除</p><hr></div><footer class=post-footer><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 13：サウンドを追加しよう！ on x" href="https://x.com/intent/tweet/?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2013%ef%bc%9a%e3%82%b5%e3%82%a6%e3%83%b3%e3%83%89%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%97%e3%82%88%e3%81%86%ef%bc%81&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_13%2f&amp;hashtags=GodotEngine%2cGameDev%2c2D%2c%e3%82%a2%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e3%82%b2%e3%83%bc%e3%83%a0%2c%e6%a8%aa%e3%82%b9%e3%82%af%e3%83%ad%e3%83%bc%e3%83%ab%2c%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%2cBGM%2c%e3%82%b5%e3%82%a6%e3%83%b3%e3%83%89%e3%82%a8%e3%83%95%e3%82%a7%e3%82%af%e3%83%88"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 13：サウンドを追加しよう！ on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_13%2f&title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2013%ef%bc%9a%e3%82%b5%e3%82%a6%e3%83%b3%e3%83%89%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%97%e3%82%88%e3%81%86%ef%bc%81"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 13：サウンドを追加しよう！ on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_13%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li></ul><ul class=post-tags><li><a href=https://www.peanuts-code.com/ja/tags/godotengine/>GodotEngine</a></li><li><a href=https://www.peanuts-code.com/ja/tags/gamedev/>GameDev</a></li><li><a href=https://www.peanuts-code.com/ja/tags/2d/>2D</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B2%E3%83%BC%E3%83%A0/>アクションゲーム</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E6%A8%AA%E3%82%B9%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%AB/>横スクロール</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%BC/>プラットフォーマー</a></li><li><a href=https://www.peanuts-code.com/ja/tags/bgm/>BGM</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E3%82%B5%E3%82%A6%E3%83%B3%E3%83%89%E3%82%A8%E3%83%95%E3%82%A7%E3%82%AF%E3%83%88/>サウンドエフェクト</a></li></ul><nav class=paginav><a class=prev href=https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_14/><span class=title>« 前へ</span><br><span>Godot で作るプラットフォーマー Part 14：プレイヤーキャラクターのアクションをアップデートしよう！</span>
</a><a class=next href=https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_12/><span class=title>次へ »</span><br><span>Godot で作るプラットフォーマー Part 12：光と影を演出しよう！</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://www.peanuts-code.com/ja/>Peanuts Code</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="コピー";function s(){t.innerHTML="コピーされました!",setTimeout(()=>{t.innerHTML="コピー"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>