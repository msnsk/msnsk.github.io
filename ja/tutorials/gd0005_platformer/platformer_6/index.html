<!DOCTYPE html>
<html lang="ja" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Godot で作るプラットフォーマー Part 6：アイテムを作ろう！ | Peanuts Code</title>
<meta name="keywords" content="Godot, GodotEngine, ゲーム開発, チュートリアル, 初級, 2D, プラットフォーマー, アクションゲーム, 横スクロール, アイテム" />
<meta name="description" content="第6回目の今回は、アイテムを作る。アイテムというのは、ちょうどスーパーマリオシリーズのコインのような、当たるとポイントを獲得できてちょっと嬉しい存在だ。さらに、下から小突くとアイテムが出てくる箱、その名もアイテムボックスを作る。それぞれスクリプトで動作を制御し、最後はレベルシーンに配置するところまでやっていこう。
 Memo：">
<meta name="author" content="Masanao Sako">
<link rel="canonical" href="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_6/" />
<meta name="google-site-verification" content="XYZabc" />
<meta name="yandex-verification" content="XYZabc" />
<meta name="msvalidate.01" content="XYZabc" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.css" rel="preload stylesheet" as="style">
<link rel="preload" href="/images/logomark.png" as="image">
<link rel="icon" href="https://www.peanuts-code.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.peanuts-code.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.peanuts-code.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://www.peanuts-code.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://www.peanuts-code.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.96.0" />
<link rel="alternate" hreflang="ja" href="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_6/" />

<script async src="https://www.googletagmanager.com/gtag/js?id=G-DK0NK2RTTW"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-DK0NK2RTTW', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="Godot で作るプラットフォーマー Part 6：アイテムを作ろう！" />
<meta property="og:description" content="第6回目の今回は、アイテムを作る。アイテムというのは、ちょうどスーパーマリオシリーズのコインのような、当たるとポイントを獲得できてちょっと嬉しい存在だ。さらに、下から小突くとアイテムが出てくる箱、その名もアイテムボックスを作る。それぞれスクリプトで動作を制御し、最後はレベルシーンに配置するところまでやっていこう。
 Memo：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_6/" />
<meta property="og:image" content="https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_6/img57.gif" /><meta property="article:section" content="tutorials" />
<meta property="article:published_time" content="2022-02-19T16:17:02&#43;09:00" />
<meta property="article:modified_time" content="2022-02-25T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_6/img57.gif" />
<meta name="twitter:title" content="Godot で作るプラットフォーマー Part 6：アイテムを作ろう！"/>
<meta name="twitter:description" content="第6回目の今回は、アイテムを作る。アイテムというのは、ちょうどスーパーマリオシリーズのコインのような、当たるとポイントを獲得できてちょっと嬉しい存在だ。さらに、下から小突くとアイテムが出てくる箱、その名もアイテムボックスを作る。それぞれスクリプトで動作を制御し、最後はレベルシーンに配置するところまでやっていこう。
 Memo："/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Tutorials",
      "item": "https://www.peanuts-code.com/ja/tutorials/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "シリーズ：Godot で作るプラットフォーマー",
      "item": "https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Godot で作るプラットフォーマー Part 6：アイテムを作ろう！",
      "item": "https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_6/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Godot で作るプラットフォーマー Part 6：アイテムを作ろう！",
  "name": "Godot で作るプラットフォーマー Part 6：アイテムを作ろう！",
  "description": "第6回目の今回は、アイテムを作る。アイテムというのは、ちょうどスーパーマリオシリーズのコインのような、当たるとポイントを獲得できてちょっと嬉しい存在だ。さらに、下から小突くとアイテムが出てくる箱、その名もアイテムボックスを作る。それぞれスクリプトで動作を制御し、最後はレベルシーンに配置するところまでやっていこう。\n Memo：",
  "keywords": [
    "Godot", "GodotEngine", "ゲーム開発", "チュートリアル", "初級", "2D", "プラットフォーマー", "アクションゲーム", "横スクロール", "アイテム"
  ],
  "articleBody": "第6回目の今回は、アイテムを作る。アイテムというのは、ちょうどスーパーマリオシリーズのコインのような、当たるとポイントを獲得できてちょっと嬉しい存在だ。さらに、下から小突くとアイテムが出てくる箱、その名もアイテムボックスを作る。それぞれスクリプトで動作を制御し、最後はレベルシーンに配置するところまでやっていこう。\n Memo： \n過去のシリーズをまだご覧になっていない方は、そちらを先にご覧いただくことをおすすめします。\nGodot で作るプラットフォーマー \n  \n (adsbygoogle = window.adsbygoogle || []).push({});   Item シーンを作る Item シーンを作成してノードを追加する 敵キャラクターの作り方と同じく、アイテムについても、雛形となるシーンを作成して、それを継承する形で複数種類のアイテムのシーンを作っていく。\nまずは雛形として「Item」シーンを作成しよう。\n 「シーン」メニュー＞「新規シーン」を選択する 「ルートノードを生成」で「その他のノード」を選択する 「Area2D」クラスのノードを選択する 「Area2D」ルートノードの名前を「Item」に変更する 「Items」フォルダを作成して、パスを「res://Items/Item.tscn」としてシーンを保存する\n  続いて、ルートノードに必要な子ノードを追加していく。\n 「Item」ルートノードに「AnimatedSprite」ノードを追加する 「Item」ルートノードに「CollisionShape2D」ノードを追加する 「Item」ルートノードに「Label」ノードを追加する 「Item」ルートノードに「AnimationPlayer」ノードを追加する  各ノードのプロパティを編集する 各ノードのプロパティをインスペクターで調整していく。\nAnimatedSprite の編集   「Frames」プロパティに「新規SpriteFrames」を割り当てる\n  スプライトフレームパネルを開き、以下の手順でアニメーションを作成する\n 「default」アニメーションの名前を「idle」に変更する 「idle」アニメーションに、仮のアニメーションフレームとして「res://Assets/Items/Fruits/Apple.png」のスプライトシートを割り当てる（フレーム 0 ~ 16） 速度を 24 FPS にする ループをオンにしておく\n    インスペクターに戻って、「Animation」プロパティの値を「idle」にする\n  「Playing」プロパティをオンにする\n  CollisionShape2D の編集  「Shape」プロパティに「新規CapsuleShape2D」を割り当てる 2Dワークスペースでコリジョン形状をスプライトテクスチャに合わせて調整する  Radius: 8 Height: 0    Label の編集  「Text」プロパティの値に、デフォルトのテキストとして「100」と入力する 「Align」プロパティを「Center」にする 「Valign」プロパティを「Center」にする 「Position」プロパティを（-32, -20）にする 「Size」プロパティを (64, 14) にする  AnimationPlayer の編集 「AnimationPlayer」は「AnimatedSprite」のようなスプライトテクスチャのアニメーション以外にも、他のあらゆるプロパティの値をアニメーションさせながら変化させることができる。\n今回は、プレイヤーキャラクターがアイテムに当たった時に獲得ポイントを表示しながらアイテムが消えるアニメーションを新規作成する。以下の手順に沿って作ってみよう。\n アニメーションパネルを開いたら、パネル上部中央の「アニメーション」をクリックする\n 「新規」を選択する\n アニメーションの名前を「hit」にする\n アニメーションの長さを「0.5」秒にする\n  ここからは（アニメーションさせるプロパティの）トラックを追加し、トラック上にいくつかキーを挿入し、キーごとに値を設定して、トラック上の値の変化によりアニメーションさせていく。キーを挿入するまでの手順は2パターンあるので、お好みの方でやってみてほしい。\n● パターン 1 : アニメーションパネル上でトラックを追加してそこにキー挿入する方法\n アニメーションパネルの左上「トラックを追加」をクリックし、トラックの種類から「プロパティトラック」を選択する。\n どのノードのプロパティなのかを選択する。ここでは「AnimatedSprite」を選択する\n どのプロパティのトラックを追加するのかを選択する。見つかりにくい時は上の検索ボックスを利用する。ここでは「modulate」プロパティを選択して開く\n アニメーションパネルに「AnimatedSprite」ノードの「modulate」プロパティのトラックが追加された。ここで上部タイムライン上の青い縦のバーを 0 秒の位置に持ってこよう。\n この青いバーの位置にキーを挿入する。挿入するには「modulate」トラックの青いバーより少し横を右クリックし、「キーを挿入」メニューを選択しよう。\n  ● パターン 2 : インスペクター上の鍵アイコンをクリックし、トラックとキーを同時に挿入する\n 事前にアニメーションパネルのタイムラインでキーを挿入したいタイミング（ひとまず最初は一番左の 0 秒の位置）に青い縦のバーを合わせておく シーンドックで「AnimatedSprite」を選択する\n 「AnimatedSprite」ノードを選択した場合、エディター下部で自動的にスプライトフレームパネルが開くが、アニメーションパネルに切り替える\n インスペクターで、今回アニメーションのトラックとして追加したい「Modulate」プロパティの右側にある鍵アイコンをクリックする\n 新規トラックを作成してキーを挿入するかどうかの確認のダイアログが表示されるので「作成」をクリックする\n  ここからの手順は共通。\n 0.5秒の位置にも「modulate」トラックにキーを挿入しよう。 それぞれのキーの値を編集する。挿入したキーは四角いアイコンで表示されているので、それをクリックして選択する。\n インスペクターで「AnimationTrackKeyEdit」の「Value」の値を編集する。  0 秒: (r, g, b, a) = (255, 255, 255, 0) 0.5秒: (r, g, b, a) = (255, 255, 255, 255)    ここまでの設定でアニメーションがどうなったのか見ていこう。アニメーションパネル左上にあるプレイバックアイコンを操作することで2Dワークスペース上で簡単に確認ができる。\nGIF画像のリピート再生だとわかりにくいかもしれないが、「Modulate」プロパティの値の透明度を 255 から 0 に変化させることによって、フェードアウトするアニメーションになった。\n同様にして、他にもいくつかのトラックを追加し、それぞれのトラックに対して、キーを挿入してアニメーションをより複雑にしていこう。\n● AnimatedSprite ノードのトラック\n modulate プロパティ: アイテムの不透明度を MAX から 0 へ　*作成済み  Time: 0 秒 / Value: (255, 255, 255, 255) Time: 0.5 秒 / Value: (255, 255, 255, 0)   position プロパティ: アイテムの位置を上方向に 10 px 移動  Time: 0 秒 / Value: (0, 0) Time: 0 秒 / Value: (0, -10)   scale プロパティ: アイテムの大きさを横方向に 5 倍広げて縦方向は 0 に  Time: / Value: (1, 1) Time: / Value: (5, 0)\n    ● Label ノードのトラック\n modulate プロパティ: 獲得ポイントの不透明度を最初の 0.1 秒で Max（表示）、最後の 0.1 秒で 0（非表示）へ  Time: 0 秒 / Value: (255, 255, 255, 0) Time: 0.1 秒 / Value: (255, 255, 255, 255) Time: 0.4 秒 / Value: (255, 255, 255, 255) Time: 0.5 秒 / Value: (255, 255, 255, 0)   rect_position プロパティ: 獲得ポイント表示をアイテムのやや上からさらに 20 px 上へ移動  Time: 0 秒 / Value: (-32, -20) Time: 0.5 秒 / Value: (-32, -40)    アニメーションパネルは以下のスクリーンショットのようになったはずだ。\nでは、2Dワークスペース上でアニメーションを確認してみよう。\nだいたい意図した形になったので、アイテムのアニメーションは完成としよう。\nItem シーンにスクリプトをアタッチする それではアイテムシーンをスクリプトで制御していこう。\nさっそく、シーンドックで「Item」ルートノードを選択したら、スクリプトをアタッチする。継承元を「Area2D」、ファイルパスを「res://Items/Item.gd」としてスクリプトを作成しよう。\nスクリプトエディタが開いたら、いつも通り、まずはプロパティから定義していく。\nextends Area2D   export var point = 100 # アイテムに当たった時の獲得ポイント onready var sprite = $AnimatedSprite # AnimatedSprite ノードの参照 onready var label = $Label # Label ノードの参照 onready var anim_player = $AnimationPlayer # AnimationPlayer ノードの参照 ここでpointというプロパティをデフォルトの値を100として定義した。これはプレイヤーキャラクターがアイテムに当たった時に獲得できるポイントだ。exportキーワード付きなので、継承後のシーンではインスペクターで気軽にポイントを変更できる。この値はアイテムの種類によって変える予定だ。取るのが難しいアイテムほど高得点にしたい。また、今後、スコア機能を実装する時にポイントがスコアに加算されるようにもしていく予定だ。また、このpointプロパティを画面上に表示させるため、_readyメソッドで「Label」ノードの「Text」プロパティにpointの値を適用するよう、このあと設定していく。\nでは_readyメソッドを定義していこう。\nfunc _ready(): \tsprite.modulate = Color(1, 1, 1, 1) \tsprite.position = Vector2.ZERO \tsprite.scale = Vector2.ONE \tlabel.modulate = Color(1, 1, 1, 0) \tlabel.rect_position = Vector2(-32, -20) \tlabel.text = str(point) 「AnimatedSprite」ノードのmodulate、position、scaleおよび「Label」ノードのmodulate、rect_positionは全て、さきほどアニメーションパネルで「hit」アニメーションに用いたプロパティだ。デバッグ作業をしていると、各プロパティがアニメーションを実行した後の値のままになってしまうので、最初に_readyメソッドで初期値を設定するようにした。\n最後の「Label」ノードのtextプロパティは、インスペクターで 100 と入力しておいた「Text」プロパティとイコールだ。上で定義したpointプロパティの値は int 型なのでstr関数により string 型（文字列型）に変換して、textプロパティの値として設定している。\nあとはプレイヤーキャラクターが当たったらアイテムが消える動きを作っていこう。\nここはまずシグナルを利用したいので、シーンドックに戻って「Item」ルートノードを選択し、ノードドック＞「シグナル」タブから「body_entered(body)」を接続しよう。接続先はもちろん「Item.gd」スクリプトだ。\n接続できたら_on_Item_body_enteredメソッドが追加されたはずだ。このメソッドを以下のように編集する。\nfunc _on_Item_body_entered(body): \t# もし衝突した body の名前が Player だったら \tif body.name == \"Player\": \tprint(\"Player hit Item\") \t# AnimationPlayer ノードの「hit」アニメーションを再生する \tanim_player.play(\"hit\") \t# 「hit」アニメーションが終了するまで待機 \tyield(anim_player, \"animation_finished\") \t# この「Item」ノードを開放する（消す） \tqueue_free() ここで一旦テストとして「Item」シーンのインスタンスを「Level1」シーンに追加して、動作確認しておこう。確認できたら追加した「Item」ノードは不要なので削除すること。\n動作も概ね期待通りなので、雛形となる「Item.tscn」シーンはこれで完成としておこう。次はこの「Item.tscn」を継承して個々のアイテムのシーンを作っていく。\n \n (adsbygoogle = window.adsbygoogle || []).push({});   Item シーンを継承して複数種類のアイテムのシーンを作る では次に「Item.tscn」シーンを継承して、個々のアイテムを作っていく。作業は基本的にスプライトシートを差し替えて、獲得ポイントを変更するだけだ。\n作成する個々のアイテムの種類と獲得ポイントは以下のように設定する（完全に適当なので、アイテムの種類数や割り当てるポイントの大きさはご自由にしていただいて構わない）。\n Apple: 100 Bananas: 300 Cherries: 500 Kiwi: 700 Melon: 1000 Orange: 1200 Pineapple: 1500 Strawberry: 2000  上述の個々のアイテムのシーンを以下の手順で一つずつ順番に作成していこう。\n 「シーン」メニュー＞「新しい継承シーン」を選択する。 継承元に「res://Items/Item.tscn」を選択する。 ルートノードの名前を「Item」から「Bananas」など個々のアイテムの名前に変更する ファイルパスを「res://Items/Bananas.tscn」などとして、シーン保存する ルートノードを選択し、インスペクターから「Point」プロパティの値を 300 など各アイテムに割り当てる予定のポイントに変更する（ Apple の場合は変更なし）\n 「AnimatedSprite」ノードの「Frames」プロパティの値「SpriteFrames」の右横の ⌵ をクリックし、「ユニーク化」を選択する　*お忘れなきよう！  スプライトフレームパネルを開き、「idle」アニメーションのアニメーションフレームを全て削除して、新たに「res://Assets/Items/Fruits/Bananas.png」など各アイテムのスプライトシートを割り当てる（ Apple の場合は変更なし）\n  必要な数だけ個々のアイテムのシーンを作成していただけただろうか。次は「Level1」シーンに作成したアイテムのインスタンスノードを追加して、マップに配置していこう。\n \n (adsbygoogle = window.adsbygoogle || []).push({});   Level1 シーンにアイテムを追加する シーンドックで「Level1」シーンを開こう。そして、作成した個々のアイテムシーンをインスタンス化して、「Level1」ルートノードの子ノードとして追加しよう。\nここではサンプルとして合計8種類のフルーツアイテムを一つずつ追加した。確認しやすくするため、一時的に敵キャラクターのノードは全て非表示にした。\nシーンドックで各アイテムを追加したら（もしくはしながら）、2Dワークスペース上で、タイルマップのどの位置にアイテムを置いたら面白いかを検討しつつ、一つずつ配置していこう。サンプルの配置場所は以下のとおりだ。\nではプロジェクトを実行して、プレイヤーキャラクターがアイテムに当たった時の挙動を確認しつつ、実際のプレイ画面上でも念のためにアイテムの配置を確認しておこう。なお、以下のGIF画像は 2 倍速にしている。\n各アイテムの「AnimatedSprite」の「idle」アニメーションがループ再生されており、プレイヤーキャラクターがアイテムに当たったら「AnimationPlayer」のアニメーションを実行してオブジェクトが削除された。概ね問題ないだろう。\n \n (adsbygoogle = window.adsbygoogle || []).push({});   ItemBox シーンを作る 次は下から小突くとフルーツアイテムが順番に出てくるアイテムボックスを作ってみよう。スーパーマリオシリーズの下から小突くとコインが繰り返し出てくるブロックのようなイメージだ。アイテムボックスの仕様は以下のようにする。\n 衝突判定があり、プレイヤーキャラクターや敵キャラクターはボックスを透過しない 下からプレイヤーキャラクターが衝突した時しかアイテムは出ない 最初に下から衝突してから 4 秒経過すると、アイテムボックスは空っぽになる 最後の一つのアイテムが出ると、アイテムボックスは壊れて無くなる。  ItemBox シーンを作成してノードを追加する では以下の手順でシーンを作ろう。\n 「シーン」メニュー＞「新規シーン」を選択 「ルートノードを生成」で「その他のノード」を選択する 「StaticBody2D」クラスをルートノードに設定する ルートノードの名前を「ItemBox」に変更する ファイルパスを「res://Items/ItemBox.tscn」として保存する  なお、自ら動くことのない物理ボディには「StaticBody2D」が最適だ。\n続いて、上述の仕様を満たすために必要なノードを追加していく。  「ItemBox」ルートノードに「AnimatedSprite」ノードを追加する 「ItemBOx」ルートノードに「CollisionShape2D」ノードを追加する 「ItemBox」ルートノードに「Timer」ノードを追加する 「ItemBox」ルートノードに「Area2D」ノードを追加する 「Area2D」ノードに「CollisionShape2D」を追加する  シーンドックは以下のようになっただろうか。 次はインスペクターでそれぞれのノードのプロパティを編集していく。\n各ノードのプロパティを編集する AnimatedSprite の編集 アセットにアニメーション用のスプライトシートが用意してあるので、それらを利用してアニメーションを設定する。\n  インスペクターで「Frames」プロパティに「新規SpriteFrames」を割り当てる\n  スプライトフレームパネルを開き、以下の2つのアニメーションを作成する\n アニメーション名: hit  スプライトシート: res://Assets/Items/Boxes/Box2/Hit (28x24).png 速度: 24 FPS ループ: オフ     アニメーション名: idle  スプライトシート: res://Assets/Items/Boxes/Box2/Idle.png 速度: 24 FPS ループ: オン      インスペクターに戻り「Animation」プロパティを「idle」に設定する\n  ルートノード直下の CollisionShape2D の編集 プレイヤー / 敵キャラクターとの衝突を検知するようにコリジョン形状を調整していく。\n インスペクターで「Shape」プロパティに「新規RectangleShape2D」を割り当てる 2Dワークスペースでコリジョン形状を編集し、「idle」アニメーションのスプライトテクスチャの一番下を 1 px だけ空けて、他はスプライトテクスチャにピッタリ合わせる\n インスペクター関連プロパティが以下のようになっているか確認する   Extents: (10, 9.5) Position: (0, -0.5)  Timer の編集 最初にアイテムボックスを下から小突いてから 4 秒経過後にアイテムボックスを空っぽにするにはタイマーの設定が必要だ。「Timer」ノードを以下のように設定しよう。\n 「Wait Time」プロパティの値を 4 にする 「One Shot」プロパティを オン にする  Area2D 直下の CollisionShape2D を編集する 下からプレイヤーキャラクターが衝突した時しかアイテムが出ないように、ボックスの下部にだけ、本体とは別のコリジョン形状を設定する。\n インスペクターで「Shape」プロパティに「新規RectangleShape2D」を割り当てる 2Dワークスペースでコリジョン形状を編集し、「idle」アニメーションのスプライトテクスチャの一番下から高さ 1 px の範囲に合わせる\n  ここまでで各ノードのプロパティ編集はひとまず完了だ。「ItemBox」ルートノードにスクリプトをアタッチしたいところだが、その前にもう一つ別のオマケのシーンを作成する。\n \n (adsbygoogle = window.adsbygoogle || []).push({});   BrokenBox シーンを作成する アイテムボックスからアイテムが出尽くした時に箱が壊れる演出を入れたい。アイテムボックスが壊れる時に、BrokenBox シーンを ItemBox と同じ場所に配置したら、ItemBox は消しつつ BrokenBox シーンによって木片が飛び散るようにする。このような細かい複数の物体や流体を表現するにはパーティクルシステムを利用する。パーティクルとは小片とか粒という意味だ。\nでは手早く以下の手順で BrokenBox シーンを作成しよう。\n 「シーン」メニュー＞「新規シーン」を選択 「ルートノードを生成」で「その他のノード」を選択 「Particles2D」クラスのノードを選択 「Particles2D」ノードの名前を「BrokenBox」に変更する ファイルパスを「res://Items/BrokenBox.tscn」としてシーンを保存する  BrokenBox ルートノードのプロパティを編集する ルートノードに設定した「Particles2D」ノードだが、このプラットフォーマーのチュートリアルでは初登場だ。「Paarticle2D」は2Dゲームで、例えば炎や雨、雪、煙、血飛沫など、細かな粒子の動きを表現するのによく利用される。なお、「Particles2D」クラスのノードについては、Godot の公式オンラインドキュメントも説明が比較的わかりやすいので、参考にしていただくのが良いだろう。\n 公式オンラインドキュメント \nパーティクル・システム(2D) \n 「Particles2D」ノードにはプロパティの項目がたくさんある。最初は思い通りの動きにするのにやや骨が折れるが、慣れてしまえば本当に多くの表現に利用できる。インスペクターで必要なプロパティを上から順番に編集していこう。\nインスペクターでが値の左横にあるプロパティは、初期値から変更を加えているので目印にしてほしい。\n Emitting: オフ\nパーティクルを実行するかどうか。下の「One Shot」がオンなので、一度実行されたらオフになる。ボックスが破壊されたタイミングでスクリプトによってオンにする予定だ。 Amount: 16\nパーティクルの数。今回は16個  Time セクション:\n Lifetime: 4\nパーティクルが存在する時間（秒）。今回は 4 秒後に消える設定。 One Shot: オン\n一回限りの実行かどうか。今回はボックスが壊れたらボックスは消えるのでオンにしておく。 Speed Scale\nパーティクルシステム実行時の速度 Explosiveness: 0.8\n1 に近づくほど、次回の実行までの時間が長くなる。したがって 1 はすべてのパーティクルが同時に表示される。今回は同時まではいかないが、同時にやや近い 0.8 に設定。\n  Process Material セクション:\n  Material: 新規ParticlesMaterial\nパーティクルを処理するための素材。セットした「ParticlesMaterial」のプロパティを設定していくので、インスペクターで「ParticlesMaterial」をクリックする。\nParticlesMaterial のプロパティ:\n  Emission Shape セクション\n Shape: Box\nデフォルトの Point だと全てのパーティクルの開始位置が点になるが、Boxだと、四角い範囲内からの開始になる。\n    Flags セクション\n Disable Z: オン\n2Dゲームなので、Z軸方向の位置は無効にする。\n    Direction セクション\n Direction: (0, -1, 0)\nパーティクルの移動する方向、真っ直ぐ上方向にするため y の値を -1 とした。 Spread: 30\nパーティクルが広がる角度の設定。デフォルトは 45° だが、箱の破片があまり広く飛び散ってほしくないので、少し狭めの 30° にした。\n    Gravity セクション\n Gravity: (0, 10, 0)\n重力の設定。真っ直ぐ下方向に重力をかけるため y の値を 10 とした。\n    Initial Velocity セクション\n Velocity: 20\nパーティクルの速度の設定。下から小突いて壊れた時に飛び散る破片として違和感ない 20 とした。\n    Angular Velocity セクション\n Velocity: 15\nパーティクルの 1 秒あたりの回転角度の設定。少しだけ回転するように 15° とした。\n    Scale セクション\n Scale: 0.5\n箱の破片の大きさを実際のテクスチャの半分にして、細かな破片になるようにした。 Scale Random: 1\n0.5 ~ 1 の Scalse の間で完全にランダムになるよう値を 1 とした（1 は 100%）。\n    Animation セクション\n Offset: 1\nパーティクルのアニメーションのオフセット設定。アニメーションの開始フレームをずらすことができる。しかし今回は「Animation」セクションの「Speed」プロパティを 0 にしているため、そのままだとアニメーションはせず、全てのパーティクルがスプライトシートの 1 フレーム目のテクスチャになってしまう。それを回避するためにまずはこのプロパティの値を 1 とした。これにより、アニメーションの開始位置をスプライトシートの最後のフレームにずらすことができる。しかしこのままでは、全てのパーティクルがスプライトシートの最後のフレームのテクスチャになってしまうだけだ。そこで次の「Offset Random」を設定する。 Offset Random: 1\nアニメーションのオフセットのランダム率を 1（つまり 100%）とした。これにより、例えば 4 フレームのスプライトシートによるアニメーションなら、1 ~ 4 フレームのうちいずれかのテクスチャがアニメーションの開始位置として適用される。今回「Speed」プロパティが 0 なので、アニメーションせず、各パーティクルのテクスチャはランダムで決定され、かつ生成されてから消失するまで同じテクスチャが維持される。\n      Textures セクション:\nファイルシステムドックから「res://Assets/Items/Boxes/Box2/Break.png」のスプライトテクスチャファイルをドラッグ\u0026ドロップで適用する。\n  Material セクション:\n Material: 新規CanvasItemMaterial を適用 Particle Animation: オン Particle Animation H Frames: 4 Particle Animation V Frames: 1 Particle Anim Loop: オフ\n    これでインスペクターでのプロパティの編集は完了だ。「Particles2D」クラスは「ParticlesMaterial」も含めて、プロパティが非常に多く、最初は難しく感じるだろう。どのプロパティが何に影響するのかは、いろいろ触っているうちにわかってくるところがある。このチュートリアルに限らず、是非あなた自身の手でパーティクルシステムにより様々な表現ができることを試してみて欲しい。\nBrokenBox にスクリプトをアタッチする 「BrokenBox」ルートノードに新規でスクリプトをアタッチしよう。ファイルパスを「res://Items/BrokenBox.gd」として作成しよう。\nこのスクリプトでやりたいことはシンプルに以下の2つだけだ。\n シーンツリーに追加されたらまず「Emitting」プロパティをオンにしてパーティクルシステムを最初から自動的に実行する パーティクルシステムが終了して「Emitting」プロパティがオフになったらこの「BrokenBox」ノードを解放（削除）する  ということで、上記の2つを制御するための具体的なスクリプトは以下の通りだ。\nextends Particles2D  # シーンツリーに追加されたらパーティクルシステムを実行 func _ready(): \temitting = true  # パーティクルシステムが終了したら BrokenBox ノードを解放 func _process(delta): \tif not emitting: \tqueue_free() \t# デバッグ用 \tprint(\"BrokenBox removed.\") \n \n (adsbygoogle = window.adsbygoogle || []).push({});   ItemBox シーンにスクリプトをアタッチする 当初予定していた仕様を満たすため、「ItemBox.gd」スクリプトに戻って、コードでアイテムボックスを制御していく。\nまずは「ItemBox」ルートノードを選択して、新規でスクリプトをアタッチする。スクリプトのファイルパスは「res://Items/ItemBox.gd」として作成しよう。\n「ItemBox.gd」スクリプトを開いたらさっそく編集していこう。まずはプロパティの定義からしていく。\nextends StaticBody2D  # Timer ノードのタイマーを利用したことがなければ true var timer_unused = true # AnimatedSprite ノードの参照 onready var sprite = $AnimatedSprite # Timer ノードの参照 onready var timer = $Timer # 親ノードの参照 onready var parent = get_parent() # 事前に読み込んだ BrokenBox シーンファイル onready var broken_box_tscn = preload(\"res://Items/BrokenBox.tscn\") # 事前に読み込んだ個々のアイテムのシーンファイルを配列（Array）に格納 onready var items = [ \tpreload(\"res://Items/Apple.tscn\"), \tpreload(\"res://Items/Bananas.tscn\"), \tpreload(\"res://Items/Cherries.tscn\"), \tpreload(\"res://Items/Kiwi.tscn\"), \tpreload(\"res://Items/Melon.tscn\"), \tpreload(\"res://Items/Orange.tscn\"), \tpreload(\"res://Items/Pineapple.tscn\"), \tpreload(\"res://Items/Strawberry.tscn\"), ] 今回、アイテムボックスの仕様を満たすには、「Timer」ノードのタイマーが発動済みか未使用かの区別が必要になる。そのステータス管理用のプロパティがtimer_unusedだ。\nonreadyキーワード付きのitems（~s と複数形になっていることに注意）プロパティは、このシリーズのチュートリアルでは初登場の 配列（Array） 型の値をとる。配列というのは、複数のオブジェクトを格納することができるデータ型だ。今回は、事前に読み込んだ個々のアイテムのシーンファイル .tscn を格納している。つまり、アイテムボックスから出現するアイテムの元となるシーンファイルをこの配列の要素にしている。要素の順番も重要だ。配列の前からポイントの低いアイテムの順番になっている。前から順に要素を取り出すようにすれば、ポイントの低いアイテムから順番に出現させることができる。\n配列（Array）は非常に便利なので、今後もできるだけ慣れ親しんでいきたいところだ。お時間があれば、ぜひ公式オンラインドキュメントもご参照いただきたい。\n 公式オンラインドキュメント \nArray \n _readyメソッドでゲーム開始前に必要な準備をコーディングしよう。\nfunc _ready(): \t# AnimatedSprite ノードが idle アニメーションを再生 \tsprite.play(\"idle\") \nここで「Timer」ノードの「timeout()」シグナルをこのスクリプトに接続しておく。\nちなみに、先にインスペクターで「Timer」ノードの「Wait Time」プロパティを 4 秒に設定したので、タイマーがスタートしてから 4 秒でこのシグナルが発信される。\nシグナルを接続したら、以下の_on_Timer_timeoutメソッドが追加されたはずだ。メソッド内を編集していく。\nfunc _on_Timer_timeout(): \t# デバッグ用 \tprint(\"Item box timer time out\") \t# 配列 items が空っぽでなければ \tif not items.empty(): \t# 配列 items から全ての要素を消去 \titems.clear() \t# デバッグ：配列 items の要素数を確認 \tprint(\"items size: \", items.size()) 配列クラスには色々便利なメソッドが用意されているが、ここではひとまず、今回利用したメソッドに関してのみ説明しておこう。\nif構文で利用しているemptyメソッドでは、配列itemsが空っぽかどうかを確認できる。空っぽだったらtrue、空っぽでなければfalseを返す。\nifブロック内で実行しているclearメソッドは、配列内の要素を全て消去する。制限時間 4 秒が経過したらアイテムボックスは空っぽになる、というイメージだ。\nデバッグ用のprint関数内で使用されているsizeメソッドは、配列の要素数を返す。\n次に「Area2D」ノードの「body_entered(body)」シグナルをこのスクリプトに接続する。\n接続したらスクリプトに_on_Area2D_body_enteredメソッドが追加されたはずだ。ところで「Area2D」ノードのコリジョン形状はアイテムボックスの下部 1 px の部分にだけ配置したことは覚えているだろうか。そこにプレイヤーキャラクターが衝突した時に実行すべきコードをこの_on_Area2D_body_enteredメソッド内に記述していくというわけだ。\n具体的にコードは以下のようになった。\nfunc _on_Area2D_body_entered(body): \t# 衝突した body が Player という名前のノードだったら \tif body.name == \"Player\": \t# timer_unused プロパティが true だったら \tif timer_unused: \t# Timer ノードのタイマーをスタートする \ttimer.start() \t# timer_unused を false にする \ttimer_unused = false \t\t# AnimatedSprite の play メソッドで hit アニメーションを再生 \tsprite.play(\"hit\") \t# AnimatedSprite のアニメーションが終了するまで待機 \tyield(sprite, \"animation_finished\") \t# AnimatedSprite の Play メソッドで idle アニメーションに戻して再生 \tsprite.play(\"idle\") \t\t# もし配列 items が空っぽだったら \tif items.empty(): \t# デバッグ用 \tprint(\"Item box is empty.\") \t# AnimatedSpriteノードを非表示にしてアイテムボックスを画面から消す \tsprite.visible = false \t# BrokenBox シーンのインスタンスを変数に代入 \tvar broken_box = broken_box_tscn.instance() \t# 親ノードの子ノード（ItemBox と同じ階層）として BrokenBox インスタンスを追加 \tparent.add_child(broken_box) \t# BrokenBox の位置を ItemBOx の位置と同じにする \tbroken_box.position = position \t# ItemBox を解放（削除）する \tqueue_free() \t# デバッグ用 \tprint(self.name, \" removed.\") \t# 配列 items が空っぽではなかったら \telse: \t# デバッグ用 \tprint(\"Item box is not empty.\") \t# 変数 item を定義  配列 items の最初の要素を取り出してインスタンス化 \tvar item = items.pop_front().instance() \t# インスタンス化したアイテムのシーンを ItemBox の子ノードにする \tadd_child(item) \t# アイテムのインスタンスノードの position の y の値を -12 する（箱より少し上にアイテムを出現させる） \titem.position.y -= 12 \t# アイテムのインスタンスノードの hit メソッドを実行 \titem.hit() 少し補足説明しておく。\nif timer_unused:の構文で、timer_unusedプロパティがtrueの場合（つまりタイマーが使われた事がない）だけ、タイマーをスタートさせている。その直後にこのtimer_unusedをfalse（タイマーが使われた事がある）に変更するので、初めてアイテムボックスを下から小突いた時にしかタイマーは開始しない仕組みになっている。\n次に「AnimatedSprite」の「hit」アニメーションを再生させている。\nさらにそのあとはif / else構文で条件分岐する。\nここでもまた配列itemsのemptyメソッドを利用している。ifとelseの条件が逆の方がわかりやすいかもしれないが、今回はif構文にnotを入れなくて済むようにした。\nif items.empty():の条件である『配列itemsが空っぽの場合』を満たしたらブロックの中に進む。これはつまりアイテムボックスからアイテムが出尽くした場合だ。その場合、以下のような順番で処理が進む。\n 先に「AnimatedSprite」ノードを非表示にして、画面からアイテムボックスを消す。 「BrokenBox」シーンをインスタンス化する 「BrokenBox」のインスタンスを、親ノード に追加する（この時点でパーティクルシステムが実行される） 「BrokenBox」ノードの位置を「ItemBox」ノードの位置と同じにする 「ItemBox」ノードは解放（削除）する（解放しても「BrokenBox」は親ノードに紐づいているためパーティクル実行中でも影響されない）  順番が逆でややこしいかもしれないが、else:の条件は『配列itemsが空っぽでなければ』となる。アイテムボックスにまだアイテムが入っている場合だ。この場合は以下の順序でコードが実行される。\n pop_frontメソッドにより、配列itemsの先頭の要素（アイテムのシーン）を取り出して、それをインスタンス化する（この時取り出した要素はitems内からは削除される） 取り出したシーンのインスタンスを「ItemBox」自身の子ノードとして追加する 子にしたアイテムのノードの位置を、「ItemsBox」自身の位置より y 軸上で -12ずらした位置に設定する アイテムのノードのhitメソッドを実行する  これで「ItemBox.gd」スクリプトのコーディングは完成だ。\n「Level1」シーンにインスタンスを追加して、アイテムボックスが正しく動作するか確認しておこう。\nプロジェクトを実行して当初想定していた以下の仕様を満たしているか確認してみよう。\n 衝突判定があり、プレイヤーキャラクターや敵キャラクターはボックスを透過しない 下からプレイヤーキャラクターが衝突した時しかアイテムは出ない 最初に下から衝突してから 4 秒経過すると、アイテムボックスは空っぽになる 最後の一つのアイテムが出ると、アイテムボックスは壊れて無くなる。  概ね問題ないが、アイテムボックスからアイテム（フルーツ）が出てきてすぐにぺちゃんこに変形してしまうので、何が出てきたのかわかりにくい。そこで「Item.tscn」シーンを開き、「AnimationPlayer」の「hit」アニメーションを編集しよう。\n「AnimatedSprite」「modulate」トラック：0 秒の位置にあるキーの「Easing」プロパティを 1 から 3 に変更\n「AnimatedSprite」「scale」トラック：0 秒の位置にあるキーの「Easing」プロパティを 1 から 4 に変更\nもう一度確認だ。\nさっきよりはフルーツの形状がわかりやすくなっただろう。これでアイテムボックスは完成としよう。\n Level1 シーンにアイテムボックスを追加する では Part 6 最後の仕上げとして、完成したアイテムボックスを「Level1」シーンに追加しよう。どこに配置するかはあなたの自由なので、適当な場所に配置してほしい。\nあくまでサンプルだが、以下のスクリーンショットのような感じで、マップ上に3つ配置した。\n最後にプロジェクトを実行して、「Level1」シーン全体を確認してみよう。なお以下のGIF画像は 2.5 倍速にしている。\n Part 6 で編集したスクリプトのコード 最後に今回の Part 6 で編集したスクリプトのコードを共有しておくので、必要に応じて確認してほしい。\n Item.gd の全コード extends Area2D # Added @ Part 6   export var point = 100 onready var sprite = $AnimatedSprite onready var label = $Label onready var anim_player = $AnimationPlayer   func _ready(): \tsprite.modulate = Color(1, 1, 1, 1) \tsprite.position = Vector2.ZERO \tsprite.scale = Vector2.ONE \tlabel.modulate = Color(1, 1, 1, 0) \tlabel.rect_position = Vector2(-32, -20) \tlabel.text = str(point)   func _on_Item_body_entered(body): \tif body.name == \"Player\": \tprint(\"Player hit Item\") \thit()   func hit(): \tprint(\"Got \", point, \" point.\") \tanim_player.play(\"hit\") \tyield(anim_player, \"animation_finished\") \tqueue_free()   ItemBox.gd の全コード extends StaticBody2D # Added @ Part 6  var timer_unused = true onready var sprite = $AnimatedSprite onready var timer = $Timer onready var parent = get_parent() onready var broken_box_tscn = preload(\"res://Items/BrokenBox.tscn\") onready var items = [ \tpreload(\"res://Items/Apple.tscn\"), \tpreload(\"res://Items/Bananas.tscn\"), \tpreload(\"res://Items/Cherries.tscn\"), \tpreload(\"res://Items/Kiwi.tscn\"), \tpreload(\"res://Items/Melon.tscn\"), \tpreload(\"res://Items/Orange.tscn\"), \tpreload(\"res://Items/Pineapple.tscn\"), \tpreload(\"res://Items/Strawberry.tscn\"), ]   func _ready(): \tsprite.play(\"idle\")   func _on_Timer_timeout(): \tprint(\"ItemBox  Timer timeout\") \tif not items.empty(): \titems.clear() \tprint(\"items size: \", items.size())   func _on_Area2D_body_entered(body): \tif body.name == \"Player\": \tprint(\"ItemBox  Area2D Player entered\") \t\tif timer_unused: \ttimer.start() \ttimer_unused = false \t\tsprite.play(\"hit\") \tyield(sprite, \"animation_finished\") \tsprite.play(\"idle\") \t\tif items.empty(): \tprint(\"ItemBox is empty.\") \tsprite.visible = false \tvar broken_box = broken_box_tscn.instance() \tparent.add_child(broken_box) \tbroken_box.position = position \tqueue_free() \tprint(self.name, \" removed.\") \telse: \tprint(\"ItemBox is not empty.\") \tvar item = items.pop_front().instance() \tadd_child(item) \titem.position.y -= 12 \titem.hit()   BrokenBox.gd の全コード extends Particles2D # Added @ Part 6   func _ready(): \temitting = true   func _process(delta): \tif not emitting: \tqueue_free() \tprint(\"BrokenBox removed.\")   \n (adsbygoogle = window.adsbygoogle || []).push({});   おわりに 以上で Part 6 は完了だ。今回はアイテムの雛形シーンを作り、それを継承して個々のアイテムシーンを作った。さらに、それらのアイテムが出てくるアイテムボックスを作り、アイテムボックスが壊れる時の演出をパーティクルシステムで実装した。ということで、今回もなかなかボリューミーな回になった。しかし、やった分だけゲームの楽しさは確実に増したはずだ。\n次回 Part 7 では、レベルクリア条件となるものを用意して、次のレベルへの遷移を実装する予定だ。それでは次回もお楽しみに。\n UPDATE:\n2022-02-25 「おわりに」の次回の内容を「HUD」から「次のレベルへの遷移」に変更\n",
  "wordCount" : "1334",
  "inLanguage": "ja",
  "image":"https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_6/img57.gif","datePublished": "2022-02-19T16:17:02+09:00",
  "dateModified": "2022-02-25T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Masanao Sako"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_6/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Peanuts Code",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.peanuts-code.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.peanuts-code.com/ja/" accesskey="h" title="Peanuts Code (Alt + H)">
                <img src="/images/logomark.png" alt="logo" aria-label="logo"
                    height="35">Peanuts Code</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://www.peanuts-code.com/en/" title="English"
                            aria-label="English">En</a>
                    </li>
                </ul>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.peanuts-code.com/ja/" title="ホーム">
                    <span>ホーム</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/posts/" title="ブログ">
                    <span>ブログ</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/tutorials/" title="チュートリアル">
                    <span>チュートリアル</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/tags/" title="タグ">
                    <span>タグ</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/about/" title="アバウト">
                    <span>アバウト</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://www.peanuts-code.com/ja/">Home</a>&nbsp;»&nbsp;<a href="https://www.peanuts-code.com/ja/tutorials/">Tutorials</a>&nbsp;»&nbsp;<a href="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/">シリーズ：Godot で作るプラットフォーマー</a></div>
    <h1 class="post-title">
      Godot で作るプラットフォーマー Part 6：アイテムを作ろう！
    </h1>
    <div class="post-meta">2022-02-19&nbsp;·&nbsp;7 分&nbsp;·&nbsp;Masanao Sako
</div>
  </header> 
<figure class="entry-cover"><img loading="lazy" src="https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_6/img57.gif" alt="プラットフォーマー Part 6 サムネイル">
        
</figure><div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目次</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#item-%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e3%82%8b" aria-label="Item シーンを作る">Item シーンを作る</a><ul>
                        
                <li>
                    <a href="#item-%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e6%88%90%e3%81%97%e3%81%a6%e3%83%8e%e3%83%bc%e3%83%89%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b" aria-label="Item シーンを作成してノードを追加する">Item シーンを作成してノードを追加する</a></li>
                <li>
                    <a href="#%e5%90%84%e3%83%8e%e3%83%bc%e3%83%89%e3%81%ae%e3%83%97%e3%83%ad%e3%83%91%e3%83%86%e3%82%a3%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b" aria-label="各ノードのプロパティを編集する">各ノードのプロパティを編集する</a><ul>
                        
                <li>
                    <a href="#animatedsprite-%e3%81%ae%e7%b7%a8%e9%9b%86" aria-label="AnimatedSprite の編集">AnimatedSprite の編集</a></li>
                <li>
                    <a href="#collisionshape2d-%e3%81%ae%e7%b7%a8%e9%9b%86" aria-label="CollisionShape2D の編集">CollisionShape2D の編集</a></li>
                <li>
                    <a href="#label-%e3%81%ae%e7%b7%a8%e9%9b%86" aria-label="Label の編集">Label の編集</a></li>
                <li>
                    <a href="#animationplayer-%e3%81%ae%e7%b7%a8%e9%9b%86" aria-label="AnimationPlayer の編集">AnimationPlayer の編集</a></li></ul>
                </li>
                <li>
                    <a href="#item-%e3%82%b7%e3%83%bc%e3%83%b3%e3%81%ab%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%82%92%e3%82%a2%e3%82%bf%e3%83%83%e3%83%81%e3%81%99%e3%82%8b" aria-label="Item シーンにスクリプトをアタッチする">Item シーンにスクリプトをアタッチする</a></li></ul>
                </li>
                <li>
                    <a href="#item-%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e7%b6%99%e6%89%bf%e3%81%97%e3%81%a6%e8%a4%87%e6%95%b0%e7%a8%ae%e9%a1%9e%e3%81%ae%e3%82%a2%e3%82%a4%e3%83%86%e3%83%a0%e3%81%ae%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e3%82%8b" aria-label="Item シーンを継承して複数種類のアイテムのシーンを作る">Item シーンを継承して複数種類のアイテムのシーンを作る</a></li>
                <li>
                    <a href="#level1-%e3%82%b7%e3%83%bc%e3%83%b3%e3%81%ab%e3%82%a2%e3%82%a4%e3%83%86%e3%83%a0%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b" aria-label="Level1 シーンにアイテムを追加する">Level1 シーンにアイテムを追加する</a></li>
                <li>
                    <a href="#itembox-%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e3%82%8b" aria-label="ItemBox シーンを作る">ItemBox シーンを作る</a><ul>
                        
                <li>
                    <a href="#itembox-%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e6%88%90%e3%81%97%e3%81%a6%e3%83%8e%e3%83%bc%e3%83%89%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b" aria-label="ItemBox シーンを作成してノードを追加する">ItemBox シーンを作成してノードを追加する</a></li>
                <li>
                    <a href="#%e5%90%84%e3%83%8e%e3%83%bc%e3%83%89%e3%81%ae%e3%83%97%e3%83%ad%e3%83%91%e3%83%86%e3%82%a3%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b-1" aria-label="各ノードのプロパティを編集する">各ノードのプロパティを編集する</a><ul>
                        
                <li>
                    <a href="#animatedsprite-%e3%81%ae%e7%b7%a8%e9%9b%86-1" aria-label="AnimatedSprite の編集">AnimatedSprite の編集</a></li>
                <li>
                    <a href="#%e3%83%ab%e3%83%bc%e3%83%88%e3%83%8e%e3%83%bc%e3%83%89%e7%9b%b4%e4%b8%8b%e3%81%ae-collisionshape2d-%e3%81%ae%e7%b7%a8%e9%9b%86" aria-label="ルートノード直下の CollisionShape2D の編集">ルートノード直下の CollisionShape2D の編集</a></li>
                <li>
                    <a href="#timer-%e3%81%ae%e7%b7%a8%e9%9b%86" aria-label="Timer の編集">Timer の編集</a></li>
                <li>
                    <a href="#area2d-%e7%9b%b4%e4%b8%8b%e3%81%ae-collisionshape2d-%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b" aria-label="Area2D 直下の CollisionShape2D を編集する">Area2D 直下の CollisionShape2D を編集する</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#brokenbox-%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e6%88%90%e3%81%99%e3%82%8b" aria-label="BrokenBox シーンを作成する">BrokenBox シーンを作成する</a><ul>
                        
                <li>
                    <a href="#brokenbox-%e3%83%ab%e3%83%bc%e3%83%88%e3%83%8e%e3%83%bc%e3%83%89%e3%81%ae%e3%83%97%e3%83%ad%e3%83%91%e3%83%86%e3%82%a3%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b" aria-label="BrokenBox ルートノードのプロパティを編集する">BrokenBox ルートノードのプロパティを編集する</a></li>
                <li>
                    <a href="#brokenbox-%e3%81%ab%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%82%92%e3%82%a2%e3%82%bf%e3%83%83%e3%83%81%e3%81%99%e3%82%8b" aria-label="BrokenBox にスクリプトをアタッチする">BrokenBox にスクリプトをアタッチする</a></li></ul>
                </li>
                <li>
                    <a href="#itembox-%e3%82%b7%e3%83%bc%e3%83%b3%e3%81%ab%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%82%92%e3%82%a2%e3%82%bf%e3%83%83%e3%83%81%e3%81%99%e3%82%8b" aria-label="ItemBox シーンにスクリプトをアタッチする">ItemBox シーンにスクリプトをアタッチする</a></li>
                <li>
                    <a href="#level1-%e3%82%b7%e3%83%bc%e3%83%b3%e3%81%ab%e3%82%a2%e3%82%a4%e3%83%86%e3%83%a0%e3%83%9c%e3%83%83%e3%82%af%e3%82%b9%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b" aria-label="Level1 シーンにアイテムボックスを追加する">Level1 シーンにアイテムボックスを追加する</a></li>
                <li>
                    <a href="#part-6-%e3%81%a7%e7%b7%a8%e9%9b%86%e3%81%97%e3%81%9f%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%81%ae%e3%82%b3%e3%83%bc%e3%83%89" aria-label="Part 6 で編集したスクリプトのコード">Part 6 で編集したスクリプトのコード</a></li>
                <li>
                    <a href="#%e3%81%8a%e3%82%8f%e3%82%8a%e3%81%ab" aria-label="おわりに">おわりに</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>第6回目の今回は、アイテムを作る。アイテムというのは、ちょうどスーパーマリオシリーズのコインのような、当たるとポイントを獲得できてちょっと嬉しい存在だ。さらに、下から小突くとアイテムが出てくる箱、その名もアイテムボックスを作る。それぞれスクリプトで動作を制御し、最後はレベルシーンに配置するところまでやっていこう。</p>
<blockquote>
<p><em><strong><span style="color:salmon">Memo：</span>
</strong><br>
過去のシリーズをまだご覧になっていない方は、そちらを先にご覧いただくことをおすすめします。<br>
<a href="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/" title="Godot で作るプラットフォーマー">Godot で作るプラットフォーマー</a>
</em></p>
</blockquote>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="item-シーンを作る">Item シーンを作る<a hidden class="anchor" aria-hidden="true" href="#item-シーンを作る">#</a></h1>
<h2 id="item-シーンを作成してノードを追加する">Item シーンを作成してノードを追加する<a hidden class="anchor" aria-hidden="true" href="#item-シーンを作成してノードを追加する">#</a></h2>
<p>敵キャラクターの作り方と同じく、アイテムについても、雛形となるシーンを作成して、それを継承する形で複数種類のアイテムのシーンを作っていく。</p>
<p>まずは雛形として「Item」シーンを作成しよう。</p>
<ol>
<li>「シーン」メニュー＞「新規シーン」を選択する</li>
<li>「ルートノードを生成」で「その他のノード」を選択する</li>
<li>「Area2D」クラスのノードを選択する</li>
<li>「Area2D」ルートノードの名前を「Item」に変更する</li>
<li>「Items」フォルダを作成して、パスを「res://Items/Item.tscn」としてシーンを保存する<br>
<br></li>
</ol>
<p>続いて、ルートノードに必要な子ノードを追加していく。</p>
<ol>
<li>「Item」ルートノードに「AnimatedSprite」ノードを追加する</li>
<li>「Item」ルートノードに「CollisionShape2D」ノードを追加する</li>
<li>「Item」ルートノードに「Label」ノードを追加する</li>
<li>「Item」ルートノードに「AnimationPlayer」ノードを追加する</li>
</ol>
<p><img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img1.png" alt="Itemシーンのシーンツリー"  />
</p>
<br>
<h2 id="各ノードのプロパティを編集する">各ノードのプロパティを編集する<a hidden class="anchor" aria-hidden="true" href="#各ノードのプロパティを編集する">#</a></h2>
<p>各ノードのプロパティをインスペクターで調整していく。<br>
<br></p>
<h3 id="animatedsprite-の編集">AnimatedSprite の編集<a hidden class="anchor" aria-hidden="true" href="#animatedsprite-の編集">#</a></h3>
<ol>
<li>
<p>「Frames」プロパティに「新規SpriteFrames」を割り当てる</p>
</li>
<li>
<p>スプライトフレームパネルを開き、以下の手順でアニメーションを作成する<br>
<br></p>
<ol>
<li>「default」アニメーションの名前を「idle」に変更する</li>
<li>「idle」アニメーションに、仮のアニメーションフレームとして「res://Assets/Items/Fruits/Apple.png」のスプライトシートを割り当てる（フレーム 0 ~ 16）</li>
<li>速度を 24 FPS にする</li>
<li>ループをオンにしておく<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img2.png" alt="AnimatedSpriteのidleアニメーション"  />
</li>
</ol>
 <br>
</li>
<li>
<p>インスペクターに戻って、「Animation」プロパティの値を「idle」にする</p>
</li>
<li>
<p>「Playing」プロパティをオンにする<br>
<br></p>
</li>
</ol>
<h3 id="collisionshape2d-の編集">CollisionShape2D の編集<a hidden class="anchor" aria-hidden="true" href="#collisionshape2d-の編集">#</a></h3>
<ol>
<li>「Shape」プロパティに「新規CapsuleShape2D」を割り当てる</li>
<li>2Dワークスペースでコリジョン形状をスプライトテクスチャに合わせて調整する
<ul>
<li>Radius: 8</li>
<li>Height: 0</li>
</ul>
</li>
</ol>
<p><img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img3.png" alt="CollisionShape2Dのコリジョン形状"  />
</p>
<br>
<h3 id="label-の編集">Label の編集<a hidden class="anchor" aria-hidden="true" href="#label-の編集">#</a></h3>
<ol>
<li>「Text」プロパティの値に、デフォルトのテキストとして「100」と入力する</li>
<li>「Align」プロパティを「Center」にする</li>
<li>「Valign」プロパティを「Center」にする</li>
<li>「Position」プロパティを（-32, -20）にする</li>
<li>「Size」プロパティを (64, 14) にする</li>
</ol>
<p><img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img4.png" alt="Labelノードの配置"  />
</p>
<br>
<h3 id="animationplayer-の編集">AnimationPlayer の編集<a hidden class="anchor" aria-hidden="true" href="#animationplayer-の編集">#</a></h3>
<p>「AnimationPlayer」は「AnimatedSprite」のようなスプライトテクスチャのアニメーション以外にも、他のあらゆるプロパティの値をアニメーションさせながら変化させることができる。</p>
<p>今回は、プレイヤーキャラクターがアイテムに当たった時に獲得ポイントを表示しながらアイテムが消えるアニメーションを新規作成する。以下の手順に沿って作ってみよう。</p>
<ol>
<li>アニメーションパネルを開いたら、パネル上部中央の「アニメーション」をクリックする<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img5.png" alt="アニメーションをクリック"  />
</li>
<li>「新規」を選択する<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img6.png" alt="新規を選択"  />
</li>
<li>アニメーションの名前を「hit」にする<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img7.png" alt="新規を選択"  />
</li>
<li>アニメーションの長さを「0.5」秒にする<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img8.png" alt="アニメーションの長さを0.5秒にする"  />
</li>
</ol>
<p>ここからは（アニメーションさせるプロパティの）トラックを追加し、トラック上にいくつかキーを挿入し、キーごとに値を設定して、トラック上の値の変化によりアニメーションさせていく。キーを挿入するまでの手順は2パターンあるので、お好みの方でやってみてほしい。</p>
<p><strong>● パターン 1 : アニメーションパネル上でトラックを追加してそこにキー挿入する方法</strong></p>
<ol>
<li>アニメーションパネルの左上「トラックを追加」をクリックし、トラックの種類から「プロパティトラック」を選択する。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img9.png" alt="トラックを追加＞プロパティトラック"  />
</li>
<li>どのノードのプロパティなのかを選択する。ここでは「AnimatedSprite」を選択する<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img10.png" alt="ノードを選択"  />
</li>
<li>どのプロパティのトラックを追加するのかを選択する。見つかりにくい時は上の検索ボックスを利用する。ここでは「modulate」プロパティを選択して開く<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img11.png" alt="プロパティを選択"  />
</li>
<li>アニメーションパネルに「AnimatedSprite」ノードの「modulate」プロパティのトラックが追加された。ここで上部タイムライン上の青い縦のバーを 0 秒の位置に持ってこよう。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img12.png" alt="タイムライン上の青いバー"  />
</li>
<li>この青いバーの位置にキーを挿入する。挿入するには「modulate」トラックの青いバーより少し横を右クリックし、「キーを挿入」メニューを選択しよう。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img13.png" alt="キーを挿入"  />
</li>
</ol>
<p><strong>● パターン 2 : インスペクター上の鍵アイコンをクリックし、トラックとキーを同時に挿入する</strong></p>
<ol>
<li>事前にアニメーションパネルのタイムラインでキーを挿入したいタイミング（ひとまず最初は一番左の 0 秒の位置）に青い縦のバーを合わせておく</li>
<li>シーンドックで「AnimatedSprite」を選択する<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img17.png" alt="AnimatedSpriteを選択"  />
</li>
<li>「AnimatedSprite」ノードを選択した場合、エディター下部で自動的にスプライトフレームパネルが開くが、アニメーションパネルに切り替える<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img18.png" alt="アニメーションパネルに切り替え"  />
</li>
<li>インスペクターで、今回アニメーションのトラックとして追加したい「Modulate」プロパティの右側にある鍵アイコンをクリックする<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img19.png" alt="Modulateプロパティのキーアイコン"  />
</li>
<li>新規トラックを作成してキーを挿入するかどうかの確認のダイアログが表示されるので「作成」をクリックする<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img20.png" alt="確認のダイアログ"  />
</li>
</ol>
<br>
<p>ここからの手順は共通。</p>
<ol>
<li>0.5秒の位置にも「modulate」トラックにキーを挿入しよう。</li>
<li>それぞれのキーの値を編集する。挿入したキーは四角いアイコンで表示されているので、それをクリックして選択する。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img14.png" alt="キーを選択"  />
</li>
<li>インスペクターで「AnimationTrackKeyEdit」の「Value」の値を編集する。
<ul>
<li>0 秒: (r, g, b, a) = (255, 255, 255, 0)</li>
<li>0.5秒: (r, g, b, a) = (255, 255, 255, 255)</li>
</ul>
</li>
</ol>
<p><img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img15.png" alt="キーの値を編集1"  />
</p>
<p><img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img16.png" alt="キーの値を編集2"  />
</p>
<p>ここまでの設定でアニメーションがどうなったのか見ていこう。アニメーションパネル左上にあるプレイバックアイコンを操作することで2Dワークスペース上で簡単に確認ができる。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img21.png" alt="プレイバックアイコン"  />
</p>
<p>GIF画像のリピート再生だとわかりにくいかもしれないが、「Modulate」プロパティの値の透明度を 255 から 0 に変化させることによって、フェードアウトするアニメーションになった。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img22.gif" alt="アニメーションの確認"  />
</p>
<br>
<p>同様にして、他にもいくつかのトラックを追加し、それぞれのトラックに対して、キーを挿入してアニメーションをより複雑にしていこう。</p>
<p>● AnimatedSprite ノードのトラック</p>
<ul>
<li>modulate プロパティ: アイテムの不透明度を MAX から 0 へ　*作成済み
<ul>
<li>Time: 0 秒 / Value: (255, 255, 255, 255)</li>
<li>Time: 0.5 秒 / Value: (255, 255, 255, 0)</li>
</ul>
</li>
<li>position プロパティ: アイテムの位置を上方向に 10 px 移動
<ul>
<li>Time: 0 秒 / Value: (0, 0)</li>
<li>Time: 0 秒 / Value: (0, -10)</li>
</ul>
</li>
<li>scale プロパティ: アイテムの大きさを横方向に 5 倍広げて縦方向は 0 に
<ul>
<li>Time:  / Value: (1, 1)</li>
<li>Time:  / Value: (5, 0)<br>
<br></li>
</ul>
</li>
</ul>
<p>● Label ノードのトラック</p>
<ul>
<li>modulate プロパティ: 獲得ポイントの不透明度を最初の 0.1 秒で Max（表示）、最後の 0.1 秒で 0（非表示）へ
<ul>
<li>Time: 0 秒 / Value: (255, 255, 255, 0)</li>
<li>Time: 0.1 秒 / Value: (255, 255, 255, 255)</li>
<li>Time: 0.4 秒 / Value: (255, 255, 255, 255)</li>
<li>Time: 0.5 秒 / Value: (255, 255, 255, 0)</li>
</ul>
</li>
<li>rect_position プロパティ: 獲得ポイント表示をアイテムのやや上からさらに 20 px 上へ移動
<ul>
<li>Time: 0 秒 / Value: (-32, -20)</li>
<li>Time: 0.5 秒 / Value: (-32, -40)</li>
</ul>
</li>
</ul>
<p>アニメーションパネルは以下のスクリーンショットのようになったはずだ。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img23.png" alt="プレイバックアイコン"  />
</p>
<p>では、2Dワークスペース上でアニメーションを確認してみよう。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img24.gif" alt="アニメーションの確認"  />
</p>
<p>だいたい意図した形になったので、アイテムのアニメーションは完成としよう。</p>
<br>
<h2 id="item-シーンにスクリプトをアタッチする">Item シーンにスクリプトをアタッチする<a hidden class="anchor" aria-hidden="true" href="#item-シーンにスクリプトをアタッチする">#</a></h2>
<p>それではアイテムシーンをスクリプトで制御していこう。</p>
<p>さっそく、シーンドックで「Item」ルートノードを選択したら、スクリプトをアタッチする。継承元を「Area2D」、ファイルパスを「res://Items/Item.gd」としてスクリプトを作成しよう。</p>
<p>スクリプトエディタが開いたら、いつも通り、まずはプロパティから定義していく。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Area2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">var</span> point <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span> <span style="color:#75715e"># アイテムに当たった時の獲得ポイント</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> sprite <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimatedSprite</span> <span style="color:#75715e"># AnimatedSprite ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> label <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Label</span> <span style="color:#75715e"># Label ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> anim_player <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimationPlayer</span> <span style="color:#75715e"># AnimationPlayer ノードの参照</span>
</span></span></code></pre></div><p>ここで<code>point</code>というプロパティをデフォルトの値を<code>100</code>として定義した。これはプレイヤーキャラクターがアイテムに当たった時に獲得できるポイントだ。<code>export</code>キーワード付きなので、継承後のシーンではインスペクターで気軽にポイントを変更できる。この値はアイテムの種類によって変える予定だ。取るのが難しいアイテムほど高得点にしたい。また、今後、スコア機能を実装する時にポイントがスコアに加算されるようにもしていく予定だ。また、この<code>point</code>プロパティを画面上に表示させるため、<code>_ready</code>メソッドで「Label」ノードの「Text」プロパティに<code>point</code>の値を適用するよう、このあと設定していく。</p>
<p>では<code>_ready</code>メソッドを定義していこう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	sprite<span style="color:#f92672">.</span>modulate <span style="color:#f92672">=</span> <span style="color:#a6e22e">Color</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	sprite<span style="color:#f92672">.</span>position <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO
</span></span><span style="display:flex;"><span>	sprite<span style="color:#f92672">.</span>scale <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ONE
</span></span><span style="display:flex;"><span>	label<span style="color:#f92672">.</span>modulate <span style="color:#f92672">=</span> <span style="color:#a6e22e">Color</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>	label<span style="color:#f92672">.</span>rect_position <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">32</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">20</span>)
</span></span><span style="display:flex;"><span>	label<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> str(point)
</span></span></code></pre></div><p>「AnimatedSprite」ノードの<code>modulate</code>、<code>position</code>、<code>scale</code>および「Label」ノードの<code>modulate</code>、<code>rect_position</code>は全て、さきほどアニメーションパネルで「hit」アニメーションに用いたプロパティだ。デバッグ作業をしていると、各プロパティがアニメーションを実行した後の値のままになってしまうので、最初に<code>_ready</code>メソッドで初期値を設定するようにした。</p>
<p>最後の「Label」ノードの<code>text</code>プロパティは、インスペクターで 100 と入力しておいた「Text」プロパティとイコールだ。上で定義した<code>point</code>プロパティの値は int 型なので<code>str</code>関数により string 型（文字列型）に変換して、<code>text</code>プロパティの値として設定している。</p>
<p>あとはプレイヤーキャラクターが当たったらアイテムが消える動きを作っていこう。</p>
<p>ここはまずシグナルを利用したいので、シーンドックに戻って「Item」ルートノードを選択し、ノードドック＞「シグナル」タブから「body_entered(body)」を接続しよう。接続先はもちろん「Item.gd」スクリプトだ。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img25.png" alt="body_enteredシグナルを接続"  />
</p>
<p>接続できたら<code>_on_Item_body_entered</code>メソッドが追加されたはずだ。このメソッドを以下のように編集する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Item_body_entered(body):
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># もし衝突した body の名前が Player だったら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> body<span style="color:#f92672">.</span>name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Player&#34;</span>:
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;Player hit Item&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># AnimationPlayer ノードの「hit」アニメーションを再生する</span>
</span></span><span style="display:flex;"><span>		anim_player<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;hit&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># 「hit」アニメーションが終了するまで待機</span>
</span></span><span style="display:flex;"><span>		yield(anim_player, <span style="color:#e6db74">&#34;animation_finished&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># この「Item」ノードを開放する（消す）</span>
</span></span><span style="display:flex;"><span>		queue_free()
</span></span></code></pre></div><p>ここで一旦テストとして「Item」シーンのインスタンスを「Level1」シーンに追加して、動作確認しておこう。確認できたら追加した「Item」ノードは不要なので削除すること。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img25.1.gif" alt="Itemシーンの動作確認"  />
</p>
<p>動作も概ね期待通りなので、雛形となる「Item.tscn」シーンはこれで完成としておこう。次はこの「Item.tscn」を継承して個々のアイテムのシーンを作っていく。</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="item-シーンを継承して複数種類のアイテムのシーンを作る">Item シーンを継承して複数種類のアイテムのシーンを作る<a hidden class="anchor" aria-hidden="true" href="#item-シーンを継承して複数種類のアイテムのシーンを作る">#</a></h1>
<p>では次に「Item.tscn」シーンを継承して、個々のアイテムを作っていく。作業は基本的にスプライトシートを差し替えて、獲得ポイントを変更するだけだ。</p>
<p>作成する個々のアイテムの種類と獲得ポイントは以下のように設定する（完全に適当なので、アイテムの種類数や割り当てるポイントの大きさはご自由にしていただいて構わない）。</p>
<ul>
<li>Apple: 100</li>
<li>Bananas: 300</li>
<li>Cherries: 500</li>
<li>Kiwi: 700</li>
<li>Melon: 1000</li>
<li>Orange: 1200</li>
<li>Pineapple: 1500</li>
<li>Strawberry: 2000</li>
</ul>
<p>上述の個々のアイテムのシーンを以下の手順で一つずつ順番に作成していこう。</p>
<ol>
<li>「シーン」メニュー＞「新しい継承シーン」を選択する。</li>
<li>継承元に「res://Items/Item.tscn」を選択する。</li>
<li>ルートノードの名前を「Item」から「Bananas」など個々のアイテムの名前に変更する</li>
<li>ファイルパスを「res://Items/Bananas.tscn」などとして、シーン保存する</li>
<li>ルートノードを選択し、インスペクターから「Point」プロパティの値を 300 など各アイテムに割り当てる予定のポイントに変更する（ Apple の場合は変更なし）<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img26.png" alt="Script VariablesのPoint"  />
</li>
<li>「AnimatedSprite」ノードの「Frames」プロパティの値「SpriteFrames」の右横の <strong>⌵</strong> をクリックし、「ユニーク化」を選択する　<strong><span style="color:salmon">*お忘れなきよう！</span>
</strong></li>
<li>スプライトフレームパネルを開き、「idle」アニメーションのアニメーションフレームを全て削除して、新たに「res://Assets/Items/Fruits/Bananas.png」など各アイテムのスプライトシートを割り当てる（ Apple の場合は変更なし）<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img27.png" alt="AnimatedSpriteのアニメーションフレームを差し替え"  />
</li>
</ol>
<p>必要な数だけ個々のアイテムのシーンを作成していただけただろうか。次は「Level1」シーンに作成したアイテムのインスタンスノードを追加して、マップに配置していこう。</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="level1-シーンにアイテムを追加する">Level1 シーンにアイテムを追加する<a hidden class="anchor" aria-hidden="true" href="#level1-シーンにアイテムを追加する">#</a></h1>
<p>シーンドックで「Level1」シーンを開こう。そして、作成した個々のアイテムシーンをインスタンス化して、「Level1」ルートノードの子ノードとして追加しよう。</p>
<p>ここではサンプルとして合計8種類のフルーツアイテムを一つずつ追加した。確認しやすくするため、一時的に敵キャラクターのノードは全て非表示にした。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img28.png" alt="Level1シーンにアイテムシーン追加"  />
</p>
<p>シーンドックで各アイテムを追加したら（もしくはしながら）、2Dワークスペース上で、タイルマップのどの位置にアイテムを置いたら面白いかを検討しつつ、一つずつ配置していこう。サンプルの配置場所は以下のとおりだ。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img29.png" alt="2Dワークスペースでアイテムノードを配置"  />
</p>
<p>ではプロジェクトを実行して、プレイヤーキャラクターがアイテムに当たった時の挙動を確認しつつ、実際のプレイ画面上でも念のためにアイテムの配置を確認しておこう。なお、以下のGIF画像は 2 倍速にしている。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img30.gif" alt="2Dワークスペースでアイテムノードを配置"  />
</p>
<p>各アイテムの「AnimatedSprite」の「idle」アニメーションがループ再生されており、プレイヤーキャラクターがアイテムに当たったら「AnimationPlayer」のアニメーションを実行してオブジェクトが削除された。概ね問題ないだろう。</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="itembox-シーンを作る">ItemBox シーンを作る<a hidden class="anchor" aria-hidden="true" href="#itembox-シーンを作る">#</a></h1>
<p>次は下から小突くとフルーツアイテムが順番に出てくるアイテムボックスを作ってみよう。スーパーマリオシリーズの下から小突くとコインが繰り返し出てくるブロックのようなイメージだ。アイテムボックスの仕様は以下のようにする。</p>
<ol>
<li>衝突判定があり、プレイヤーキャラクターや敵キャラクターはボックスを透過しない</li>
<li>下からプレイヤーキャラクターが衝突した時しかアイテムは出ない</li>
<li>最初に下から衝突してから 4 秒経過すると、アイテムボックスは空っぽになる</li>
<li>最後の一つのアイテムが出ると、アイテムボックスは壊れて無くなる。</li>
</ol>
<br>
<h2 id="itembox-シーンを作成してノードを追加する">ItemBox シーンを作成してノードを追加する<a hidden class="anchor" aria-hidden="true" href="#itembox-シーンを作成してノードを追加する">#</a></h2>
<p>では以下の手順でシーンを作ろう。</p>
<ol>
<li>「シーン」メニュー＞「新規シーン」を選択</li>
<li>「ルートノードを生成」で「その他のノード」を選択する</li>
<li>「StaticBody2D」クラスをルートノードに設定する</li>
<li>ルートノードの名前を「ItemBox」に変更する</li>
<li>ファイルパスを「res://Items/ItemBox.tscn」として保存する</li>
</ol>
<p>なお、自ら動くことのない物理ボディには「StaticBody2D」が最適だ。</p>
<br>
続いて、上述の仕様を満たすために必要なノードを追加していく。
<ol>
<li>「ItemBox」ルートノードに「AnimatedSprite」ノードを追加する</li>
<li>「ItemBOx」ルートノードに「CollisionShape2D」ノードを追加する</li>
<li>「ItemBox」ルートノードに「Timer」ノードを追加する</li>
<li>「ItemBox」ルートノードに「Area2D」ノードを追加する</li>
<li>「Area2D」ノードに「CollisionShape2D」を追加する</li>
</ol>
<br>
シーンドックは以下のようになっただろうか。
<p><img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img31.png" alt="ItemBoxのシーンドック"  />
</p>
<p>次はインスペクターでそれぞれのノードのプロパティを編集していく。</p>
<br>
<h2 id="各ノードのプロパティを編集する-1">各ノードのプロパティを編集する<a hidden class="anchor" aria-hidden="true" href="#各ノードのプロパティを編集する-1">#</a></h2>
<h3 id="animatedsprite-の編集-1">AnimatedSprite の編集<a hidden class="anchor" aria-hidden="true" href="#animatedsprite-の編集-1">#</a></h3>
<p>アセットにアニメーション用のスプライトシートが用意してあるので、それらを利用してアニメーションを設定する。</p>
<ol>
<li>
<p>インスペクターで「Frames」プロパティに「新規SpriteFrames」を割り当てる</p>
</li>
<li>
<p>スプライトフレームパネルを開き、以下の2つのアニメーションを作成する</p>
<ul>
<li>アニメーション名: hit
<ul>
<li>スプライトシート: res://Assets/Items/Boxes/Box2/Hit (28x24).png</li>
<li>速度: 24 FPS</li>
<li>ループ: オフ</li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img32.png" alt="hitアニメーション"  />
</p>
<ul>
<li>アニメーション名: idle
<ul>
<li>スプライトシート: res://Assets/Items/Boxes/Box2/Idle.png</li>
<li>速度: 24 FPS</li>
<li>ループ: オン</li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img33.png" alt="idleアニメーション"  />
</p>
</li>
<li>
<p>インスペクターに戻り「Animation」プロパティを「idle」に設定する</p>
</li>
</ol>
<br>
<h3 id="ルートノード直下の-collisionshape2d-の編集">ルートノード直下の CollisionShape2D の編集<a hidden class="anchor" aria-hidden="true" href="#ルートノード直下の-collisionshape2d-の編集">#</a></h3>
<p>プレイヤー / 敵キャラクターとの衝突を検知するようにコリジョン形状を調整していく。</p>
<ol>
<li>インスペクターで「Shape」プロパティに「新規RectangleShape2D」を割り当てる</li>
<li>2Dワークスペースでコリジョン形状を編集し、「idle」アニメーションのスプライトテクスチャの一番下を 1 px だけ空けて、他はスプライトテクスチャにピッタリ合わせる<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img34.png" alt="コリジョン形状の編集"  />
</li>
<li>インスペクター関連プロパティが以下のようになっているか確認する</li>
</ol>
<ul>
<li>Extents: (10, 9.5)</li>
<li>Position: (0, -0.5)</li>
</ul>
<br>
<h3 id="timer-の編集">Timer の編集<a hidden class="anchor" aria-hidden="true" href="#timer-の編集">#</a></h3>
<p>最初にアイテムボックスを下から小突いてから 4 秒経過後にアイテムボックスを空っぽにするにはタイマーの設定が必要だ。「Timer」ノードを以下のように設定しよう。</p>
<ol>
<li>「Wait Time」プロパティの値を <strong>4</strong> にする</li>
<li>「One Shot」プロパティを <strong>オン</strong> にする</li>
</ol>
<br>
<h3 id="area2d-直下の-collisionshape2d-を編集する">Area2D 直下の CollisionShape2D を編集する<a hidden class="anchor" aria-hidden="true" href="#area2d-直下の-collisionshape2d-を編集する">#</a></h3>
<p>下からプレイヤーキャラクターが衝突した時しかアイテムが出ないように、ボックスの下部にだけ、本体とは別のコリジョン形状を設定する。</p>
<ol>
<li>インスペクターで「Shape」プロパティに「新規RectangleShape2D」を割り当てる</li>
<li>2Dワークスペースでコリジョン形状を編集し、「idle」アニメーションのスプライトテクスチャの一番下から高さ 1 px の範囲に合わせる<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img35.png" alt="コリジョン形状の編集"  />
</li>
</ol>
<p>ここまでで各ノードのプロパティ編集はひとまず完了だ。「ItemBox」ルートノードにスクリプトをアタッチしたいところだが、その前にもう一つ別のオマケのシーンを作成する。</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="brokenbox-シーンを作成する">BrokenBox シーンを作成する<a hidden class="anchor" aria-hidden="true" href="#brokenbox-シーンを作成する">#</a></h1>
<p>アイテムボックスからアイテムが出尽くした時に箱が壊れる演出を入れたい。アイテムボックスが壊れる時に、BrokenBox シーンを ItemBox と同じ場所に配置したら、ItemBox は消しつつ BrokenBox シーンによって木片が飛び散るようにする。このような細かい複数の物体や流体を表現するにはパーティクルシステムを利用する。パーティクルとは小片とか粒という意味だ。</p>
<p>では手早く以下の手順で BrokenBox シーンを作成しよう。</p>
<ol>
<li>「シーン」メニュー＞「新規シーン」を選択</li>
<li>「ルートノードを生成」で「その他のノード」を選択</li>
<li>「Particles2D」クラスのノードを選択</li>
<li>「Particles2D」ノードの名前を「BrokenBox」に変更する</li>
<li>ファイルパスを「res://Items/BrokenBox.tscn」としてシーンを保存する</li>
</ol>
<p><img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img35.0.1.png" alt=""  />
</p>
<br>
<h2 id="brokenbox-ルートノードのプロパティを編集する">BrokenBox ルートノードのプロパティを編集する<a hidden class="anchor" aria-hidden="true" href="#brokenbox-ルートノードのプロパティを編集する">#</a></h2>
<p>ルートノードに設定した「Particles2D」ノードだが、このプラットフォーマーのチュートリアルでは初登場だ。「Paarticle2D」は2Dゲームで、例えば炎や雨、雪、煙、血飛沫など、細かな粒子の動きを表現するのによく利用される。なお、「Particles2D」クラスのノードについては、Godot の公式オンラインドキュメントも説明が比較的わかりやすいので、参考にしていただくのが良いだろう。</p>
<blockquote>
<p><em><strong><span style="color:salmon">公式オンラインドキュメント</span>
</strong><br>
<a href="https://docs.godotengine.org/ja/stable/tutorials/2d/particle_systems_2d.html" target="_blank">パーティクル・システム(2D)</a>
</em></p>
</blockquote>
<p>「Particles2D」ノードにはプロパティの項目がたくさんある。最初は思い通りの動きにするのにやや骨が折れるが、慣れてしまえば本当に多くの表現に利用できる。インスペクターで必要なプロパティを上から順番に編集していこう。</p>
<p>インスペクターで<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img35.1.png" alt=""  />
が値の左横にあるプロパティは、初期値から変更を加えているので目印にしてほしい。</p>
<ul>
<li>Emitting: オフ<br>
パーティクルを実行するかどうか。下の「One Shot」がオンなので、一度実行されたらオフになる。ボックスが破壊されたタイミングでスクリプトによってオンにする予定だ。</li>
<li>Amount: 16<br>
パーティクルの数。今回は16個</li>
</ul>
<p><strong>Time セクション:</strong></p>
<ul>
<li>Lifetime: 4<br>
パーティクルが存在する時間（秒）。今回は 4 秒後に消える設定。</li>
<li>One Shot: オン<br>
一回限りの実行かどうか。今回はボックスが壊れたらボックスは消えるのでオンにしておく。</li>
<li>Speed Scale<br>
パーティクルシステム実行時の速度</li>
<li>Explosiveness: 0.8<br>
1 に近づくほど、次回の実行までの時間が長くなる。したがって 1 はすべてのパーティクルが同時に表示される。今回は同時まではいかないが、同時にやや近い 0.8 に設定。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img36.png" alt=""  />
</li>
</ul>
<br>
<p><strong>Process Material セクション:</strong></p>
<ul>
<li>
<p>Material: 新規ParticlesMaterial<br>
パーティクルを処理するための素材。セットした「ParticlesMaterial」のプロパティを設定していくので、インスペクターで「ParticlesMaterial」をクリックする。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img36.1.png" alt=""  />
<br>
<strong>ParticlesMaterial のプロパティ:</strong></p>
<ul>
<li>
<p>Emission Shape セクション</p>
<ul>
<li>Shape: Box<br>
デフォルトの Point だと全てのパーティクルの開始位置が点になるが、Boxだと、四角い範囲内からの開始になる。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img37.png" alt=""  />
</li>
</ul>
</li>
<li>
<p>Flags セクション</p>
<ul>
<li>Disable Z: オン<br>
2Dゲームなので、Z軸方向の位置は無効にする。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img37.1.png" alt=""  />
</li>
</ul>
</li>
<li>
<p>Direction セクション</p>
<ul>
<li>Direction: (0, -1, 0)<br>
パーティクルの移動する方向、真っ直ぐ上方向にするため y の値を -1 とした。</li>
<li>Spread: 30<br>
パーティクルが広がる角度の設定。デフォルトは 45° だが、箱の破片があまり広く飛び散ってほしくないので、少し狭めの 30° にした。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img38.png" alt=""  />
</li>
</ul>
</li>
<li>
<p>Gravity セクション</p>
<ul>
<li>Gravity: (0, 10, 0)<br>
重力の設定。真っ直ぐ下方向に重力をかけるため y の値を 10 とした。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img39.png" alt=""  />
</li>
</ul>
</li>
<li>
<p>Initial Velocity セクション</p>
<ul>
<li>Velocity: 20<br>
パーティクルの速度の設定。下から小突いて壊れた時に飛び散る破片として違和感ない 20 とした。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img40.png" alt=""  />
</li>
</ul>
</li>
<li>
<p>Angular Velocity セクション</p>
<ul>
<li>Velocity: 15<br>
パーティクルの 1 秒あたりの回転角度の設定。少しだけ回転するように 15° とした。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img41.png" alt=""  />
</li>
</ul>
</li>
<li>
<p>Scale セクション</p>
<ul>
<li>Scale: 0.5<br>
箱の破片の大きさを実際のテクスチャの半分にして、細かな破片になるようにした。</li>
<li>Scale Random: 1<br>
0.5 ~ 1 の Scalse の間で完全にランダムになるよう値を 1 とした（1 は 100%）。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img43.png" alt=""  />
</li>
</ul>
</li>
<li>
<p>Animation セクション</p>
<ul>
<li>Offset: 1<br>
パーティクルのアニメーションのオフセット設定。アニメーションの開始フレームをずらすことができる。しかし今回は「Animation」セクションの「Speed」プロパティを 0 にしているため、そのままだとアニメーションはせず、全てのパーティクルがスプライトシートの 1 フレーム目のテクスチャになってしまう。それを回避するためにまずはこのプロパティの値を 1 とした。これにより、アニメーションの開始位置をスプライトシートの最後のフレームにずらすことができる。しかしこのままでは、全てのパーティクルがスプライトシートの最後のフレームのテクスチャになってしまうだけだ。そこで次の「Offset Random」を設定する。</li>
<li>Offset Random: 1<br>
アニメーションのオフセットのランダム率を 1（つまり 100%）とした。これにより、例えば 4 フレームのスプライトシートによるアニメーションなら、1 ~ 4 フレームのうちいずれかのテクスチャがアニメーションの開始位置として適用される。今回「Speed」プロパティが 0 なので、アニメーションせず、各パーティクルのテクスチャはランダムで決定され、かつ生成されてから消失するまで同じテクスチャが維持される。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img44.png" alt=""  />
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Textures セクション:</strong><br>
ファイルシステムドックから「res://Assets/Items/Boxes/Box2/Break.png」のスプライトテクスチャファイルをドラッグ&amp;ドロップで適用する。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img45.png" alt=""  />
</p>
</li>
<li>
<p><strong>Material セクション:</strong></p>
<ul>
<li>Material: 新規CanvasItemMaterial を適用</li>
<li>Particle Animation: オン</li>
<li>Particle Animation H Frames: 4</li>
<li>Particle Animation V Frames: 1</li>
<li>Particle Anim Loop: オフ<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img46.png" alt=""  />
</li>
</ul>
</li>
</ul>
<p>これでインスペクターでのプロパティの編集は完了だ。「Particles2D」クラスは「ParticlesMaterial」も含めて、プロパティが非常に多く、最初は難しく感じるだろう。どのプロパティが何に影響するのかは、いろいろ触っているうちにわかってくるところがある。このチュートリアルに限らず、是非あなた自身の手でパーティクルシステムにより様々な表現ができることを試してみて欲しい。</p>
<br>
<h2 id="brokenbox-にスクリプトをアタッチする">BrokenBox にスクリプトをアタッチする<a hidden class="anchor" aria-hidden="true" href="#brokenbox-にスクリプトをアタッチする">#</a></h2>
<p>「BrokenBox」ルートノードに新規でスクリプトをアタッチしよう。ファイルパスを「res://Items/BrokenBox.gd」として作成しよう。</p>
<p>このスクリプトでやりたいことはシンプルに以下の2つだけだ。</p>
<ul>
<li>シーンツリーに追加されたらまず「Emitting」プロパティをオンにしてパーティクルシステムを最初から自動的に実行する</li>
<li>パーティクルシステムが終了して「Emitting」プロパティがオフになったらこの「BrokenBox」ノードを解放（削除）する</li>
</ul>
<p>ということで、上記の2つを制御するための具体的なスクリプトは以下の通りだ。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Particles2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># シーンツリーに追加されたらパーティクルシステムを実行</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	emitting <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># パーティクルシステムが終了したら BrokenBox ノードを解放</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _process(delta):
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> emitting:
</span></span><span style="display:flex;"><span>		queue_free()
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># デバッグ用</span>
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;BrokenBox removed.&#34;</span>)
</span></span></code></pre></div><br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="itembox-シーンにスクリプトをアタッチする">ItemBox シーンにスクリプトをアタッチする<a hidden class="anchor" aria-hidden="true" href="#itembox-シーンにスクリプトをアタッチする">#</a></h1>
<p>当初予定していた仕様を満たすため、「ItemBox.gd」スクリプトに戻って、コードでアイテムボックスを制御していく。</p>
<p>まずは「ItemBox」ルートノードを選択して、新規でスクリプトをアタッチする。スクリプトのファイルパスは「res://Items/ItemBox.gd」として作成しよう。</p>
<p>「ItemBox.gd」スクリプトを開いたらさっそく編集していこう。まずはプロパティの定義からしていく。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">StaticBody2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Timer ノードのタイマーを利用したことがなければ true</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> timer_unused <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span><span style="color:#75715e"># AnimatedSprite ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> sprite <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimatedSprite</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Timer ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> timer <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Timer</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 親ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> parent <span style="color:#f92672">=</span> get_parent()
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 事前に読み込んだ BrokenBox シーンファイル</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> broken_box_tscn <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://Items/BrokenBox.tscn&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 事前に読み込んだ個々のアイテムのシーンファイルを配列（Array）に格納</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> items <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Items/Apple.tscn&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Items/Bananas.tscn&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Items/Cherries.tscn&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Items/Kiwi.tscn&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Items/Melon.tscn&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Items/Orange.tscn&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Items/Pineapple.tscn&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Items/Strawberry.tscn&#34;</span>),
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>今回、アイテムボックスの仕様を満たすには、「Timer」ノードのタイマーが発動済みか未使用かの区別が必要になる。そのステータス管理用のプロパティが<code>timer_unused</code>だ。</p>
<p><code>onready</code>キーワード付きの<code>items</code>（~s と複数形になっていることに注意）プロパティは、このシリーズのチュートリアルでは初登場の <strong>配列（Array）</strong> 型の値をとる。配列というのは、複数のオブジェクトを格納することができるデータ型だ。今回は、事前に読み込んだ個々のアイテムのシーンファイル .tscn を格納している。つまり、アイテムボックスから出現するアイテムの元となるシーンファイルをこの配列の要素にしている。要素の順番も重要だ。配列の前からポイントの低いアイテムの順番になっている。前から順に要素を取り出すようにすれば、ポイントの低いアイテムから順番に出現させることができる。</p>
<p>配列（Array）は非常に便利なので、今後もできるだけ慣れ親しんでいきたいところだ。お時間があれば、ぜひ公式オンラインドキュメントもご参照いただきたい。</p>
<blockquote>
<p><em><strong><span style="color:salmon">公式オンラインドキュメント</span>
</strong><br>
<a href="https://docs.godotengine.org/ja/stable/classes/class_array.html" target="_blank">Array</a>
</em></p>
</blockquote>
<br>
<p><code>_ready</code>メソッドでゲーム開始前に必要な準備をコーディングしよう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># AnimatedSprite ノードが idle アニメーションを再生</span>
</span></span><span style="display:flex;"><span>	sprite<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;idle&#34;</span>)
</span></span></code></pre></div><br>
<p>ここで「Timer」ノードの「timeout()」シグナルをこのスクリプトに接続しておく。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img47.png" alt=""  />
</p>
<p>ちなみに、先にインスペクターで「Timer」ノードの「Wait Time」プロパティを 4 秒に設定したので、タイマーがスタートしてから 4 秒でこのシグナルが発信される。</p>
<p>シグナルを接続したら、以下の<code>_on_Timer_timeout</code>メソッドが追加されたはずだ。メソッド内を編集していく。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Timer_timeout():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># デバッグ用</span>
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#34;Item box timer time out&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 配列 items が空っぽでなければ</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> items<span style="color:#f92672">.</span>empty():
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># 配列 items から全ての要素を消去</span>
</span></span><span style="display:flex;"><span>		items<span style="color:#f92672">.</span>clear()
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># デバッグ：配列 items の要素数を確認</span>
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;items size: &#34;</span>, items<span style="color:#f92672">.</span>size())
</span></span></code></pre></div><p>配列クラスには色々便利なメソッドが用意されているが、ここではひとまず、今回利用したメソッドに関してのみ説明しておこう。</p>
<p><code>if</code>構文で利用している<code>empty</code>メソッドでは、配列<code>items</code>が空っぽかどうかを確認できる。空っぽだったら<code>true</code>、空っぽでなければ<code>false</code>を返す。</p>
<p><code>if</code>ブロック内で実行している<code>clear</code>メソッドは、配列内の要素を全て消去する。制限時間 4 秒が経過したらアイテムボックスは空っぽになる、というイメージだ。</p>
<p>デバッグ用の<code>print</code>関数内で使用されている<code>size</code>メソッドは、配列の要素数を返す。</p>
<br>
<p>次に「Area2D」ノードの「body_entered(body)」シグナルをこのスクリプトに接続する。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img48.png" alt=""  />
</p>
<p>接続したらスクリプトに<code>_on_Area2D_body_entered</code>メソッドが追加されたはずだ。ところで「Area2D」ノードのコリジョン形状はアイテムボックスの下部 1 px の部分にだけ配置したことは覚えているだろうか。そこにプレイヤーキャラクターが衝突した時に実行すべきコードをこの<code>_on_Area2D_body_entered</code>メソッド内に記述していくというわけだ。</p>
<p>具体的にコードは以下のようになった。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Area2D_body_entered(body):
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 衝突した body が Player という名前のノードだったら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> body<span style="color:#f92672">.</span>name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Player&#34;</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># timer_unused プロパティが true だったら</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> timer_unused:
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># Timer ノードのタイマーをスタートする</span>
</span></span><span style="display:flex;"><span>			timer<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># timer_unused を false にする</span>
</span></span><span style="display:flex;"><span>			timer_unused <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># AnimatedSprite の play メソッドで hit アニメーションを再生</span>
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;hit&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># AnimatedSprite のアニメーションが終了するまで待機</span>
</span></span><span style="display:flex;"><span>		yield(sprite, <span style="color:#e6db74">&#34;animation_finished&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># AnimatedSprite の Play メソッドで idle アニメーションに戻して再生</span>
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;idle&#34;</span>)
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># もし配列 items が空っぽだったら</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> items<span style="color:#f92672">.</span>empty():
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># デバッグ用</span>
</span></span><span style="display:flex;"><span>			print(<span style="color:#e6db74">&#34;Item box is empty.&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># AnimatedSpriteノードを非表示にしてアイテムボックスを画面から消す</span>
</span></span><span style="display:flex;"><span>			sprite<span style="color:#f92672">.</span>visible <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># BrokenBox シーンのインスタンスを変数に代入</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">var</span> broken_box <span style="color:#f92672">=</span> broken_box_tscn<span style="color:#f92672">.</span>instance()
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># 親ノードの子ノード（ItemBox と同じ階層）として BrokenBox インスタンスを追加</span>
</span></span><span style="display:flex;"><span>			parent<span style="color:#f92672">.</span>add_child(broken_box)
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># BrokenBox の位置を ItemBOx の位置と同じにする</span>
</span></span><span style="display:flex;"><span>			broken_box<span style="color:#f92672">.</span>position <span style="color:#f92672">=</span> position
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># ItemBox を解放（削除）する</span>
</span></span><span style="display:flex;"><span>			queue_free()
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># デバッグ用</span>
</span></span><span style="display:flex;"><span>			print(self<span style="color:#f92672">.</span>name, <span style="color:#e6db74">&#34; removed.&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># 配列 items が空っぽではなかったら</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># デバッグ用</span>
</span></span><span style="display:flex;"><span>			print(<span style="color:#e6db74">&#34;Item box is not empty.&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># 変数 item を定義 &gt; 配列 items の最初の要素を取り出してインスタンス化</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">var</span> item <span style="color:#f92672">=</span> items<span style="color:#f92672">.</span>pop_front()<span style="color:#f92672">.</span>instance()
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># インスタンス化したアイテムのシーンを ItemBox の子ノードにする</span>
</span></span><span style="display:flex;"><span>			add_child(item)
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># アイテムのインスタンスノードの position の y の値を -12 する（箱より少し上にアイテムを出現させる）</span>
</span></span><span style="display:flex;"><span>			item<span style="color:#f92672">.</span>position<span style="color:#f92672">.</span>y <span style="color:#f92672">-=</span> <span style="color:#ae81ff">12</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># アイテムのインスタンスノードの hit メソッドを実行</span>
</span></span><span style="display:flex;"><span>			item<span style="color:#f92672">.</span>hit()
</span></span></code></pre></div><p>少し補足説明しておく。</p>
<p><code>if timer_unused:</code>の構文で、<code>timer_unused</code>プロパティが<code>true</code>の場合（つまりタイマーが使われた事がない）だけ、タイマーをスタートさせている。その直後にこの<code>timer_unused</code>を<code>false</code>（タイマーが使われた事がある）に変更するので、初めてアイテムボックスを下から小突いた時にしかタイマーは開始しない仕組みになっている。</p>
<p>次に「AnimatedSprite」の「hit」アニメーションを再生させている。</p>
<p>さらにそのあとは<code>if / else</code>構文で条件分岐する。</p>
<p>ここでもまた配列<code>items</code>の<code>empty</code>メソッドを利用している。<code>if</code>と<code>else</code>の条件が逆の方がわかりやすいかもしれないが、今回は<code>if</code>構文に<code>not</code>を入れなくて済むようにした。</p>
<p><code>if items.empty():</code>の条件である『配列<code>items</code>が空っぽの場合』を満たしたらブロックの中に進む。これはつまりアイテムボックスからアイテムが出尽くした場合だ。その場合、以下のような順番で処理が進む。</p>
<ol>
<li>先に「AnimatedSprite」ノードを非表示にして、画面からアイテムボックスを消す。</li>
<li>「BrokenBox」シーンをインスタンス化する</li>
<li>「BrokenBox」のインスタンスを、<strong>親ノード</strong> に追加する（この時点でパーティクルシステムが実行される）</li>
<li>「BrokenBox」ノードの位置を「ItemBox」ノードの位置と同じにする</li>
<li>「ItemBox」ノードは解放（削除）する（解放しても「BrokenBox」は親ノードに紐づいているためパーティクル実行中でも影響されない）</li>
</ol>
<p>順番が逆でややこしいかもしれないが、<code>else:</code>の条件は『配列<code>items</code>が空っぽでなければ』となる。アイテムボックスにまだアイテムが入っている場合だ。この場合は以下の順序でコードが実行される。</p>
<ol>
<li><code>pop_front</code>メソッドにより、配列<code>items</code>の先頭の要素（アイテムのシーン）を取り出して、それをインスタンス化する（この時取り出した要素は<code>items</code>内からは削除される）</li>
<li>取り出したシーンのインスタンスを「ItemBox」自身の子ノードとして追加する</li>
<li>子にしたアイテムのノードの位置を、「ItemsBox」自身の位置より y 軸上で <code>-12</code>ずらした位置に設定する</li>
<li>アイテムのノードの<code>hit</code>メソッドを実行する</li>
</ol>
<br>
<p>これで「ItemBox.gd」スクリプトのコーディングは完成だ。</p>
<p>「Level1」シーンにインスタンスを追加して、アイテムボックスが正しく動作するか確認しておこう。</p>
<p><img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img50.png" alt=""  />
</p>
<p>プロジェクトを実行して当初想定していた以下の仕様を満たしているか確認してみよう。</p>
<ol>
<li>衝突判定があり、プレイヤーキャラクターや敵キャラクターはボックスを透過しない</li>
<li>下からプレイヤーキャラクターが衝突した時しかアイテムは出ない</li>
<li>最初に下から衝突してから 4 秒経過すると、アイテムボックスは空っぽになる</li>
<li>最後の一つのアイテムが出ると、アイテムボックスは壊れて無くなる。</li>
</ol>
<p><img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img51.gif" alt=""  />
</p>
<p>概ね問題ないが、アイテムボックスからアイテム（フルーツ）が出てきてすぐにぺちゃんこに変形してしまうので、何が出てきたのかわかりにくい。そこで「Item.tscn」シーンを開き、「AnimationPlayer」の「hit」アニメーションを編集しよう。</p>
<p><img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img52.png" alt=""  />
</p>
<p>「AnimatedSprite」&gt;「modulate」トラック：0 秒の位置にあるキーの「Easing」プロパティを 1 から <strong>3</strong> に変更<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img53.png" alt=""  />
<br>
「AnimatedSprite」&gt;「scale」トラック：0 秒の位置にあるキーの「Easing」プロパティを 1 から <strong>4</strong> に変更<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img54.png" alt=""  />
</p>
<p>もう一度確認だ。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img55.gif" alt=""  />
</p>
<p>さっきよりはフルーツの形状がわかりやすくなっただろう。これでアイテムボックスは完成としよう。</p>
<br>
<hr>
<h1 id="level1-シーンにアイテムボックスを追加する">Level1 シーンにアイテムボックスを追加する<a hidden class="anchor" aria-hidden="true" href="#level1-シーンにアイテムボックスを追加する">#</a></h1>
<p>では Part 6 最後の仕上げとして、完成したアイテムボックスを「Level1」シーンに追加しよう。どこに配置するかはあなたの自由なので、適当な場所に配置してほしい。</p>
<p>あくまでサンプルだが、以下のスクリーンショットのような感じで、マップ上に3つ配置した。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img56.png" alt=""  />
</p>
<p>最後にプロジェクトを実行して、「Level1」シーン全体を確認してみよう。なお以下のGIF画像は 2.5 倍速にしている。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_6/img57.gif" alt=""  />
</p>
<br>
<hr>
<h1 id="part-6-で編集したスクリプトのコード">Part 6 で編集したスクリプトのコード<a hidden class="anchor" aria-hidden="true" href="#part-6-で編集したスクリプトのコード">#</a></h1>
<p>最後に今回の Part 6 で編集したスクリプトのコードを共有しておくので、必要に応じて確認してほしい。</p>
<details>
<summary>Item.gd の全コード</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Area2D</span> <span style="color:#75715e"># Added @ Part 6</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">var</span> point <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> sprite <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimatedSprite</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> label <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Label</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> anim_player <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimationPlayer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	sprite<span style="color:#f92672">.</span>modulate <span style="color:#f92672">=</span> <span style="color:#a6e22e">Color</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	sprite<span style="color:#f92672">.</span>position <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO
</span></span><span style="display:flex;"><span>	sprite<span style="color:#f92672">.</span>scale <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ONE
</span></span><span style="display:flex;"><span>	label<span style="color:#f92672">.</span>modulate <span style="color:#f92672">=</span> <span style="color:#a6e22e">Color</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>	label<span style="color:#f92672">.</span>rect_position <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">32</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">20</span>)
</span></span><span style="display:flex;"><span>	label<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> str(point)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Item_body_entered(body):
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> body<span style="color:#f92672">.</span>name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Player&#34;</span>:
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;Player hit Item&#34;</span>)
</span></span><span style="display:flex;"><span>		hit()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> hit():
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#34;Got &#34;</span>, point, <span style="color:#e6db74">&#34; point.&#34;</span>)
</span></span><span style="display:flex;"><span>	anim_player<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;hit&#34;</span>)
</span></span><span style="display:flex;"><span>	yield(anim_player, <span style="color:#e6db74">&#34;animation_finished&#34;</span>)
</span></span><span style="display:flex;"><span>	queue_free()
</span></span></code></pre></div></details>
<details>
<summary>ItemBox.gd の全コード</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">StaticBody2D</span> <span style="color:#75715e"># Added @ Part 6</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> timer_unused <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> sprite <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimatedSprite</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> timer <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Timer</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> parent <span style="color:#f92672">=</span> get_parent()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> broken_box_tscn <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://Items/BrokenBox.tscn&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> items <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Items/Apple.tscn&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Items/Bananas.tscn&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Items/Cherries.tscn&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Items/Kiwi.tscn&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Items/Melon.tscn&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Items/Orange.tscn&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Items/Pineapple.tscn&#34;</span>),
</span></span><span style="display:flex;"><span>	preload(<span style="color:#e6db74">&#34;res://Items/Strawberry.tscn&#34;</span>),
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	sprite<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;idle&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Timer_timeout():
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#34;ItemBox &gt; Timer timeout&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> items<span style="color:#f92672">.</span>empty():
</span></span><span style="display:flex;"><span>		items<span style="color:#f92672">.</span>clear()
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;items size: &#34;</span>, items<span style="color:#f92672">.</span>size())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Area2D_body_entered(body):
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> body<span style="color:#f92672">.</span>name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Player&#34;</span>:
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;ItemBox &gt; Area2D Player entered&#34;</span>)
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> timer_unused:
</span></span><span style="display:flex;"><span>			timer<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>			timer_unused <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;hit&#34;</span>)
</span></span><span style="display:flex;"><span>		yield(sprite, <span style="color:#e6db74">&#34;animation_finished&#34;</span>)
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;idle&#34;</span>)
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> items<span style="color:#f92672">.</span>empty():
</span></span><span style="display:flex;"><span>			print(<span style="color:#e6db74">&#34;ItemBox is empty.&#34;</span>)
</span></span><span style="display:flex;"><span>			sprite<span style="color:#f92672">.</span>visible <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">var</span> broken_box <span style="color:#f92672">=</span> broken_box_tscn<span style="color:#f92672">.</span>instance()
</span></span><span style="display:flex;"><span>			parent<span style="color:#f92672">.</span>add_child(broken_box)
</span></span><span style="display:flex;"><span>			broken_box<span style="color:#f92672">.</span>position <span style="color:#f92672">=</span> position
</span></span><span style="display:flex;"><span>			queue_free()
</span></span><span style="display:flex;"><span>			print(self<span style="color:#f92672">.</span>name, <span style="color:#e6db74">&#34; removed.&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>			print(<span style="color:#e6db74">&#34;ItemBox is not empty.&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">var</span> item <span style="color:#f92672">=</span> items<span style="color:#f92672">.</span>pop_front()<span style="color:#f92672">.</span>instance()
</span></span><span style="display:flex;"><span>			add_child(item)
</span></span><span style="display:flex;"><span>			item<span style="color:#f92672">.</span>position<span style="color:#f92672">.</span>y <span style="color:#f92672">-=</span> <span style="color:#ae81ff">12</span>
</span></span><span style="display:flex;"><span>			item<span style="color:#f92672">.</span>hit()
</span></span></code></pre></div></details>
<details>
<summary>BrokenBox.gd の全コード</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Particles2D</span> <span style="color:#75715e"># Added @ Part 6</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	emitting <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _process(delta):
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> emitting:
</span></span><span style="display:flex;"><span>		queue_free()
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;BrokenBox removed.&#34;</span>)
</span></span></code></pre></div></details>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="おわりに">おわりに<a hidden class="anchor" aria-hidden="true" href="#おわりに">#</a></h1>
<p>以上で Part 6 は完了だ。今回はアイテムの雛形シーンを作り、それを継承して個々のアイテムシーンを作った。さらに、それらのアイテムが出てくるアイテムボックスを作り、アイテムボックスが壊れる時の演出をパーティクルシステムで実装した。ということで、今回もなかなかボリューミーな回になった。しかし、やった分だけゲームの楽しさは確実に増したはずだ。</p>
<p>次回 Part 7 では、レベルクリア条件となるものを用意して、次のレベルへの遷移を実装する予定だ。それでは次回もお楽しみに。</p>
<hr>
<p><strong>UPDATE:</strong><br>
2022-02-25 「おわりに」の次回の内容を「HUD」から「次のレベルへの遷移」に変更</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://www.peanuts-code.com/ja/tags/godot/">Godot</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/godotengine/">GodotEngine</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%82%B2%E3%83%BC%E3%83%A0%E9%96%8B%E7%99%BA/">ゲーム開発</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB/">チュートリアル</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E5%88%9D%E7%B4%9A/">初級</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/2d/">2D</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%BC/">プラットフォーマー</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B2%E3%83%BC%E3%83%A0/">アクションゲーム</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E6%A8%AA%E3%82%B9%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%AB/">横スクロール</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%82%A2%E3%82%A4%E3%83%86%E3%83%A0/">アイテム</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_5/">
    <span class="title">« 前のページ</span>
    <br>
    <span>Godot で作るプラットフォーマー Part 5：さらに敵キャラクターを作ろう！</span>
  </a>
  <a class="next" href="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_7/">
    <span class="title">次のページ »</span>
    <br>
    <span>Godot で作るプラットフォーマー Part 7：次のレベルに遷移させよう！</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 6：アイテムを作ろう！ on twitter"
        href="https://twitter.com/intent/tweet/?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%206%ef%bc%9a%e3%82%a2%e3%82%a4%e3%83%86%e3%83%a0%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_6%2f&amp;hashtags=Godot%2cGodotEngine%2c%e3%82%b2%e3%83%bc%e3%83%a0%e9%96%8b%e7%99%ba%2c%e3%83%81%e3%83%a5%e3%83%bc%e3%83%88%e3%83%aa%e3%82%a2%e3%83%ab%2c%e5%88%9d%e7%b4%9a%2c2D%2c%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%2c%e3%82%a2%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e3%82%b2%e3%83%bc%e3%83%a0%2c%e6%a8%aa%e3%82%b9%e3%82%af%e3%83%ad%e3%83%bc%e3%83%ab%2c%e3%82%a2%e3%82%a4%e3%83%86%e3%83%a0">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 6：アイテムを作ろう！ on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_6%2f&amp;title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%206%ef%bc%9a%e3%82%a2%e3%82%a4%e3%83%86%e3%83%a0%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81&amp;summary=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%206%ef%bc%9a%e3%82%a2%e3%82%a4%e3%83%86%e3%83%a0%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81&amp;source=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_6%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 6：アイテムを作ろう！ on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_6%2f&title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%206%ef%bc%9a%e3%82%a2%e3%82%a4%e3%83%86%e3%83%a0%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 6：アイテムを作ろう！ on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_6%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 6：アイテムを作ろう！ on whatsapp"
        href="https://api.whatsapp.com/send?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%206%ef%bc%9a%e3%82%a2%e3%82%a4%e3%83%86%e3%83%a0%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81%20-%20https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_6%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 6：アイテムを作ろう！ on telegram"
        href="https://telegram.me/share/url?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%206%ef%bc%9a%e3%82%a2%e3%82%a4%e3%83%86%e3%83%a0%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_6%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://www.peanuts-code.com/ja/">Peanuts Code</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
