<!DOCTYPE html>
<html lang="ja" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Godot で作るプラットフォーマー Part 15：いろいろな仕掛けを追加しよう！ | Peanuts Code</title>
<meta name="keywords" content="GodotEngine, GameDev, 2D, アクションゲーム, 横スクロール, プラットフォーマー, トラップ" />
<meta name="description" content="第15回目の今回はいよいよこのチュートリアルのシリーズの最終回だ。最終回はプラットフォーマーのレベルデザインに比較的よく使われるいくつかの仕掛けを追加していく。具体的には以下にリストアップしたトラップ">
<meta name="author" content="Gobo">
<link rel="canonical" href="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_15/" />
<meta name="google-site-verification" content="XYZabc" />
<meta name="yandex-verification" content="XYZabc" />
<meta name="msvalidate.01" content="XYZabc" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.css" rel="preload stylesheet" as="style">
<link rel="preload" href="/images/logomark.png" as="image">
<link rel="icon" href="https://www.peanuts-code.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.peanuts-code.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.peanuts-code.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://www.peanuts-code.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://www.peanuts-code.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.104.2" />
<link rel="alternate" hreflang="ja" href="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_15/" />

<script async src="https://www.googletagmanager.com/gtag/js?id=G-DK0NK2RTTW"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-DK0NK2RTTW', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="Godot で作るプラットフォーマー Part 15：いろいろな仕掛けを追加しよう！" />
<meta property="og:description" content="第15回目の今回はいよいよこのチュートリアルのシリーズの最終回だ。最終回はプラットフォーマーのレベルデザインに比較的よく使われるいくつかの仕掛けを追加していく。具体的には以下にリストアップしたトラップ" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_15/" />
<meta property="og:image" content="https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_15/img42.gif" /><meta property="article:section" content="tutorials" />
<meta property="article:published_time" content="2022-04-24T00:00:00&#43;09:00" />
<meta property="article:modified_time" content="2022-04-24T00:00:00&#43;09:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_15/img42.gif" />
<meta name="twitter:title" content="Godot で作るプラットフォーマー Part 15：いろいろな仕掛けを追加しよう！"/>
<meta name="twitter:description" content="第15回目の今回はいよいよこのチュートリアルのシリーズの最終回だ。最終回はプラットフォーマーのレベルデザインに比較的よく使われるいくつかの仕掛けを追加していく。具体的には以下にリストアップしたトラップ"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "チュートリアル",
      "item": "https://www.peanuts-code.com/ja/tutorials/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "シリーズ：Godot で作るプラットフォーマー",
      "item": "https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Godot で作るプラットフォーマー Part 15：いろいろな仕掛けを追加しよう！",
      "item": "https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_15/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Godot で作るプラットフォーマー Part 15：いろいろな仕掛けを追加しよう！",
  "name": "Godot で作るプラットフォーマー Part 15：いろいろな仕掛けを追加しよう！",
  "description": "第15回目の今回はいよいよこのチュートリアルのシリーズの最終回だ。最終回はプラットフォーマーのレベルデザインに比較的よく使われるいくつかの仕掛けを追加していく。具体的には以下にリストアップしたトラップ",
  "keywords": [
    "GodotEngine", "GameDev", "2D", "アクションゲーム", "横スクロール", "プラットフォーマー", "トラップ"
  ],
  "articleBody": "第15回目の今回はいよいよこのチュートリアルのシリーズの最終回だ。最終回はプラットフォーマーのレベルデザインに比較的よく使われるいくつかの仕掛けを追加していく。具体的には以下にリストアップしたトラップやギミックの類だ。\n動く床 落ちる床 高く飛べる床 火が出る装置 飛んでくる鉄球 今回は Part 1 でインポート済みのアセットからたくさんのスプライトシートを利用する。例によって、見た目にブラーがかかっている（ピクセルアート特有のエッジが効いた画像ではない）場合は、ファイルシステム上で利用するアセットファイルを選択し、インポートドックから「プリセット」＞「2D Pixel」を選択し、「再インポート」をクリックして修正しよう。\nMemo： 過去のシリーズをまだご覧になっていない方は、そちらを先にご覧いただくことをおすすめします。\nGodot で作るプラットフォーマー 動く床 名前の通り、プレイヤーキャラクターがそこに乗っているだけで移動できる、動く床を作成する。日本語で『床』としたが、英語でいうところのプラットフォームだ。まさにプラットフォーマーというジャンルに相応しい定番の仕掛けである。\nシーンを作成する 「Node2D」をルートノードにして新規でシーンを作成する。 ルートノードの名前は「MovingPlatform」とする。 ファイルパスを「res://Traps/MovingPlatform/MovingPlatform.tscn」として保存する。 次に、以下のスクリーンショットと同じシーンツリーになるように、必要なノードを追加する。なお、ノードの名前変更はルートノード以外必要ない。\nノードのプロパティを編集する シーンツリーに追加したノードうち、いくつかのプロパティを編集していこう。\nPath2D ノード このノードは、動く床の経路となるパスを作成する。ここではひとまず雛形としてシンプルな直線のパスを作成するが、インスタンス化した先のシーンでパスの形状は編集可能だ。\nインスペクターで「Resource」＞「Local To Scene」にチェックを入れてオンにする。 シーンツリードックで「Path2D」が選択されている状態だと、2D ワークスペース上にパスを描画するツール（以下のスクリーンショット）が表示される。それぞれのアイコンにカーソルを合わせると説明が見れるので確認しておこう。\n2D ワークスペース上に点を2つ以上打つことでパスを描いていく。左から3番目の「+」のついたアイコンをクリックして点を追加しよう。点は(0, 0)と、もう一つ真っ直ぐ上の適当な場所、(0, -128)あたりに打っておこう。これで縦に真っ直ぐのパスができたはずだ。\n公式オンラインドキュメント: ベジェ、曲線、パス Path2D Curve2D PathFollow2D ノード このノードは、親である「Path2D」ノードのパスを経路として、それに沿って子ノード（ここでは「KinematicBody2D」）を移動させる役割をする。経路に沿った移動に関わるプロパティについて少し解説しておく。\n「Offset」プロパティでピクセル単位の値でパスの原点からの距離を指定するか、「Unit Offset」プロパティで原点からの距離を割合（0 ~ 1）で指定することで、経路上の位置を決めることができる。この位置を常に変化させることで、経路上をオブジェクトが移動する動きを作ることができるわけだ。この位置の変化はのちほど「AnimationPlayer」ノードのアニメーションとスクリプトで制御するので、ここで今直接編集する必要はない。\n「Rotate」プロパティをオフにしておく。インスペクターで唯一変更するプロパティだ。\nパスが y 軸に対して平行な直線ではない場合に、パスをたどるオブジェクト（ここでは動く床）の向きもデフォルトでは回転するが、このプロパティをオフにすることで固定できる。床がパスの角度に合わせて回転してしまうと、プレイヤーキャラクターはそこに乗っていられなくなる（敢えてそういうトラップとしてオンにしておくのもアイデアだが）。\n公式オンラインドキュメント: PathFollow2D AnimatedSprite ノード 親の「KinematicBody2D」ノードに「SpriteFrames」リソースを適用して見た目（テクスチャ）を作る。\nインスペクタードックで「Frames」プロパティに「新規 SpriteFrames」リソースを割り当てる。 スプライトフレームパネルで以下のアニメーションを作成する。 アニメーション名: off\n速度: 1 FPS ループ: オフ アニメーションフレームリソース: res://Assets/Traps/Platforms/Brown Off.png\nアニメーション名: on\n速度: 16 FPS ループ: オン アニメーションフレームリソース: res://Assets/Traps/Platforms/Brown On (32x8).png\nAnimationPlayer ノード このノードは重要だ。いつものような楽しい演出としての使用ではなく、このノードによって「PathFollow2D」ノードの「Unit Offset」プロパティの値を徐々に変更することで、「KinematicBody2D」が「Path2D」の経路を辿るようにする。\nアニメーションパネルで以下の内容のアニメーションを新規作成する アニメーション名: move 読み込み後自動再生: オン アニメーションの長さ(秒): 4 リピート再生: オン トラック：PathFollow2D ノード ＞ unit_offset プロパティ Time: 0 秒 / Value: 0 / Easing: 1.00 Time: 2 秒 / Value: 0.99 / Easing: 1.00\n*Value を 1 にすると経路を折り返すタイミングで一瞬弾けるような現象が生じるので 0.99 としている\nチェーンのシーンを作成する 次は動く床の経路がわかるように、経路に沿ってチェーンを配置したい。そこで今回はチェーンのセグメント１つ分のシーンを作成し、動く床が読み込まれた時に、スクリプトで画面上に必要な数だけチェーンをインスタンス化する方向で進める。ではシーンを作成しよう。\nルートノードに「Sprite」クラスを指定して新規でシーンを作成する。 ルートノードの名前は「MovingPlatformChain」に変更する。 「MovingPlatformChain」ルートノードの「Texture」プロパティにリソース「res://Assets/Traps/Platforms/Chain.png」を適用する。 ファイルパスを「res://Traps/MovingPlatform/MovingPlatformChain.tscn」としてシーンを保存する。\nスクリプトをアタッチして編集する それではスクリプトで「MovingPlatform」が読み込まれたらチェーンを表示するようにコーディングしていこう。\n「MovingPlatform」ルートノードにスクリプトをアタッチしてほしい。この時、ファイルパスを「res://Traps/MovingPlatform/MovingPlatform.gd」としてスクリプトを作成しよう。\nアタッチできたら、「MovingPlatform.gd」スクリプトを以下のように編集してほしい。\nextends Node2D # Path2D の参照 onready var path = $Path2D # MovingPlatformChainシーンをプリロード onready var chain_scn = preload(\"res://Traps/MovingPlatform/MovingPlatformChain.tscn\") # ノードが読み込まれる時に実行 func _ready(): make_chain() # チェーンを Path2D の経路に合わせて必要数インスタンス化して配置するメソッド func make_chain(): # Path2D のキャッシュされた点（の位置）を取得 var points = path.curve.get_baked_points() # Path2D の全てのキャッシュされた点にチェーンのインスタンスを配置 for point in points: var chain = chain_scn.instance() add_child(chain) move_child(chain, 0) chain.z_index = -1 chain.position = point 「Path2D」ノードのリソース「Curve2D」クラスのメソッドget_baked_pointsで、キャッシュされた点を取得できる。このキャッシュされた点はパスを作成した時の点とは別物である。パスをゲーム画面上に描画するときに、パスの形状を複数の点に置き換えてキャッシュ（一時保存）しているのだ。ちなみに、キャッシュされた点と点の間隔は、「Bake Interval」プロパティで設定でき、値が小さいほどパスのカーブなどの形状を滑らかに描画できるが、その分コンピュータのメモリを消費するので注意が必要だ。\n今回はこのキャッシュされた点の位置を利用して、そこにチェーンを配置するようにしたというわけだ。\n公式オンラインドキュメント: Curve2D Level3 シーンにインスタンスを追加する 今回のチュートリアル用に「Level3」シーンを作成しておこう。「Level1」シーンを複製（継承ではない）して、敵キャラクターやアイテムなどの不要なノードは一旦全て削除し、TileMapも簡単なものを新しく作成しよう。\n続けて、先ほど作成した「MovingPlatformtscn」をインスタンス化して追加しよう。\n以下のように確認しやすい配置にするだけでOKだ。\n「MovingPlatform」のインスタンスの「Path2D」のパスを以下の手順で編集してみよう。\nシーンツリードックで「MovingPlatform」を右クリックし、「編集可能な子」にチェックを入れよう。\nそのままシーンツリードックで「MovingPlatform」の子の「Path2D」ノードを選択する。\nインスペクターで「Curve」プロパティの「Curve2D」リソースをユニーク化する。\n2D ワークスペースでツールバーのパス描画ツールを切り替えながらパスを編集してみよう。例えば「点を空きスペースに追加」ツールで点を追加し、「曲線を閉じる」ツールでパスの端と端を繋いで、「コントロールポイントを選ぶ」ツールで既存の点をドラッグして滑らかなカーブにしてみよう。\n最後にシーンを実行して動作確認をしておこう。\n床の動きが速すぎる場合は、「MovingPlatform」の子「AnimationPlayer」ノードを選択し、インスペクターで「Playback Options」＞「Speed」プロパティを編集する。遅くしたい場合は値を 1 より小さくする。\n応用： 回転ノコギリ 動く床のロジックを応用して「回転ノコギリ」のトラップを作ることができる。\n「Path2D」のパスを辿る回転するノコギリで、当たるとダメージを受ける、というトラップだ。\n「AnimatedSprite」の「Frames」プロパティに適用する「SpriteFrames」リソースのアニメーション用アセットは「res://Assets/Traps/Saw/」にまとまっている。\n「KinematicBody2D」の代わりに「Area2D」を使用し、そのシグナル「body_entered」をスクリプトに接続して、プレイヤーキャラクターがコリジョン形状に入ったらダメージを与えるように制御すればOKだ。\n今回のチュートリアルでは、ボリュームの都合で詳細な解説は割愛させていただく。\n落ちる床 落ちる床は、プロペラで空中に浮かんでおり、プレイヤーキャラクターが飛び乗ると、そのあとすぐにグラグラして落下するという仕掛けだ。飛び乗ったあとすぐに離れないと、画面下に落下してゲームオーバーになってしまう、というのがよくある使い方だ。\nシーンを作成する ルートノードに「KinematicBody2D」クラスを指定してシーンを新規作成する。このクラスを選択する理由は、スクリプトのコードにより重力を加えて落下させるためだ。 ルートノードの名前は「FallingPlatform」に変更する。 ファイルパスを「res://Traps/FallingPlatform/FallingPlatform.tscn」としてシーンを保存する。 以下のスクリーンショットのようなシーンツリーになるように必要なノードを追加しよう。\nなお、以下のノードはどちらも「CollisionShape2D」クラスのため、名前を変更している。 「BodyCollision」ノード 「AreaCollision」ノード ノードのプロパティを編集する AnimatedSprite ノード このノードを編集して落ちる床のルートノードの見た目を作る。\nインスペクターで「Frames」プロパティに「新規 SpriteFrames」リソースを適用する。 スプライトフレームパネルで以下のアニメーションを作成する アニメーション名: Off 速度: 1 FPS ループ: オフ アニメーションフレームリソース: res://Assets/Traps/Falling Platforms/Off.png\nアニメーション名: on 速度: 16 FPS ループ: オン アニメーションフレームリソース: res://Assets/Traps/Falling Platforms/On (32x10).png\nインスペクターに戻って、「Animation」プロパティの値として「on」を選択する。 続けて「Playing」プロパティをオンにする。 BodyCollision ノード このノードを編集して、ルートノードのコリジョン形状を設定する。ルートノードは「KinematicBody2D」（つまり物理ボディ）なので、コリジョン形状を作れば、プレイヤーキャラクターがそこに乗ることができるようになる。\nインスペクターで「Shape」プロパティに「新規 RectangleShape2D」リソースを適用する。 2D ワークスペース上でコリジョン形状を、「SpriteFrames」のテクスチャの床部分に合わせて調整する。\n「RectangleShape2D」リソースの「Extents」プロパティは (16, 2.5) になったはずだ。\nAreaCollision ノード このノードは、プレイヤーキャラクターが落ちる床に乗ったことを検知するために、親ノードの「Area2D」にコリジョン形状をを提供する。プレイヤーキャラクターの足が床に接したことを検知したいので、床のすぐ上に 1 px 程度の浅いコリジョン形状を配置する必要がある。なお、作業手順は先の「BodyCollision」ノードと同様だ。\nインスペクターで「Shape」プロパティに「新規 RectangleShape2D」リソースを適用する。 2D ワークスペース上でコリジョン形状を、床部分の上に乗せるような形で調整する。\n「RectangleShape2D」リソースの「Extents」プロパティは (15, 1) になったはずだ。\nAnimationPlayer ノード このノードのアニメーションで、プレイヤーキャラクターが乗った直後に落ちる床が左右にグラグラ震える演出を追加する。のちほど、このアニメーションが再生された後に床が落下するようにスクリプトで制御していく。\nアニメーションパネルを開き、以下の内容で新規アニメーションを作成する。 アニメーション名: shaking 読み込み後、自動再生: オフ アニメーションの長さ(秒): 0.4 アニメーションループ: オフ トラック: AnimatedSprite ノード ＞ offset プロパティ Time: 0 / Value: (-1, 0) / Easing: 1.00 Time: 0.05 / Value: (1, 0) / Easing: 1.00 Time: 0.1 / Value: (-1, 0) / Easing: 1.00 Time: 0.15 / Value: (1, 0) / Easing: 1.00 Time: 0.2 / Value: (-1, 0) / Easing: 1.00 Time: 0.25 / Value: (1, 0) / Easing: 1.00 Time: 0.3 / Value: (-1, 0) / Easing: 1.00 Time: 0.35 / Value: (1, 0) / Easing: 1.00 Time: 0.4 / Value: (-1, 0) / Easing: 1.00 以下のGIF画像ように、一瞬震えるアニメーションになればOKだ。\nTimer ノード このタイマーは、落下してから一定時間経過後に落ちる床のインスタンスを解放するために利用する。\nインスペクターで「Wait Time」プロパティの値はデフォルトの 1 秒のままにしておく。この時間が落下開始してから解放するまでの時間になる。 「One Shot」プロパティをオンにする。タイマーは一回しか使わない。 「Autostart」プロパティはオフのままだ。のちほどスクリプトでプレイヤーが床に乗ってからスタートするよう調整する。 スクリプトをアタッチして編集する ここからは、プレイヤーキャラクターが乗ったら落ちる床が本当に落ちるようにプログラミングしていく。ルートノード「FallingPlatform」にスクリプトをアタッチしてほしい。ファイルパスを「res://Traps/FallingPlatform/FallingPlatform.gd」として作成しよう。\nアタッチできたら「FallingPlatform.gd」スクリプトを以下のように編集しよう。\nextends KinematicBody2D # 重力のプロパティ var gravity = 512 # 速度のプロパティ、初期値は(0, 0) var velocity = Vector2() # AnimationPlayer ノードの参照 onready var anim_player = $AnimationPlayer # Timer ノードの参照 onready var timer = $Timer func _ready(): # シーンが読み込まれたら物理プロセスを停止しておく set_physics_process(false) func _physics_process(delta): # 速度のy軸方向の値に重力を加算する velocity.y += gravity * delta # 速度に合わせて KinematicBody2D のルートノードを動かす（落下させる） move_and_slide(velocity, Vector2.UP) 少し解説しておくと、まず_readyメソッドにより、set_physics_process(false)が呼ばれるので、シーンが読み込まれる際に物理プロセスは停止状態になる。\nそのため、すぐ下の_physics_processメソッドで、落ちる床が重力により落下するように定義しているが、これは物理プロセスが次に再開された時に初めて実行されることになる。\n次に「Area2D」ノードのシグナル「body_entered」をスクリプトに接続する。プレイヤーキャラクターが落ちる床に乗ったら発信されるシグナルだ。接続後、追加された_on_Area2D_body_enteredメソッドを以下のように編集しよう。\n# 物理ボディが Area2D のコリジョン形状に入った時に発信されるシグナルで呼ばれるメソッド func _on_Area2D_body_entered(body): # プレイヤーキャラクターが床に乗ったら if body.name == \"Player\": # AnimationPlayer ノードの shaking アニメーションを再生する anim_player.play(\"shaking\") これで落ちる床に乗ったら、「AnimationPlayer」の「shaking」アニメーションが再生されるようになった。さらに「AnimationPlayer」ノードのシグナル「animation_finished」をスクリプトに接続しよう。追加された_on_AnimationPlayer_animation_finishedメソッドを以下のように編集してほしい。\nfunc _on_AnimationPlayer_animation_finished(anim_name): # 終了したアニメーションが shaking だったら if anim_name == \"shaking\": # 物理プロセスを再開する（自動的に重力で床が落下する） set_physics_process(true) # タイマーをスタートする timer.start() これでアニメーション「shaking」が終了した直後、物理プロセスが再開され、重力により自動的に床が落下する。\n最後に「Timer」ノードのシグナル「timeout」をスクリプトに接続して、_on_Timer_timeoutメソッドを以下のように編集しよう。\nfunc _on_Timer_timeout(): # FallingPlatform ノードを解放する queue_free() これで完全にゲームの世界から落ちる床が消える。以上でスクリプトの編集は完了だ。\nLevel3 シーンにインスタンスを追加する 作成した「FallingPlatform.tscn」のインスタンスを「Level3」シーンに追加し、シーンを実行して動作を確認してみよう。\n問題なさそうだ。これを実際にレベルデザインする際に下に地面がないところに配置するとよりスリリングで効果的だ。\n高く飛べる床 次は「高く飛べる床」を作る。トランポリンやバネのような仕掛けだ。タイルマップで、これを利用しないと辿り着けないような高い位置に地面を作ると効果的だ。\nシーンを作成する 「StaticBody2D」クラスをルートノードにしてシーンを新規作成する。 ルートノードの名前を「Spring」に変更する。 ファイルパスを「res://Traps/Spring/Spring.tscn」としてシーンを保存する。 以下のスクリーンショットのようなシーンツリーになるように必要なノードを追加する。\nなお、以下のノードは同じ「CollisionShape2D」クラスのためノードの名前を変更している。 「BodyCollision」ノード 「AreaCollision」ノード ノードのプロパティを編集する AnimatedSprite ノード ルートノードの「Spring」に見た目を提供する。\nインスペクターで「Frames」プロパティに「新規 SpriteFrames」リソースを適用する。 スプライトフレームパネルで以下の２つのアニメーションを作成する。 アニメーション名: idle 速度: 1 FPS ループ: オフ アニメーションフレームリソース: res://Assets/Traps/Trampoline/Idle.png\nアニメーション名: jump 速度: 8 FPS ループ: オフ アニメーションフレームリソース: res://Assets/Traps/Trampoline/Jump (28x28).png\nインスペクターに戻って「Animation」プロパティを「idle」に設定する。 「Playing」プロパティをオンに設定する。 BodyCollision ノード ルートノードにコリジョン形状を適用する。「AnimatedSprite」のテクスチャ画像の赤い台の位置に合わせてコリジョン形状を設定し、プレイヤーキャラクターがそこに乗れるようにする。\nインスペクターで「Shape」プロパティに「新規 RectangleShape2D」リソースを適用する。 2D ワークスペースで「AnimatedSprite」の「idle」のアニメーションフレームの赤い台の形に合わせてコリジョン形状を調整する。ピッタリ形を合わせた場合は「RectangleShape2D」＞「Extents」プロパティは (11.5, 2.5) になる。\nAreaCollision ノード このノードは、プレイヤーキャラクターが床に乗ったかどうかを検知するための親ノード「Area2D」にコリジョン形状を適用する。プレイヤーキャラクターの足を検出するため、赤い台のすぐ上に浅く配置するのがポイントだ。\nインスペクターで「Shape」プロパティに「新規 RectangleShape2D」リソースを適用する。 2D ワークスペースで、「AnimatedSprite」の「idle」のアニメーションフレームの赤い台のすぐ上の部分に浅くコリジョン形状を配置する。「RectangleShape2D」＞「Extents」プロパティは (10.5, 1.5) になる。\nスクリプトをアタッチして編集する ルートノード「Spring」にスクリプトをアタッチする。ファイルパスを「res://Traps/Spring/Spring.gd」として作成する。\nスクリプトがアタッチできたら、例によってまずはプロパティから定義する。\nextends StaticBody2D # Player ノードの参照用（最初は名前のみ定義） var player # AnimatedSprite ノードの参照 onready var sprite = $AnimatedSprite さてここで、プレイヤーキャラクターが「Area2D」ノードのコリジョン形状に入ったタイミング発信されるシグナルを利用したいので、「Area2D」ノードの「body_entered」シグナルを「Spring.gd」スクリプトに接続しておこう。\nスクリプトに_on_Area2D_body_enteredメソッドが追加されたら以下のように編集する。\nfunc _on_Area2D_body_entered(body): # AnimatedSpriteのアニメーションのフレームを 0 にする sprite.frame = 0 # Player ノードを検知したら if body.name == \"Player\": # デバッグ用 print(\"Player entered Spring area\") # プロパティ player に body(Playerノード)を代入 player = body # AnimatedSpriteの jump アニメーションを再生する sprite.play(\"jump\") これで、プレイヤーキャラクターが高く飛ぶ床に乗ったら、床がアニメーションするようになった。ちなみにメソッドの外で定義されているplayerプロパティにbodyを代入したのは、このメソッド以外で「Player」ノードを制御したいからだ。\nでは、肝心のプレイヤーを高く飛ばすためのコードを作っていこう。床のアニメーションの特定のタイミングに合わせてプレイヤーキャラクターを高く飛ばしたい。そこで「AnimatedSprite」ノードのシグナル「frame_changed」をスクリプトに接続して利用する。\nこのシグナルはアニメーションのフレームが変わるたびにシグナルが発信される。アニメーション「jump」のフレームが 1 の時に一番床が高くなるので、それを条件にif構文を使って、このフレームが 1 のタイミングでプレイヤーを高く飛ばそう。ではシグナルを接続して追加された_on_AnimatedSprite_frame_changedメソッドを以下のように編集しよう。\nfunc _on_AnimatedSprite_frame_changed(): # AnimatedSprite のアニメーションが jump でかつフレームが 1 でかつ　player プロパティが空っぽでない場合 if sprite.animation == \"jump\" and sprite.frame == 1 and player != null: # Player ノードの y 軸方向の速度をプレイヤーキャラクターのジャンプ力の2倍にする player.velocity.y = - player.jump_force * 2 # Player ノードのダブルジャンプを可能にする player.can_double_jump = true Level3 シーンにインスタンスを追加する 作成した「Spring.tscn」のインスタンスを「Level3」シーンに追加し、シーンを実行して動作を確認してみよう。\n十分高く飛ばすことができた。高さを調整したい時はplayer.velocity.y = - player.jump_force * 2の最後の 2 を別の数値に変更して調整いただければと思う。これを使って、高い足場に移動するようなレベルのデザインをすると効果的だ。\n火が出る装置 踏むと足元から火が出る装置を作る。例えば、この装置を足元にずらりと並べて、どこに着地しても火が出るようなスリリングなステージを構成することができる。\nシーンを作成する 「StaticBody2D」クラスをルートノードにしてシーンを新規作成する。 ルートノードの名前は「FirePod」に変更する。 ファイルパスを「res://Traps/FirePod/FirePod.gd」としてシーンを保存する。 以下のスクリーンショットのようなシーンツリーになるように必要なノードを追加する（ほとんど落ちる床や高く飛べる床と同じ構成だ）。\nなお、以下のノードは同じ「CollisionShape2D」クラスのため名前を変更している。 「BodyCollision」ノード 「AreaCollision」ノード ノードのプロパティを編集する AnimatedSprite ノード ルートノードの見た目を作る。\nインスペクターで「Frames」プロパティに「新規 SpriteFrames」リソースを適用する。 スプライトフレームパネルで以下のアニメーションを作成する。 アニメーション名: hit 速度: 8 FPS ループ: オフ アニメーションフレームリソース: res://Assets/Traps/Fire/Hit (16x32).png\nアニメーション名: off 速度: 1 FPS ループ: オフ アニメーションフレームリソース: res://Assets/Traps/Fire/Off.png\nアニメーション名: on 速度: 8 FPS ループ: オン アニメーションフレームリソース: res://Assets/Traps/Fire/On (16x32).png\nインスペクターに戻って「Animation」プロパティで「off」を選択する。 「Playing」プロパティをオンにする。 BodyCollision ノード ルートノードにコリジョン形状を適用する。\nインスペクターで「Shape」プロパティに「新規 RectangleShape2D」リソースを適用する。 2D ワークスペースで、「AnimatedSprite」の「off」のアニメーションフレームの装置のサイズに合わせてコリジョン形状を調整する。ピッタリ形を合わせた場合は「RectangleShape2D」＞「Extents」プロパティは (8, 8) になる。\nAreaCollision ノード このノードは、以下の２つを検知するために親ノードの「Area2D」にコリジョン形状を適用する。\nプレイヤーキャラクターが装置の上に乗ったこと 火が出た時にプレイヤーキャラクターが火に当たったこと いずれもプレイヤーキャラクターの足を検出する必要があるため、装置のすぐ上にコリジョン形状を配置する。\nインスペクターで「Shape」プロパティに「新規 RectangleShape2D」リソースを適用する。 2D ワークスペースで、「AnimatedSprite」の「off」アニメーションフレームの装置のすぐ上の部分にコリジョン形状を配置する。「RectangleShape2D」＞「Extents」プロパティは (5, 3) になる。\nTimer ノード 火が出る装置の火が出ている時間はこのノードのタイマーで管理する。\nインスペクターで「Wait Time」プロパティはデフォルトの 1 のままにしておく。火が出るのは 1 秒くらいがちょうど良いだろう。 「One Shot」プロパティをオンにしよう。 「Autostart」プロパティはデフォルトのオフのままにしておく。プレイヤーキャラクターが装置に乗ったことを検知してから火を出したいので、スクリプトでタイマーをスタートさせるようのちほどコーディングする。 スクリプトをアタッチして編集する ルートノード「FirePod」にスクリプトをアタッチしよう。この時、ファイルパスを「res://Traps/FirePod/FirePod.gd」として作成する。\nなお、火が出る装置には以下の基本動作を繰り返すように制御しつつ、「on」アニメーション時に装置の上にプレイヤーキャラクターが乗っていたら（火に当たったら）ダメージを与えるように制御していく。\nプレイヤーキャラクターが乗った時に「Area2D」のシグナル発信 シグナルをトリガーに「off」アニメーションを「hit」アニメーションに切り替え 「hit」アニメーションが終了した時に「AnimatedSprite」のシグナル発信 シグナルをトリガーに「on」アニメーションに切り替え 「on」アニメーション開始時に「Timer」のタイマー開始 タイムアウトした時に「Timer」のシグナル発信 シグナルをトリガーに「off」アニメーションに戻る アタッチできたら、さっそく「FirePod.gd」スクリプトを編集していこう。まずはプロパティから定義する。\nextends StaticBody2D # プレイヤーキャラクターが受けるダメージ var damage: float = 20.0 # AnimatedSprite ノードの参照 onready var sprite = $AnimatedSprite # AreaCollision ノードの参照 onready var area_collision = $Area2D/AreaCollision # Timer ノードの参照 onready var timer = $Timer 続いて「Area2D」のシグナル「body_entered」を「FirePod.gd」スクリプトに接続しよう。\n接続できたら、追加された_on_Area2D_body_enteredメソッドを編集する。\n# Area2D ノードが物理ボディを検知した時に発信されるシグナルで呼ばれるメソッド func _on_Area2D_body_entered(body): # プレイヤーキャラクターが乗ったら if body.name == \"Player\": # AnimatedSprite ノードのアニメーションが現在「off」の場合 if sprite.animation == \"off\": # デバッグ用 print(\"Player entered when FirePod off.\") # アニメーション「hit」を再生する sprite.play(\"hit\") # AreaCollision ノードの Disabled プロパティをオン（衝突判定を無効）にする area_collision.set_deferred(\"disabled\", true) # AnimatedSprite ノードのアニメーションが現在「on」の場合 elif sprite.animation == \"on\": # デバッグ用 print(\"Player entered when FirePod on.\") # Player ノードの「enemy_hit」シグナルを引数にダメージを渡して発信 body.emit_signal(\"enemy_hit\", damage) # Player ノードの　AnimatedSprite ノードのアニメーション「hit」を再生する body.sprite.play(\"hit\") # Player ノードの DamageSFX ノードのサウンド（ダメージの効果音）を再生する body.damage_sfx.play() 次は「AnimatedSprite」ノードのアニメーションが終了した時に発信されるシグナル「animation_finished」をスクリプトに接続しよう。追加されたメソッド_on_AnimatedSprite_animation_finishedを以下のように編集する。\nfunc _on_AnimatedSprite_animation_finished(): # AnimatedSprite ノードのアニメーションが現在「hit」の場合 if sprite.animation == \"hit\": # Timer ノードのタイマーをスタートさせる timer.start() # AnimatedSprite ノードのアニメーション「on」を再生する sprite.play(\"on\") # AreaCollision ノードの Disabled プロパティをオフ（衝突判定を有効）に戻す area_collision.set_deferred(\"disabled\", false) 最後に「Timer」ノードのタイマーがタイムアウトした時に発信されるシグナル「timeout」をスクリプトに接続しよう。追加されたメソッド_on_Timer_timeoutを以下のように編集する。\nfunc _on_Timer_timeout(): # AnimatedSprite ノードのアニメーションが現在「on」の場合 if sprite.animation == \"on\": # AnimatedSprite ノードのアニメーション「off」を再生する sprite.play(\"off\") 以上で「FirePod.gd」スクリプトのコーディングは完了だ。\nLevel3 シーンにインスタンスを追加する 作成した「FirePod.tscn」のインスタンスを「Level3」シーンに追加しよう。今回は5、6個のインスタンスをずらりと並べてその上にアイテムボックスを置いてみた。ダメージ判定も確認したいのでプロジェクトを実行して動作を確認してみよう。\n概ね想定通りの挙動だ。実際にレベルデザインでも、この火が出る装置を連続的に複数並べると効果的だ。走り抜けたら何も怖くない装置だが、途中にアイテムボックスの誘惑を用意しておくと、このトラップの効果が発揮されるだろう。\n応用: スパイク もっと簡単なトラップとして、プラットフォーマーでよく用いられるのが、刺さると痛いスパイク（トゲ）だ。アニメーションも必要もないので、今回の火の当たり判定の部分を応用すれば簡単にシーンを作成できるだろう。\nシーンツリーは、ルートノードを「Area2D」にして、それに「Sprite」と「CollisionShape2D」を追加するだけで済むはずだ。「Sprite」ノードの「Texture」プロパティには「res://Assets/Traps/Spikes/Idle.png」のリソースファイルを適用すると良いだろう。\n詳細な説明は、このチュートリアルのボリュームの関係で割愛させていただく。\n飛んでくる鉄球 今回のチュートリアルではこれが最後の仕掛けになる。難易度も一番高いので頑張ろう。レベル上の任意の場所にチェーンで繋がれたトゲトゲの鉄球だ。仕様としては以下の通りだ。\n鉄球にプレイヤーキャラクターが一定距離まで近づくとプレイヤーキャラクターを検知する 検知した時点のプレイヤーキャラクターの位置を目掛けて鉄球が飛んでくる（追尾はしない） 鉄球はチェーンに繋がれているので一定の距離までしか飛んでこない チェーンが伸びきったら自動的に元の位置に戻る 元の位置に戻った時に 1 の動作を再開する 鉄球に当たるとプレイヤーキャラクターはダメージを受ける シーンを作成する 「Node2D」クラスをルートノードにしてシーンを新規作成する。 ルートノードの名前を「SpikedBall」に変更する。 ファイルパスを「res://Traps/SpikedBall/SpikedBall.tscn」としてシーンを保存する。 以下のスクリーンショットのようなシーンツリーになるように必要なノードを追加していく。\nなお、名前を変更しているノードとそのクラスは以下の通りだ。 「BallArea」ノード: 「Area2D」クラス 「BallCollision」ノード: 「CollisionShape2D」クラス 「DetectionArea」ノード: 「Area2D」クラス 「DetectionCollision」ノード: 「CollisionShape2D」クラス シーンツリーはここまでに作ってきた仕掛けの要素を色々まとめたような構造になっている。動く床と同様に「Path2D」と「PathFollow2D」を利用して鉄球を移動させている。動く床では「AnimationPlayer」を利用したが、鉄球では「Tween」を利用する。また、「Area2D」ブランチは、プレイヤーキャラクターを検知する範囲を設定するためのノードで、仕組みとしては、落ちる床や火が出る装置と同様だ。\nノードのプロパティを編集する Path2D ノード 動く床の時は 2D ワークスペースでパスを描いたが、今回はスクリプトでパスを描くことになるので、ここでは作業不要だ。\nインスペクターで「Resource」＞「Local To Scene」にチェックを入れてオンにする。 Sprite ノード このノードは鉄球のテクスチャ用だ。「BallArea」ノードが鉄球そのものだと考えるとわかりやすいだろう。\nインスペクターで「Texture」プロパティにリソース「res://Assets/Traps/Spiked Ball/Spiked Ball.png」を適用する。 「Offset」の値を (-0.5, -0.5) とする。ドット絵の都合でテクスチャが 1 px だけ右下に寄っているため、中央に配置するよう補正した形だ。 BallCollision ノード このノードは鉄球である「BallArea」ノードにコリジョン形状を適用する。\nインスペクターで「Shape」プロパティに「新規 CircleShape2D」リソースを適用する。 2D ワークスペースで「Sprite」のテクスチャに合わせてコリジョン形状を調整する。トゲの範囲までコリジョン形状を広げるか、内側のボール部分のみにするかで若干ゲームの難易度は変わる。このチュートリアルでは、以下のスクリーンショットのようにボール部分のみとした。「CircleShape2D」リソースのプロパティ「Radius」の値は 10 、「Custom Solver Bias」は 0 になる。\nDetectionCollision ノード こちらの「CollisionShape2D」クラスのノードは、プレイヤーキャラクターの検知用だ。いわば鉄球トラップのテリトリーと言っても良いだろう。半径 80 px の円で形成する。\nインスペクターで「Shape」プロパティに「新規 CircleShape2D」リソースを適用する。 こちらは 2D ワークスペースでは作業せず、インスペクターにそのまま半径の値を入力する。「CircleShape2D」リソースの「Radius」プロパティの値を 80 にする。「Custom Solver Bias」は 0 のまま。2D ワークスペースでは以下のスクリーンショットのようになったはずだ。\nチェーンのシーンを作成する 鉄球はチェーンで地面に繋がれている。この長いチェーンを構成するチェーンのセグメントをシーンとして作成する。ちょうど動く床と同じパターンだ。\nルートノードに「Sprite」クラスを指定して新規でシーンを作成する。 ルートノードの名前は「SpikedBallChain」に変更する。 「MovingPlatformChain」ルートノードの「Texture」プロパティにリソース「res://Assets/Traps/Spiked Ball/Chain.png」を適用する。 ファイルパスを「res://Traps/SpikedBall/SpikedBallChain.tscn」としてシーンを保存する。 スクリプトをアタッチして編集する ではスクリプトをルートノードの「SpikedBall」にアタッチしよう。ファイルパスを「res://Traps/SpikedBall/SpikedBall.gd」として作成する。\nここからは大まかに以下の仕様を形にしていく。\n鉄球のシーンが読み込まれた時にチェーンを作成する 「Area2D」ノードでプレイヤーキャラクターを検知して発信するシグナルをトリガーにして 「Path2D」パスを作成する 鉄球を移動させる 鉄球の位置に合わせて常にチェーン全体の長さ（各チェーンセグメントの位置）を変化させる プレイヤーキャラクターが鉄球に当たったらダメージを与える では「SpikedBall.gd」をスクリプトを編集していこう。まずはプロパティの定義からだ。\nextends Node2D # チェーンの最大の長さ var chain_length = 80 # チェーンセグメントの数 var chain_num = 10 # プレイヤーキャラクターが受けるダメージ var damage = 20.0 # Path2D ノードの参照 onready var path = $Path2D # PathFollow2D ノードの参照 onready var path_follow = $Path2D/PathFollow2D # BallArea ノードの参照 onready var ball_area = $Path2D/PathFollow2D/BallArea # DetectionArea ノードの参照 onready var detection_area = $DetectionArea # DetectionCollision ノードの参照 onready var detection_collision = $DetectionArea/DetectionCollision # Tween ノードの参照 onready var tween = $Tween # チェーンのシーンファイルのプリロードの参照 onready var chain_scn = preload(\"res://Traps/SpikedBall/SpikedBallChain.tscn\") # チェーンセグメントのコンテナとして利用する配列 onready var chain_container = [] 次に鉄球シーンが読み込まれる際にチェーンを作成するコードを記述する。\n# シーン読み込み時に呼ばれるメソッド func _ready(): # チェーンを作成するメソッドを呼ぶ make_chain() # チェーンを作成するメソッドを定義 func make_chain(): # チェーンのセグメントの数（10）だけループ処理 for i in range(chain_num): # チェーンのシーンをインスタンス化 var chain = chain_scn.instance() # チェーンのインスタンスを子ノードとして SpikedBall ルートノードに追加 add_child(chain) # 子に追加したインスタンスノードを 0 番目に移動 move_child(chain, 0) # インスタンスノードを背面に移動 chain.z_index = -1 # チェーンセグメントのコンテナ用配列に追加 chain_container.append(chain) 次に_processメソッドを利用して毎フレーム、チェーンの長さ（チェーンセグメントの個々の位置）を更新するようにする。\n# Tips：引数 delta を使用しない時は _delta とするとアラートが出ない func _process(_delta): # チェーンを再配置するメソッドを呼ぶ relocate_chain() # チェーンを再配置するメソッドを定義する func relocate_chain(): # ルートノードの位置から現在の鉄球の位置に対する方向を取得 var direction = global_position.direction_to(ball_area.global_position) # ルートノードの位置から現在の鉄球の位置までの距離をチェーンセグメントの数で割って... # ...セグメント１つ分の長さを取得する var segment_length = global_position.distance_to(ball_area.global_position) / chain_num # チェーンセグメントの数（10）だけループ処理 for i in range(chain_num - 1): # コンテナから順番に取り出したチェーンセグメントの位置を次の計算式で指定する... # ... 方向 × セグメントの長さ × コンテナの順番 chain_container[i].position = direction * segment_length * i 次に「DetectionArea」ノードのコリジョン形状の範囲にプレイヤーキャラクターが入った時の挙動を作っていく。まず「Area2D」がプレイヤーキャラクターを検知した時に発信されるシグナル「body_entered」をスクリプトに接続しよう。\nシグナルが接続できたら、追加されたメソッド_on_DetectionArea_body_enteredと、その中で呼ばれる２つのメソッドを記述していく。その２つのメソッドのうち、１つは「Path2D」ノードに2つの点を打って直線のパスを作成するメソッド。もう一つは「Path2D」ノードで作成されたパスの経路を辿って鉄球が移動するアニメーションを制御するメソッドだ。\n# DetectionArea ノードのコリジョン形状に物理ボディが入った時に発信されるシグナルで呼ばれるメソッド func _on_DetectionArea_body_entered(body): # デバッグ用 print(\"_on_DetectionArea_body_entered called\") # 検知した物理ボディが Player ノードだったら if body.name == \"Player\": # Path2Dのパスを作成するメソッドを呼ぶ set_path_points(body) # 鉄球をパスに沿って動かすメソッドを呼ぶ move_ball() # DetectionCollision ノードの衝突判定を無効化する detection_collision.set_deferred(\"disabled\", true) # Path2Dのパスを作成するメソッドを定義 func set_path_points(body): # デバッグ用 print(\"set_path_points called\") # 一度 Path2D のパスの点を全て消去してリセットする path.curve.clear_points() # まず鉄球のデフォルトの位置である原点(0, 0)にパスの点を追加する path.curve.add_point(Vector2.ZERO) # 鉄球の現在の位置から衝突した物理ボディ（「Player」ノードのこと）に対する方向を取得 var direction = global_position.direction_to(body.global_position) # 鉄球から物理ボディへの方向にチェーンの最大長を乗算した位置を鉄球がこれから目指す位置とする var directed_point = direction * chain_length # 鉄球が目指す位置を Path2D ノードのパスの２つ目の点として追加する path.curve.add_point(directed_point) # 鉄球をパスに沿って移動させるメソッドを定義 func move_ball(): # デバッグ用 print(\"move_ball called\") # PathFollow2D の Unit Offset プロパティを 0 から 1 へ 0.5 秒かけて変化させる Tween の設定 tween.interpolate_property(path_follow, \"unit_offset\", 0, 1, 0.5) # Tween ノードのアニメーションを開始する tween.start() # Tween ノードの tween_completed を利用してアニメーション（移動）が終わるのを待つ yield(tween,\"tween_completed\") # PathFollow2D の Unit Offset プロパティを 1 から 0 へ 1 秒かけて変化させる Tween の設定 tween.interpolate_property(path_follow, \"unit_offset\", 1, 0, 1) # Tween ノードのアニメーションを開始する tween.start() # アニメーション（移動）が終わるのを待つ yield(tween,\"tween_completed\") # DetectionCollision ノードの衝突判定を有効化する detection_collision.set_deferred(\"disabled\", false) 改めて解説すると、メソッドset_path_pointsは、「Path2D」ノードに原点 (0, 0) とプレイヤーキャラクターを検知した位置の２つの点を追加して直線のパスを作る。次にメソッドmove_ballで、そのパスの両端を「Tween」ノードを利用して鉄球が行って戻ってくる動作を処理している。\n最後に鉄球にプレイヤーキャラクターが当たった時のダメージ処理をコーディングする。まず先に、鉄球「BallArea」ノードのコリジョン形状にプレイヤーキャラクターが入った時に発信されるシグナル「body_entered」をスクリプトに接続しよう。\n接続できたら、追加された_on_BallArea_body_enteredメソッドを以下のように編集する。\n# BodyArea に物理ボディが入った時に呼ばれるメソッド func _on_BallArea_body_entered(body): # 物理ボディが Player ノードだったら if body.name == \"Player\": # Player ノードのシグナル「enemy_hit」を引数にダメージを渡して発信 body.emit_signal(\"enemy_hit\", damage) # Player シーンの AnimatedSprite ノードのアニメーション「hit」を再生 body.sprite.play(\"hit\") # Player シーンの DamageSFX ノードのサウンド（効果音）を再生する body.damage_sfx.play() これで飛んでくる鉄球のコーディングは完了だ。\nLevel3 シーンにインスタンスを追加する 出来上がった飛んでくる鉄球のシーン「Spikes.tscn」のインスタンスを「Level3」シーンに追加して動作確認してみよう。今回もダメージ判定を含めて確認するため、プロジェクトを実行しよう。\nちょうどうまく操作すればかわせる程度のスピードで鉄球が飛んでくるように調整できた。チェーンが最大長まで伸びきったら鉄球は元の位置に戻る。飛んでくる時は0.5秒で移動するが、戻るときは1秒かかる。この辺りも丁度良い塩梅になったのではないだろうか。\nLevel3 のレベルデザインをする ここまでに作った装置を全て使用して「Level3」シーンをデザインしてみよう。\n「MovingPlatform」のインスタンスを追加した時は、そのノードを右クリックして「編集可能な子」にして「Path2D」のパスの形も色々作ってみよう。ただし、その前に「Curve」プロパティの「Curve2D」リソースをユニーク化することをお忘れなく。\nまた、応用編として紹介した回転ノコギリやスパイクのシーンも作成している場合は、それらのインスタンスも追加しよう。\nこのチュートリアルではサンプルとして以下のようなデザインにした。\nタイルマップのデザインや今回作ったそれぞれの装置の配置をして「Level3」のデザインが完成したら、プロジェクトを実行してゲームを遊んでみよう。\nPart 15 で編集したスクリプトのコード 最後に今回の Part 15 で編集したスクリプトのコードを共有しておくので、必要に応じて確認してほしい。\n.MovingPlatform.gd の全コード extends Node2D onready var path = $Path2D onready var chain_scn = preload(\"res://Traps/MovingPlatform/MovingPlatformChain.tscn\") func _ready(): make_chain() func make_chain(): var points = path.curve.get_baked_points() for point in points: var chain = chain_scn.instance() add_child(chain) move_child(chain, 0) chain.z_index = -1 chain.position = point FallingPlatform.gd の全コード extends KinematicBody2D var gravity = 512 var velocity = Vector2() onready var anim_player = $AnimationPlayer onready var timer = $Timer func _ready(): set_physics_process(false) func _physics_process(delta): velocity.y += gravity * delta move_and_slide(velocity, Vector2.UP) func _on_Area2D_body_entered(body): if body.name == \"Player\": anim_player.play(\"shaking\") func _on_AnimationPlayer_animation_finished(anim_name): if anim_name == \"shaking\": set_physics_process(true) timer.start() func _on_Timer_timeout(): queue_free() Spring.gd の全コード extends StaticBody2D var player onready var sprite = $AnimatedSprite func _on_Area2D_body_entered(body): sprite.frame = 0 if body.name == \"Player\": print(\"Player entered Spring area\") player = body sprite.play(\"jump\") func _on_AnimatedSprite_frame_changed(): if sprite.animation == \"jump\" and sprite.frame == 1 and player != null: player.velocity.y = - player.jump_force * 2 player.can_double_jump = true FirePod.gd の全コード extends StaticBody2D var damage: float = 20.0 onready var sprite = $AnimatedSprite onready var area_collision = $Area2D/AreaCollision onready var timer = $Timer func _on_Area2D_body_entered(body): if body.name == \"Player\": if sprite.animation == \"off\": print(\"Player entered when FirePod off.\") sprite.play(\"hit\") area_collision.set_deferred(\"disabled\", true) elif sprite.animation == \"on\": print(\"Player entered when FirePod on.\") body.emit_signal(\"enemy_hit\", damage) body.sprite.play(\"hit\") body.damage_sfx.play() func _on_AnimatedSprite_animation_finished(): if sprite.animation == \"hit\": timer.start() sprite.play(\"on\") area_collision.set_deferred(\"disabled\", false) func _on_Timer_timeout(): if sprite.animation == \"on\": sprite.play(\"off\") SpikedBall.gd の全コード extends Node2D var chain_length = 80 var chain_num = 10 var damage = 20.0 onready var path = $Path2D onready var path_follow = $Path2D/PathFollow2D onready var ball_area = $Path2D/PathFollow2D/BallArea onready var detection_area = $DetectionArea onready var detection_collision = $DetectionArea/DetectionCollision onready var tween = $Tween onready var chain_scn = preload(\"res://Traps/SpikedBall/SpikedBallChain.tscn\") onready var chain_container = [] func _ready(): make_chain() func make_chain(): for i in range(chain_num): var chain = chain_scn.instance() add_child(chain) move_child(chain, 0) chain.z_index = -1 chain_container.append(chain) func _process(_delta): relocate_chain() func relocate_chain(): var direction = global_position.direction_to(ball_area.global_position) var segment_length = global_position.distance_to(ball_area.global_position) / chain_num for i in range(chain_num - 1): chain_container[i].position = direction * segment_length * i func _on_DetectionArea_body_entered(body): print(\"_on_DetectionArea_body_entered called\") if body.name == \"Player\": set_path_points(body) move_ball() detection_collision.set_deferred(\"disabled\", true) func set_path_points(body): print(\"set_path_points called\") path.curve.clear_points() path.curve.add_point(Vector2.ZERO) var direction = global_position.direction_to(body.global_position) var directed_point = direction * chain_length path.curve.add_point(directed_point) func move_ball(): print(\"move_ball called\") tween.interpolate_property(path_follow, \"unit_offset\", 0, 1, 0.5) tween.start() yield(tween,\"tween_completed\") tween.interpolate_property(path_follow, \"unit_offset\", 1, 0, 1) tween.start() yield(tween,\"tween_completed\") detection_collision.set_deferred(\"disabled\", false) func _on_BallArea_body_entered(body): if body.name == \"Player\": body.emit_signal(\"enemy_hit\", damage) body.sprite.play(\"hit\") body.damage_sfx.play() おわりに 以上で Part 15 は完了だ。\n今回はステージ上の様々な仕掛けを作った。オーソドックスな仕掛けでも、タイルマップとの組み合わせ、敵キャラクターの組み合わせ、仕掛け同士の組み合わせによって、楽しく、そして難しいレベルデザインが可能になるだろう。プレイヤーにどうやって先に進めるのかを考える機会を与え、考えた結果、難しい場面を乗り越えられたときにある種の快感を提供することができるはずだ。\nさて、今回の Part 15 にて「Godot で作るプラットフォーマー」のチュートリアルシリーズは終了だ。このシリーズを通して、プラットフォーマーのゲームを作るための基本的なところは網羅できただろう。チュートリアルを参考にしてくださった方々には感謝申し上げたい。また、このチュートリアルがこれからゲーム開発に挑戦したいと考えている方々に少しでもお役に立てたならば幸いだ。\nところで、面白いことに、自分でプラットフォーマーのゲームを作ってみたあと、改めて往年のスーパーマリオブラザーズシリーズなどをプレイしてみると、あらゆる部分でゲームが緻密に設計されているのがよくわかる。ジャンプひとつとっても絶妙のバランスだ。世界的にゲームが大ヒットする理由の一つはやはりゲームデザインなのだと思い知らされる。ゲームデザインは十分条件ではないが、必要条件であると言っても過言ではないだろう。\n今後も Godot を使った別のチュートリアルシリーズや、Godot を使う上での Tips 的なブログを投稿していくので、これからも Peanuts-code.com のコンテンツをどうぞお楽しみに。\n",
  "wordCount" : "19063",
  "inLanguage": "ja",
  "image":"https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_15/img42.gif","datePublished": "2022-04-24T00:00:00+09:00",
  "dateModified": "2022-04-24T00:00:00+09:00",
  "author":{
    "@type": "Person",
    "name": "Gobo"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_15/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Peanuts Code",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.peanuts-code.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.peanuts-code.com/ja/" accesskey="h" title="Peanuts Code (Alt + H)">
                <img src="/images/logomark.png" alt="logo" aria-label="logo"
                    height="35">Peanuts Code</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://www.peanuts-code.com/en/" title="English"
                            aria-label="English">En</a>
                    </li>
                </ul>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.peanuts-code.com/ja/" title="ホーム">
                    <span>ホーム</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/posts/" title="ブログ">
                    <span>ブログ</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/tutorials/" title="チュートリアル">
                    <span>チュートリアル</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/about/" title="サイト情報">
                    <span>サイト情報</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/search/" title="検索 (Alt &#43; /)" accesskey=/>
                    <span>検索</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://www.peanuts-code.com/ja/">Home</a>&nbsp;»&nbsp;<a href="https://www.peanuts-code.com/ja/tutorials/">チュートリアル</a>&nbsp;»&nbsp;<a href="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/">シリーズ：Godot で作るプラットフォーマー</a></div>
    <h1 class="post-title">
      Godot で作るプラットフォーマー Part 15：いろいろな仕掛けを追加しよう！
    </h1>
    <div class="post-meta">2022-04-24&nbsp;·&nbsp;39 分&nbsp;·&nbsp;Gobo
</div>
    
    <ul class="post-tags">
      <li><a href="https://www.peanuts-code.com/ja/tags/godotengine/">GodotEngine</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/gamedev/">GameDev</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/2d/">2D</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B2%E3%83%BC%E3%83%A0/">アクションゲーム</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E6%A8%AA%E3%82%B9%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%AB/">横スクロール</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%BC/">プラットフォーマー</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%83%88%E3%83%A9%E3%83%83%E3%83%97/">トラップ</a></li>
    </ul>

<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 15：いろいろな仕掛けを追加しよう！ on twitter"
        href="https://twitter.com/intent/tweet/?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2015%ef%bc%9a%e3%81%84%e3%82%8d%e3%81%84%e3%82%8d%e3%81%aa%e4%bb%95%e6%8e%9b%e3%81%91%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%97%e3%82%88%e3%81%86%ef%bc%81&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_15%2f&amp;hashtags=GodotEngine%2cGameDev%2c2D%2c%e3%82%a2%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e3%82%b2%e3%83%bc%e3%83%a0%2c%e6%a8%aa%e3%82%b9%e3%82%af%e3%83%ad%e3%83%bc%e3%83%ab%2c%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%2c%e3%83%88%e3%83%a9%e3%83%83%e3%83%97">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 15：いろいろな仕掛けを追加しよう！ on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_15%2f&amp;title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2015%ef%bc%9a%e3%81%84%e3%82%8d%e3%81%84%e3%82%8d%e3%81%aa%e4%bb%95%e6%8e%9b%e3%81%91%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%97%e3%82%88%e3%81%86%ef%bc%81&amp;summary=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2015%ef%bc%9a%e3%81%84%e3%82%8d%e3%81%84%e3%82%8d%e3%81%aa%e4%bb%95%e6%8e%9b%e3%81%91%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%97%e3%82%88%e3%81%86%ef%bc%81&amp;source=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_15%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 15：いろいろな仕掛けを追加しよう！ on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_15%2f&title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2015%ef%bc%9a%e3%81%84%e3%82%8d%e3%81%84%e3%82%8d%e3%81%aa%e4%bb%95%e6%8e%9b%e3%81%91%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%97%e3%82%88%e3%81%86%ef%bc%81">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 15：いろいろな仕掛けを追加しよう！ on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_15%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 15：いろいろな仕掛けを追加しよう！ on whatsapp"
        href="https://api.whatsapp.com/send?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2015%ef%bc%9a%e3%81%84%e3%82%8d%e3%81%84%e3%82%8d%e3%81%aa%e4%bb%95%e6%8e%9b%e3%81%91%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%97%e3%82%88%e3%81%86%ef%bc%81%20-%20https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_15%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 15：いろいろな仕掛けを追加しよう！ on telegram"
        href="https://telegram.me/share/url?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2015%ef%bc%9a%e3%81%84%e3%82%8d%e3%81%84%e3%82%8d%e3%81%aa%e4%bb%95%e6%8e%9b%e3%81%91%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%97%e3%82%88%e3%81%86%ef%bc%81&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_15%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

    
    
    
  </header> 
<figure class="entry-cover"><img loading="lazy" src="https://www.peanuts-code.com/images/tutorials/gd0005_platformer/platformer_15/img42.gif" alt="プラットフォーマー Part 15 サムネイル">
        
</figure><div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目次</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%8b%95%e3%81%8f%e5%ba%8a" aria-label="動く床">動く床</a><ul>
                        
                <li>
                    <a href="#%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e6%88%90%e3%81%99%e3%82%8b" aria-label="シーンを作成する">シーンを作成する</a></li>
                <li>
                    <a href="#%e3%83%8e%e3%83%bc%e3%83%89%e3%81%ae%e3%83%97%e3%83%ad%e3%83%91%e3%83%86%e3%82%a3%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b" aria-label="ノードのプロパティを編集する">ノードのプロパティを編集する</a><ul>
                        
                <li>
                    <a href="#path2d-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="Path2D ノード">Path2D ノード</a></li>
                <li>
                    <a href="#pathfollow2d-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="PathFollow2D ノード">PathFollow2D ノード</a></li>
                <li>
                    <a href="#animatedsprite-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="AnimatedSprite ノード">AnimatedSprite ノード</a></li>
                <li>
                    <a href="#animationplayer-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="AnimationPlayer ノード">AnimationPlayer ノード</a></li></ul>
                </li>
                <li>
                    <a href="#%e3%83%81%e3%82%a7%e3%83%bc%e3%83%b3%e3%81%ae%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e6%88%90%e3%81%99%e3%82%8b" aria-label="チェーンのシーンを作成する">チェーンのシーンを作成する</a></li>
                <li>
                    <a href="#%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%82%92%e3%82%a2%e3%82%bf%e3%83%83%e3%83%81%e3%81%97%e3%81%a6%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b" aria-label="スクリプトをアタッチして編集する">スクリプトをアタッチして編集する</a></li>
                <li>
                    <a href="#level3-%e3%82%b7%e3%83%bc%e3%83%b3%e3%81%ab%e3%82%a4%e3%83%b3%e3%82%b9%e3%82%bf%e3%83%b3%e3%82%b9%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b" aria-label="Level3 シーンにインスタンスを追加する">Level3 シーンにインスタンスを追加する</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%90%bd%e3%81%a1%e3%82%8b%e5%ba%8a" aria-label="落ちる床">落ちる床</a><ul>
                        
                <li>
                    <a href="#%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e6%88%90%e3%81%99%e3%82%8b-1" aria-label="シーンを作成する">シーンを作成する</a></li>
                <li>
                    <a href="#%e3%83%8e%e3%83%bc%e3%83%89%e3%81%ae%e3%83%97%e3%83%ad%e3%83%91%e3%83%86%e3%82%a3%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b-1" aria-label="ノードのプロパティを編集する">ノードのプロパティを編集する</a><ul>
                        
                <li>
                    <a href="#animatedsprite-%e3%83%8e%e3%83%bc%e3%83%89-1" aria-label="AnimatedSprite ノード">AnimatedSprite ノード</a></li>
                <li>
                    <a href="#bodycollision-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="BodyCollision ノード">BodyCollision ノード</a></li>
                <li>
                    <a href="#areacollision-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="AreaCollision ノード">AreaCollision ノード</a></li>
                <li>
                    <a href="#animationplayer-%e3%83%8e%e3%83%bc%e3%83%89-1" aria-label="AnimationPlayer ノード">AnimationPlayer ノード</a></li>
                <li>
                    <a href="#timer-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="Timer ノード">Timer ノード</a></li></ul>
                </li>
                <li>
                    <a href="#%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%82%92%e3%82%a2%e3%82%bf%e3%83%83%e3%83%81%e3%81%97%e3%81%a6%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b-1" aria-label="スクリプトをアタッチして編集する">スクリプトをアタッチして編集する</a></li>
                <li>
                    <a href="#level3-%e3%82%b7%e3%83%bc%e3%83%b3%e3%81%ab%e3%82%a4%e3%83%b3%e3%82%b9%e3%82%bf%e3%83%b3%e3%82%b9%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b-1" aria-label="Level3 シーンにインスタンスを追加する">Level3 シーンにインスタンスを追加する</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%ab%98%e3%81%8f%e9%a3%9b%e3%81%b9%e3%82%8b%e5%ba%8a" aria-label="高く飛べる床">高く飛べる床</a><ul>
                        
                <li>
                    <a href="#%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e6%88%90%e3%81%99%e3%82%8b-2" aria-label="シーンを作成する">シーンを作成する</a></li>
                <li>
                    <a href="#%e3%83%8e%e3%83%bc%e3%83%89%e3%81%ae%e3%83%97%e3%83%ad%e3%83%91%e3%83%86%e3%82%a3%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b-2" aria-label="ノードのプロパティを編集する">ノードのプロパティを編集する</a><ul>
                        
                <li>
                    <a href="#animatedsprite-%e3%83%8e%e3%83%bc%e3%83%89-2" aria-label="AnimatedSprite ノード">AnimatedSprite ノード</a></li>
                <li>
                    <a href="#bodycollision-%e3%83%8e%e3%83%bc%e3%83%89-1" aria-label="BodyCollision ノード">BodyCollision ノード</a></li>
                <li>
                    <a href="#areacollision-%e3%83%8e%e3%83%bc%e3%83%89-1" aria-label="AreaCollision ノード">AreaCollision ノード</a></li></ul>
                </li>
                <li>
                    <a href="#%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%82%92%e3%82%a2%e3%82%bf%e3%83%83%e3%83%81%e3%81%97%e3%81%a6%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b-2" aria-label="スクリプトをアタッチして編集する">スクリプトをアタッチして編集する</a></li>
                <li>
                    <a href="#level3-%e3%82%b7%e3%83%bc%e3%83%b3%e3%81%ab%e3%82%a4%e3%83%b3%e3%82%b9%e3%82%bf%e3%83%b3%e3%82%b9%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b-2" aria-label="Level3 シーンにインスタンスを追加する">Level3 シーンにインスタンスを追加する</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%81%ab%e3%81%8c%e5%87%ba%e3%82%8b%e8%a3%85%e7%bd%ae" aria-label="火が出る装置">火が出る装置</a><ul>
                        
                <li>
                    <a href="#%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e6%88%90%e3%81%99%e3%82%8b-3" aria-label="シーンを作成する">シーンを作成する</a></li>
                <li>
                    <a href="#%e3%83%8e%e3%83%bc%e3%83%89%e3%81%ae%e3%83%97%e3%83%ad%e3%83%91%e3%83%86%e3%82%a3%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b-3" aria-label="ノードのプロパティを編集する">ノードのプロパティを編集する</a><ul>
                        
                <li>
                    <a href="#animatedsprite-%e3%83%8e%e3%83%bc%e3%83%89-3" aria-label="AnimatedSprite ノード">AnimatedSprite ノード</a></li>
                <li>
                    <a href="#bodycollision-%e3%83%8e%e3%83%bc%e3%83%89-2" aria-label="BodyCollision ノード">BodyCollision ノード</a></li>
                <li>
                    <a href="#areacollision-%e3%83%8e%e3%83%bc%e3%83%89-2" aria-label="AreaCollision ノード">AreaCollision ノード</a></li>
                <li>
                    <a href="#timer-%e3%83%8e%e3%83%bc%e3%83%89-1" aria-label="Timer ノード">Timer ノード</a></li></ul>
                </li>
                <li>
                    <a href="#%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%82%92%e3%82%a2%e3%82%bf%e3%83%83%e3%83%81%e3%81%97%e3%81%a6%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b-3" aria-label="スクリプトをアタッチして編集する">スクリプトをアタッチして編集する</a></li>
                <li>
                    <a href="#level3-%e3%82%b7%e3%83%bc%e3%83%b3%e3%81%ab%e3%82%a4%e3%83%b3%e3%82%b9%e3%82%bf%e3%83%b3%e3%82%b9%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b-3" aria-label="Level3 シーンにインスタンスを追加する">Level3 シーンにインスタンスを追加する</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%a3%9b%e3%82%93%e3%81%a7%e3%81%8f%e3%82%8b%e9%89%84%e7%90%83" aria-label="飛んでくる鉄球">飛んでくる鉄球</a><ul>
                        
                <li>
                    <a href="#%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e6%88%90%e3%81%99%e3%82%8b-4" aria-label="シーンを作成する">シーンを作成する</a></li>
                <li>
                    <a href="#%e3%83%8e%e3%83%bc%e3%83%89%e3%81%ae%e3%83%97%e3%83%ad%e3%83%91%e3%83%86%e3%82%a3%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b-4" aria-label="ノードのプロパティを編集する">ノードのプロパティを編集する</a><ul>
                        
                <li>
                    <a href="#path2d-%e3%83%8e%e3%83%bc%e3%83%89-1" aria-label="Path2D ノード">Path2D ノード</a></li>
                <li>
                    <a href="#sprite-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="Sprite ノード">Sprite ノード</a></li>
                <li>
                    <a href="#ballcollision-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="BallCollision ノード">BallCollision ノード</a></li>
                <li>
                    <a href="#detectioncollision-%e3%83%8e%e3%83%bc%e3%83%89" aria-label="DetectionCollision ノード">DetectionCollision ノード</a></li></ul>
                </li>
                <li>
                    <a href="#%e3%83%81%e3%82%a7%e3%83%bc%e3%83%b3%e3%81%ae%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e6%88%90%e3%81%99%e3%82%8b-1" aria-label="チェーンのシーンを作成する">チェーンのシーンを作成する</a></li>
                <li>
                    <a href="#%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%82%92%e3%82%a2%e3%82%bf%e3%83%83%e3%83%81%e3%81%97%e3%81%a6%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b-4" aria-label="スクリプトをアタッチして編集する">スクリプトをアタッチして編集する</a></li>
                <li>
                    <a href="#level3-%e3%82%b7%e3%83%bc%e3%83%b3%e3%81%ab%e3%82%a4%e3%83%b3%e3%82%b9%e3%82%bf%e3%83%b3%e3%82%b9%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b-4" aria-label="Level3 シーンにインスタンスを追加する">Level3 シーンにインスタンスを追加する</a></li></ul>
                </li>
                <li>
                    <a href="#level3-%e3%81%ae%e3%83%ac%e3%83%99%e3%83%ab%e3%83%87%e3%82%b6%e3%82%a4%e3%83%b3%e3%82%92%e3%81%99%e3%82%8b" aria-label="Level3 のレベルデザインをする">Level3 のレベルデザインをする</a></li>
                <li>
                    <a href="#part-15-%e3%81%a7%e7%b7%a8%e9%9b%86%e3%81%97%e3%81%9f%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%81%ae%e3%82%b3%e3%83%bc%e3%83%89" aria-label="Part 15 で編集したスクリプトのコード">Part 15 で編集したスクリプトのコード</a></li>
                <li>
                    <a href="#%e3%81%8a%e3%82%8f%e3%82%8a%e3%81%ab" aria-label="おわりに">おわりに</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>第15回目の今回はいよいよこのチュートリアルのシリーズの最終回だ。最終回はプラットフォーマーのレベルデザインに比較的よく使われるいくつかの仕掛けを追加していく。具体的には以下にリストアップしたトラップやギミックの類だ。</p>
<ul>
<li>動く床</li>
<li>落ちる床</li>
<li>高く飛べる床</li>
<li>火が出る装置</li>
<li>飛んでくる鉄球</li>
</ul>
<p>今回は Part 1 でインポート済みのアセットからたくさんのスプライトシートを利用する。例によって、見た目にブラーがかかっている（ピクセルアート特有のエッジが効いた画像ではない）場合は、ファイルシステム上で利用するアセットファイルを選択し、インポートドックから「プリセット」＞「2D Pixel」を選択し、「再インポート」をクリックして修正しよう。</p>
<blockquote>
<p><em><strong><span style="color:salmon">Memo：</span>
</strong><br>
過去のシリーズをまだご覧になっていない方は、そちらを先にご覧いただくことをおすすめします。<br>
<a href="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/" title="Godot で作るプラットフォーマー">Godot で作るプラットフォーマー</a>
</em></p>
</blockquote>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="動く床">動く床<a hidden class="anchor" aria-hidden="true" href="#動く床">#</a></h1>
<p>名前の通り、プレイヤーキャラクターがそこに乗っているだけで移動できる、動く床を作成する。日本語で『床』としたが、英語でいうところのプラットフォームだ。まさにプラットフォーマーというジャンルに相応しい定番の仕掛けである。</p>
<br>
<h2 id="シーンを作成する">シーンを作成する<a hidden class="anchor" aria-hidden="true" href="#シーンを作成する">#</a></h2>
<ol>
<li>「Node2D」をルートノードにして新規でシーンを作成する。</li>
<li>ルートノードの名前は「MovingPlatform」とする。</li>
<li>ファイルパスを「res://Traps/MovingPlatform/MovingPlatform.tscn」として保存する。</li>
<li>次に、以下のスクリーンショットと同じシーンツリーになるように、必要なノードを追加する。なお、ノードの名前変更はルートノード以外必要ない。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img1.png" alt="MovingPlatformのシーンツリー"  />
</li>
</ol>
<br>
<h2 id="ノードのプロパティを編集する">ノードのプロパティを編集する<a hidden class="anchor" aria-hidden="true" href="#ノードのプロパティを編集する">#</a></h2>
<p>シーンツリーに追加したノードうち、いくつかのプロパティを編集していこう。<br>
<br></p>
<h3 id="path2d-ノード">Path2D ノード<a hidden class="anchor" aria-hidden="true" href="#path2d-ノード">#</a></h3>
<p>このノードは、動く床の経路となるパスを作成する。ここではひとまず雛形としてシンプルな直線のパスを作成するが、インスタンス化した先のシーンでパスの形状は編集可能だ。</p>
<ol>
<li>インスペクターで「Resource」＞「Local To Scene」にチェックを入れてオンにする。</li>
<li>シーンツリードックで「Path2D」が選択されている状態だと、2D ワークスペース上にパスを描画するツール（以下のスクリーンショット）が表示される。それぞれのアイコンにカーソルを合わせると説明が見れるので確認しておこう。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img2.png" alt="パス描画ツール"  />
</li>
<li>2D ワークスペース上に点を2つ以上打つことでパスを描いていく。左から3番目の「+」のついたアイコンをクリックして点を追加しよう。点は(0, 0)と、もう一つ真っ直ぐ上の適当な場所、(0, -128)あたりに打っておこう。これで縦に真っ直ぐのパスができたはずだ。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img3.png" alt="Path2Dの2Dワークスペース"  />
</li>
</ol>
<br>
<blockquote>
<p><em><strong><span style="color:salmon">公式オンラインドキュメント:</span>
</strong><br>
<a href="https://docs.godotengine.org/ja/stable/tutorials/math/beziers_and_curves.html" target="_blank">ベジェ、曲線、パス</a>
<br>
<a href="https://docs.godotengine.org/ja/stable/classes/class_path2d.html" target="_blank">Path2D</a>
<br>
<a href="https://docs.godotengine.org/ja/stable/classes/class_curve2d.html#class-curve2d" target="_blank">Curve2D</a>
</em></p>
</blockquote>
<br>
<h3 id="pathfollow2d-ノード">PathFollow2D ノード<a hidden class="anchor" aria-hidden="true" href="#pathfollow2d-ノード">#</a></h3>
<p>このノードは、親である「Path2D」ノードのパスを経路として、それに沿って子ノード（ここでは「KinematicBody2D」）を移動させる役割をする。経路に沿った移動に関わるプロパティについて少し解説しておく。</p>
<p>「Offset」プロパティでピクセル単位の値でパスの原点からの距離を指定するか、「Unit Offset」プロパティで原点からの距離を割合（0 ~ 1）で指定することで、経路上の位置を決めることができる。この位置を常に変化させることで、経路上をオブジェクトが移動する動きを作ることができるわけだ。この位置の変化はのちほど「AnimationPlayer」ノードのアニメーションとスクリプトで制御するので、ここで今直接編集する必要はない。</p>
<p>「Rotate」プロパティをオフにしておく。インスペクターで唯一変更するプロパティだ。</p>
<p>パスが y 軸に対して平行な直線ではない場合に、パスをたどるオブジェクト（ここでは動く床）の向きもデフォルトでは回転するが、このプロパティをオフにすることで固定できる。床がパスの角度に合わせて回転してしまうと、プレイヤーキャラクターはそこに乗っていられなくなる（敢えてそういうトラップとしてオンにしておくのもアイデアだが）。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img4.png" alt="PathFollow2Dのプロパティ編集"  />
</p>
<br>
<blockquote>
<p><em><strong><span style="color:salmon">公式オンラインドキュメント:</span>
</strong><br>
<a href="https://docs.godotengine.org/ja/stable/classes/class_pathfollow2d.html#class-pathfollow2d" target="_blank">PathFollow2D</a>
</em></p>
</blockquote>
<br>
<h3 id="animatedsprite-ノード">AnimatedSprite ノード<a hidden class="anchor" aria-hidden="true" href="#animatedsprite-ノード">#</a></h3>
<p>親の「KinematicBody2D」ノードに「SpriteFrames」リソースを適用して見た目（テクスチャ）を作る。</p>
<ol>
<li>インスペクタードックで「Frames」プロパティに「新規 SpriteFrames」リソースを割り当てる。</li>
<li>スプライトフレームパネルで以下のアニメーションを作成する。</li>
</ol>
<ul>
<li>
<p>アニメーション名: off</p>
<ul>
<li>速度: 1 FPS</li>
<li>ループ: オフ</li>
<li>アニメーションフレームリソース: res://Assets/Traps/Platforms/Brown Off.png<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img5.png" alt="AnimatedSpriteのアニメーション編集"  />
</li>
</ul>
</li>
<li>
<p>アニメーション名: on</p>
<ul>
<li>速度: 16 FPS</li>
<li>ループ: オン</li>
<li>アニメーションフレームリソース: res://Assets/Traps/Platforms/Brown On (32x8).png<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img6.png" alt="AnimatedSpriteのアニメーション編集"  />
</li>
</ul>
</li>
</ul>
<br>
<h3 id="animationplayer-ノード">AnimationPlayer ノード<a hidden class="anchor" aria-hidden="true" href="#animationplayer-ノード">#</a></h3>
<p>このノードは重要だ。いつものような楽しい演出としての使用ではなく、このノードによって「PathFollow2D」ノードの「Unit Offset」プロパティの値を徐々に変更することで、「KinematicBody2D」が「Path2D」の経路を辿るようにする。</p>
<ol>
<li>アニメーションパネルで以下の内容のアニメーションを新規作成する</li>
</ol>
<ul>
<li>アニメーション名: move</li>
<li>読み込み後自動再生: オン</li>
<li>アニメーションの長さ(秒): 4</li>
<li>リピート再生: オン</li>
<li>トラック：PathFollow2D ノード ＞ unit_offset プロパティ
<ul>
<li>Time: 0 秒 / Value: 0 / Easing: 1.00</li>
<li>Time: 2 秒 / Value: 0.99 / Easing: 1.00<br>
*<em>Value を 1 にすると経路を折り返すタイミングで一瞬弾けるような現象が生じるので 0.99 としている</em><br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img7.png" alt="AnimationPlayerのアニメーション編集"  />
</li>
</ul>
</li>
</ul>
<br>
<h2 id="チェーンのシーンを作成する">チェーンのシーンを作成する<a hidden class="anchor" aria-hidden="true" href="#チェーンのシーンを作成する">#</a></h2>
<p>次は動く床の経路がわかるように、経路に沿ってチェーンを配置したい。そこで今回はチェーンのセグメント１つ分のシーンを作成し、動く床が読み込まれた時に、スクリプトで画面上に必要な数だけチェーンをインスタンス化する方向で進める。ではシーンを作成しよう。</p>
<ol>
<li>ルートノードに「Sprite」クラスを指定して新規でシーンを作成する。</li>
<li>ルートノードの名前は「MovingPlatformChain」に変更する。</li>
<li>「MovingPlatformChain」ルートノードの「Texture」プロパティにリソース「res://Assets/Traps/Platforms/Chain.png」を適用する。</li>
<li>ファイルパスを「res://Traps/MovingPlatform/MovingPlatformChain.tscn」としてシーンを保存する。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img7.1.png" alt="MovingPlatformChain"  />
</li>
</ol>
<br>
<h2 id="スクリプトをアタッチして編集する">スクリプトをアタッチして編集する<a hidden class="anchor" aria-hidden="true" href="#スクリプトをアタッチして編集する">#</a></h2>
<p>それではスクリプトで「MovingPlatform」が読み込まれたらチェーンを表示するようにコーディングしていこう。</p>
<p>「MovingPlatform」ルートノードにスクリプトをアタッチしてほしい。この時、ファイルパスを「res://Traps/MovingPlatform/MovingPlatform.gd」としてスクリプトを作成しよう。</p>
<p>アタッチできたら、「MovingPlatform.gd」スクリプトを以下のように編集してほしい。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Node2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Path2D の参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> path <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Path2D</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># MovingPlatformChainシーンをプリロード</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> chain_scn <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://Traps/MovingPlatform/MovingPlatformChain.tscn&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ノードが読み込まれる時に実行</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	make_chain()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># チェーンを Path2D の経路に合わせて必要数インスタンス化して配置するメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> make_chain():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># Path2D のキャッシュされた点（の位置）を取得</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> points <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>curve<span style="color:#f92672">.</span>get_baked_points()
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Path2D の全てのキャッシュされた点にチェーンのインスタンスを配置</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> point <span style="color:#f92672">in</span> points:
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> chain <span style="color:#f92672">=</span> chain_scn<span style="color:#f92672">.</span>instance()
</span></span><span style="display:flex;"><span>		add_child(chain)
</span></span><span style="display:flex;"><span>		move_child(chain, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>		chain<span style="color:#f92672">.</span>z_index <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>		chain<span style="color:#f92672">.</span>position <span style="color:#f92672">=</span> point
</span></span></code></pre></div><p>「Path2D」ノードのリソース「Curve2D」クラスのメソッド<code>get_baked_points</code>で、<strong>キャッシュされた点</strong>を取得できる。このキャッシュされた点はパスを作成した時の点とは別物である。パスをゲーム画面上に描画するときに、パスの形状を複数の点に置き換えてキャッシュ（一時保存）しているのだ。ちなみに、キャッシュされた点と点の間隔は、「Bake Interval」プロパティで設定でき、値が小さいほどパスのカーブなどの形状を滑らかに描画できるが、その分コンピュータのメモリを消費するので注意が必要だ。</p>
<p>今回はこのキャッシュされた点の位置を利用して、そこにチェーンを配置するようにしたというわけだ。<br>
<br></p>
<blockquote>
<p><em><strong><span style="color:salmon">公式オンラインドキュメント:</span>
</strong><br>
<a href="https://docs.godotengine.org/ja/stable/classes/class_curve2d.html#class-curve2d" target="_blank">Curve2D</a>
</em></p>
</blockquote>
<br>
<h2 id="level3-シーンにインスタンスを追加する">Level3 シーンにインスタンスを追加する<a hidden class="anchor" aria-hidden="true" href="#level3-シーンにインスタンスを追加する">#</a></h2>
<p>今回のチュートリアル用に「Level3」シーンを作成しておこう。「Level1」シーンを複製（継承ではない）して、敵キャラクターやアイテムなどの不要なノードは一旦全て削除し、TileMapも簡単なものを新しく作成しよう。</p>
<p>続けて、先ほど作成した「MovingPlatformtscn」をインスタンス化して追加しよう。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img8.png" alt="Level3シーンツリー"  />
</p>
<p>以下のように確認しやすい配置にするだけでOKだ。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img9.png" alt="Level3シーン2Dワークスペース"  />
</p>
<p>「MovingPlatform」のインスタンスの「Path2D」のパスを以下の手順で編集してみよう。</p>
<ol>
<li>シーンツリードックで「MovingPlatform」を右クリックし、「編集可能な子」にチェックを入れよう。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img10.png" alt="編集可能な子にチェック"  />
</li>
<li>そのままシーンツリードックで「MovingPlatform」の子の「Path2D」ノードを選択する。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img11.png" alt="シーンツリードックでPath2Dを選択"  />
</li>
<li>インスペクターで「Curve」プロパティの「Curve2D」リソースをユニーク化する。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img12.png" alt="インスペクターでリソースをユニーク化"  />
</li>
<li>2D ワークスペースでツールバーのパス描画ツールを切り替えながらパスを編集してみよう。例えば「点を空きスペースに追加」ツールで点を追加し、「曲線を閉じる」ツールでパスの端と端を繋いで、「コントロールポイントを選ぶ」ツールで既存の点をドラッグして滑らかなカーブにしてみよう。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img13.png" alt="2Dワークスペースでパスを編集"  />
</li>
</ol>
<br>
<p>最後にシーンを実行して動作確認をしておこう。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img14.gif" alt="シーンを実行"  />
</p>
<p>床の動きが速すぎる場合は、「MovingPlatform」の子「AnimationPlayer」ノードを選択し、インスペクターで「Playback Options」＞「Speed」プロパティを編集する。遅くしたい場合は値を 1 より小さくする。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img15.png" alt="AnimationPlayerノードのPlayback Options＞Speedプロパティ"  />
</p>
<br>
<h2 id="hahahugoshortcode-s6-hbhb"><span style="color:salmon">応用： 回転ノコギリ</span>
</h2>
<p>動く床のロジックを応用して「回転ノコギリ」のトラップを作ることができる。</p>
<p>「Path2D」のパスを辿る回転するノコギリで、当たるとダメージを受ける、というトラップだ。</p>
<p>「AnimatedSprite」の「Frames」プロパティに適用する「SpriteFrames」リソースのアニメーション用アセットは「res://Assets/Traps/Saw/」にまとまっている。</p>
<p>「KinematicBody2D」の代わりに「Area2D」を使用し、そのシグナル「body_entered」をスクリプトに接続して、プレイヤーキャラクターがコリジョン形状に入ったらダメージを与えるように制御すればOKだ。</p>
<p>今回のチュートリアルでは、ボリュームの都合で詳細な解説は割愛させていただく。</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="落ちる床">落ちる床<a hidden class="anchor" aria-hidden="true" href="#落ちる床">#</a></h1>
<p>落ちる床は、プロペラで空中に浮かんでおり、プレイヤーキャラクターが飛び乗ると、そのあとすぐにグラグラして落下するという仕掛けだ。飛び乗ったあとすぐに離れないと、画面下に落下してゲームオーバーになってしまう、というのがよくある使い方だ。</p>
<br>
<h2 id="シーンを作成する-1">シーンを作成する<a hidden class="anchor" aria-hidden="true" href="#シーンを作成する-1">#</a></h2>
<ol>
<li>ルートノードに「KinematicBody2D」クラスを指定してシーンを新規作成する。このクラスを選択する理由は、スクリプトのコードにより重力を加えて落下させるためだ。</li>
<li>ルートノードの名前は「FallingPlatform」に変更する。</li>
<li>ファイルパスを「res://Traps/FallingPlatform/FallingPlatform.tscn」としてシーンを保存する。</li>
<li>以下のスクリーンショットのようなシーンツリーになるように必要なノードを追加しよう。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img16.png" alt="FallingPlatformシーンツリー"  />
<br>
なお、以下のノードはどちらも「CollisionShape2D」クラスのため、名前を変更している。
<ul>
<li>「BodyCollision」ノード</li>
<li>「AreaCollision」ノード</li>
</ul>
</li>
</ol>
<br>
<h2 id="ノードのプロパティを編集する-1">ノードのプロパティを編集する<a hidden class="anchor" aria-hidden="true" href="#ノードのプロパティを編集する-1">#</a></h2>
<h3 id="animatedsprite-ノード-1">AnimatedSprite ノード<a hidden class="anchor" aria-hidden="true" href="#animatedsprite-ノード-1">#</a></h3>
<p>このノードを編集して落ちる床のルートノードの見た目を作る。</p>
<ol>
<li>インスペクターで「Frames」プロパティに「新規 SpriteFrames」リソースを適用する。</li>
<li>スプライトフレームパネルで以下のアニメーションを作成する</li>
</ol>
<ul>
<li>アニメーション名: Off
<ul>
<li>速度: 1 FPS</li>
<li>ループ: オフ</li>
<li>アニメーションフレームリソース: res://Assets/Traps/Falling Platforms/Off.png<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img17.png" alt="SpriteFramesのoffアニメーション"  />
</li>
</ul>
</li>
<li>アニメーション名: on
<ul>
<li>速度: 16 FPS</li>
<li>ループ: オン</li>
<li>アニメーションフレームリソース: res://Assets/Traps/Falling Platforms/On (32x10).png<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img18.png" alt="SpriteFramesのonアニメーション"  />
</li>
</ul>
</li>
</ul>
<ol>
<li>インスペクターに戻って、「Animation」プロパティの値として「on」を選択する。</li>
<li>続けて「Playing」プロパティをオンにする。</li>
</ol>
<br>
<h3 id="bodycollision-ノード">BodyCollision ノード<a hidden class="anchor" aria-hidden="true" href="#bodycollision-ノード">#</a></h3>
<p>このノードを編集して、ルートノードのコリジョン形状を設定する。ルートノードは「KinematicBody2D」（つまり物理ボディ）なので、コリジョン形状を作れば、プレイヤーキャラクターがそこに乗ることができるようになる。</p>
<ol>
<li>インスペクターで「Shape」プロパティに「新規 RectangleShape2D」リソースを適用する。</li>
<li>2D ワークスペース上でコリジョン形状を、「SpriteFrames」のテクスチャの床部分に合わせて調整する。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img19.png" alt="BodyCollisionのRectangleShape2Dのコリジョン形状設定"  />
</li>
</ol>
<p>「RectangleShape2D」リソースの「Extents」プロパティは <strong>(16, 2.5)</strong> になったはずだ。</p>
<br>
<h3 id="areacollision-ノード">AreaCollision ノード<a hidden class="anchor" aria-hidden="true" href="#areacollision-ノード">#</a></h3>
<p>このノードは、プレイヤーキャラクターが落ちる床に乗ったことを検知するために、親ノードの「Area2D」にコリジョン形状をを提供する。プレイヤーキャラクターの足が床に接したことを検知したいので、床のすぐ上に 1 px 程度の浅いコリジョン形状を配置する必要がある。なお、作業手順は先の「BodyCollision」ノードと同様だ。</p>
<ol>
<li>インスペクターで「Shape」プロパティに「新規 RectangleShape2D」リソースを適用する。</li>
<li>2D ワークスペース上でコリジョン形状を、床部分の上に乗せるような形で調整する。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img20.png" alt="AreaCollisionのRectangleShape2Dのコリジョン形状設定"  />
</li>
</ol>
<p>「RectangleShape2D」リソースの「Extents」プロパティは <strong>(15, 1)</strong> になったはずだ。</p>
<br>
<h3 id="animationplayer-ノード-1">AnimationPlayer ノード<a hidden class="anchor" aria-hidden="true" href="#animationplayer-ノード-1">#</a></h3>
<p>このノードのアニメーションで、プレイヤーキャラクターが乗った直後に落ちる床が左右にグラグラ震える演出を追加する。のちほど、このアニメーションが再生された後に床が落下するようにスクリプトで制御していく。</p>
<ol>
<li>アニメーションパネルを開き、以下の内容で新規アニメーションを作成する。</li>
</ol>
<ul>
<li>アニメーション名: shaking</li>
<li>読み込み後、自動再生: オフ</li>
<li>アニメーションの長さ(秒): 0.4</li>
<li>アニメーションループ: オフ</li>
<li>トラック:
<ul>
<li>AnimatedSprite ノード ＞ offset プロパティ
<ul>
<li>Time: 0 / Value: (-1, 0) / Easing: 1.00</li>
<li>Time: 0.05 / Value: (1, 0) / Easing: 1.00</li>
<li>Time: 0.1 / Value: (-1, 0) / Easing: 1.00</li>
<li>Time: 0.15 / Value: (1, 0) / Easing: 1.00</li>
<li>Time: 0.2 / Value: (-1, 0) / Easing: 1.00</li>
<li>Time: 0.25 / Value: (1, 0) / Easing: 1.00</li>
<li>Time: 0.3 / Value: (-1, 0) / Easing: 1.00</li>
<li>Time: 0.35 / Value: (1, 0) / Easing: 1.00</li>
<li>Time: 0.4 / Value: (-1, 0) / Easing: 1.00</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img21.png" alt="shakingアニメーション"  />
</p>
<br>
<p>以下のGIF画像ように、一瞬震えるアニメーションになればOKだ。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img22.gif" alt="shakingアニメーションGIF"  />
</p>
<br>
<h3 id="timer-ノード">Timer ノード<a hidden class="anchor" aria-hidden="true" href="#timer-ノード">#</a></h3>
<p>このタイマーは、落下してから一定時間経過後に落ちる床のインスタンスを解放するために利用する。</p>
<ol>
<li>インスペクターで「Wait Time」プロパティの値はデフォルトの 1 秒のままにしておく。この時間が落下開始してから解放するまでの時間になる。</li>
<li>「One Shot」プロパティをオンにする。タイマーは一回しか使わない。</li>
<li>「Autostart」プロパティはオフのままだ。のちほどスクリプトでプレイヤーが床に乗ってからスタートするよう調整する。</li>
</ol>
<br>
<h2 id="スクリプトをアタッチして編集する-1">スクリプトをアタッチして編集する<a hidden class="anchor" aria-hidden="true" href="#スクリプトをアタッチして編集する-1">#</a></h2>
<p>ここからは、プレイヤーキャラクターが乗ったら落ちる床が本当に落ちるようにプログラミングしていく。ルートノード「FallingPlatform」にスクリプトをアタッチしてほしい。ファイルパスを「res://Traps/FallingPlatform/FallingPlatform.gd」として作成しよう。</p>
<p>アタッチできたら「FallingPlatform.gd」スクリプトを以下のように編集しよう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">KinematicBody2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 重力のプロパティ</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> gravity <span style="color:#f92672">=</span> <span style="color:#ae81ff">512</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 速度のプロパティ、初期値は(0, 0)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> velocity <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>()
</span></span><span style="display:flex;"><span><span style="color:#75715e"># AnimationPlayer ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> anim_player <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimationPlayer</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Timer ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> timer <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Timer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># シーンが読み込まれたら物理プロセスを停止しておく</span>
</span></span><span style="display:flex;"><span>	set_physics_process(false)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _physics_process(delta):
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 速度のy軸方向の値に重力を加算する</span>
</span></span><span style="display:flex;"><span>	velocity<span style="color:#f92672">.</span>y <span style="color:#f92672">+=</span> gravity <span style="color:#f92672">*</span> delta
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 速度に合わせて KinematicBody2D のルートノードを動かす（落下させる）</span>
</span></span><span style="display:flex;"><span>	move_and_slide(velocity, <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>UP)
</span></span></code></pre></div><p>少し解説しておくと、まず<code>_ready</code>メソッドにより、<code>set_physics_process(false)</code>が呼ばれるので、シーンが読み込まれる際に物理プロセスは停止状態になる。</p>
<p>そのため、すぐ下の<code>_physics_process</code>メソッドで、落ちる床が重力により落下するように定義しているが、これは物理プロセスが次に再開された時に初めて実行されることになる。</p>
<br>
<p>次に「Area2D」ノードのシグナル「body_entered」をスクリプトに接続する。プレイヤーキャラクターが落ちる床に乗ったら発信されるシグナルだ。接続後、追加された<code>_on_Area2D_body_entered</code>メソッドを以下のように編集しよう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e"># 物理ボディが Area2D のコリジョン形状に入った時に発信されるシグナルで呼ばれるメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Area2D_body_entered(body):
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># プレイヤーキャラクターが床に乗ったら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> body<span style="color:#f92672">.</span>name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Player&#34;</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># AnimationPlayer ノードの shaking アニメーションを再生する</span>
</span></span><span style="display:flex;"><span>		anim_player<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;shaking&#34;</span>)
</span></span></code></pre></div><br>
<p>これで落ちる床に乗ったら、「AnimationPlayer」の「shaking」アニメーションが再生されるようになった。さらに「AnimationPlayer」ノードのシグナル「animation_finished」をスクリプトに接続しよう。追加された<code>_on_AnimationPlayer_animation_finished</code>メソッドを以下のように編集してほしい。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_AnimationPlayer_animation_finished(anim_name):
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 終了したアニメーションが shaking だったら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> anim_name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;shaking&#34;</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># 物理プロセスを再開する（自動的に重力で床が落下する）</span>
</span></span><span style="display:flex;"><span>		set_physics_process(true)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># タイマーをスタートする</span>
</span></span><span style="display:flex;"><span>		timer<span style="color:#f92672">.</span>start()
</span></span></code></pre></div><p>これでアニメーション「shaking」が終了した直後、物理プロセスが再開され、重力により自動的に床が落下する。</p>
<br>
<p>最後に「Timer」ノードのシグナル「timeout」をスクリプトに接続して、<code>_on_Timer_timeout</code>メソッドを以下のように編集しよう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Timer_timeout():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># FallingPlatform ノードを解放する</span>
</span></span><span style="display:flex;"><span>	queue_free()
</span></span></code></pre></div><br>
<p>これで完全にゲームの世界から落ちる床が消える。以上でスクリプトの編集は完了だ。</p>
<br>
<h2 id="level3-シーンにインスタンスを追加する-1">Level3 シーンにインスタンスを追加する<a hidden class="anchor" aria-hidden="true" href="#level3-シーンにインスタンスを追加する-1">#</a></h2>
<p>作成した「FallingPlatform.tscn」のインスタンスを「Level3」シーンに追加し、シーンを実行して動作を確認してみよう。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img23.gif" alt="FallingPlatformインスタンス追加後Level3シーンを実行"  />
</p>
<p>問題なさそうだ。これを実際にレベルデザインする際に下に地面がないところに配置するとよりスリリングで効果的だ。</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="高く飛べる床">高く飛べる床<a hidden class="anchor" aria-hidden="true" href="#高く飛べる床">#</a></h1>
<p>次は「高く飛べる床」を作る。トランポリンやバネのような仕掛けだ。タイルマップで、これを利用しないと辿り着けないような高い位置に地面を作ると効果的だ。</p>
<br>
<h2 id="シーンを作成する-2">シーンを作成する<a hidden class="anchor" aria-hidden="true" href="#シーンを作成する-2">#</a></h2>
<ol>
<li>「StaticBody2D」クラスをルートノードにしてシーンを新規作成する。</li>
<li>ルートノードの名前を「Spring」に変更する。</li>
<li>ファイルパスを「res://Traps/Spring/Spring.tscn」としてシーンを保存する。</li>
<li>以下のスクリーンショットのようなシーンツリーになるように必要なノードを追加する。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img24.png" alt="Springシーンツリー"  />
<br>
なお、以下のノードは同じ「CollisionShape2D」クラスのためノードの名前を変更している。
<ul>
<li>「BodyCollision」ノード</li>
<li>「AreaCollision」ノード</li>
</ul>
</li>
</ol>
<br>
<h2 id="ノードのプロパティを編集する-2">ノードのプロパティを編集する<a hidden class="anchor" aria-hidden="true" href="#ノードのプロパティを編集する-2">#</a></h2>
<h3 id="animatedsprite-ノード-2">AnimatedSprite ノード<a hidden class="anchor" aria-hidden="true" href="#animatedsprite-ノード-2">#</a></h3>
<p>ルートノードの「Spring」に見た目を提供する。</p>
<ol>
<li>インスペクターで「Frames」プロパティに「新規 SpriteFrames」リソースを適用する。</li>
<li>スプライトフレームパネルで以下の２つのアニメーションを作成する。</li>
</ol>
<ul>
<li>アニメーション名: idle
<ul>
<li>速度: 1 FPS</li>
<li>ループ: オフ</li>
<li>アニメーションフレームリソース: res://Assets/Traps/Trampoline/Idle.png<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img25.png" alt="idleアニメーション"  />
</li>
</ul>
</li>
<li>アニメーション名: jump
<ul>
<li>速度: 8 FPS</li>
<li>ループ: オフ</li>
<li>アニメーションフレームリソース: res://Assets/Traps/Trampoline/Jump (28x28).png<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img26.png" alt="jumpアニメーション"  />
</li>
</ul>
</li>
</ul>
<ol>
<li>インスペクターに戻って「Animation」プロパティを「idle」に設定する。</li>
<li>「Playing」プロパティをオンに設定する。</li>
</ol>
<br>
<h3 id="bodycollision-ノード-1">BodyCollision ノード<a hidden class="anchor" aria-hidden="true" href="#bodycollision-ノード-1">#</a></h3>
<p>ルートノードにコリジョン形状を適用する。「AnimatedSprite」のテクスチャ画像の赤い台の位置に合わせてコリジョン形状を設定し、プレイヤーキャラクターがそこに乗れるようにする。</p>
<ol>
<li>インスペクターで「Shape」プロパティに「新規 RectangleShape2D」リソースを適用する。</li>
<li>2D ワークスペースで「AnimatedSprite」の「idle」のアニメーションフレームの赤い台の形に合わせてコリジョン形状を調整する。ピッタリ形を合わせた場合は「RectangleShape2D」＞「Extents」プロパティは (11.5, 2.5) になる。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img27.png" alt="jumpアニメーション"  />
</li>
</ol>
<br>
<h3 id="areacollision-ノード-1">AreaCollision ノード<a hidden class="anchor" aria-hidden="true" href="#areacollision-ノード-1">#</a></h3>
<p>このノードは、プレイヤーキャラクターが床に乗ったかどうかを検知するための親ノード「Area2D」にコリジョン形状を適用する。プレイヤーキャラクターの足を検出するため、赤い台のすぐ上に浅く配置するのがポイントだ。</p>
<ol>
<li>インスペクターで「Shape」プロパティに「新規 RectangleShape2D」リソースを適用する。</li>
<li>2D ワークスペースで、「AnimatedSprite」の「idle」のアニメーションフレームの赤い台のすぐ上の部分に浅くコリジョン形状を配置する。「RectangleShape2D」＞「Extents」プロパティは (10.5, 1.5) になる。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img28.png" alt="jumpアニメーション"  />
</li>
</ol>
<br>
<h2 id="スクリプトをアタッチして編集する-2">スクリプトをアタッチして編集する<a hidden class="anchor" aria-hidden="true" href="#スクリプトをアタッチして編集する-2">#</a></h2>
<p>ルートノード「Spring」にスクリプトをアタッチする。ファイルパスを「res://Traps/Spring/Spring.gd」として作成する。</p>
<p>スクリプトがアタッチできたら、例によってまずはプロパティから定義する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">StaticBody2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Player ノードの参照用（最初は名前のみ定義）</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> player
</span></span><span style="display:flex;"><span><span style="color:#75715e"># AnimatedSprite ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> sprite <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimatedSprite</span>
</span></span></code></pre></div><br>
<p>さてここで、プレイヤーキャラクターが「Area2D」ノードのコリジョン形状に入ったタイミング発信されるシグナルを利用したいので、「Area2D」ノードの「body_entered」シグナルを「Spring.gd」スクリプトに接続しておこう。</p>
<p>スクリプトに<code>_on_Area2D_body_entered</code>メソッドが追加されたら以下のように編集する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Area2D_body_entered(body):
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># AnimatedSpriteのアニメーションのフレームを 0 にする</span>
</span></span><span style="display:flex;"><span>	sprite<span style="color:#f92672">.</span>frame <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># Player ノードを検知したら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> body<span style="color:#f92672">.</span>name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Player&#34;</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># デバッグ用</span>
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;Player entered Spring area&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># プロパティ player に body(Playerノード)を代入</span>
</span></span><span style="display:flex;"><span>		player <span style="color:#f92672">=</span> body
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># AnimatedSpriteの jump アニメーションを再生する</span>
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;jump&#34;</span>)
</span></span></code></pre></div><p>これで、プレイヤーキャラクターが高く飛ぶ床に乗ったら、床がアニメーションするようになった。ちなみにメソッドの外で定義されている<code>player</code>プロパティに<code>body</code>を代入したのは、このメソッド以外で「Player」ノードを制御したいからだ。<br>
<br></p>
<p>では、肝心のプレイヤーを高く飛ばすためのコードを作っていこう。床のアニメーションの特定のタイミングに合わせてプレイヤーキャラクターを高く飛ばしたい。そこで「AnimatedSprite」ノードのシグナル「frame_changed」をスクリプトに接続して利用する。</p>
<p>このシグナルはアニメーションのフレームが変わるたびにシグナルが発信される。アニメーション「jump」のフレームが 1 の時に一番床が高くなるので、それを条件に<code>if</code>構文を使って、このフレームが 1 のタイミングでプレイヤーを高く飛ばそう。ではシグナルを接続して追加された<code>_on_AnimatedSprite_frame_changed</code>メソッドを以下のように編集しよう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_AnimatedSprite_frame_changed():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># AnimatedSprite のアニメーションが jump でかつフレームが 1 でかつ　player プロパティが空っぽでない場合</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> sprite<span style="color:#f92672">.</span>animation <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;jump&#34;</span> <span style="color:#f92672">and</span> sprite<span style="color:#f92672">.</span>frame <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">and</span> player <span style="color:#f92672">!=</span> null:
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># Player ノードの y 軸方向の速度をプレイヤーキャラクターのジャンプ力の2倍にする</span>
</span></span><span style="display:flex;"><span>		player<span style="color:#f92672">.</span>velocity<span style="color:#f92672">.</span>y <span style="color:#f92672">=</span> <span style="color:#f92672">-</span> player<span style="color:#f92672">.</span>jump_force <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># Player ノードのダブルジャンプを可能にする</span>
</span></span><span style="display:flex;"><span>		player<span style="color:#f92672">.</span>can_double_jump <span style="color:#f92672">=</span> true
</span></span></code></pre></div><br>
<h2 id="level3-シーンにインスタンスを追加する-2">Level3 シーンにインスタンスを追加する<a hidden class="anchor" aria-hidden="true" href="#level3-シーンにインスタンスを追加する-2">#</a></h2>
<p>作成した「Spring.tscn」のインスタンスを「Level3」シーンに追加し、シーンを実行して動作を確認してみよう。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img29.gif" alt="Springシーンのインスタンス追加後Level3シーンを実行"  />
</p>
<p>十分高く飛ばすことができた。高さを調整したい時は<code>player.velocity.y = - player.jump_force * 2</code>の最後の 2 を別の数値に変更して調整いただければと思う。これを使って、高い足場に移動するようなレベルのデザインをすると効果的だ。</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="火が出る装置">火が出る装置<a hidden class="anchor" aria-hidden="true" href="#火が出る装置">#</a></h1>
<p>踏むと足元から火が出る装置を作る。例えば、この装置を足元にずらりと並べて、どこに着地しても火が出るようなスリリングなステージを構成することができる。</p>
<br>
<h2 id="シーンを作成する-3">シーンを作成する<a hidden class="anchor" aria-hidden="true" href="#シーンを作成する-3">#</a></h2>
<ol>
<li>「StaticBody2D」クラスをルートノードにしてシーンを新規作成する。</li>
<li>ルートノードの名前は「FirePod」に変更する。</li>
<li>ファイルパスを「res://Traps/FirePod/FirePod.gd」としてシーンを保存する。</li>
<li>以下のスクリーンショットのようなシーンツリーになるように必要なノードを追加する（ほとんど落ちる床や高く飛べる床と同じ構成だ）。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img30.png" alt="FirePodシーンツリー"  />
<br>
なお、以下のノードは同じ「CollisionShape2D」クラスのため名前を変更している。
<ul>
<li>「BodyCollision」ノード</li>
<li>「AreaCollision」ノード</li>
</ul>
</li>
</ol>
<br>
<h2 id="ノードのプロパティを編集する-3">ノードのプロパティを編集する<a hidden class="anchor" aria-hidden="true" href="#ノードのプロパティを編集する-3">#</a></h2>
<h3 id="animatedsprite-ノード-3">AnimatedSprite ノード<a hidden class="anchor" aria-hidden="true" href="#animatedsprite-ノード-3">#</a></h3>
<p>ルートノードの見た目を作る。</p>
<ol>
<li>インスペクターで「Frames」プロパティに「新規 SpriteFrames」リソースを適用する。</li>
<li>スプライトフレームパネルで以下のアニメーションを作成する。</li>
</ol>
<ul>
<li>アニメーション名: hit
<ul>
<li>速度: 8 FPS</li>
<li>ループ: オフ</li>
<li>アニメーションフレームリソース: res://Assets/Traps/Fire/Hit (16x32).png<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img31.png" alt="hitアニメーション"  />
</li>
</ul>
</li>
<li>アニメーション名: off
<ul>
<li>速度: 1 FPS</li>
<li>ループ: オフ</li>
<li>アニメーションフレームリソース: res://Assets/Traps/Fire/Off.png<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img32.png" alt="offアニメーション"  />
</li>
</ul>
</li>
<li>アニメーション名: on
<ul>
<li>速度: 8 FPS</li>
<li>ループ: オン</li>
<li>アニメーションフレームリソース: res://Assets/Traps/Fire/On (16x32).png<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img33.png" alt="onアニメーション"  />
</li>
</ul>
</li>
</ul>
<ol start="3">
<li>インスペクターに戻って「Animation」プロパティで「off」を選択する。</li>
<li>「Playing」プロパティをオンにする。</li>
</ol>
<br>
<h3 id="bodycollision-ノード-2">BodyCollision ノード<a hidden class="anchor" aria-hidden="true" href="#bodycollision-ノード-2">#</a></h3>
<p>ルートノードにコリジョン形状を適用する。</p>
<ol>
<li>インスペクターで「Shape」プロパティに「新規 RectangleShape2D」リソースを適用する。</li>
<li>2D ワークスペースで、「AnimatedSprite」の「off」のアニメーションフレームの装置のサイズに合わせてコリジョン形状を調整する。ピッタリ形を合わせた場合は「RectangleShape2D」＞「Extents」プロパティは (8, 8) になる。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img34.png" alt="jumpアニメーション"  />
</li>
</ol>
<br>
<h3 id="areacollision-ノード-2">AreaCollision ノード<a hidden class="anchor" aria-hidden="true" href="#areacollision-ノード-2">#</a></h3>
<p>このノードは、以下の２つを検知するために親ノードの「Area2D」にコリジョン形状を適用する。</p>
<ul>
<li>プレイヤーキャラクターが装置の上に乗ったこと</li>
<li>火が出た時にプレイヤーキャラクターが火に当たったこと</li>
</ul>
<p>いずれもプレイヤーキャラクターの足を検出する必要があるため、装置のすぐ上にコリジョン形状を配置する。</p>
<ol>
<li>インスペクターで「Shape」プロパティに「新規 RectangleShape2D」リソースを適用する。</li>
<li>2D ワークスペースで、「AnimatedSprite」の「off」アニメーションフレームの装置のすぐ上の部分にコリジョン形状を配置する。「RectangleShape2D」＞「Extents」プロパティは (5, 3) になる。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img35.png" alt="jumpアニメーション"  />
</li>
</ol>
<br>
<h3 id="timer-ノード-1">Timer ノード<a hidden class="anchor" aria-hidden="true" href="#timer-ノード-1">#</a></h3>
<p>火が出る装置の火が出ている時間はこのノードのタイマーで管理する。</p>
<ol>
<li>インスペクターで「Wait Time」プロパティはデフォルトの 1 のままにしておく。火が出るのは 1 秒くらいがちょうど良いだろう。</li>
<li>「One Shot」プロパティをオンにしよう。</li>
<li>「Autostart」プロパティはデフォルトのオフのままにしておく。プレイヤーキャラクターが装置に乗ったことを検知してから火を出したいので、スクリプトでタイマーをスタートさせるようのちほどコーディングする。</li>
</ol>
<br>
<h2 id="スクリプトをアタッチして編集する-3">スクリプトをアタッチして編集する<a hidden class="anchor" aria-hidden="true" href="#スクリプトをアタッチして編集する-3">#</a></h2>
<p>ルートノード「FirePod」にスクリプトをアタッチしよう。この時、ファイルパスを「res://Traps/FirePod/FirePod.gd」として作成する。</p>
<p>なお、火が出る装置には以下の基本動作を繰り返すように制御しつつ、「on」アニメーション時に装置の上にプレイヤーキャラクターが乗っていたら（火に当たったら）ダメージを与えるように制御していく。</p>
<ol>
<li>プレイヤーキャラクターが乗った時に「Area2D」のシグナル発信</li>
<li>シグナルをトリガーに「off」アニメーションを「hit」アニメーションに切り替え</li>
<li>「hit」アニメーションが終了した時に「AnimatedSprite」のシグナル発信</li>
<li>シグナルをトリガーに「on」アニメーションに切り替え</li>
<li>「on」アニメーション開始時に「Timer」のタイマー開始</li>
<li>タイムアウトした時に「Timer」のシグナル発信</li>
<li>シグナルをトリガーに「off」アニメーションに戻る</li>
</ol>
<p>アタッチできたら、さっそく「FirePod.gd」スクリプトを編集していこう。まずはプロパティから定義する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">StaticBody2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># プレイヤーキャラクターが受けるダメージ</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> damage: <span style="color:#a6e22e">float</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">20.0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># AnimatedSprite ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> sprite <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimatedSprite</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># AreaCollision ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> area_collision <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Area2D</span><span style="color:#f92672">/</span>AreaCollision
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Timer ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> timer <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Timer</span>
</span></span></code></pre></div><br>
<p>続いて「Area2D」のシグナル「body_entered」を「FirePod.gd」スクリプトに接続しよう。</p>
<p>接続できたら、追加された<code>_on_Area2D_body_entered</code>メソッドを編集する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e"># Area2D ノードが物理ボディを検知した時に発信されるシグナルで呼ばれるメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Area2D_body_entered(body):
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># プレイヤーキャラクターが乗ったら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> body<span style="color:#f92672">.</span>name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Player&#34;</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># AnimatedSprite ノードのアニメーションが現在「off」の場合</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> sprite<span style="color:#f92672">.</span>animation <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;off&#34;</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># デバッグ用</span>
</span></span><span style="display:flex;"><span>			print(<span style="color:#e6db74">&#34;Player entered when FirePod off.&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># アニメーション「hit」を再生する</span>
</span></span><span style="display:flex;"><span>			sprite<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;hit&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># AreaCollision ノードの Disabled プロパティをオン（衝突判定を無効）にする</span>
</span></span><span style="display:flex;"><span>			area_collision<span style="color:#f92672">.</span>set_deferred(<span style="color:#e6db74">&#34;disabled&#34;</span>, true)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># AnimatedSprite ノードのアニメーションが現在「on」の場合</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">elif</span> sprite<span style="color:#f92672">.</span>animation <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;on&#34;</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># デバッグ用</span>
</span></span><span style="display:flex;"><span>			print(<span style="color:#e6db74">&#34;Player entered when FirePod on.&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># Player ノードの「enemy_hit」シグナルを引数にダメージを渡して発信</span>
</span></span><span style="display:flex;"><span>			body<span style="color:#f92672">.</span>emit_signal(<span style="color:#e6db74">&#34;enemy_hit&#34;</span>, damage)
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># Player ノードの　AnimatedSprite ノードのアニメーション「hit」を再生する</span>
</span></span><span style="display:flex;"><span>			body<span style="color:#f92672">.</span>sprite<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;hit&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#75715e"># Player ノードの DamageSFX ノードのサウンド（ダメージの効果音）を再生する</span>
</span></span><span style="display:flex;"><span>			body<span style="color:#f92672">.</span>damage_sfx<span style="color:#f92672">.</span>play()
</span></span></code></pre></div><br>
<p>次は「AnimatedSprite」ノードのアニメーションが終了した時に発信されるシグナル「animation_finished」をスクリプトに接続しよう。追加されたメソッド<code>_on_AnimatedSprite_animation_finished</code>を以下のように編集する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_AnimatedSprite_animation_finished():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># AnimatedSprite ノードのアニメーションが現在「hit」の場合</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> sprite<span style="color:#f92672">.</span>animation <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;hit&#34;</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># Timer ノードのタイマーをスタートさせる</span>
</span></span><span style="display:flex;"><span>		timer<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># AnimatedSprite ノードのアニメーション「on」を再生する</span>
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;on&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># AreaCollision ノードの Disabled プロパティをオフ（衝突判定を有効）に戻す</span>
</span></span><span style="display:flex;"><span>		area_collision<span style="color:#f92672">.</span>set_deferred(<span style="color:#e6db74">&#34;disabled&#34;</span>, false)
</span></span></code></pre></div><br>
<p>最後に「Timer」ノードのタイマーがタイムアウトした時に発信されるシグナル「timeout」をスクリプトに接続しよう。追加されたメソッド<code>_on_Timer_timeout</code>を以下のように編集する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Timer_timeout():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># AnimatedSprite ノードのアニメーションが現在「on」の場合</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> sprite<span style="color:#f92672">.</span>animation <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;on&#34;</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># AnimatedSprite ノードのアニメーション「off」を再生する</span>
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;off&#34;</span>)
</span></span></code></pre></div><br>
<p>以上で「FirePod.gd」スクリプトのコーディングは完了だ。</p>
<br>
<h2 id="level3-シーンにインスタンスを追加する-3">Level3 シーンにインスタンスを追加する<a hidden class="anchor" aria-hidden="true" href="#level3-シーンにインスタンスを追加する-3">#</a></h2>
<p>作成した「FirePod.tscn」のインスタンスを「Level3」シーンに追加しよう。今回は5、6個のインスタンスをずらりと並べてその上にアイテムボックスを置いてみた。ダメージ判定も確認したいので<strong>プロジェクト</strong>を実行して動作を確認してみよう。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img36.gif" alt="Level3にFirePodインスタンス追加後プロジェクトを実行"  />
</p>
<p>概ね想定通りの挙動だ。実際にレベルデザインでも、この火が出る装置を連続的に複数並べると効果的だ。走り抜けたら何も怖くない装置だが、途中にアイテムボックスの誘惑を用意しておくと、このトラップの効果が発揮されるだろう。</p>
<br>
<h2 id="hahahugoshortcode-s10-hbhb"><span style="color:salmon">応用: スパイク</span>
</h2>
<p>もっと簡単なトラップとして、プラットフォーマーでよく用いられるのが、刺さると痛いスパイク（トゲ）だ。アニメーションも必要もないので、今回の火の当たり判定の部分を応用すれば簡単にシーンを作成できるだろう。</p>
<p>シーンツリーは、ルートノードを「Area2D」にして、それに「Sprite」と「CollisionShape2D」を追加するだけで済むはずだ。「Sprite」ノードの「Texture」プロパティには「res://Assets/Traps/Spikes/Idle.png」のリソースファイルを適用すると良いだろう。</p>
<p>詳細な説明は、このチュートリアルのボリュームの関係で割愛させていただく。</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="飛んでくる鉄球">飛んでくる鉄球<a hidden class="anchor" aria-hidden="true" href="#飛んでくる鉄球">#</a></h1>
<p>今回のチュートリアルではこれが最後の仕掛けになる。難易度も一番高いので頑張ろう。レベル上の任意の場所にチェーンで繋がれたトゲトゲの鉄球だ。仕様としては以下の通りだ。</p>
<ol>
<li>鉄球にプレイヤーキャラクターが一定距離まで近づくとプレイヤーキャラクターを検知する</li>
<li>検知した時点のプレイヤーキャラクターの位置を目掛けて鉄球が飛んでくる（追尾はしない）</li>
<li>鉄球はチェーンに繋がれているので一定の距離までしか飛んでこない</li>
<li>チェーンが伸びきったら自動的に元の位置に戻る</li>
<li>元の位置に戻った時に 1 の動作を再開する</li>
<li>鉄球に当たるとプレイヤーキャラクターはダメージを受ける</li>
</ol>
<br>
<h2 id="シーンを作成する-4">シーンを作成する<a hidden class="anchor" aria-hidden="true" href="#シーンを作成する-4">#</a></h2>
<ol>
<li>「Node2D」クラスをルートノードにしてシーンを新規作成する。</li>
<li>ルートノードの名前を「SpikedBall」に変更する。</li>
<li>ファイルパスを「res://Traps/SpikedBall/SpikedBall.tscn」としてシーンを保存する。</li>
<li>以下のスクリーンショットのようなシーンツリーになるように必要なノードを追加していく。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img37.png" alt="SpikedBallシーンツリー"  />
<br>
なお、名前を変更しているノードとそのクラスは以下の通りだ。
<ul>
<li>「BallArea」ノード: 「Area2D」クラス</li>
<li>「BallCollision」ノード: 「CollisionShape2D」クラス</li>
<li>「DetectionArea」ノード: 「Area2D」クラス</li>
<li>「DetectionCollision」ノード: 「CollisionShape2D」クラス</li>
</ul>
</li>
</ol>
<p>シーンツリーはここまでに作ってきた仕掛けの要素を色々まとめたような構造になっている。動く床と同様に「Path2D」と「PathFollow2D」を利用して鉄球を移動させている。動く床では「AnimationPlayer」を利用したが、鉄球では「Tween」を利用する。また、「Area2D」ブランチは、プレイヤーキャラクターを検知する範囲を設定するためのノードで、仕組みとしては、落ちる床や火が出る装置と同様だ。</p>
<br>
<h2 id="ノードのプロパティを編集する-4">ノードのプロパティを編集する<a hidden class="anchor" aria-hidden="true" href="#ノードのプロパティを編集する-4">#</a></h2>
<br>
<h3 id="path2d-ノード-1">Path2D ノード<a hidden class="anchor" aria-hidden="true" href="#path2d-ノード-1">#</a></h3>
<p>動く床の時は 2D ワークスペースでパスを描いたが、今回はスクリプトでパスを描くことになるので、ここでは作業不要だ。</p>
<ol>
<li>インスペクターで「Resource」＞「Local To Scene」にチェックを入れてオンにする。</li>
</ol>
<br>
<h3 id="sprite-ノード">Sprite ノード<a hidden class="anchor" aria-hidden="true" href="#sprite-ノード">#</a></h3>
<p>このノードは鉄球のテクスチャ用だ。「BallArea」ノードが鉄球そのものだと考えるとわかりやすいだろう。</p>
<ol>
<li>インスペクターで「Texture」プロパティにリソース「res://Assets/Traps/Spiked Ball/Spiked Ball.png」を適用する。</li>
<li>「Offset」の値を (-0.5, -0.5) とする。ドット絵の都合でテクスチャが 1 px だけ右下に寄っているため、中央に配置するよう補正した形だ。</li>
</ol>
<br>
<h3 id="ballcollision-ノード">BallCollision ノード<a hidden class="anchor" aria-hidden="true" href="#ballcollision-ノード">#</a></h3>
<p>このノードは鉄球である「BallArea」ノードにコリジョン形状を適用する。</p>
<ol>
<li>インスペクターで「Shape」プロパティに「新規 CircleShape2D」リソースを適用する。</li>
<li>2D ワークスペースで「Sprite」のテクスチャに合わせてコリジョン形状を調整する。トゲの範囲までコリジョン形状を広げるか、内側のボール部分のみにするかで若干ゲームの難易度は変わる。このチュートリアルでは、以下のスクリーンショットのようにボール部分のみとした。「CircleShape2D」リソースのプロパティ「Radius」の値は 10 、「Custom Solver Bias」は 0 になる。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img38.png" alt="BallCollisionのコリジョン形状"  />
</li>
</ol>
<br>
<h3 id="detectioncollision-ノード">DetectionCollision ノード<a hidden class="anchor" aria-hidden="true" href="#detectioncollision-ノード">#</a></h3>
<p>こちらの「CollisionShape2D」クラスのノードは、プレイヤーキャラクターの検知用だ。いわば鉄球トラップのテリトリーと言っても良いだろう。半径 80 px の円で形成する。</p>
<ol>
<li>インスペクターで「Shape」プロパティに「新規 CircleShape2D」リソースを適用する。</li>
<li>こちらは 2D ワークスペースでは作業せず、インスペクターにそのまま半径の値を入力する。「CircleShape2D」リソースの「Radius」プロパティの値を 80 にする。「Custom Solver Bias」は 0 のまま。2D ワークスペースでは以下のスクリーンショットのようになったはずだ。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img39.png" alt="BallCollisionのコリジョン形状"  />
</li>
</ol>
<br>
<h2 id="チェーンのシーンを作成する-1">チェーンのシーンを作成する<a hidden class="anchor" aria-hidden="true" href="#チェーンのシーンを作成する-1">#</a></h2>
<p>鉄球はチェーンで地面に繋がれている。この長いチェーンを構成するチェーンのセグメントをシーンとして作成する。ちょうど動く床と同じパターンだ。</p>
<ol>
<li>ルートノードに「Sprite」クラスを指定して新規でシーンを作成する。</li>
<li>ルートノードの名前は「SpikedBallChain」に変更する。</li>
<li>「MovingPlatformChain」ルートノードの「Texture」プロパティにリソース「res://Assets/Traps/Spiked Ball/Chain.png」を適用する。</li>
<li>ファイルパスを「res://Traps/SpikedBall/SpikedBallChain.tscn」としてシーンを保存する。</li>
</ol>
<p><img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img39.1.png" alt="SpikedBallChainシーン"  />
</p>
<br>
<h2 id="スクリプトをアタッチして編集する-4">スクリプトをアタッチして編集する<a hidden class="anchor" aria-hidden="true" href="#スクリプトをアタッチして編集する-4">#</a></h2>
<p>ではスクリプトをルートノードの「SpikedBall」にアタッチしよう。ファイルパスを「res://Traps/SpikedBall/SpikedBall.gd」として作成する。</p>
<p>ここからは大まかに以下の仕様を形にしていく。</p>
<ul>
<li>鉄球のシーンが読み込まれた時にチェーンを作成する</li>
<li>「Area2D」ノードでプレイヤーキャラクターを検知して発信するシグナルをトリガーにして
<ul>
<li>「Path2D」パスを作成する</li>
<li>鉄球を移動させる</li>
</ul>
</li>
<li>鉄球の位置に合わせて常にチェーン全体の長さ（各チェーンセグメントの位置）を変化させる</li>
<li>プレイヤーキャラクターが鉄球に当たったらダメージを与える</li>
</ul>
<p>では「SpikedBall.gd」をスクリプトを編集していこう。まずはプロパティの定義からだ。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Node2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># チェーンの最大の長さ</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> chain_length <span style="color:#f92672">=</span> <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># チェーンセグメントの数</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> chain_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># プレイヤーキャラクターが受けるダメージ</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> damage <span style="color:#f92672">=</span> <span style="color:#ae81ff">20.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Path2D ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> path <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Path2D</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># PathFollow2D ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> path_follow <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Path2D</span><span style="color:#f92672">/</span><span style="color:#a6e22e">PathFollow2D</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># BallArea ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> ball_area <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Path2D</span><span style="color:#f92672">/</span><span style="color:#a6e22e">PathFollow2D</span><span style="color:#f92672">/</span>BallArea
</span></span><span style="display:flex;"><span><span style="color:#75715e"># DetectionArea ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> detection_area <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>DetectionArea
</span></span><span style="display:flex;"><span><span style="color:#75715e"># DetectionCollision ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> detection_collision <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>DetectionArea<span style="color:#f92672">/</span>DetectionCollision
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tween ノードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> tween <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Tween</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># チェーンのシーンファイルのプリロードの参照</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> chain_scn <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://Traps/SpikedBall/SpikedBallChain.tscn&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># チェーンセグメントのコンテナとして利用する配列</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> chain_container <span style="color:#f92672">=</span> []
</span></span></code></pre></div><br>
<p>次に鉄球シーンが読み込まれる際にチェーンを作成するコードを記述する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e"># シーン読み込み時に呼ばれるメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># チェーンを作成するメソッドを呼ぶ</span>
</span></span><span style="display:flex;"><span>	make_chain()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># チェーンを作成するメソッドを定義</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> make_chain():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># チェーンのセグメントの数（10）だけループ処理</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(chain_num):
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># チェーンのシーンをインスタンス化</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> chain <span style="color:#f92672">=</span> chain_scn<span style="color:#f92672">.</span>instance()
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># チェーンのインスタンスを子ノードとして SpikedBall ルートノードに追加</span>
</span></span><span style="display:flex;"><span>		add_child(chain)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># 子に追加したインスタンスノードを 0 番目に移動</span>
</span></span><span style="display:flex;"><span>		move_child(chain, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># インスタンスノードを背面に移動</span>
</span></span><span style="display:flex;"><span>		chain<span style="color:#f92672">.</span>z_index <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># チェーンセグメントのコンテナ用配列に追加</span>
</span></span><span style="display:flex;"><span>		chain_container<span style="color:#f92672">.</span>append(chain)
</span></span></code></pre></div><br>
<p>次に<code>_process</code>メソッドを利用して毎フレーム、チェーンの長さ（チェーンセグメントの個々の位置）を更新するようにする。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e"># Tips：引数 delta を使用しない時は _delta とするとアラートが出ない</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _process(_delta):
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># チェーンを再配置するメソッドを呼ぶ</span>
</span></span><span style="display:flex;"><span>	relocate_chain()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># チェーンを再配置するメソッドを定義する</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> relocate_chain():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># ルートノードの位置から現在の鉄球の位置に対する方向を取得</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> direction <span style="color:#f92672">=</span> global_position<span style="color:#f92672">.</span>direction_to(ball_area<span style="color:#f92672">.</span>global_position)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># ルートノードの位置から現在の鉄球の位置までの距離をチェーンセグメントの数で割って...</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># ...セグメント１つ分の長さを取得する</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> segment_length <span style="color:#f92672">=</span> global_position<span style="color:#f92672">.</span>distance_to(ball_area<span style="color:#f92672">.</span>global_position) <span style="color:#f92672">/</span> chain_num
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># チェーンセグメントの数（10）だけループ処理</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(chain_num <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># コンテナから順番に取り出したチェーンセグメントの位置を次の計算式で指定する...</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># ... 方向 × セグメントの長さ × コンテナの順番</span>
</span></span><span style="display:flex;"><span>		chain_container[i]<span style="color:#f92672">.</span>position <span style="color:#f92672">=</span> direction <span style="color:#f92672">*</span> segment_length <span style="color:#f92672">*</span> i
</span></span></code></pre></div><br>
<p>次に「DetectionArea」ノードのコリジョン形状の範囲にプレイヤーキャラクターが入った時の挙動を作っていく。まず「Area2D」がプレイヤーキャラクターを検知した時に発信されるシグナル「body_entered」をスクリプトに接続しよう。</p>
<p>シグナルが接続できたら、追加されたメソッド<code>_on_DetectionArea_body_entered</code>と、その中で呼ばれる２つのメソッドを記述していく。その２つのメソッドのうち、１つは「Path2D」ノードに2つの点を打って直線のパスを作成するメソッド。もう一つは「Path2D」ノードで作成されたパスの経路を辿って鉄球が移動するアニメーションを制御するメソッドだ。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e"># DetectionArea ノードのコリジョン形状に物理ボディが入った時に発信されるシグナルで呼ばれるメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_DetectionArea_body_entered(body):
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># デバッグ用</span>
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#34;_on_DetectionArea_body_entered called&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 検知した物理ボディが Player ノードだったら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> body<span style="color:#f92672">.</span>name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Player&#34;</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># Path2Dのパスを作成するメソッドを呼ぶ</span>
</span></span><span style="display:flex;"><span>		set_path_points(body)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># 鉄球をパスに沿って動かすメソッドを呼ぶ</span>
</span></span><span style="display:flex;"><span>		move_ball()
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># DetectionCollision ノードの衝突判定を無効化する</span>
</span></span><span style="display:flex;"><span>		detection_collision<span style="color:#f92672">.</span>set_deferred(<span style="color:#e6db74">&#34;disabled&#34;</span>, true)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Path2Dのパスを作成するメソッドを定義</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> set_path_points(body):
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># デバッグ用</span>
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#34;set_path_points called&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 一度 Path2D のパスの点を全て消去してリセットする</span>
</span></span><span style="display:flex;"><span>	path<span style="color:#f92672">.</span>curve<span style="color:#f92672">.</span>clear_points()
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># まず鉄球のデフォルトの位置である原点(0, 0)にパスの点を追加する</span>
</span></span><span style="display:flex;"><span>	path<span style="color:#f92672">.</span>curve<span style="color:#f92672">.</span>add_point(<span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 鉄球の現在の位置から衝突した物理ボディ（「Player」ノードのこと）に対する方向を取得</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> direction <span style="color:#f92672">=</span> global_position<span style="color:#f92672">.</span>direction_to(body<span style="color:#f92672">.</span>global_position)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 鉄球から物理ボディへの方向にチェーンの最大長を乗算した位置を鉄球がこれから目指す位置とする</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> directed_point <span style="color:#f92672">=</span> direction <span style="color:#f92672">*</span> chain_length
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 鉄球が目指す位置を Path2D ノードのパスの２つ目の点として追加する</span>
</span></span><span style="display:flex;"><span>	path<span style="color:#f92672">.</span>curve<span style="color:#f92672">.</span>add_point(directed_point)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 鉄球をパスに沿って移動させるメソッドを定義</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> move_ball():
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># デバッグ用</span>
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#34;move_ball called&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># PathFollow2D の Unit Offset プロパティを 0 から 1 へ 0.5 秒かけて変化させる Tween の設定</span>
</span></span><span style="display:flex;"><span>	tween<span style="color:#f92672">.</span>interpolate_property(path_follow, <span style="color:#e6db74">&#34;unit_offset&#34;</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0.5</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># Tween ノードのアニメーションを開始する</span>
</span></span><span style="display:flex;"><span>	tween<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># Tween ノードの tween_completed を利用してアニメーション（移動）が終わるのを待つ</span>
</span></span><span style="display:flex;"><span>	yield(tween,<span style="color:#e6db74">&#34;tween_completed&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># PathFollow2D の Unit Offset プロパティを 1 から 0 へ 1 秒かけて変化させる Tween の設定</span>
</span></span><span style="display:flex;"><span>	tween<span style="color:#f92672">.</span>interpolate_property(path_follow, <span style="color:#e6db74">&#34;unit_offset&#34;</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Tween ノードのアニメーションを開始する</span>
</span></span><span style="display:flex;"><span>	tween<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># アニメーション（移動）が終わるのを待つ</span>
</span></span><span style="display:flex;"><span>	yield(tween,<span style="color:#e6db74">&#34;tween_completed&#34;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># DetectionCollision ノードの衝突判定を有効化する</span>
</span></span><span style="display:flex;"><span>	detection_collision<span style="color:#f92672">.</span>set_deferred(<span style="color:#e6db74">&#34;disabled&#34;</span>, false)
</span></span></code></pre></div><p>改めて解説すると、メソッド<code>set_path_points</code>は、「Path2D」ノードに原点 (0, 0) とプレイヤーキャラクターを検知した位置の２つの点を追加して直線のパスを作る。次にメソッド<code>move_ball</code>で、そのパスの両端を「Tween」ノードを利用して鉄球が行って戻ってくる動作を処理している。<br>
<br></p>
<p>最後に鉄球にプレイヤーキャラクターが当たった時のダメージ処理をコーディングする。まず先に、鉄球「BallArea」ノードのコリジョン形状にプレイヤーキャラクターが入った時に発信されるシグナル「body_entered」をスクリプトに接続しよう。</p>
<p>接続できたら、追加された<code>_on_BallArea_body_entered</code>メソッドを以下のように編集する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e"># BodyArea に物理ボディが入った時に呼ばれるメソッド</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_BallArea_body_entered(body):
</span></span><span style="display:flex;"><span>	<span style="color:#75715e"># 物理ボディが Player ノードだったら</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> body<span style="color:#f92672">.</span>name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Player&#34;</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># Player ノードのシグナル「enemy_hit」を引数にダメージを渡して発信</span>
</span></span><span style="display:flex;"><span>		body<span style="color:#f92672">.</span>emit_signal(<span style="color:#e6db74">&#34;enemy_hit&#34;</span>, damage)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># Player シーンの AnimatedSprite ノードのアニメーション「hit」を再生</span>
</span></span><span style="display:flex;"><span>		body<span style="color:#f92672">.</span>sprite<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;hit&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># Player シーンの DamageSFX ノードのサウンド（効果音）を再生する</span>
</span></span><span style="display:flex;"><span>		body<span style="color:#f92672">.</span>damage_sfx<span style="color:#f92672">.</span>play()
</span></span></code></pre></div><br>
<p>これで飛んでくる鉄球のコーディングは完了だ。</p>
<br>
<h2 id="level3-シーンにインスタンスを追加する-4">Level3 シーンにインスタンスを追加する<a hidden class="anchor" aria-hidden="true" href="#level3-シーンにインスタンスを追加する-4">#</a></h2>
<p>出来上がった飛んでくる鉄球のシーン「Spikes.tscn」のインスタンスを「Level3」シーンに追加して動作確認してみよう。今回もダメージ判定を含めて確認するため、<strong>プロジェクトを実行</strong>しよう。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img40.gif" alt="飛んでくる鉄球の動作確認でプロジェクトを実行"  />
</p>
<p>ちょうどうまく操作すればかわせる程度のスピードで鉄球が飛んでくるように調整できた。チェーンが最大長まで伸びきったら鉄球は元の位置に戻る。飛んでくる時は0.5秒で移動するが、戻るときは1秒かかる。この辺りも丁度良い塩梅になったのではないだろうか。<br>
<br></p>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="level3-のレベルデザインをする">Level3 のレベルデザインをする<a hidden class="anchor" aria-hidden="true" href="#level3-のレベルデザインをする">#</a></h1>
<p>ここまでに作った装置を全て使用して「Level3」シーンをデザインしてみよう。</p>
<p>「MovingPlatform」のインスタンスを追加した時は、そのノードを右クリックして「編集可能な子」にして「Path2D」のパスの形も色々作ってみよう。ただし、その前に「Curve」プロパティの「Curve2D」リソースを<strong>ユニーク化</strong>することをお忘れなく。</p>
<p>また、応用編として紹介した回転ノコギリやスパイクのシーンも作成している場合は、それらのインスタンスも追加しよう。</p>
<p>このチュートリアルではサンプルとして以下のようなデザインにした。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img41.png" alt="飛んでくる鉄球の動作確認でプロジェクトを実行"  />
</p>
<br>
<p>タイルマップのデザインや今回作ったそれぞれの装置の配置をして「Level3」のデザインが完成したら、プロジェクトを実行してゲームを遊んでみよう。<br>
<img loading="lazy" src="/images/tutorials/gd0005_platformer/platformer_15/img42.gif" alt="Level3シーンを完成させてプロジェクトを実行"  />
</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="part-15-で編集したスクリプトのコード">Part 15 で編集したスクリプトのコード<a hidden class="anchor" aria-hidden="true" href="#part-15-で編集したスクリプトのコード">#</a></h1>
<p>最後に今回の Part 15 で編集したスクリプトのコードを共有しておくので、必要に応じて確認してほしい。</p>
<details>
<summary>.MovingPlatform.gd の全コード</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Node2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> path <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Path2D</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> chain_scn <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://Traps/MovingPlatform/MovingPlatformChain.tscn&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	make_chain()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> make_chain():
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> points <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>curve<span style="color:#f92672">.</span>get_baked_points()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> point <span style="color:#f92672">in</span> points:
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> chain <span style="color:#f92672">=</span> chain_scn<span style="color:#f92672">.</span>instance()
</span></span><span style="display:flex;"><span>		add_child(chain)
</span></span><span style="display:flex;"><span>		move_child(chain, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>		chain<span style="color:#f92672">.</span>z_index <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>		chain<span style="color:#f92672">.</span>position <span style="color:#f92672">=</span> point
</span></span></code></pre></div></details>
<br>
<details>
<summary>FallingPlatform.gd の全コード</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">KinematicBody2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> gravity <span style="color:#f92672">=</span> <span style="color:#ae81ff">512</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> velocity <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> anim_player <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimationPlayer</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> timer <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Timer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	set_physics_process(false)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _physics_process(delta):
</span></span><span style="display:flex;"><span>	velocity<span style="color:#f92672">.</span>y <span style="color:#f92672">+=</span> gravity <span style="color:#f92672">*</span> delta
</span></span><span style="display:flex;"><span>	move_and_slide(velocity, <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>UP)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Area2D_body_entered(body):
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> body<span style="color:#f92672">.</span>name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Player&#34;</span>:
</span></span><span style="display:flex;"><span>		anim_player<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;shaking&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_AnimationPlayer_animation_finished(anim_name):
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> anim_name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;shaking&#34;</span>:
</span></span><span style="display:flex;"><span>		set_physics_process(true)
</span></span><span style="display:flex;"><span>		timer<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Timer_timeout():
</span></span><span style="display:flex;"><span>	queue_free()
</span></span></code></pre></div></details>
<br>
<details>
<summary>Spring.gd の全コード</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">StaticBody2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> player
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> sprite <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimatedSprite</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Area2D_body_entered(body):
</span></span><span style="display:flex;"><span>	sprite<span style="color:#f92672">.</span>frame <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> body<span style="color:#f92672">.</span>name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Player&#34;</span>:
</span></span><span style="display:flex;"><span>		print(<span style="color:#e6db74">&#34;Player entered Spring area&#34;</span>)
</span></span><span style="display:flex;"><span>		player <span style="color:#f92672">=</span> body
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;jump&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_AnimatedSprite_frame_changed():
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> sprite<span style="color:#f92672">.</span>animation <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;jump&#34;</span> <span style="color:#f92672">and</span> sprite<span style="color:#f92672">.</span>frame <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">and</span> player <span style="color:#f92672">!=</span> null:
</span></span><span style="display:flex;"><span>		player<span style="color:#f92672">.</span>velocity<span style="color:#f92672">.</span>y <span style="color:#f92672">=</span> <span style="color:#f92672">-</span> player<span style="color:#f92672">.</span>jump_force <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>		player<span style="color:#f92672">.</span>can_double_jump <span style="color:#f92672">=</span> true
</span></span></code></pre></div></details>
<br>
<details>
<summary>FirePod.gd の全コード</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">StaticBody2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> damage: <span style="color:#a6e22e">float</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">20.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> sprite <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimatedSprite</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> area_collision <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Area2D</span><span style="color:#f92672">/</span>AreaCollision
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> timer <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Timer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Area2D_body_entered(body):
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> body<span style="color:#f92672">.</span>name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Player&#34;</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> sprite<span style="color:#f92672">.</span>animation <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;off&#34;</span>:
</span></span><span style="display:flex;"><span>			print(<span style="color:#e6db74">&#34;Player entered when FirePod off.&#34;</span>)
</span></span><span style="display:flex;"><span>			sprite<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;hit&#34;</span>)
</span></span><span style="display:flex;"><span>			area_collision<span style="color:#f92672">.</span>set_deferred(<span style="color:#e6db74">&#34;disabled&#34;</span>, true)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">elif</span> sprite<span style="color:#f92672">.</span>animation <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;on&#34;</span>:
</span></span><span style="display:flex;"><span>			print(<span style="color:#e6db74">&#34;Player entered when FirePod on.&#34;</span>)
</span></span><span style="display:flex;"><span>			body<span style="color:#f92672">.</span>emit_signal(<span style="color:#e6db74">&#34;enemy_hit&#34;</span>, damage)
</span></span><span style="display:flex;"><span>			body<span style="color:#f92672">.</span>sprite<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;hit&#34;</span>)
</span></span><span style="display:flex;"><span>			body<span style="color:#f92672">.</span>damage_sfx<span style="color:#f92672">.</span>play()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_AnimatedSprite_animation_finished():
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> sprite<span style="color:#f92672">.</span>animation <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;hit&#34;</span>:
</span></span><span style="display:flex;"><span>		timer<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;on&#34;</span>)
</span></span><span style="display:flex;"><span>		area_collision<span style="color:#f92672">.</span>set_deferred(<span style="color:#e6db74">&#34;disabled&#34;</span>, false)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_Timer_timeout():
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> sprite<span style="color:#f92672">.</span>animation <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;on&#34;</span>:
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;off&#34;</span>)
</span></span></code></pre></div></details>
<br>
<details>
<summary>SpikedBall.gd の全コード</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Node2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> chain_length <span style="color:#f92672">=</span> <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> chain_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> damage <span style="color:#f92672">=</span> <span style="color:#ae81ff">20.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> path <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Path2D</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> path_follow <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Path2D</span><span style="color:#f92672">/</span><span style="color:#a6e22e">PathFollow2D</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> ball_area <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Path2D</span><span style="color:#f92672">/</span><span style="color:#a6e22e">PathFollow2D</span><span style="color:#f92672">/</span>BallArea
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> detection_area <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>DetectionArea
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> detection_collision <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>DetectionArea<span style="color:#f92672">/</span>DetectionCollision
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> tween <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Tween</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> chain_scn <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://Traps/SpikedBall/SpikedBallChain.tscn&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> chain_container <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	make_chain()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> make_chain():
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(chain_num):
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> chain <span style="color:#f92672">=</span> chain_scn<span style="color:#f92672">.</span>instance()
</span></span><span style="display:flex;"><span>		add_child(chain)
</span></span><span style="display:flex;"><span>		move_child(chain, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>		chain<span style="color:#f92672">.</span>z_index <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>		chain_container<span style="color:#f92672">.</span>append(chain)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _process(_delta):
</span></span><span style="display:flex;"><span>	relocate_chain()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> relocate_chain():
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> direction <span style="color:#f92672">=</span> global_position<span style="color:#f92672">.</span>direction_to(ball_area<span style="color:#f92672">.</span>global_position)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> segment_length <span style="color:#f92672">=</span> global_position<span style="color:#f92672">.</span>distance_to(ball_area<span style="color:#f92672">.</span>global_position) <span style="color:#f92672">/</span> chain_num
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(chain_num <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>		chain_container[i]<span style="color:#f92672">.</span>position <span style="color:#f92672">=</span> direction <span style="color:#f92672">*</span> segment_length <span style="color:#f92672">*</span> i
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_DetectionArea_body_entered(body):
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#34;_on_DetectionArea_body_entered called&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> body<span style="color:#f92672">.</span>name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Player&#34;</span>:
</span></span><span style="display:flex;"><span>		set_path_points(body)
</span></span><span style="display:flex;"><span>		move_ball()
</span></span><span style="display:flex;"><span>		detection_collision<span style="color:#f92672">.</span>set_deferred(<span style="color:#e6db74">&#34;disabled&#34;</span>, true)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> set_path_points(body):
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#34;set_path_points called&#34;</span>)
</span></span><span style="display:flex;"><span>	path<span style="color:#f92672">.</span>curve<span style="color:#f92672">.</span>clear_points()
</span></span><span style="display:flex;"><span>	path<span style="color:#f92672">.</span>curve<span style="color:#f92672">.</span>add_point(<span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> direction <span style="color:#f92672">=</span> global_position<span style="color:#f92672">.</span>direction_to(body<span style="color:#f92672">.</span>global_position)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> directed_point <span style="color:#f92672">=</span> direction <span style="color:#f92672">*</span> chain_length
</span></span><span style="display:flex;"><span>	path<span style="color:#f92672">.</span>curve<span style="color:#f92672">.</span>add_point(directed_point)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> move_ball():
</span></span><span style="display:flex;"><span>	print(<span style="color:#e6db74">&#34;move_ball called&#34;</span>)
</span></span><span style="display:flex;"><span>	tween<span style="color:#f92672">.</span>interpolate_property(path_follow, <span style="color:#e6db74">&#34;unit_offset&#34;</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0.5</span>)
</span></span><span style="display:flex;"><span>	tween<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>	yield(tween,<span style="color:#e6db74">&#34;tween_completed&#34;</span>)
</span></span><span style="display:flex;"><span>	tween<span style="color:#f92672">.</span>interpolate_property(path_follow, <span style="color:#e6db74">&#34;unit_offset&#34;</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	tween<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>	yield(tween,<span style="color:#e6db74">&#34;tween_completed&#34;</span>)
</span></span><span style="display:flex;"><span>	detection_collision<span style="color:#f92672">.</span>set_deferred(<span style="color:#e6db74">&#34;disabled&#34;</span>, false)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_BallArea_body_entered(body):
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> body<span style="color:#f92672">.</span>name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Player&#34;</span>:
</span></span><span style="display:flex;"><span>		body<span style="color:#f92672">.</span>emit_signal(<span style="color:#e6db74">&#34;enemy_hit&#34;</span>, damage)
</span></span><span style="display:flex;"><span>		body<span style="color:#f92672">.</span>sprite<span style="color:#f92672">.</span>play(<span style="color:#e6db74">&#34;hit&#34;</span>)
</span></span><span style="display:flex;"><span>		body<span style="color:#f92672">.</span>damage_sfx<span style="color:#f92672">.</span>play()
</span></span></code></pre></div></details>
<br>
<hr>
<h1 id="おわりに">おわりに<a hidden class="anchor" aria-hidden="true" href="#おわりに">#</a></h1>
<p>以上で Part 15 は完了だ。</p>
<p>今回はステージ上の様々な仕掛けを作った。オーソドックスな仕掛けでも、タイルマップとの組み合わせ、敵キャラクターの組み合わせ、仕掛け同士の組み合わせによって、楽しく、そして難しいレベルデザインが可能になるだろう。プレイヤーにどうやって先に進めるのかを考える機会を与え、考えた結果、難しい場面を乗り越えられたときにある種の快感を提供することができるはずだ。</p>
<p>さて、今回の Part 15 にて「Godot で作るプラットフォーマー」のチュートリアルシリーズは終了だ。このシリーズを通して、プラットフォーマーのゲームを作るための基本的なところは網羅できただろう。チュートリアルを参考にしてくださった方々には感謝申し上げたい。また、このチュートリアルがこれからゲーム開発に挑戦したいと考えている方々に少しでもお役に立てたならば幸いだ。</p>
<p>ところで、面白いことに、自分でプラットフォーマーのゲームを作ってみたあと、改めて往年のスーパーマリオブラザーズシリーズなどをプレイしてみると、あらゆる部分でゲームが緻密に設計されているのがよくわかる。ジャンプひとつとっても絶妙のバランスだ。世界的にゲームが大ヒットする理由の一つはやはりゲームデザインなのだと思い知らされる。ゲームデザインは十分条件ではないが、必要条件であると言っても過言ではないだろう。</p>
<p>今後も Godot を使った別のチュートリアルシリーズや、Godot を使う上での Tips 的なブログを投稿していくので、これからも Peanuts-code.com のコンテンツをどうぞお楽しみに。</p>
<hr>


  </div>

  <footer class="post-footer">
    
    <div class="recommendation">
        <span>Twitter で新しい記事のお知らせやゲーム開発の進捗を投稿しています。<br>
お気軽にフォローしてください。</span>
      <div class="social-icons">
    <a href="https://twitter.com/MasanaoSako" target="_blank" rel="noopener noreferrer me" title="Twitter">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z">
    </path>
</svg>
    </a>
    <a href="https://github.com/msnsk/" target="_blank" rel="noopener noreferrer me" title="GitHub">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
    </a>
</div>

    </div>
    <div class="recommendation">
        <span>もしこの記事が良かったら、ぜひSNSなどでシェアしていただけると幸いです。</span>
    </div>
    
    

<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 15：いろいろな仕掛けを追加しよう！ on twitter"
        href="https://twitter.com/intent/tweet/?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2015%ef%bc%9a%e3%81%84%e3%82%8d%e3%81%84%e3%82%8d%e3%81%aa%e4%bb%95%e6%8e%9b%e3%81%91%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%97%e3%82%88%e3%81%86%ef%bc%81&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_15%2f&amp;hashtags=GodotEngine%2cGameDev%2c2D%2c%e3%82%a2%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e3%82%b2%e3%83%bc%e3%83%a0%2c%e6%a8%aa%e3%82%b9%e3%82%af%e3%83%ad%e3%83%bc%e3%83%ab%2c%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%2c%e3%83%88%e3%83%a9%e3%83%83%e3%83%97">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 15：いろいろな仕掛けを追加しよう！ on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_15%2f&amp;title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2015%ef%bc%9a%e3%81%84%e3%82%8d%e3%81%84%e3%82%8d%e3%81%aa%e4%bb%95%e6%8e%9b%e3%81%91%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%97%e3%82%88%e3%81%86%ef%bc%81&amp;summary=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2015%ef%bc%9a%e3%81%84%e3%82%8d%e3%81%84%e3%82%8d%e3%81%aa%e4%bb%95%e6%8e%9b%e3%81%91%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%97%e3%82%88%e3%81%86%ef%bc%81&amp;source=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_15%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 15：いろいろな仕掛けを追加しよう！ on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_15%2f&title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2015%ef%bc%9a%e3%81%84%e3%82%8d%e3%81%84%e3%82%8d%e3%81%aa%e4%bb%95%e6%8e%9b%e3%81%91%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%97%e3%82%88%e3%81%86%ef%bc%81">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 15：いろいろな仕掛けを追加しよう！ on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_15%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 15：いろいろな仕掛けを追加しよう！ on whatsapp"
        href="https://api.whatsapp.com/send?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2015%ef%bc%9a%e3%81%84%e3%82%8d%e3%81%84%e3%82%8d%e3%81%aa%e4%bb%95%e6%8e%9b%e3%81%91%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%97%e3%82%88%e3%81%86%ef%bc%81%20-%20https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_15%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るプラットフォーマー Part 15：いろいろな仕掛けを追加しよう！ on telegram"
        href="https://telegram.me/share/url?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%bc%20Part%2015%ef%bc%9a%e3%81%84%e3%82%8d%e3%81%84%e3%82%8d%e3%81%aa%e4%bb%95%e6%8e%9b%e3%81%91%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%97%e3%82%88%e3%81%86%ef%bc%81&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0005_platformer%2fplatformer_15%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

    <ul class="post-tags">
      <li><a href="https://www.peanuts-code.com/ja/tags/godotengine/">GodotEngine</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/gamedev/">GameDev</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/2d/">2D</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B2%E3%83%BC%E3%83%A0/">アクションゲーム</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E6%A8%AA%E3%82%B9%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%AB/">横スクロール</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%BC/">プラットフォーマー</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%83%88%E3%83%A9%E3%83%83%E3%83%97/">トラップ</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://www.peanuts-code.com/ja/tutorials/gd0005_platformer/platformer_14/">
    <span class="title">« 前のページ</span>
    <br>
    <span>Godot で作るプラットフォーマー Part 14：プレイヤーキャラクターのアクションをアップデートしよう！</span>
  </a>
  <a class="next" href="https://www.peanuts-code.com/ja/tutorials/gd0018_melee_attacks/">
    <span class="title">次のページ »</span>
    <br>
    <span>Godot3 で作る 2D ゲームの近接攻撃の当たり判定</span>
  </a>
</nav>

    
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://www.peanuts-code.com/ja/">Peanuts Code</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
