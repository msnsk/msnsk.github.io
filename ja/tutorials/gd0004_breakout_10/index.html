<!DOCTYPE html>
<html lang="ja" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Godot で作るブロック崩し Part 10：パワーアップアイテムをドロップさせよう！ | Peanuts Code</title>
<meta name="keywords" content="Godot, ゲーム開発, ブロック崩し, 中級" />
<meta name="description" content="Alert:">
<meta name="author" content="Masanao Sako">
<link rel="canonical" href="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout_10/" />
<meta name="google-site-verification" content="XYZabc" />
<meta name="yandex-verification" content="XYZabc" />
<meta name="msvalidate.01" content="XYZabc" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.css" rel="preload stylesheet" as="style">
<link rel="preload" href="/images/logomark.png" as="image">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://www.peanuts-code.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.peanuts-code.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.peanuts-code.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://www.peanuts-code.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://www.peanuts-code.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.91.0" />
<link rel="alternate" hreflang="ja" href="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout_10/" />

<script async src="https://www.googletagmanager.com/gtag/js?id=G-DK0NK2RTTW"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-DK0NK2RTTW', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="Godot で作るブロック崩し Part 10：パワーアップアイテムをドロップさせよう！" />
<meta property="og:description" content="Alert:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout_10/" />
<meta property="og:image" content="https://www.peanuts-code.com/images/tutorials/gd0004_breakout_10/img_0.png" /><meta property="article:section" content="tutorials" />
<meta property="article:published_time" content="2021-12-02T22:49:34&#43;09:00" />
<meta property="article:modified_time" content="2021-12-02T22:49:34&#43;09:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://www.peanuts-code.com/images/tutorials/gd0004_breakout_10/img_0.png" />
<meta name="twitter:title" content="Godot で作るブロック崩し Part 10：パワーアップアイテムをドロップさせよう！"/>
<meta name="twitter:description" content="Alert:"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Tutorials",
      "item": "https://www.peanuts-code.com/ja/tutorials/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Godot で作るブロック崩し Part 10：パワーアップアイテムをドロップさせよう！",
      "item": "https://www.peanuts-code.com/ja/tutorials/gd0004_breakout_10/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Godot で作るブロック崩し Part 10：パワーアップアイテムをドロップさせよう！",
  "name": "Godot で作るブロック崩し Part 10：パワーアップアイテムをドロップさせよう！",
  "description": "Alert:",
  "keywords": [
    "Godot", "ゲーム開発", "ブロック崩し", "中級"
  ],
  "articleBody": " Alert: \n次回の Part 11 の内容との整合性が取れず、2021/12/12 2:15頃に内容をかなり大幅に修正しました。ご不便をおかけして申し訳ありません。それ以前に本記事をご覧になられていた方はご確認ください。  Part 10 の今回は、ブロック崩しにパワーアップアイテムを追加していく。ブロックを崩すとアイテムが落ちてきて、パドルとアイテムが衝突するとパワーアップが適用される、という仕組みの部分を実装していこう。\nなお、パドルを大きくしたり、複数のボールを発射できるなど、いくつかのパワーアップを用意していく予定だが、個々のパワーアップの実装については、次回の Part 11 で説明させていただくこととする。\nそれでは前回に引き続きブロック崩しを開発していこう。\n Memo: \nPart 1 ~ Part 8 をまだご覧になっていない方は、そちらを先にご覧いただくことをおすすめします。\nGodot で作るブロック崩し Part 1：パドルを作って動かそう！ Godot で作るブロック崩し Part 2：ボールを作って発射しよう！ Godot で作るブロック崩し Part 3：壁を作ってボールを跳ね返らせよう！ Godot で作るブロック崩し Part 4：ブロックを配置してボールを当てて消そう！ Godot で作るブロック崩し Part 5：細かい更新をしてゲーム性を高めよう！ Godot で作るブロック崩し Part 6：ゲームスタート/ゲームオーバーの画面を作ろう！ Godot で作るブロック崩し Part 7：HUDを作って表示内容を更新してみよう！ Godot で作るブロック崩し Part 8：ポーズ画面を作ろう！ Godot で作るブロック崩し Part 9：アニメーションを追加しよう！   本題の前に 2D ワークスペースで作業がしやすいように、「NextScreen」ノードをシーンドック上は「非表示」にしておき、ゲームが開始して「NextScreen」の_readyメソッドが読み込まれたら「表示」に切り替わるようにしておこう（毎回シーンドックで調整するのは面倒だ）。\nでは以下のように「NextScreen.gd」スクリプトの_readyメソッドにshowメソッドを追加しておこう。\nfunc _ready(): show() # 追加 pause_screen.pause_mode = 1 get_tree().paused = true シーンドックで「Game.tscn」を開き、「NextScreen」ノードを非表示にしてしまおう。これで 2D ワークスペースで作業しやすくなったはずだ。\n Powerup シーンを作る パワーアップアイテムは、ブロックを崩した時に一定の確率でドロップするようにしたい。となると、パワーアップアイテムが常に「Game」シーンに存在するわけではない。このような場合は、パワーアップアイテムの設計図となるシーンを一つ作成しておき、ブロックを崩した時に、一定の確率で「Game」シーン内にそのインスタンスを生成する、という仕組みを構成していけば良い。\nシーンを新規作成する まずはパワーアップアイテムのシーンを新規作成する。ルートノードとして「Area2D」クラスのノードを作成し、その名前を「Powerup」に変更しておこう。そして、そのままシーンを「res://scene/Powerup.tscn」として保存しておこう。\nここで、なぜ「Area2D」を選んだのか説明しておく。\nパワーアップアイテムがブロックを消した時に画面上に現れ、そこから画面下方へ落ちていき、パドルに衝突したらアイテムは消え、パワーアップ処理が実行されるようにしたい。他の物理オブジェクトと衝突した時にシグナルを発することができるのが「Area2D」か「RigidBody2D」のどちらかだ。「StaticBody2D」や「KinematicBody2D」はそのようなシグナルは用意されていないのでここでは使えない。さらに「RigidBody2D」は物理処理を自動的にしてくれるが、ただ下方向に移動するだけのオブジェクトにとっては自動の物理演算は不要だ。このような理由から「Area2D」ノードを選択した。\nノードを追加する 次に必要な子ノードを追加していく。\nまず「AnimatedSprite」クラスのノードを追加する。このクラスは、通常の「Sprite」クラスとは異なり、「Texture」プロパティの代わりに「Frames」というプロパティがある。これは画像ファイル単体を適用するプロパティではなく、複数の画像ファイルや画像をまとめたシート形式のファイルを適用して、アニメーションを作成するためのプロパティだ。パワーアップアイテムがドロップしている最中に簡単なアニメーションをさせるために、こちらのクラスを採用した。\n次は、例によって「CollisionShape2D」ノードを追加しておこう。名前はそのままで良い。\n2つの子ノードを追加した結果、シーンドックは以下のようになったはずだ。\nプロパティを編集する 「Powerup.tscn」シーンは、ドロップするアイテムによって、そのインスタンスのプロパティが異なる部分がある。どのアイテムがドロップする場合でも共通して設定が必要なプロパティだけ、インスペクタドックで編集していく。アイテムによって値が異なるプロパティについては、スクリプトで変更していく予定だ。\nAnimatedSprite のプロパティを編集する まずは「Frames」プロパティで「新規 SpriteFrames」を選択する。「Resource」セクションを展開して、「Local to Scene」プロパティにチェックを入れてオンにしておこう。これをしていないと、ドロップしたアイテムのアニメーションフレームが同じリソースを参照することになり、ドロップした全てのアイテムの画像が追加された同一のアニメーションになってしまうので注意してほしい。「Path」プロパティは「res://scene/Powerup.tscn::1」になっていればOKだ。\nここで、「SpriteFrames」を編集する。シーンドックで「AnimatedSprite」を選択した状態で画面下部のスプライトフレームエディタを開こう。最初から「default」という名前のアニメーションがあるので、その名前を「drop」に変更しておこう。速度は「4 フレーム」にする。ループはそのまま有効にしておく。\n今はアニメーションフレームは空っぽのままで良い。あくまでこのシーンはインスタンスのための雛形なので、パワーアップアイテムによって内容が変わる部分はそのままにしなければならない。\nインスペクタに戻り、「Animation」プロパティで、今しがた作成した「drop」アニメーションを選択しよう。アニメーションはパワーアップアイテムが画面上に出現した時点で再生したいので、「Playing」プロパティをオンにしておこう。\nCollisionShape2D のプロパティを編集する 今度はインスペクタドックで「CollisionShape2D」ノードのプロパティを編集していこう。\nまずは「Shape」プロパティで「新規 RectangleShape」を設定する。あとは、2D ワークスペースでハンドルをドラッグしてサイズをちょうど縦横 20 px の正方形になるように調整する。上と左の目盛りを参考にサイズを合わせると良い。\nただ、今回は Sprite の画像がなくてやりにくいと感じるかもしれない。一旦この「RectangleShape」を調整するために、「AnimatedSprite」ノードの「drop」アニメーションに、アニメーションフレームとして画像を一つ暫定的に追加しても良い。例えば下のスクリーンショットでは「Heart3.png」を追加している。「RectangleShape」のサイズ調整が終わったら、忘れず追加した画像を消しておこう。\nこれでインスペクタドックでのプロパティの編集はひとまず完了だ。\nコリジョンレイヤーを編集する 実は、先ほど作成したパワーアップアイテムのコリジョンシェイプのサイズはブロックのそれより大きい。このままだとどうなるかというと、パワーアップアイテムはゲームに出現すると、すぐに上下左右の隣り合っているブロックと衝突してしまう。このあとスクリプトで「衝突したら画面から消える」コードを実装したら、出てきた瞬間に消えることになる。\nこのような状況を回避するため、一般的なお作法として、オブジェクトの種類ごとに衝突用のレイヤーを分け、衝突反応を有効にする他のレイヤーを指定する。このレイヤーをコリジョンレイヤーと言う。それでは実際にやってみよう。\nまずはわかりやすくゲームで使用するコリジョンレイヤーに名前をつける。「プロジェクト」メニュー＞「プロジェクト設定」＞「一般」タブ＞サイドバーから「Layer Names」カテゴリの「2d Physics」を開き、必要な分だけレイヤーに名前をつけよう。このブロック崩しでは以下のレイヤーを使用する。\n Paddle Ball Wall Brick Item\n  では順番にコリジョンレイヤーの設定をしていこう。基本的にはコリジョンを持つノードで以下の手順を同じようにやっていくだけで良い。\n シーンドックでコリジョンレイヤーを設定したいノード（ここでは「Paddle」ノード）を選択する。 インスペクタドックで「Collision」セクションを開く 「Layer」でそのノードが所属するレイヤーを選択する。\n「…」をクリックするとレイヤー名を見ながらチェックして選択できるのでおすすめだ。\n 「Mask」でそのノードとの衝突反応を有効にしたいレイヤーを同様に選択する。例えば「Paddle」ノードの場合、衝突を有効にしたいのは「Ball」と「Wall」と「Item」だ。  以上の手順で、コリジョンを持つノードに対して順番に設定していくと以下のようになったはずだ。\n 「Paddle」ノード\n 「Ball」ノード\n 「Wall」ノード\n 「Brick」ノード（「Brick.tscn」に切り替えて）\n 「Item」ノード（「Powerup.tscn」に切り替えて）\n  これでパワーアップアイテムはパドルとしか衝突しなくなった。\nスクリプトで Powerup シーンを制御する 「Powerup」ルートノードにスクリプトにアタッチしよう。スクリプトは「res://scripts/Powerup.gd」として保存しておこう。このスクリプトでは主に、どのパワーアップアイテムが出るかをランダムで確定させ、確定したアイテムによって異なるアニメーションフレームを設定する。\nスクリプト全体の最終形  スクリプト全体を見る extends Area2D signal item_collided(item) enum Powerup { SLOW, EXPAND, MULTIPLE, LASER, LIFE, } var chosen_item = null onready var sprite = $AnimatedSprite onready var slow_1 = preload(\"res://sprites/Slow1.png\") onready var slow_2 = preload(\"res://sprites/Slow2.png\") onready var slow_3 = preload(\"res://sprites/Slow3.png\") onready var slow_frames = [slow_1, slow_2, slow_3] onready var expand_1 = preload(\"res://sprites/Expand1.png\") onready var expand_2 = preload(\"res://sprites/Expand2.png\") onready var expand_3 = preload(\"res://sprites/Expand3.png\") onready var expand_frames = [expand_1, expand_2, expand_3] onready var multiple_1 = preload(\"res://sprites/Multiple1.png\") onready var multiple_2 = preload(\"res://sprites/Multiple2.png\") onready var multiple_frames = [multiple_1, multiple_2] onready var laser_1 = preload(\"res://sprites/Laser1.png\") onready var laser_2 = preload(\"res://sprites/Laser2.png\") onready var laser_3 = preload(\"res://sprites/Laser3.png\") onready var laser_frames = [laser_1, laser_2, laser_3] onready var life_1 = preload(\"res://sprites/Heart1.png\") onready var life_2 = preload(\"res://sprites/Heart2.png\") onready var life_3 = preload(\"res://sprites/Heart3.png\") onready var life_frames = [life_1, life_2, life_3] func _ready(): randomize() add_sprite_frames() func add_sprite_frames(): sprite.frames.clear(\"drop\") var random_num = randf() var item_list = [] if random_num  0.3: item_list += slow_frames chosen_item = Powerup.SLOW elif random_num  0.55: item_list += expand_frames chosen_item = Powerup.EXPAND elif random_num  0.75: item_list += multiple_frames chosen_item = Powerup.MULTIPLE elif random_num  0.9: item_list += laser_frames chosen_item = Powerup.LASER else: item_list += life_frames chosen_item = Powerup.LIFE print(\"Powerup node: \", chosen_item) for item in item_list: # add to the head sprite.frames.add_frame(\"drop\", item, 0) func _physics_process(_delta): position.y += 0.75 func _on_Powerup_body_entered(body): emit_signal(\"item_collided\", chosen_item) queue_free()  ではここから小分けにスクリプトを解説していく。\nシグナルを定義する オリジナルのシグナルitem_collidedを用意した。\nsignal item_collided(item) これは主に「Game.gd」スクリプトの方で利用するためのものだ。このシグナルの定義の段階では、特に引数を記述する必要はないが、わかりやすいので記述した。itemでアイテムの種類を「Game」ノードへ渡せるようにするつもりだ。\nenum を定義する 次にPowerupという名前のenumを定義している。\nenum Powerup { SLOW, EXPAND, MULTIPLE, LASER, LIFE, } これは要素を一つずつconstキーワードで定数として、値を0、1、2… と順番に定義しているのと同義だ。例えば以下のような感じだ。\nconst SLOW = 0 const EXPAND = 1 enumというのはプルダウンメニューのようなものだ。その要素として大文字でSLOWやEXPANDなどいくつか並んでいるが、これらはパワーアップアイテムの種類だ。ここで一度、実装を予定しているパワーアップアイテムを紹介しておく。\n SLOW：ボールのスピードが初期値に戻る（ゆっくりになる） EXPAND：バーが横に2倍拡大する MULTIPLE：一定時間ボールを複数発射できるようになる LASER：レーザービームを発射してブロックを消すことができる LIFE：ライフが 1 増える（最大 5）  変数 chosen_item を定義する そして、enum のあとは、変数chosen_itemを定義している。\nvar chosen_item = null ブロックを一つ消した時に、ランダムで決定されるアイテムの種類を保存する。その種類は先に定義したenum Powerupから選択される。初期値はひとまず何もないことを示すnullとしている。あとで、どのアイテムがドロップしたかを、それぞれのアイテムが一定の割合で選択されるようにコーディングし、このchosen_itemにそのアイテムを値として入れることになる。\n_physics_process メソッドを定義する func _physics_process(_delta): position.y += 0.75 _physics_processメソッドを追加した。このメソッドでは、毎フレーム、「Powerup」ノードのpositionプロパティのy座標を 0.5 ずつ加算している。一般的にゲームのy座標は画面の下方向にいくほど増加する。したがって、パワーアップアイテムがドロップしている時の動きがこれで実装できたはずだ。\nここまでで、一旦スクリプトの内容を網羅した。次に、ドロップしたアイテムにパドルが衝突したら、アイテムが画面上から消える動きを作る。これにはシグナルを利用する。\nシーンドックで「Powerup」ノードを選択し、ノードドック＞シグナルを表示するとbody_entered(body: Node)というシグナルが見つかるはずだ。\nこれを「Powerup.gd」スクリプトに接続しよう。すると、スクリプトに_on_Powerup_body_enteredメソッドが追加される。\nパワーアップアイテムに何らかのオブジェクトが衝突するとシグナルbody_enteredが発信され、メソッド_on_Powerup_body_enteredが実行される。これを利用して、このメソッド内にオブジェクトを開放するためのメソッドqueue_freeメソッドを追加すれば、パワーアップアイテムがパドルに当たった瞬間に画面から消えてくれるようになる。さらにその手前に、emit_signalメソッドを追加する。これで先に用意したシグナルitem_collidedもパドルとアイテムが衝突した時に発信されるようになる。引数に変数chosen_itemを入れることも忘れずに。\nfunc _on_Powerup_body_entered(body): emit_signal(\"item_collided\", chosen_item) queue_free() \nシーンを実行してドロップ時の動きを確認する では「Powerup.gd」スクリプトの編集ができたところで、一度シーンを実行してみよう。実行前に「デバッグ」メニューで「コリジョン形状の表示」にチェックを入れておこう。2D ワークスペースで「Powerup」ノードを画面中央上部に一時的に移動してから確認するとわかりやすいだろう。\n想定通りに落ちてきてくれた。ブロックを消してパワーアップアイテムがドロップするときは、このような動きになる。\nonready キーワードの変数でアニメーションフレーム用画像を定義 さあここで大量のonreadyキーワード付きの変数を定義している。臆さずよく見てみよう。ほとんどが、似たようなコードの繰り返しになっているのがなんとなくわかるだろう。\nonready var sprite = $AnimatedSprite onready var slow_1 = preload(\"res://sprites/Slow1.png\") onready var slow_2 = preload(\"res://sprites/Slow2.png\") onready var slow_3 = preload(\"res://sprites/Slow3.png\") onready var slow_frames = [slow_1, slow_2, slow_3] onready var expand_1 = preload(\"res://sprites/Expand1.png\") onready var expand_2 = preload(\"res://sprites/Expand2.png\") onready var expand_3 = preload(\"res://sprites/Expand3.png\") onready var expand_frames = [expand_1, expand_2, expand_3] onready var multiple_1 = preload(\"res://sprites/Multiple1.png\") onready var multiple_2 = preload(\"res://sprites/Multiple2.png\") onready var multiple_frames = [multiple_1, multiple_2] onready var laser_1 = preload(\"res://sprites/Laser1.png\") onready var laser_2 = preload(\"res://sprites/Laser2.png\") onready var laser_3 = preload(\"res://sprites/Laser3.png\") onready var laser_frames = [laser_1, laser_2, laser_3] onready var life_1 = preload(\"res://sprites/Heart1.png\") onready var life_2 = preload(\"res://sprites/Heart2.png\") onready var life_3 = preload(\"res://sprites/Heart3.png\") onready var life_frames = [life_1, life_2, life_3] 最初の1行だけ別物で、子ノード「AnimatedSprite」にアクセスしやすいように、変数に代入している。\nそれ以外の変数は4行ごとにほぼ似たような定義を繰り返している。その4行ひと塊について説明していこう。\npreloadで読み込んでいるのは、パワーアップアイテムのアニメーションフレーム用の Sprite 画像だ。これはpreload()と記述したあと、()の中に、ファイルシステムドックから Sprite 画像ファイルをドラッグ\u0026ドロップするとファイルパスに変換してくれる。変数slow_1、slow_2、slow_3までは Sprite 画像をPreloadしている。\nそのあとの変数slow_framesは[]で括っているので、これは配列（Array）だ。配列の要素として、先に定義したslow_1、slow_2、slow_3が入っている。この配列は、あとでアニメーションフレームをコードで設定するための下準備となっている。\n同様にしてexpand、multiple、laser、lifeの順番で画像をpreloadして、それらを配列の要素として定義している。\n_ready メソッドを定義する では次におなじみの_readyメソッドを確認しておこう。\nfunc _ready(): randomize() add_sprite_frames() randomizeというメソッドを実行しているが、これはあとで登場する、ランダムな数値を取得するために事前に必要になるメソッドだ。randomizeを事前に実行しておかないと、ランダムな数値を取得するはずのメソッドを実行しても、毎回同じ数値を取得することになるので要注意だ。\n次に実行しているのがadd_sprite_framesというメソッドだ。このメソッドの目的は、ランダムで決定したパワーアップアイテムの種類によって、適切なアニメーションフレームを設定する役割を担っている。\nadd_sprite_frames メソッドを定義する そして、スクリプトの最後に定義しているのがadd_sprite_framesというメソッドで、これが_readyメソッド内で実行されているメソッドだ。ではその中身を見ていこう。少しコードが長いので、さらに小分けにして説明する。\nfunc add_sprite_frames(): var random_num = randf() var item_list = [] まずメソッド内でrandom_numという変数を定義しており、その中身はrandfというメソッドになっている。このメソッドはランダムな数値（float型）を0から1の間で返してくれる。例えば0.07や0.8993のような数値だ。ただし、先にrandomizeメソッドを実行している必要がある。\n次にitem_listという変数を定義している。その値は、一旦、空の配列[]のみになっている。これは後ほど使用する。ではadd_sprite_frames内の次のコードを見ていこう。\nif random_num  0.3: item_list += slow_frames chosen_item = Powerup.SLOW elif random_num  0.55: item_list += expand_frames chosen_item = Powerup.EXPAND elif random_num  0.75: item_list += multiple_frames chosen_item = Powerup.MULTIPLE elif random_num  0.9: item_list += laser_frames chosen_item = Powerup.LASER else: item_list += life_frames chosen_item = Powerup.LIFE この部分のコードはif / elif / else構文になっている。\nif random_num という形式のコードは、もし「random_numの数値がxxx以下だったら」という意味になる。そして、elifは「その前のifやelifに当てはまらなかったら」という条件も含む。最後のelseは「その前までのifやelif全てに当てはまらなかったら」という意味だ。つまり、このブロックの概要としては、先にメソッド内で定義した変数random_numのランダムな値によって、落ちるパワーアップアイテムが変わるようになっている。\nそしてitem_list += xxx_framesという形のコードについては、先に定義したitem_listという空っぽの配列に、例えばslow_framesやmultiple_framesなどの、アニメーションフレーム用の画像ファイルを含む配列の要素を足すという意味になる。\nちなみに、random_numの最大値は1、最大値は1であることを踏まえると、このサンプルコードでは以下の確率で落ちるアイテムが決まる。もちろん、あなたの好きな確率を割り振っていただいて全く問題ない。\n 0以上0.3以下（30%の確率)：「Slow」のアイテムが落ちる 0.3より大きく0.55以下（25%の確率）：「Expand」のアイテムが落ちる 0.55より大きく0.75以下（20%の確率）：「Multiple」のアイテムが落ちる 0.75より大きく0.9以下（15%の確率）：「Laser」のアイテムが落ちる 0.9より大きく1以下（10%の確率）：「Life」のアイテムが落ちる  ところで、アイテムが落ちるかどうかの確率はまた別で設定することになる。つまり、それぞれのアイテムが実際のゲーム中に現れる確率は、アイテム出現率とそれぞれのアイテムの出現割合の掛け算になるので、さらに低くなる。\nそのあとのchosen_item = Powerup.xxxの形式のコードも見ておこう。変数chosen_itemに enum Powerupの要素のうちrandom_numの値によって確定したパワーアップアイテムが入る形だ。例えば、random_numの値が0.789だった場合はLASERがchosen_itemに代入される。これにより「Powerup」ノードのchosen_itemという変数から、どのアイテムに確定したのかがわかるようになる。これは「Game.tscn」シーンでパワーアップの個々の機能を実装するときに役に立つだろう。\nadd_sprite_frames メソッドを定義する それではadd_sprite_framesメソッドの最後の部分を見てみよう。\nfor item in item_list: # add to the head frames.add_frame(\"drop\", item, 0) forループだ。文法上、for ... in xxxのxxxには配列や値の範囲を記述するが、このコードでは配列item_listが記述されている。item_listにはすでに、random_numの値によって選ばれたパワーアップアイテムのアニメーションフレーム用画像が含まれている。そして...は、配列の要素一つ一つを順番に当てはめていく。そして、要素を当てはめるごとに、forループのブロック内のコードを実行する。\nこのコードの具体的な話をすると、まず、配列item_list内のアニメーションフレームの画像一つ一つが順番にitemに当てはめられる。そして、framesプロパティのadd_frameメソッドが第一引数にアニメーション「drop」を、第二引数にitemつまりアニメーションフレーム用画像を、第三引数に0を指定して実行されている。\nつまり、このメソッドは、アニメーション「drop」のアニメーションフレームの0の位置に画像を追加している。追加位置は0は最初（先頭）だ。\nデフォルトでは第三引数の値は-1、つまり最後（末尾）と決まっているのに、なぜ敢えて先頭にしているのか。これは少しややこしく、細かい話だが説明しておく。\n今回ファイルシステムドックを見ていただくとわかる通り、画像のファイル名の末尾の数字が、実際にアニメーションで表示したい順番とは逆なのだ。例えば「Expand」アイテムのアニメーションとしては、両端が左右に向いた矢印が小さい状態から左右に伸びるようなアニメーションにしたいが、「expand_1」の画像が一番左右に伸びていて「expand_3」は一番短くなっている。配列expand_frames内の画像ファイルは名前の順番になっており、item_listに画像ファイルが追加された後も同じだ。その結果、forループはexpand_1から順にアニメーションフレームに追加されるため、expand_3がアニメーションの先頭に来るようにするには、forループで毎回アニメーションフレームの先頭に追加する必要があるというわけだ。\nシーンを実行して確認する それでは、ランダムでドロップするパワーアップアイテムが変わるかどうか、シーンを実行して確認してみよう。今回も「Powerup」ノードを画面の上部中央に配置してから確認するとわかりやすいだろう。\n時々デバッグパネルが開くのに時間がかかっているが、ランダムでアイテムが変わることが確認できた。\n次はいよいよ「Game」シーンにパワーアップアイテムを登場させる。\nスクリプトで Game シーンにパワーアップアイテムをドロップさせる 実際のゲーム画面にパワーアップアイテムが表示されるように更新していこう。パワーアップアイテムのノードは、ブロックを消したタイミングでシーンに追加されるものなので、「Game.gd」スクリプトで出現と解放をコントロールする必要がある。\nそれでは「Game.gd」スクリプトを編集していこう。\n変数を2つ追加する まずは、新たに定義したプロパティから。\nextends Node2D const POINT = 100 export var drop_rate= 1 # 追加 # 中略 onready var powerup = preload(\"res://scene/Powerup.tscn\") # 追加 最初に追加した変数はdrop_rateだ。これはブロックを消した時の出現率だ。デバッグのために値は一旦1としている。これは 100 % と同義だ。本番ではこれを 0.05 ~ 0.25 くらいに収めるのが適当だろう。exportキーワードをつけて、インスペクタで簡単に編集できるようにしている。\n次にonready付きの変数powerupを定義している。内容は PackedScene の「Powerup.tscn」、つまり先に作成しておいた「Powerup」シーンだ。ブロックを消してアイテムがドロップした時に、このシーンを継承する形で「Game」ルートノードに追加しやすいように、先にシーンを変数に代入している。\n_ready メソッドを編集する 次に_readyメソッド内に1行追加し、1行更新した。\nfunc _ready(): # For debug #leave_one_brick(43) randomize() # 追加 update_hud_life() ball.connect(\"tree_exited\", self, \"_on_Ball_tree_exited\") for brick in level.get_children(): brick.connect(\"tree_exited\", self, \"_on_Brick_tree_exited\", [brick.global_position]) # 更新 まずは「# 追加」のコメントがある行だ。randomizeメソッドを実行している。これは以前にも登場したが、以降にrandfやrandom_rangeなどのランダムな値を返すメソッドを実行する際には事前に必ず必要な処理だ。これがないと、毎回同じ値が出力されてしまう。「Game.gd」スクリプトでは、ブロックを消した時にパワーアップアイテムを一定確率で出現させる処理で必要になる。\n次に一番下のforループ内の処理で実行しているbrickのconnectメソッドだ。これはシグナルをコードで接続するためのメソッドであることは以前にも説明していたが、今回そのメソッドに第四引数を追加した。それが[brick.global_position]だ。個々のブロックのglobal_positionプロパティの値、つまりゲーム画面上のブロックの座標位置を渡している。\nちなみに、第四引数は必ず配列として[]で括る決まりになっている。この配列に複数のプロパティを追加することが可能で、その値を接続先のメソッドの引数として使用することができる。今回、ブロックを消したらそのブロックの座標位置からパワーアップアイテムをドロップさせる必要があるので、このglobal_positionを引数として追加した。\nさてここで、コードの順番通りに_on_Ball_tree_exitedの追加を説明したいところだが、更新内容的には後回しにしたほうが良いだろう。\n_on_Brick_tree_exited メソッドを編集する 続いては_on_Brick_tree_exitedメソッドの更新内容を見てみよう。\n# Method receiving Brick signal func _on_Brick_tree_exited(brick_position): # Update Score score += POINT * bonus_rate bonus_rate += 0.1 hud_score.text = \"Score: \" + str(score) # Exit current Level node print(\"get child count: \", level.get_child_count()) if level.get_child_count()  0: level.queue_free() print(\"level queue free\") set_next_level() # Drop powerup item drop_powerup(brick_position) # 追加 追加したのは一番下の1行だ。drop_powerupというメソッドを実行し、引数には元の_on_Brick_tree_exitedの引数であるbrick_positionをとっている。そして、この引数brick_positionの値というのは、先に_readyメソッド内のconnectメソッドの第四引数として追加した個々のブロックのglobal_positionとイコールだ。\ndrop_powerup メソッドを追加する そしてdrop_powerupメソッドはこの後に定義されているので続けて見ていこう。\nfunc drop_powerup(brick_position: Vector2): if randf()  drop_rate: var powerup_instance = powerup.instance() powerup_instance.position = brick_position call_deferred(\"add_child\", powerup_instance) powerup_instance.connect(\"item_collided\", self, \"_on_Powerup_item_collided\") パワーアップアイテムの処理のために今回新しく定義したのがこのdrop_powerupメソッドだ。\nメソッドの内容はifブロックになっている。randfメソッドは0から1の間の数値（float 型）を返す組み込み関数であることは先に説明した。これによって得られた値が、冒頭で定義した変数drop_rate以下であれば、ifブロックの中のコードが実行される。ちなみに、今はデバッグのためdrop_rateを1にしているので、パワーアップアイテムが 100 % 出現するが、デバッグが済んで、drop_rateを仮に0.1にすれば、ブロックを消した時のアイテムの出現率は 10 % になるというわけだ。\nではifブロックの中を見ていこう。\nvar powerup_instance = powerup.instance()で、まず事前にpreloadしていた「Powerup.tscn」シーンのインスタンスを、変数powerup_instanceとして定義している。\nそのあと、powerup_instance.position = brick_positionで、そのインスタンスの座標位置をブロックの座標位置と一致させている。\n続けて、call_deferred(\"add_child\", powerup_instance)により、「Powerup」シーンのインスタンスを「Game.tscn」シーンに登場させるために、「Game」ルートノードの子ノードとして追加した。この時、処理が追いつかなくなる可能性があるため、call_dererredメソッドからadd_childメソッドを実行している。\nそして最後に、powerup_instance.connect(\"item_collided\", self, \"_on_Powerup_item_collided\")で、「Game」ノードの子になった「Powerup」ノードのitem_collidedシグナルをこのスクリプトの_on_Powerup_item_collidedメソッドに接続している。\nちなみに、「Powerup.gd」スクリプトの編集で、パワーアップアイテムがパドルに衝突したらシグナルによって_on_Powerup_body_enteredメソッドが実行され、シグナルitem_collidedを発信するようにしていたことを思い出してほしい。\nということで、_on_Powerup_item_collidedメソッドにアイテムを獲得したあとのパワーアップ処理を追加していくことになるが、ここはアイテムの数だけコーディングする必要があるので、ボリューム的な問題で、次回のチュートリアルに回したいと思う。ひとまず引数には「Powerup.gd」で定義したchosen_itemを指すitemを引数にしてメソッドだけ定義しておこう。中にpassだけ記述しておけばエラーは表示されない。\nfunc _on_Powerup_item_collided(item): pass \n次にボールが画面下に落ちてしまった時に、画面上にドロップしているパワーアップアイテムを全て消去するようにする。そうしないと、例えば、次の新しいボールをパドルに乗せたまま「Laser」アイテムを取得し、レーザーで好きなだけブロックを消せるような状況が発生してしまう。このようなゲーム性を損なうパターンは避けるべきだ。\nこの処理をコーディングしやすくするために、先に「Powerup」ノードを追加するための新しいノードグループを作成する。シーンドックで「Powerup.tscn」を開いて、「Powerup」ノードを選択し、ノードドックの「グループ」タブで「PowerupItems」グループを追加しよう。\nでは「Game.gd」スクリプトの方に戻ろう。すでにある_on_Ball_tree_exitedメソッドを更新する。\n# Method receiving Ball signal func _on_Ball_tree_exited(): life -= 1 update_hud_life() if life  0: get_tree().change_scene(\"res://scene/GameOverView.tscn\") else: for child in get_children(): # 以下3行追加 if child.is_in_group(\"PowerupItems\"): child.queue_free() paddle.position = paddle_position ball = load(\"res://scene/Ball.tscn\").instance() call_deferred(\"add_child\", ball) call_deferred(\"move_child\", ball, 3) ball.connect(\"tree_exited\", self, \"_on_Ball_tree_exited\") if / else構文のelseブロックの最初にforループのブロックを3行追加した。\nまずget_childrenメソッドが「Game」ノードの全ての子ノードを配列の要素に追加した形で返してくれる。よって、このforループは、この配列に対してのループ処理になる。childには順次「Game」ノードの子ノードが入る形になる。\nループ内の処理としては、まず最初にif構文で『その子ノードが先ほど作成した「PowerupItems」グループのメンバーだったら』という条件を定義し、それに当てはまればqueue_freeメソッドでノードを解放する、という処理だ。つまり、画面下にボールが落ちた時に、パワーアップアイテムに該当するノードは全て消去される、というわけだ。\nプロジェクトを実行して最後の動作確認をする それでは最後にプロジェクトを実行して動作確認しておこう。まずはdrop_rateを1にしたままで確認する。\n以下について問題ないことを確認できた。\n ブロックを消すと一定の割合でそれぞれのパワーアップアイテムがドロップする。 パドルにパワーアップアイテムが衝突するとパワーアップアイテムは画面上から消える。 ボールを画面下に落とすと、その時点でドロップしているパワーアップアイテムは画面上から消える。  では次に、drop_rateを0.1にして再度プロジェクトを実行してみよう。\n少しハードモードな印象もあるが、割とありそうなアイテムのドロップ率だ。これくらいの確率なら、アイテムが落ちた時にプレイヤーに嬉しい気持ちを感じてもらえるのではないだろうか。もちろん、あなたのお好みの確率に調整していただければ問題ない。\n おわりに 以上で Part 10 は完了だ。今回はブロックを消したらランダムでパワーアップアイテムが落ちる仕組みを作った。\n次回は個々のパワーアップ処理を実装していく。\n",
  "wordCount" : "908",
  "inLanguage": "ja",
  "image":"https://www.peanuts-code.com/images/tutorials/gd0004_breakout_10/img_0.png","datePublished": "2021-12-02T22:49:34+09:00",
  "dateModified": "2021-12-02T22:49:34+09:00",
  "author":{
    "@type": "Person",
    "name": "Masanao Sako"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.peanuts-code.com/ja/tutorials/gd0004_breakout_10/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Peanuts Code",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.peanuts-code.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.peanuts-code.com/ja/" accesskey="h" title="Peanuts Code (Alt + H)">
                <img src="/images/logomark.png" alt="logo" aria-label="logo"
                    height="35">Peanuts Code</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://www.peanuts-code.com/en/" title="English"
                            aria-label="English">En</a>
                    </li>
                </ul>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.peanuts-code.com/ja/" title="ホーム">
                    <span>ホーム</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/posts/" title="ブログ">
                    <span>ブログ</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/tutorials/" title="チュートリアル">
                    <span>チュートリアル</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/tags/" title="タグ">
                    <span>タグ</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/about/" title="アバウト">
                    <span>アバウト</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://www.peanuts-code.com/ja/">Home</a>&nbsp;»&nbsp;<a href="https://www.peanuts-code.com/ja/tutorials/">Tutorials</a></div>
    <h1 class="post-title">
      Godot で作るブロック崩し Part 10：パワーアップアイテムをドロップさせよう！
    </h1>
    <div class="post-meta">2021-12-02&nbsp;·&nbsp;5 分&nbsp;·&nbsp;Masanao Sako
</div>
  </header> 
<figure class="entry-cover"><img loading="lazy" src="https://www.peanuts-code.com/images/tutorials/gd0004_breakout_10/img_0.png" alt="ブロック崩しPart10サムネイル">
        
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目次</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e6%9c%ac%e9%a1%8c%e3%81%ae%e5%89%8d%e3%81%ab" aria-label="本題の前に">本題の前に</a></li>
                <li>
                    <a href="#powerup-%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e3%82%8b" aria-label="Powerup シーンを作る">Powerup シーンを作る</a><ul>
                        
                <li>
                    <a href="#%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e6%96%b0%e8%a6%8f%e4%bd%9c%e6%88%90%e3%81%99%e3%82%8b" aria-label="シーンを新規作成する">シーンを新規作成する</a></li>
                <li>
                    <a href="#%e3%83%8e%e3%83%bc%e3%83%89%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b" aria-label="ノードを追加する">ノードを追加する</a></li>
                <li>
                    <a href="#%e3%83%97%e3%83%ad%e3%83%91%e3%83%86%e3%82%a3%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b" aria-label="プロパティを編集する">プロパティを編集する</a><ul>
                        
                <li>
                    <a href="#animatedsprite-%e3%81%ae%e3%83%97%e3%83%ad%e3%83%91%e3%83%86%e3%82%a3%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b" aria-label="AnimatedSprite のプロパティを編集する">AnimatedSprite のプロパティを編集する</a></li>
                <li>
                    <a href="#collisionshape2d-%e3%81%ae%e3%83%97%e3%83%ad%e3%83%91%e3%83%86%e3%82%a3%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b" aria-label="CollisionShape2D のプロパティを編集する">CollisionShape2D のプロパティを編集する</a></li></ul>
                </li>
                <li>
                    <a href="#%e3%82%b3%e3%83%aa%e3%82%b8%e3%83%a7%e3%83%b3%e3%83%ac%e3%82%a4%e3%83%a4%e3%83%bc%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b" aria-label="コリジョンレイヤーを編集する">コリジョンレイヤーを編集する</a></li>
                <li>
                    <a href="#%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%81%a7-powerup-%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e5%88%b6%e5%be%a1%e3%81%99%e3%82%8b" aria-label="スクリプトで Powerup シーンを制御する">スクリプトで Powerup シーンを制御する</a><ul>
                        
                <li>
                    <a href="#%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e5%85%a8%e4%bd%93%e3%81%ae%e6%9c%80%e7%b5%82%e5%bd%a2" aria-label="スクリプト全体の最終形">スクリプト全体の最終形</a></li>
                <li>
                    <a href="#%e3%82%b7%e3%82%b0%e3%83%8a%e3%83%ab%e3%82%92%e5%ae%9a%e7%be%a9%e3%81%99%e3%82%8b" aria-label="シグナルを定義する">シグナルを定義する</a></li>
                <li>
                    <a href="#enum-%e3%82%92%e5%ae%9a%e7%be%a9%e3%81%99%e3%82%8b" aria-label="enum を定義する">enum を定義する</a></li>
                <li>
                    <a href="#%e5%a4%89%e6%95%b0-chosen_item-%e3%82%92%e5%ae%9a%e7%be%a9%e3%81%99%e3%82%8b" aria-label="変数 chosen_item を定義する">変数 chosen_item を定義する</a></li>
                <li>
                    <a href="#_physics_process-%e3%83%a1%e3%82%bd%e3%83%83%e3%83%89%e3%82%92%e5%ae%9a%e7%be%a9%e3%81%99%e3%82%8b" aria-label="_physics_process メソッドを定義する">_physics_process メソッドを定義する</a></li>
                <li>
                    <a href="#%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e5%ae%9f%e8%a1%8c%e3%81%97%e3%81%a6%e3%83%89%e3%83%ad%e3%83%83%e3%83%97%e6%99%82%e3%81%ae%e5%8b%95%e3%81%8d%e3%82%92%e7%a2%ba%e8%aa%8d%e3%81%99%e3%82%8b" aria-label="シーンを実行してドロップ時の動きを確認する">シーンを実行してドロップ時の動きを確認する</a></li>
                <li>
                    <a href="#onready-%e3%82%ad%e3%83%bc%e3%83%af%e3%83%bc%e3%83%89%e3%81%ae%e5%a4%89%e6%95%b0%e3%81%a7%e3%82%a2%e3%83%8b%e3%83%a1%e3%83%bc%e3%82%b7%e3%83%a7%e3%83%b3%e3%83%95%e3%83%ac%e3%83%bc%e3%83%a0%e7%94%a8%e7%94%bb%e5%83%8f%e3%82%92%e5%ae%9a%e7%be%a9" aria-label="onready キーワードの変数でアニメーションフレーム用画像を定義">onready キーワードの変数でアニメーションフレーム用画像を定義</a></li>
                <li>
                    <a href="#_ready-%e3%83%a1%e3%82%bd%e3%83%83%e3%83%89%e3%82%92%e5%ae%9a%e7%be%a9%e3%81%99%e3%82%8b" aria-label="_ready メソッドを定義する">_ready メソッドを定義する</a></li>
                <li>
                    <a href="#add_sprite_frames-%e3%83%a1%e3%82%bd%e3%83%83%e3%83%89%e3%82%92%e5%ae%9a%e7%be%a9%e3%81%99%e3%82%8b" aria-label="add_sprite_frames メソッドを定義する">add_sprite_frames メソッドを定義する</a></li>
                <li>
                    <a href="#add_sprite_frames-%e3%83%a1%e3%82%bd%e3%83%83%e3%83%89%e3%82%92%e5%ae%9a%e7%be%a9%e3%81%99%e3%82%8b-1" aria-label="add_sprite_frames メソッドを定義する">add_sprite_frames メソッドを定義する</a></li>
                <li>
                    <a href="#%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e5%ae%9f%e8%a1%8c%e3%81%97%e3%81%a6%e7%a2%ba%e8%aa%8d%e3%81%99%e3%82%8b" aria-label="シーンを実行して確認する">シーンを実行して確認する</a></li></ul>
                </li>
                <li>
                    <a href="#%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%81%a7-game-%e3%82%b7%e3%83%bc%e3%83%b3%e3%81%ab%e3%83%91%e3%83%af%e3%83%bc%e3%82%a2%e3%83%83%e3%83%97%e3%82%a2%e3%82%a4%e3%83%86%e3%83%a0%e3%82%92%e3%83%89%e3%83%ad%e3%83%83%e3%83%97%e3%81%95%e3%81%9b%e3%82%8b" aria-label="スクリプトで Game シーンにパワーアップアイテムをドロップさせる">スクリプトで Game シーンにパワーアップアイテムをドロップさせる</a><ul>
                        
                <li>
                    <a href="#%e5%a4%89%e6%95%b0%e3%82%922%e3%81%a4%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b" aria-label="変数を2つ追加する">変数を2つ追加する</a></li>
                <li>
                    <a href="#_ready-%e3%83%a1%e3%82%bd%e3%83%83%e3%83%89%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b" aria-label="_ready メソッドを編集する">_ready メソッドを編集する</a></li>
                <li>
                    <a href="#_on_brick_tree_exited-%e3%83%a1%e3%82%bd%e3%83%83%e3%83%89%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b" aria-label="_on_Brick_tree_exited メソッドを編集する">_on_Brick_tree_exited メソッドを編集する</a></li>
                <li>
                    <a href="#drop_powerup-%e3%83%a1%e3%82%bd%e3%83%83%e3%83%89%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b" aria-label="drop_powerup メソッドを追加する">drop_powerup メソッドを追加する</a></li>
                <li>
                    <a href="#%e3%83%97%e3%83%ad%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%82%92%e5%ae%9f%e8%a1%8c%e3%81%97%e3%81%a6%e6%9c%80%e5%be%8c%e3%81%ae%e5%8b%95%e4%bd%9c%e7%a2%ba%e8%aa%8d%e3%82%92%e3%81%99%e3%82%8b" aria-label="プロジェクトを実行して最後の動作確認をする">プロジェクトを実行して最後の動作確認をする</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e3%81%8a%e3%82%8f%e3%82%8a%e3%81%ab" aria-label="おわりに">おわりに</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><blockquote>
<p><strong><span style="color:red">Alert:</span>
</strong><br>
<span style="color:red">次回の Part 11 の内容との整合性が取れず、2021/12/12 2:15頃に内容をかなり大幅に修正しました。ご不便をおかけして申し訳ありません。それ以前に本記事をご覧になられていた方はご確認ください。</span>
</p>
</blockquote>
<br>
<p>Part 10 の今回は、ブロック崩しにパワーアップアイテムを追加していく。ブロックを崩すとアイテムが落ちてきて、パドルとアイテムが衝突するとパワーアップが適用される、という仕組みの部分を実装していこう。</p>
<p>なお、パドルを大きくしたり、複数のボールを発射できるなど、いくつかのパワーアップを用意していく予定だが、個々のパワーアップの実装については、次回の Part 11 で説明させていただくこととする。</p>
<p>それでは前回に引き続き<strong>ブロック崩し</strong>を開発していこう。</p>
<blockquote>
<p><strong><span style="color:teal">Memo:</span>
</strong><br>
Part 1 ~ Part 8 をまだご覧になっていない方は、そちらを先にご覧いただくことをおすすめします。<br>
<a href="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout_1/" title="Godot で作るブロック崩し Part 1：パドルを作って動かそう！">Godot で作るブロック崩し Part 1：パドルを作って動かそう！</a>
<br>
<a href="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout_2/" title="Godot で作るブロック崩し Part 2：ボールを作って発射しよう！">Godot で作るブロック崩し Part 2：ボールを作って発射しよう！</a>
<br>
<a href="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout_3/" title="Godot で作るブロック崩し Part 3：壁を作ってボールを跳ね返らせよう！">Godot で作るブロック崩し Part 3：壁を作ってボールを跳ね返らせよう！</a>
<br>
<a href="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout_4/" title="Godot で作るブロック崩し Part 4：ブロックを配置してボールを当てて消そう！">Godot で作るブロック崩し Part 4：ブロックを配置してボールを当てて消そう！</a>
<br>
<a href="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout_5/" title="Godot で作るブロック崩し Part 5：細かい更新をしてゲーム性を高めよう！">Godot で作るブロック崩し Part 5：細かい更新をしてゲーム性を高めよう！</a>
<br>
<a href="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout_6/" title="Godot で作るブロック崩し Part 6：ゲームスタート/ゲームオーバーの画面を作ろう！">Godot で作るブロック崩し Part 6：ゲームスタート/ゲームオーバーの画面を作ろう！</a>
<br>
<a href="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout_7/" title="Godot で作るブロック崩し Part 7：HUDを作って表示内容を更新してみよう！">Godot で作るブロック崩し Part 7：HUDを作って表示内容を更新してみよう！</a>
<br>
<a href="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout_8/" title="Godot で作るブロック崩し Part 8：ポーズ画面を作ろう！">Godot で作るブロック崩し Part 8：ポーズ画面を作ろう！</a>
<br>
<a href="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout_9/" title="Godot で作るブロック崩し Part 9：アニメーションを追加しよう！">Godot で作るブロック崩し Part 9：アニメーションを追加しよう！</a>
</p>
</blockquote>
<br>
<hr>
<h1 id="本題の前に">本題の前に<a hidden class="anchor" aria-hidden="true" href="#本題の前に">#</a></h1>
<p>2D ワークスペースで作業がしやすいように、「NextScreen」ノードをシーンドック上は「非表示」にしておき、ゲームが開始して「NextScreen」の<code>_ready</code>メソッドが読み込まれたら「表示」に切り替わるようにしておこう（毎回シーンドックで調整するのは面倒だ）。</p>
<p>では以下のように「NextScreen.gd」スクリプトの<code>_ready</code>メソッドに<code>show</code>メソッドを追加しておこう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">func</span> _ready():
	show() <span style="color:#75715e"># 追加</span>
	pause_screen<span style="color:#f92672">.</span>pause_mode <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
	get_tree()<span style="color:#f92672">.</span>paused <span style="color:#f92672">=</span> true
</code></pre></div><p>シーンドックで「Game.tscn」を開き、「NextScreen」ノードを非表示にしてしまおう。これで 2D ワークスペースで作業しやすくなったはずだ。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout_10/img_1.png" alt="シーンドックでNextScreenを非表示にする"  />
</p>
<br>
<hr>
<h1 id="powerup-シーンを作る">Powerup シーンを作る<a hidden class="anchor" aria-hidden="true" href="#powerup-シーンを作る">#</a></h1>
<p>パワーアップアイテムは、ブロックを崩した時に一定の確率でドロップするようにしたい。となると、パワーアップアイテムが常に「Game」シーンに存在するわけではない。このような場合は、パワーアップアイテムの設計図となるシーンを一つ作成しておき、ブロックを崩した時に、一定の確率で「Game」シーン内にそのインスタンスを生成する、という仕組みを構成していけば良い。</p>
<br>
<h2 id="シーンを新規作成する">シーンを新規作成する<a hidden class="anchor" aria-hidden="true" href="#シーンを新規作成する">#</a></h2>
<p>まずはパワーアップアイテムのシーンを新規作成する。ルートノードとして「Area2D」クラスのノードを作成し、その名前を「Powerup」に変更しておこう。そして、そのままシーンを「res://scene/Powerup.tscn」として保存しておこう。</p>
<p>ここで、なぜ「Area2D」を選んだのか説明しておく。</p>
<p>パワーアップアイテムがブロックを消した時に画面上に現れ、そこから画面下方へ落ちていき、パドルに衝突したらアイテムは消え、パワーアップ処理が実行されるようにしたい。他の物理オブジェクトと衝突した時にシグナルを発することができるのが「Area2D」か「RigidBody2D」のどちらかだ。「StaticBody2D」や「KinematicBody2D」はそのようなシグナルは用意されていないのでここでは使えない。さらに「RigidBody2D」は物理処理を自動的にしてくれるが、ただ下方向に移動するだけのオブジェクトにとっては自動の物理演算は不要だ。このような理由から「Area2D」ノードを選択した。</p>
<br>
<h2 id="ノードを追加する">ノードを追加する<a hidden class="anchor" aria-hidden="true" href="#ノードを追加する">#</a></h2>
<p>次に必要な子ノードを追加していく。</p>
<p>まず「AnimatedSprite」クラスのノードを追加する。このクラスは、通常の「Sprite」クラスとは異なり、「Texture」プロパティの代わりに「Frames」というプロパティがある。これは画像ファイル単体を適用するプロパティではなく、複数の画像ファイルや画像をまとめたシート形式のファイルを適用して、アニメーションを作成するためのプロパティだ。パワーアップアイテムがドロップしている最中に簡単なアニメーションをさせるために、こちらのクラスを採用した。</p>
<p>次は、例によって「CollisionShape2D」ノードを追加しておこう。名前はそのままで良い。</p>
<p>2つの子ノードを追加した結果、シーンドックは以下のようになったはずだ。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout_10/img_2.png" alt="Powerupシーンのノード"  />
</p>
<br>
<h2 id="プロパティを編集する">プロパティを編集する<a hidden class="anchor" aria-hidden="true" href="#プロパティを編集する">#</a></h2>
<p>「Powerup.tscn」シーンは、ドロップするアイテムによって、そのインスタンスのプロパティが異なる部分がある。どのアイテムがドロップする場合でも共通して設定が必要なプロパティだけ、インスペクタドックで編集していく。アイテムによって値が異なるプロパティについては、スクリプトで変更していく予定だ。</p>
<h3 id="animatedsprite-のプロパティを編集する">AnimatedSprite のプロパティを編集する<a hidden class="anchor" aria-hidden="true" href="#animatedsprite-のプロパティを編集する">#</a></h3>
<p>まずは「Frames」プロパティで「新規 SpriteFrames」を選択する。「Resource」セクションを展開して、「Local to Scene」プロパティにチェックを入れてオンにしておこう。これをしていないと、ドロップしたアイテムのアニメーションフレームが同じリソースを参照することになり、ドロップした全てのアイテムの画像が追加された同一のアニメーションになってしまうので注意してほしい。「Path」プロパティは「res://scene/Powerup.tscn::1」になっていればOKだ。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout_10/img_3.png" alt="Powerupシーンのインスペクタ1"  />
</p>
<p>ここで、「SpriteFrames」を編集する。シーンドックで「AnimatedSprite」を選択した状態で画面下部の<strong>スプライトフレーム</strong>エディタを開こう。最初から「default」という名前のアニメーションがあるので、その名前を「drop」に変更しておこう。速度は「4 フレーム」にする。ループはそのまま有効にしておく。</p>
<p>今はアニメーションフレームは空っぽのままで良い。あくまでこのシーンはインスタンスのための雛形なので、パワーアップアイテムによって内容が変わる部分はそのままにしなければならない。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout_10/img_4.png" alt="アニメーションフレーム"  />
</p>
<p>インスペクタに戻り、「Animation」プロパティで、今しがた作成した「drop」アニメーションを選択しよう。アニメーションはパワーアップアイテムが画面上に出現した時点で再生したいので、「Playing」プロパティをオンにしておこう。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout_10/img_5.png" alt="インスペクタ"  />
</p>
<h3 id="collisionshape2d-のプロパティを編集する">CollisionShape2D のプロパティを編集する<a hidden class="anchor" aria-hidden="true" href="#collisionshape2d-のプロパティを編集する">#</a></h3>
<p>今度はインスペクタドックで「CollisionShape2D」ノードのプロパティを編集していこう。</p>
<p>まずは「Shape」プロパティで「新規 RectangleShape」を設定する。あとは、2D ワークスペースでハンドルをドラッグしてサイズをちょうど縦横 20 px の正方形になるように調整する。上と左の目盛りを参考にサイズを合わせると良い。</p>
<p>ただ、今回は Sprite の画像がなくてやりにくいと感じるかもしれない。一旦この「RectangleShape」を調整するために、「AnimatedSprite」ノードの「drop」アニメーションに、アニメーションフレームとして画像を一つ暫定的に追加しても良い。例えば下のスクリーンショットでは「Heart3.png」を追加している。「RectangleShape」のサイズ調整が終わったら、忘れず追加した画像を消しておこう。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout_10/img_6.png" alt="アニメーションフレーム"  />
<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout_10/img_7.png" alt="2D ワークスペース"  />
</p>
<p>これでインスペクタドックでのプロパティの編集はひとまず完了だ。</p>
<br>
<h2 id="コリジョンレイヤーを編集する">コリジョンレイヤーを編集する<a hidden class="anchor" aria-hidden="true" href="#コリジョンレイヤーを編集する">#</a></h2>
<p>実は、先ほど作成したパワーアップアイテムのコリジョンシェイプのサイズはブロックのそれより大きい。このままだとどうなるかというと、パワーアップアイテムはゲームに出現すると、すぐに上下左右の隣り合っているブロックと衝突してしまう。このあとスクリプトで「衝突したら画面から消える」コードを実装したら、出てきた瞬間に消えることになる。</p>
<p>このような状況を回避するため、一般的なお作法として、オブジェクトの種類ごとに衝突用のレイヤーを分け、衝突反応を有効にする他のレイヤーを指定する。このレイヤーをコリジョンレイヤーと言う。それでは実際にやってみよう。</p>
<p>まずはわかりやすくゲームで使用するコリジョンレイヤーに名前をつける。「プロジェクト」メニュー＞「プロジェクト設定」＞「一般」タブ＞サイドバーから「Layer Names」カテゴリの「2d Physics」を開き、必要な分だけレイヤーに名前をつけよう。このブロック崩しでは以下のレイヤーを使用する。</p>
<ul>
<li>Paddle</li>
<li>Ball</li>
<li>Wall</li>
<li>Brick</li>
<li>Item<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout_10/img_7.1.png" alt="コリジョンレイヤーのプロジェクト設定"  />
</li>
</ul>
<p>では順番にコリジョンレイヤーの設定をしていこう。基本的にはコリジョンを持つノードで以下の手順を同じようにやっていくだけで良い。</p>
<ol>
<li>シーンドックでコリジョンレイヤーを設定したいノード（ここでは「Paddle」ノード）を選択する。</li>
<li>インスペクタドックで「Collision」セクションを開く</li>
<li>「Layer」でそのノードが所属するレイヤーを選択する。<br>
「&hellip;」をクリックするとレイヤー名を見ながらチェックして選択できるのでおすすめだ。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout_10/img_7.2.png" alt="インスペクタでコリジョンレイヤーの設定"  />
</li>
<li>「Mask」でそのノードとの衝突反応を有効にしたいレイヤーを同様に選択する。例えば「Paddle」ノードの場合、衝突を有効にしたいのは「Ball」と「Wall」と「Item」だ。</li>
</ol>
<p>以上の手順で、コリジョンを持つノードに対して順番に設定していくと以下のようになったはずだ。</p>
<ul>
<li>「Paddle」ノード<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout_10/img_7.4.png" alt="Paddleのコリジョンレイヤーの設定"  />
</li>
<li>「Ball」ノード<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout_10/img_7.5.png" alt="Ballのコリジョンレイヤーの設定"  />
</li>
<li>「Wall」ノード<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout_10/img_7.6.png" alt="Wallのコリジョンレイヤーの設定"  />
</li>
<li>「Brick」ノード（「Brick.tscn」に切り替えて）<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout_10/img_7.7.png" alt="Brickのコリジョンレイヤーの設定"  />
</li>
<li>「Item」ノード（「Powerup.tscn」に切り替えて）<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout_10/img_7.8.png" alt="Powerupのコリジョンレイヤーの設定"  />
</li>
</ul>
<p>これでパワーアップアイテムはパドルとしか衝突しなくなった。</p>
<br>
<h2 id="スクリプトで-powerup-シーンを制御する">スクリプトで Powerup シーンを制御する<a hidden class="anchor" aria-hidden="true" href="#スクリプトで-powerup-シーンを制御する">#</a></h2>
<p>「Powerup」ルートノードにスクリプトにアタッチしよう。スクリプトは「res://scripts/Powerup.gd」として保存しておこう。このスクリプトでは主に、どのパワーアップアイテムが出るかをランダムで確定させ、確定したアイテムによって異なるアニメーションフレームを設定する。</p>
<h3 id="スクリプト全体の最終形">スクリプト全体の最終形<a hidden class="anchor" aria-hidden="true" href="#スクリプト全体の最終形">#</a></h3>
<details>
<summary>スクリプト全体を見る</summary>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Area2D</span>


<span style="color:#66d9ef">signal</span> item_collided(item)

<span style="color:#66d9ef">enum</span> Powerup {
	SLOW,
	EXPAND,
	MULTIPLE,
	LASER,
	LIFE,
}

<span style="color:#66d9ef">var</span> chosen_item <span style="color:#f92672">=</span> null

<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> sprite <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimatedSprite</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> slow_1 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Slow1.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> slow_2 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Slow2.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> slow_3 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Slow3.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> slow_frames <span style="color:#f92672">=</span> [slow_1, slow_2, slow_3]
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> expand_1 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Expand1.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> expand_2 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Expand2.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> expand_3 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Expand3.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> expand_frames <span style="color:#f92672">=</span> [expand_1, expand_2, expand_3]
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> multiple_1 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Multiple1.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> multiple_2 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Multiple2.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> multiple_frames <span style="color:#f92672">=</span> [multiple_1, multiple_2]
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> laser_1 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Laser1.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> laser_2 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Laser2.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> laser_3 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Laser3.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> laser_frames <span style="color:#f92672">=</span> [laser_1, laser_2, laser_3]
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> life_1 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Heart1.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> life_2 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Heart2.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> life_3 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Heart3.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> life_frames <span style="color:#f92672">=</span> [life_1, life_2, life_3]


<span style="color:#66d9ef">func</span> _ready():
	randomize()
	add_sprite_frames()
	
	
<span style="color:#66d9ef">func</span> add_sprite_frames():
	sprite<span style="color:#f92672">.</span>frames<span style="color:#f92672">.</span>clear(<span style="color:#e6db74">&#34;drop&#34;</span>)
	<span style="color:#66d9ef">var</span> random_num <span style="color:#f92672">=</span> randf()
	<span style="color:#66d9ef">var</span> item_list <span style="color:#f92672">=</span> []
	
	<span style="color:#66d9ef">if</span> random_num <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0.3</span>:
		item_list <span style="color:#f92672">+=</span> slow_frames
		chosen_item <span style="color:#f92672">=</span> Powerup<span style="color:#f92672">.</span>SLOW
	<span style="color:#66d9ef">elif</span> random_num <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0.55</span>:
		item_list <span style="color:#f92672">+=</span> expand_frames
		chosen_item <span style="color:#f92672">=</span> Powerup<span style="color:#f92672">.</span>EXPAND
	<span style="color:#66d9ef">elif</span> random_num <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0.75</span>:
		item_list <span style="color:#f92672">+=</span> multiple_frames
		chosen_item <span style="color:#f92672">=</span> Powerup<span style="color:#f92672">.</span>MULTIPLE
	<span style="color:#66d9ef">elif</span> random_num <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0.9</span>:
		item_list <span style="color:#f92672">+=</span> laser_frames
		chosen_item <span style="color:#f92672">=</span> Powerup<span style="color:#f92672">.</span>LASER
	<span style="color:#66d9ef">else</span>:
		item_list <span style="color:#f92672">+=</span> life_frames
		chosen_item <span style="color:#f92672">=</span> Powerup<span style="color:#f92672">.</span>LIFE
	
	print(<span style="color:#e6db74">&#34;Powerup node: &#34;</span>, chosen_item)
	
	<span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> item_list:
		<span style="color:#75715e"># add to the head</span>
		sprite<span style="color:#f92672">.</span>frames<span style="color:#f92672">.</span>add_frame(<span style="color:#e6db74">&#34;drop&#34;</span>, item, <span style="color:#ae81ff">0</span>)


<span style="color:#66d9ef">func</span> _physics_process(_delta):
	position<span style="color:#f92672">.</span>y <span style="color:#f92672">+=</span> <span style="color:#ae81ff">0.75</span>


<span style="color:#66d9ef">func</span> _on_Powerup_body_entered(body):
	emit_signal(<span style="color:#e6db74">&#34;item_collided&#34;</span>, chosen_item)
	queue_free()
</code></pre></div></details>
<br>
<p>ではここから小分けにスクリプトを解説していく。</p>
<h3 id="シグナルを定義する">シグナルを定義する<a hidden class="anchor" aria-hidden="true" href="#シグナルを定義する">#</a></h3>
<p>オリジナルのシグナル<code>item_collided</code>を用意した。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">signal</span> item_collided(item)
</code></pre></div><p>これは主に「Game.gd」スクリプトの方で利用するためのものだ。このシグナルの定義の段階では、特に引数を記述する必要はないが、わかりやすいので記述した。<code>item</code>でアイテムの種類を「Game」ノードへ渡せるようにするつもりだ。</p>
<h3 id="enum-を定義する">enum を定義する<a hidden class="anchor" aria-hidden="true" href="#enum-を定義する">#</a></h3>
<p>次に<code>Powerup</code>という名前の<code>enum</code>を定義している。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">enum</span> Powerup {
	SLOW,
	EXPAND,
	MULTIPLE,
	LASER,
	LIFE,
}
</code></pre></div><p>これは要素を一つずつ<code>const</code>キーワードで定数として、値を<code>0</code>、<code>1</code>、<code>2</code>&hellip; と順番に定義しているのと同義だ。例えば以下のような感じだ。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">const</span> SLOW <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">const</span> EXPAND <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</code></pre></div><p><code>enum</code>というのはプルダウンメニューのようなものだ。その要素として大文字で<code>SLOW</code>や<code>EXPAND</code>などいくつか並んでいるが、これらはパワーアップアイテムの種類だ。ここで一度、実装を予定しているパワーアップアイテムを紹介しておく。</p>
<ul>
<li>SLOW：ボールのスピードが初期値に戻る（ゆっくりになる）</li>
<li>EXPAND：バーが横に2倍拡大する</li>
<li>MULTIPLE：一定時間ボールを複数発射できるようになる</li>
<li>LASER：レーザービームを発射してブロックを消すことができる</li>
<li>LIFE：ライフが 1 増える（最大 5）</li>
</ul>
<h3 id="変数-chosen_item-を定義する">変数 chosen_item を定義する<a hidden class="anchor" aria-hidden="true" href="#変数-chosen_item-を定義する">#</a></h3>
<p>そして、enum のあとは、変数<code>chosen_item</code>を定義している。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">var</span> chosen_item <span style="color:#f92672">=</span> null
</code></pre></div><p>ブロックを一つ消した時に、ランダムで決定されるアイテムの種類を保存する。その種類は先に定義した<code>enum Powerup</code>から選択される。初期値はひとまず<strong>何もないことを示す</strong><code>null</code>としている。あとで、どのアイテムがドロップしたかを、それぞれのアイテムが一定の割合で選択されるようにコーディングし、この<code>chosen_item</code>にそのアイテムを値として入れることになる。</p>
<h3 id="_physics_process-メソッドを定義する">_physics_process メソッドを定義する<a hidden class="anchor" aria-hidden="true" href="#_physics_process-メソッドを定義する">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">func</span> _physics_process(_delta):
	position<span style="color:#f92672">.</span>y <span style="color:#f92672">+=</span> <span style="color:#ae81ff">0.75</span>
</code></pre></div><p><code>_physics_process</code>メソッドを追加した。このメソッドでは、毎フレーム、「Powerup」ノードの<code>position</code>プロパティの<code>y</code>座標を 0.5 ずつ加算している。一般的にゲームの<code>y</code>座標は画面の下方向にいくほど増加する。したがって、パワーアップアイテムがドロップしている時の動きがこれで実装できたはずだ。</p>
<p>ここまでで、一旦スクリプトの内容を網羅した。次に、ドロップしたアイテムにパドルが衝突したら、アイテムが画面上から消える動きを作る。これにはシグナルを利用する。</p>
<p>シーンドックで「Powerup」ノードを選択し、ノードドック＞シグナルを表示すると<code>body_entered(body: Node)</code>というシグナルが見つかるはずだ。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout_10/img_8.png" alt="シグナルbody_entered"  />
</p>
<p>これを「Powerup.gd」スクリプトに接続しよう。すると、スクリプトに<code>_on_Powerup_body_entered</code>メソッドが追加される。</p>
<p>パワーアップアイテムに何らかのオブジェクトが衝突するとシグナル<code>body_entered</code>が発信され、メソッド<code>_on_Powerup_body_entered</code>が実行される。これを利用して、このメソッド内にオブジェクトを開放するためのメソッド<code>queue_free</code>メソッドを追加すれば、パワーアップアイテムがパドルに当たった瞬間に画面から消えてくれるようになる。さらにその手前に、<code>emit_signal</code>メソッドを追加する。これで先に用意したシグナル<code>item_collided</code>もパドルとアイテムが衝突した時に発信されるようになる。引数に変数<code>chosen_item</code>を入れることも忘れずに。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">func</span> _on_Powerup_body_entered(body):
	emit_signal(<span style="color:#e6db74">&#34;item_collided&#34;</span>, chosen_item)
	queue_free()
</code></pre></div><br>
<h3 id="シーンを実行してドロップ時の動きを確認する">シーンを実行してドロップ時の動きを確認する<a hidden class="anchor" aria-hidden="true" href="#シーンを実行してドロップ時の動きを確認する">#</a></h3>
<p>では「Powerup.gd」スクリプトの編集ができたところで、一度シーンを実行してみよう。実行前に「デバッグ」メニューで「コリジョン形状の表示」にチェックを入れておこう。2D ワークスペースで「Powerup」ノードを画面中央上部に一時的に移動してから確認するとわかりやすいだろう。</p>
<p><img loading="lazy" src="/images/tutorials/gd0004_breakout_10/img_9.gif" alt="デバッグパネルでアイテムドロップ時の動きを確認"  />
</p>
<p>想定通りに落ちてきてくれた。ブロックを消してパワーアップアイテムがドロップするときは、このような動きになる。</p>
<h3 id="onready-キーワードの変数でアニメーションフレーム用画像を定義">onready キーワードの変数でアニメーションフレーム用画像を定義<a hidden class="anchor" aria-hidden="true" href="#onready-キーワードの変数でアニメーションフレーム用画像を定義">#</a></h3>
<p>さあここで大量の<code>onready</code>キーワード付きの変数を定義している。臆さずよく見てみよう。ほとんどが、似たようなコードの繰り返しになっているのがなんとなくわかるだろう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> sprite <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">AnimatedSprite</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> slow_1 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Slow1.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> slow_2 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Slow2.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> slow_3 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Slow3.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> slow_frames <span style="color:#f92672">=</span> [slow_1, slow_2, slow_3]
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> expand_1 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Expand1.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> expand_2 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Expand2.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> expand_3 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Expand3.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> expand_frames <span style="color:#f92672">=</span> [expand_1, expand_2, expand_3]
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> multiple_1 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Multiple1.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> multiple_2 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Multiple2.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> multiple_frames <span style="color:#f92672">=</span> [multiple_1, multiple_2]
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> laser_1 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Laser1.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> laser_2 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Laser2.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> laser_3 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Laser3.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> laser_frames <span style="color:#f92672">=</span> [laser_1, laser_2, laser_3]
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> life_1 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Heart1.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> life_2 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Heart2.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> life_3 <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://sprites/Heart3.png&#34;</span>)
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> life_frames <span style="color:#f92672">=</span> [life_1, life_2, life_3]
</code></pre></div><p>最初の1行だけ別物で、子ノード「AnimatedSprite」にアクセスしやすいように、変数に代入している。</p>
<p>それ以外の変数は4行ごとにほぼ似たような定義を繰り返している。その4行ひと塊について説明していこう。</p>
<p><code>preload</code>で読み込んでいるのは、パワーアップアイテムのアニメーションフレーム用の Sprite 画像だ。これは<code>preload()</code>と記述したあと、<code>()</code>の中に、ファイルシステムドックから Sprite 画像ファイルをドラッグ&amp;ドロップするとファイルパスに変換してくれる。変数<code>slow_1</code>、<code>slow_2</code>、<code>slow_3</code>までは Sprite 画像を<code>Preload</code>している。</p>
<p>そのあとの変数<code>slow_frames</code>は<code>[]</code>で括っているので、これは配列（Array）だ。配列の要素として、先に定義した<code>slow_1</code>、<code>slow_2</code>、<code>slow_3</code>が入っている。この配列は、あとでアニメーションフレームをコードで設定するための下準備となっている。</p>
<p>同様にして<code>expand</code>、<code>multiple</code>、<code>laser</code>、<code>life</code>の順番で画像を<code>preload</code>して、それらを配列の要素として定義している。</p>
<h3 id="_ready-メソッドを定義する">_ready メソッドを定義する<a hidden class="anchor" aria-hidden="true" href="#_ready-メソッドを定義する">#</a></h3>
<p>では次におなじみの<code>_ready</code>メソッドを確認しておこう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">func</span> _ready():
	randomize()
	add_sprite_frames()
</code></pre></div><p><code>randomize</code>というメソッドを実行しているが、これはあとで登場する、ランダムな数値を取得するために事前に必要になるメソッドだ。<code>randomize</code>を事前に実行しておかないと、ランダムな数値を取得するはずのメソッドを実行しても、毎回同じ数値を取得することになるので要注意だ。</p>
<p>次に実行しているのが<code>add_sprite_frames</code>というメソッドだ。このメソッドの目的は、ランダムで決定したパワーアップアイテムの種類によって、適切なアニメーションフレームを設定する役割を担っている。</p>
<h3 id="add_sprite_frames-メソッドを定義する">add_sprite_frames メソッドを定義する<a hidden class="anchor" aria-hidden="true" href="#add_sprite_frames-メソッドを定義する">#</a></h3>
<p>そして、スクリプトの最後に定義しているのが<code>add_sprite_frames</code>というメソッドで、これが<code>_ready</code>メソッド内で実行されているメソッドだ。ではその中身を見ていこう。少しコードが長いので、さらに小分けにして説明する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">func</span> add_sprite_frames():
	<span style="color:#66d9ef">var</span> random_num <span style="color:#f92672">=</span> randf()
	<span style="color:#66d9ef">var</span> item_list <span style="color:#f92672">=</span> []
</code></pre></div><p>まずメソッド内で<code>random_num</code>という変数を定義しており、その中身は<code>randf</code>というメソッドになっている。このメソッドはランダムな数値（float型）を<code>0</code>から<code>1</code>の間で返してくれる。例えば<code>0.07</code>や<code>0.8993</code>のような数値だ。ただし、先に<code>randomize</code>メソッドを実行している必要がある。</p>
<p>次に<code>item_list</code>という変数を定義している。その値は、一旦、空の配列<code>[]</code>のみになっている。これは後ほど使用する。では<code>add_sprite_frames</code>内の次のコードを見ていこう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">if</span> random_num <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0.3</span>:
  item_list <span style="color:#f92672">+=</span> slow_frames
  chosen_item <span style="color:#f92672">=</span> Powerup<span style="color:#f92672">.</span>SLOW
<span style="color:#66d9ef">elif</span> random_num <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0.55</span>:
  item_list <span style="color:#f92672">+=</span> expand_frames
  chosen_item <span style="color:#f92672">=</span> Powerup<span style="color:#f92672">.</span>EXPAND
<span style="color:#66d9ef">elif</span> random_num <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0.75</span>:
  item_list <span style="color:#f92672">+=</span> multiple_frames
  chosen_item <span style="color:#f92672">=</span> Powerup<span style="color:#f92672">.</span>MULTIPLE
<span style="color:#66d9ef">elif</span> random_num <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0.9</span>:
  item_list <span style="color:#f92672">+=</span> laser_frames
  chosen_item <span style="color:#f92672">=</span> Powerup<span style="color:#f92672">.</span>LASER
<span style="color:#66d9ef">else</span>:
  item_list <span style="color:#f92672">+=</span> life_frames
  chosen_item <span style="color:#f92672">=</span> Powerup<span style="color:#f92672">.</span>LIFE
</code></pre></div><p>この部分のコードは<code>if / elif / else</code>構文になっている。</p>
<p><code>if random_num &lt;= xxx</code>という形式のコードは、もし「<code>random_num</code>の数値が<code>xxx</code>以下だったら」という意味になる。そして、<code>elif</code>は「その前の<code>if</code>や<code>elif</code>に当てはまらなかったら」という条件も含む。最後の<code>else</code>は「その前までの<code>if</code>や<code>elif</code>全てに当てはまらなかったら」という意味だ。つまり、このブロックの概要としては、先にメソッド内で定義した変数<code>random_num</code>のランダムな値によって、落ちるパワーアップアイテムが変わるようになっている。</p>
<p>そして<code>item_list += xxx_frames</code>という形のコードについては、先に定義した<code>item_list</code>という空っぽの配列に、例えば<code>slow_frames</code>や<code>multiple_frames</code>などの、アニメーションフレーム用の画像ファイルを含む配列の要素を<strong>足す</strong>という意味になる。</p>
<p>ちなみに、<code>random_num</code>の最大値は<code>1</code>、最大値は<code>1</code>であることを踏まえると、このサンプルコードでは以下の確率で落ちるアイテムが決まる。もちろん、あなたの好きな確率を割り振っていただいて全く問題ない。</p>
<ul>
<li><code>0</code>以上<code>0.3</code>以下（30%の確率)：「Slow」のアイテムが落ちる</li>
<li><code>0.3</code>より大きく<code>0.55</code>以下（25%の確率）：「Expand」のアイテムが落ちる</li>
<li><code>0.55</code>より大きく<code>0.75</code>以下（20%の確率）：「Multiple」のアイテムが落ちる</li>
<li><code>0.75</code>より大きく<code>0.9</code>以下（15%の確率）：「Laser」のアイテムが落ちる</li>
<li><code>0.9</code>より大きく<code>1</code>以下（10%の確率）：「Life」のアイテムが落ちる</li>
</ul>
<p>ところで、アイテムが落ちるかどうかの確率はまた別で設定することになる。つまり、それぞれのアイテムが実際のゲーム中に現れる確率は、アイテム出現率とそれぞれのアイテムの出現割合の掛け算になるので、さらに低くなる。</p>
<p>そのあとの<code>chosen_item = Powerup.xxx</code>の形式のコードも見ておこう。変数<code>chosen_item</code>に enum <code>Powerup</code>の要素のうち<code>random_num</code>の値によって確定したパワーアップアイテムが入る形だ。例えば、<code>random_num</code>の値が<code>0.789</code>だった場合は<code>LASER</code>が<code>chosen_item</code>に代入される。これにより「Powerup」ノードの<code>chosen_item</code>という変数から、どのアイテムに確定したのかがわかるようになる。これは「Game.tscn」シーンでパワーアップの個々の機能を実装するときに役に立つだろう。</p>
<h3 id="add_sprite_frames-メソッドを定義する-1">add_sprite_frames メソッドを定義する<a hidden class="anchor" aria-hidden="true" href="#add_sprite_frames-メソッドを定義する-1">#</a></h3>
<p>それでは<code>add_sprite_frames</code>メソッドの最後の部分を見てみよう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> item_list:
  <span style="color:#75715e"># add to the head</span>
  frames<span style="color:#f92672">.</span>add_frame(<span style="color:#e6db74">&#34;drop&#34;</span>, item, <span style="color:#ae81ff">0</span>)
</code></pre></div><p><code>for</code>ループだ。文法上、<code>for ... in xxx</code>の<code>xxx</code>には配列や値の範囲を記述するが、このコードでは配列<code>item_list</code>が記述されている。<code>item_list</code>にはすでに、<code>random_num</code>の値によって選ばれたパワーアップアイテムのアニメーションフレーム用画像が含まれている。そして<code>...</code>は、配列の要素一つ一つを順番に当てはめていく。そして、要素を当てはめるごとに、<code>for</code>ループのブロック内のコードを実行する。</p>
<p>このコードの具体的な話をすると、まず、配列<code>item_list</code>内のアニメーションフレームの画像一つ一つが順番に<code>item</code>に当てはめられる。そして、<code>frames</code>プロパティの<code>add_frame</code>メソッドが第一引数にアニメーション「drop」を、第二引数に<code>item</code>つまりアニメーションフレーム用画像を、第三引数に<code>0</code>を指定して実行されている。</p>
<p>つまり、このメソッドは、アニメーション「drop」のアニメーションフレームの<code>0</code>の位置に画像を追加している。追加位置は<code>0</code>は最初（先頭）だ。</p>
<p>デフォルトでは第三引数の値は<code>-1</code>、つまり最後（末尾）と決まっているのに、なぜ敢えて先頭にしているのか。これは少しややこしく、細かい話だが説明しておく。</p>
<p>今回ファイルシステムドックを見ていただくとわかる通り、画像のファイル名の末尾の数字が、実際にアニメーションで表示したい順番とは逆なのだ。例えば「Expand」アイテムのアニメーションとしては、両端が左右に向いた矢印が小さい状態から左右に伸びるようなアニメーションにしたいが、「expand_1」の画像が一番左右に伸びていて「expand_3」は一番短くなっている。配列<code>expand_frames</code>内の画像ファイルは名前の順番になっており、<code>item_list</code>に画像ファイルが追加された後も同じだ。その結果、<code>for</code>ループは<code>expand_1</code>から順にアニメーションフレームに追加されるため、<code>expand_3</code>がアニメーションの先頭に来るようにするには、<code>for</code>ループで毎回アニメーションフレームの先頭に追加する必要があるというわけだ。</p>
<br>
<h3 id="シーンを実行して確認する">シーンを実行して確認する<a hidden class="anchor" aria-hidden="true" href="#シーンを実行して確認する">#</a></h3>
<p>それでは、ランダムでドロップするパワーアップアイテムが変わるかどうか、シーンを実行して確認してみよう。今回も「Powerup」ノードを画面の上部中央に配置してから確認するとわかりやすいだろう。</p>
<p><img loading="lazy" src="/images/tutorials/gd0004_breakout_10/img_10.gif" alt="デバッグパネルでアイテムランダムドロップ確認"  />
<br>
時々デバッグパネルが開くのに時間がかかっているが、ランダムでアイテムが変わることが確認できた。</p>
<p>次はいよいよ「Game」シーンにパワーアップアイテムを登場させる。</p>
<br>
<h2 id="スクリプトで-game-シーンにパワーアップアイテムをドロップさせる">スクリプトで Game シーンにパワーアップアイテムをドロップさせる<a hidden class="anchor" aria-hidden="true" href="#スクリプトで-game-シーンにパワーアップアイテムをドロップさせる">#</a></h2>
<p>実際のゲーム画面にパワーアップアイテムが表示されるように更新していこう。パワーアップアイテムのノードは、ブロックを消したタイミングでシーンに追加されるものなので、「Game.gd」スクリプトで出現と解放をコントロールする必要がある。</p>
<p>それでは「Game.gd」スクリプトを編集していこう。</p>
<h3 id="変数を2つ追加する">変数を2つ追加する<a hidden class="anchor" aria-hidden="true" href="#変数を2つ追加する">#</a></h3>
<p>まずは、新たに定義したプロパティから。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Node2D</span>

<span style="color:#66d9ef">const</span> POINT <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>

<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">var</span> drop_rate<span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e"># 追加</span>

<span style="color:#75715e"># 中略</span>

<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> powerup <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://scene/Powerup.tscn&#34;</span>) <span style="color:#75715e"># 追加</span>
</code></pre></div><p>最初に追加した変数は<code>drop_rate</code>だ。これはブロックを消した時の出現率だ。デバッグのために値は一旦<code>1</code>としている。これは 100 % と同義だ。本番ではこれを 0.05 ~ 0.25 くらいに収めるのが適当だろう。<code>export</code>キーワードをつけて、インスペクタで簡単に編集できるようにしている。</p>
<p>次に<code>onready</code>付きの変数<code>powerup</code>を定義している。内容は PackedScene の「Powerup.tscn」、つまり先に作成しておいた「Powerup」シーンだ。ブロックを消してアイテムがドロップした時に、このシーンを継承する形で「Game」ルートノードに追加しやすいように、先にシーンを変数に代入している。</p>
<h3 id="_ready-メソッドを編集する">_ready メソッドを編集する<a hidden class="anchor" aria-hidden="true" href="#_ready-メソッドを編集する">#</a></h3>
<p>次に<code>_ready</code>メソッド内に1行追加し、1行更新した。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">func</span> _ready():
	<span style="color:#75715e"># For debug</span>
	<span style="color:#75715e">#leave_one_brick(43)</span>
	randomize() <span style="color:#75715e"># 追加</span>
	update_hud_life()
	
	ball<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#34;tree_exited&#34;</span>, self, <span style="color:#e6db74">&#34;_on_Ball_tree_exited&#34;</span>)
	
	<span style="color:#66d9ef">for</span> brick <span style="color:#f92672">in</span> level<span style="color:#f92672">.</span>get_children():
		brick<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#34;tree_exited&#34;</span>, self, <span style="color:#e6db74">&#34;_on_Brick_tree_exited&#34;</span>, [brick<span style="color:#f92672">.</span>global_position]) <span style="color:#75715e"># 更新</span>
</code></pre></div><p>まずは「# 追加」のコメントがある行だ。<code>randomize</code>メソッドを実行している。これは以前にも登場したが、以降に<code>randf</code>や<code>random_range</code>などのランダムな値を返すメソッドを実行する際には事前に必ず必要な処理だ。これがないと、毎回同じ値が出力されてしまう。「Game.gd」スクリプトでは、ブロックを消した時にパワーアップアイテムを一定確率で出現させる処理で必要になる。</p>
<p>次に一番下の<code>for</code>ループ内の処理で実行している<code>brick</code>の<code>connect</code>メソッドだ。これはシグナルをコードで接続するためのメソッドであることは以前にも説明していたが、今回そのメソッドに第四引数を追加した。それが<code>[brick.global_position]</code>だ。個々のブロックの<code>global_position</code>プロパティの値、つまりゲーム画面上のブロックの座標位置を渡している。</p>
<p>ちなみに、第四引数は必ず配列として<code>[]</code>で括る決まりになっている。この配列に複数のプロパティを追加することが可能で、その値を接続先のメソッドの引数として使用することができる。今回、ブロックを消したらそのブロックの座標位置からパワーアップアイテムをドロップさせる必要があるので、この<code>global_position</code>を引数として追加した。</p>
<br>
<p>さてここで、コードの順番通りに<code>_on_Ball_tree_exited</code>の追加を説明したいところだが、更新内容的には後回しにしたほうが良いだろう。</p>
<h3 id="_on_brick_tree_exited-メソッドを編集する">_on_Brick_tree_exited メソッドを編集する<a hidden class="anchor" aria-hidden="true" href="#_on_brick_tree_exited-メソッドを編集する">#</a></h3>
<p>続いては<code>_on_Brick_tree_exited</code>メソッドの更新内容を見てみよう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#75715e"># Method receiving Brick signal</span>
<span style="color:#66d9ef">func</span> _on_Brick_tree_exited(brick_position):
	<span style="color:#75715e"># Update Score</span>
	score <span style="color:#f92672">+=</span> POINT <span style="color:#f92672">*</span> bonus_rate
	bonus_rate <span style="color:#f92672">+=</span> <span style="color:#ae81ff">0.1</span>
	hud_score<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Score: &#34;</span> <span style="color:#f92672">+</span> str(score)
	
	<span style="color:#75715e"># Exit current Level node</span>
	print(<span style="color:#e6db74">&#34;get child count: &#34;</span>, level<span style="color:#f92672">.</span>get_child_count())
	<span style="color:#66d9ef">if</span> level<span style="color:#f92672">.</span>get_child_count() <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>:
		level<span style="color:#f92672">.</span>queue_free()
		print(<span style="color:#e6db74">&#34;level queue free&#34;</span>)
		set_next_level()
	
	<span style="color:#75715e"># Drop powerup item</span>
	drop_powerup(brick_position) <span style="color:#75715e"># 追加</span>
</code></pre></div><p>追加したのは一番下の1行だ。<code>drop_powerup</code>というメソッドを実行し、引数には元の<code>_on_Brick_tree_exited</code>の引数である<code>brick_position</code>をとっている。そして、この引数<code>brick_position</code>の値というのは、先に<code>_ready</code>メソッド内の<code>connect</code>メソッドの第四引数として追加した個々のブロックの<code>global_position</code>とイコールだ。</p>
<h3 id="drop_powerup-メソッドを追加する">drop_powerup メソッドを追加する<a hidden class="anchor" aria-hidden="true" href="#drop_powerup-メソッドを追加する">#</a></h3>
<p>そして<code>drop_powerup</code>メソッドはこの後に定義されているので続けて見ていこう。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">func</span> drop_powerup(brick_position: <span style="color:#a6e22e">Vector2</span>):
	<span style="color:#66d9ef">if</span> randf() <span style="color:#f92672">&lt;=</span> drop_rate:
		<span style="color:#66d9ef">var</span> powerup_instance <span style="color:#f92672">=</span> powerup<span style="color:#f92672">.</span>instance()
		powerup_instance<span style="color:#f92672">.</span>position <span style="color:#f92672">=</span> brick_position
		call_deferred(<span style="color:#e6db74">&#34;add_child&#34;</span>, powerup_instance)
		powerup_instance<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#34;item_collided&#34;</span>, self, <span style="color:#e6db74">&#34;_on_Powerup_item_collided&#34;</span>) 
</code></pre></div><p>パワーアップアイテムの処理のために今回新しく定義したのがこの<code>drop_powerup</code>メソッドだ。</p>
<p>メソッドの内容は<code>if</code>ブロックになっている。<code>randf</code>メソッドは<code>0</code>から<code>1</code>の間の数値（float 型）を返す組み込み関数であることは先に説明した。これによって得られた値が、冒頭で定義した変数<code>drop_rate</code>以下であれば、<code>if</code>ブロックの中のコードが実行される。ちなみに、今はデバッグのため<code>drop_rate</code>を<code>1</code>にしているので、パワーアップアイテムが 100 % 出現するが、デバッグが済んで、<code>drop_rate</code>を仮に<code>0.1</code>にすれば、ブロックを消した時のアイテムの出現率は 10 % になるというわけだ。</p>
<p>では<code>if</code>ブロックの中を見ていこう。</p>
<p><code>var powerup_instance = powerup.instance()</code>で、まず事前に<code>preload</code>していた「Powerup.tscn」シーンのインスタンスを、変数<code>powerup_instance</code>として定義している。</p>
<p>そのあと、<code>powerup_instance.position = brick_position</code>で、そのインスタンスの座標位置をブロックの座標位置と一致させている。</p>
<p>続けて、<code>call_deferred(&quot;add_child&quot;, powerup_instance)</code>により、「Powerup」シーンのインスタンスを「Game.tscn」シーンに登場させるために、「Game」ルートノードの子ノードとして追加した。この時、処理が追いつかなくなる可能性があるため、<code>call_dererred</code>メソッドから<code>add_child</code>メソッドを実行している。</p>
<p>そして最後に、<code>powerup_instance.connect(&quot;item_collided&quot;, self, &quot;_on_Powerup_item_collided&quot;)</code>で、「Game」ノードの子になった「Powerup」ノードの<code>item_collided</code>シグナルをこのスクリプトの<code>_on_Powerup_item_collided</code>メソッドに接続している。</p>
<p>ちなみに、「Powerup.gd」スクリプトの編集で、パワーアップアイテムがパドルに衝突したらシグナルによって<code>_on_Powerup_body_entered</code>メソッドが実行され、シグナル<code>item_collided</code>を発信するようにしていたことを思い出してほしい。</p>
<p>ということで、<code>_on_Powerup_item_collided</code>メソッドにアイテムを獲得したあとのパワーアップ処理を追加していくことになるが、ここはアイテムの数だけコーディングする必要があるので、ボリューム的な問題で、次回のチュートリアルに回したいと思う。ひとまず引数には「Powerup.gd」で定義した<code>chosen_item</code>を指す<code>item</code>を引数にしてメソッドだけ定義しておこう。中に<code>pass</code>だけ記述しておけばエラーは表示されない。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">func</span> _on_Powerup_item_collided(item):
	<span style="color:#66d9ef">pass</span>
</code></pre></div><br>
<p>次にボールが画面下に落ちてしまった時に、画面上にドロップしているパワーアップアイテムを全て消去するようにする。そうしないと、例えば、次の新しいボールをパドルに乗せたまま「Laser」アイテムを取得し、レーザーで好きなだけブロックを消せるような状況が発生してしまう。このようなゲーム性を損なうパターンは避けるべきだ。</p>
<p>この処理をコーディングしやすくするために、先に「Powerup」ノードを追加するための新しいノードグループを作成する。シーンドックで「Powerup.tscn」を開いて、「Powerup」ノードを選択し、ノードドックの「グループ」タブで「PowerupItems」グループを追加しよう。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout_10/img_11.png" alt="PowerupItemsグループを追加"  />
</p>
<p>では「Game.gd」スクリプトの方に戻ろう。すでにある<code>_on_Ball_tree_exited</code>メソッドを更新する。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#75715e"># Method receiving Ball signal</span>
<span style="color:#66d9ef">func</span> _on_Ball_tree_exited():
	life <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
	update_hud_life()
	
	<span style="color:#66d9ef">if</span> life <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>:
		get_tree()<span style="color:#f92672">.</span>change_scene(<span style="color:#e6db74">&#34;res://scene/GameOverView.tscn&#34;</span>)
	<span style="color:#66d9ef">else</span>:
		<span style="color:#66d9ef">for</span> child <span style="color:#f92672">in</span> get_children(): <span style="color:#75715e"># 以下3行追加</span>
			<span style="color:#66d9ef">if</span> child<span style="color:#f92672">.</span>is_in_group(<span style="color:#e6db74">&#34;PowerupItems&#34;</span>):
				child<span style="color:#f92672">.</span>queue_free()
		paddle<span style="color:#f92672">.</span>position <span style="color:#f92672">=</span> paddle_position
		ball <span style="color:#f92672">=</span> load(<span style="color:#e6db74">&#34;res://scene/Ball.tscn&#34;</span>)<span style="color:#f92672">.</span>instance()
		call_deferred(<span style="color:#e6db74">&#34;add_child&#34;</span>, ball)
		call_deferred(<span style="color:#e6db74">&#34;move_child&#34;</span>, ball, <span style="color:#ae81ff">3</span>)
		ball<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#34;tree_exited&#34;</span>, self, <span style="color:#e6db74">&#34;_on_Ball_tree_exited&#34;</span>)
</code></pre></div><p><code>if / else</code>構文の<code>else</code>ブロックの最初に<code>for</code>ループのブロックを3行追加した。</p>
<p>まず<code>get_children</code>メソッドが「Game」ノードの全ての子ノードを配列の要素に追加した形で返してくれる。よって、この<code>for</code>ループは、この配列に対してのループ処理になる。<code>child</code>には順次「Game」ノードの子ノードが入る形になる。</p>
<p>ループ内の処理としては、まず最初に<code>if</code>構文で『その子ノードが先ほど作成した「PowerupItems」グループのメンバーだったら』という条件を定義し、それに当てはまれば<code>queue_free</code>メソッドでノードを解放する、という処理だ。つまり、画面下にボールが落ちた時に、パワーアップアイテムに該当するノードは全て消去される、というわけだ。</p>
<br>
<h3 id="プロジェクトを実行して最後の動作確認をする">プロジェクトを実行して最後の動作確認をする<a hidden class="anchor" aria-hidden="true" href="#プロジェクトを実行して最後の動作確認をする">#</a></h3>
<p>それでは最後にプロジェクトを実行して動作確認しておこう。まずは<code>drop_rate</code>を<code>1</code>にしたままで確認する。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout_10/img_12.gif" alt="プロジェクトを実行して最終動作確認その1"  />
</p>
<p>以下について問題ないことを確認できた。</p>
<ul>
<li>ブロックを消すと一定の割合でそれぞれのパワーアップアイテムがドロップする。</li>
<li>パドルにパワーアップアイテムが衝突するとパワーアップアイテムは画面上から消える。</li>
<li>ボールを画面下に落とすと、その時点でドロップしているパワーアップアイテムは画面上から消える。</li>
</ul>
<br>
<p>では次に、<code>drop_rate</code>を<code>0.1</code>にして再度プロジェクトを実行してみよう。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout_10/img_13.gif" alt="プロジェクトを実行して最終動作確認その2"  />
</p>
<p>少しハードモードな印象もあるが、割とありそうなアイテムのドロップ率だ。これくらいの確率なら、アイテムが落ちた時にプレイヤーに嬉しい気持ちを感じてもらえるのではないだろうか。もちろん、あなたのお好みの確率に調整していただければ問題ない。</p>
<hr>
<h1 id="おわりに">おわりに<a hidden class="anchor" aria-hidden="true" href="#おわりに">#</a></h1>
<p>以上で Part 10 は完了だ。今回はブロックを消したらランダムでパワーアップアイテムが落ちる仕組みを作った。</p>
<p>次回は個々のパワーアップ処理を実装していく。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://www.peanuts-code.com/ja/tags/godot/">Godot</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%82%B2%E3%83%BC%E3%83%A0%E9%96%8B%E7%99%BA/">ゲーム開発</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E5%B4%A9%E3%81%97/">ブロック崩し</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E4%B8%AD%E7%B4%9A/">中級</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout_11/">
    <span class="title">« 前のページ</span>
    <br>
    <span>Godot で作るブロック崩し Part 11：パワーアップを実装しよう！</span>
  </a>
  <a class="next" href="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout_9/">
    <span class="title">次のページ »</span>
    <br>
    <span>Godot で作るブロック崩し Part 9：アニメーションを追加しよう！</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るブロック崩し Part 10：パワーアップアイテムをドロップさせよう！ on twitter"
        href="https://twitter.com/intent/tweet/?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%20Part%2010%ef%bc%9a%e3%83%91%e3%83%af%e3%83%bc%e3%82%a2%e3%83%83%e3%83%97%e3%82%a2%e3%82%a4%e3%83%86%e3%83%a0%e3%82%92%e3%83%89%e3%83%ad%e3%83%83%e3%83%97%e3%81%95%e3%81%9b%e3%82%88%e3%81%86%ef%bc%81&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout_10%2f&amp;hashtags=Godot%2c%e3%82%b2%e3%83%bc%e3%83%a0%e9%96%8b%e7%99%ba%2c%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%2c%e4%b8%ad%e7%b4%9a">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るブロック崩し Part 10：パワーアップアイテムをドロップさせよう！ on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout_10%2f&amp;title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%20Part%2010%ef%bc%9a%e3%83%91%e3%83%af%e3%83%bc%e3%82%a2%e3%83%83%e3%83%97%e3%82%a2%e3%82%a4%e3%83%86%e3%83%a0%e3%82%92%e3%83%89%e3%83%ad%e3%83%83%e3%83%97%e3%81%95%e3%81%9b%e3%82%88%e3%81%86%ef%bc%81&amp;summary=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%20Part%2010%ef%bc%9a%e3%83%91%e3%83%af%e3%83%bc%e3%82%a2%e3%83%83%e3%83%97%e3%82%a2%e3%82%a4%e3%83%86%e3%83%a0%e3%82%92%e3%83%89%e3%83%ad%e3%83%83%e3%83%97%e3%81%95%e3%81%9b%e3%82%88%e3%81%86%ef%bc%81&amp;source=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout_10%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るブロック崩し Part 10：パワーアップアイテムをドロップさせよう！ on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout_10%2f&title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%20Part%2010%ef%bc%9a%e3%83%91%e3%83%af%e3%83%bc%e3%82%a2%e3%83%83%e3%83%97%e3%82%a2%e3%82%a4%e3%83%86%e3%83%a0%e3%82%92%e3%83%89%e3%83%ad%e3%83%83%e3%83%97%e3%81%95%e3%81%9b%e3%82%88%e3%81%86%ef%bc%81">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るブロック崩し Part 10：パワーアップアイテムをドロップさせよう！ on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout_10%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るブロック崩し Part 10：パワーアップアイテムをドロップさせよう！ on whatsapp"
        href="https://api.whatsapp.com/send?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%20Part%2010%ef%bc%9a%e3%83%91%e3%83%af%e3%83%bc%e3%82%a2%e3%83%83%e3%83%97%e3%82%a2%e3%82%a4%e3%83%86%e3%83%a0%e3%82%92%e3%83%89%e3%83%ad%e3%83%83%e3%83%97%e3%81%95%e3%81%9b%e3%82%88%e3%81%86%ef%bc%81%20-%20https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout_10%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るブロック崩し Part 10：パワーアップアイテムをドロップさせよう！ on telegram"
        href="https://telegram.me/share/url?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%20Part%2010%ef%bc%9a%e3%83%91%e3%83%af%e3%83%bc%e3%82%a2%e3%83%83%e3%83%97%e3%82%a2%e3%82%a4%e3%83%86%e3%83%a0%e3%82%92%e3%83%89%e3%83%ad%e3%83%83%e3%83%97%e3%81%95%e3%81%9b%e3%82%88%e3%81%86%ef%bc%81&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout_10%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2021 <a href="https://www.peanuts-code.com/ja/">Peanuts Code</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
