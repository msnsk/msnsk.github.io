<!doctype html><html lang=ja dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Godot で作るブロック崩し Part 6：ゲームスタート/ゲームオーバーの画面を作ろう！ | Peanuts Code</title>
<meta name=keywords content="GodotEngine,GameDev,ブロック崩し,2D"><meta name=description content="Part 6 の今回は、ゲームスタート画面とゲームオーバーの画面を作り、それらとプレイ画面との間で適宜、画面が遷移するようにしていく。 それでは前回に引き続きブロック崩しを開発していこう。 Memo: 過去のシリーズをまだご"><meta name=author content="Gobo"><link rel=canonical href=https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/breakout_6/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.peanuts-code.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.peanuts-code.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.peanuts-code.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.peanuts-code.com/apple-touch-icon.png><link rel=mask-icon href=https://www.peanuts-code.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ja href=https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/breakout_6/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Godot で作るブロック崩し Part 6：ゲームスタート/ゲームオーバーの画面を作ろう！"><meta property="og:description" content="Part 6 の今回は、ゲームスタート画面とゲームオーバーの画面を作り、それらとプレイ画面との間で適宜、画面が遷移するようにしていく。 それでは前回に引き続きブロック崩しを開発していこう。 Memo: 過去のシリーズをまだご"><meta property="og:type" content="article"><meta property="og:url" content="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/breakout_6/"><meta property="og:image" content="https://www.peanuts-code.com/images/tutorials/gd0004_breakout/breakout_6/img_44.gif"><meta property="article:section" content="tutorials"><meta property="article:published_time" content="2021-11-21T13:39:21+09:00"><meta property="article:modified_time" content="2021-11-21T13:39:21+09:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.peanuts-code.com/images/tutorials/gd0004_breakout/breakout_6/img_44.gif"><meta name=twitter:title content="Godot で作るブロック崩し Part 6：ゲームスタート/ゲームオーバーの画面を作ろう！"><meta name=twitter:description content="Part 6 の今回は、ゲームスタート画面とゲームオーバーの画面を作り、それらとプレイ画面との間で適宜、画面が遷移するようにしていく。 それでは前回に引き続きブロック崩しを開発していこう。 Memo: 過去のシリーズをまだご"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"🤖 チュートリアル","item":"https://www.peanuts-code.com/ja/tutorials/"},{"@type":"ListItem","position":2,"name":"🤖 シリーズ：Godot で作るブロック崩し","item":"https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/"},{"@type":"ListItem","position":3,"name":"Godot で作るブロック崩し Part 6：ゲームスタート/ゲームオーバーの画面を作ろう！","item":"https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/breakout_6/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Godot で作るブロック崩し Part 6：ゲームスタート/ゲームオーバーの画面を作ろう！","name":"Godot で作るブロック崩し Part 6：ゲームスタート\/ゲームオーバーの画面を作ろう！","description":"Part 6 の今回は、ゲームスタート画面とゲームオーバーの画面を作り、それらとプレイ画面との間で適宜、画面が遷移するようにしていく。 それでは前回に引き続きブロック崩しを開発していこう。 Memo: 過去のシリーズをまだご","keywords":["GodotEngine","GameDev","ブロック崩し","2D"],"articleBody":"Part 6 の今回は、ゲームスタート画面とゲームオーバーの画面を作り、それらとプレイ画面との間で適宜、画面が遷移するようにしていく。\nそれでは前回に引き続きブロック崩しを開発していこう。\nMemo: 過去のシリーズをまだご覧になっていない方は、そちらを先にご覧いただくことをおすすめします。\nGodot で作るブロック崩し スタート画面を作る ゲームを開始した時、ゲームタイトルが表示され、ボタンを押すなり何らかの操作によってプレイ画面に遷移するのが一般的だし、プレイヤーにとってもそのような流れが馴染み深く、わかりやすいはずだ。では実際にブロック崩しでもスタート画面を作ってプレイ画面へ遷移するようにアップデートしていこう。\nスタート画面のシーンを作って必要なノードを追加する 「シーン」メニュー＞「新規シーン」を選択して新しいシーンを作る。\n続けて緑色の「ユーザーインターフェース」を選択すると、シーンのルートノードとして「Control」クラスのノードが生成される。\n名前を「GameStartView」に変更する。\n続いて「GameStartView」に「VBoxContainer」ノードを追加する。\n名前を「VBox」に変更しよう。\nこの「VBoxContainer」クラスのノードは、単にその子ノードを縦に自動的に配置してくれる箱のようなものだ。頭文字の V は Vertical（垂直方向）の V だ。似たようなクラスで「HBoxContainer」もあり、こちらは Horizontal（水平方向）に子ノードを並べたいときに使う。\nまずは、シーンドックで「VBox」ノードを選択して、ツールバーの「レイアウト」をクリックし、「Rect全面」を選択しよう。\nすると「VBox」ノードが親ノード「GameStartView」の大きさまで目一杯拡大する。\nインスペクタで「Alignment」プロパティを「Center」に変更しておこう。これで「VBox」ノードの子ノードは全て中央に合わせて配置される。\n「VBox」ノードができたら、その子ノードとして「Label」クラスのノードを3つ追加していく。\n追加できたら、それぞれ名前を「Title」、「Message」、「SIL」に変更する。\nここまでできたら、一度シーンを保存しておこう。保存先フォルダを「res://scene/」にして、「GameStartView.tscn」という名前で保存する。\nそれぞれのLabelノードの設定を変更する 次にインスペクタで「Title」ノードの以下のプロパティを変更する。\nText: 画面に表示したい文言を入力する。ここでは「breakout」と入力。一旦小文字で良い。 Align: テキストの位置を決める。今回は中央に配置したいので「Center」を選択。 Uppercase: これは大文字という意味だ。文字全てを大文字にしたい場合に有効にする。では有効にしよう。先ほど小文字で入力した「Text」プロパティが大文字で表示されているのがわかるだろう。\n同様に「Message」ノードも以下の内容で設定する。\nText: 「Press Any Key」と入力。大文字、小文字はお好みで。 Align: 「Center」を選択。 2D ワークスペースにはこのように表示されるはずだ。\nさらに「SIL」ノードも編集していこう。ちなみに、SIL とはフォントのライセンスの一つだ。詳しくはGoogle検索で調べてほしいが、大事なこと部分お伝えすると、このライセンスを保持するフォントデータは、利用は比較的自由だが、ソフトウェアなどに利用する場合は書作権とライセンスの情報を明記する必要がある。後ほどこのライセンスのフォントを一つ利用するので、著作権とSILの情報を明記するためにこのラベルを用意した。\n設定すべき内容は以下のとおりだ。\nText: 以下の文を改行を含めて設定。 [Press Start 2P]\nDesigned by CodeMan38 (https://fonts.google.com/?query=CodeMan38 )\nLicensed under SIL Open Font License 1.1 (http://scripts.sil.org/OFL )\n©Google Inc.\nAlign: 「Center」を選択。 2D ワークスペースの表示はこのようになる。\nここまでできたら、一度シーンを実行してみよう。デバッグパネルは以下のようなに表示されただろうか。\nカスタムフォントを設定する 全ての文字がデフォルトのフォントのままでは、とても味気ないので、Google fontsから SIL のフォントを一つダウンロードし、それをゲームに適用していく。\nまずは Google Fonts のサイト から「Press Start 2P」というフォントをダウンロードしよう。\nダウンロードしたら.zipファイルを展開して、フォントファイルをファイルシステムドックへドラッグ\u0026ドロップする。\n次にシーンドックで「Title」ノードを選択したら、インスペクタで「Custom Fonts」を開き、「Font」プロパティの**[空]**のプルダウンをクリックして「新規 DynamicFont」を選択する。\n続けてインスペクタ上で「Font」を開いておき「Font Data」プロパティの**[空]**を目掛けて、さっきファイルシステムに追加したフォントファイル「PressStart2P-Regular.ttf」をドラッグ\u0026ドロップする。\nこれでフォントファイルが「Title」ノードのテキストに反映したはずだ。\nさらにフォントサイズをタイトルらしく大きく表示したいので、そのままインスペクタにて「Custom Fonts」＞「Settings」＞「Size」プロパティの値を56に変更する。\nここまでカスタムフォントの設定ができたら、シーンを実行してみて実際の画面表示を確認してみよう。ゲームがレトロなのでフォントもレトロにしたが、タイトルは一旦これで良い塩梅になっただろう。\n同様に「Message」ノードの「Custom Fonts」プロパティも同様に「ressStart2P-Regular.ttf」をフォントとして読み込み、設定していこう。ただし、「Settings」＞「Size」プロパティの値は16とする。\nさらに「Custom Colors」＞「Font Color」プロパティで文字の色を変える。ここでは「41b0ff」の水色っぽいカラーを指定したがお好みの色に変えていただいて問題ない。\n「VBox」の子ノード（Label ノード）同志、間隔が狭すぎるので広げよう。「VBox」ノードの「Custom Constants」＞「Separation」プロパティにチェックを入れ、値を入力する。値が大きいほど間隔が広くなる。ここでは48とする。\nここで再度シーンを実行して確認しよう。これでさっきよりスッキリした印象だ。\nスタート画面の背景色を変える それでは最後にスタート画面の背景の色を変えていこう。\nまず、背景用のノードを「GameStartView」ノードに追加する必要がある。「ColorRect」ノードを追加しよう。ちなみに Rect は Rectanble（長方形）の略だ。\n名前を「Background」に変更し、シーンドック上「GameStartView」ノードのすぐ下（子ノードの中で一番上）に移動させる。シーンドック上、上にあるほど画面上では背面に位置することになるので、「Background」ノードが一番後ろに移動した形だ。\nそのまま「Background」を選択した状態で、ツールバーの「レイアウト」＞「Rect前面」を選択しよう。「VBox」ノードの時と同様に、「Background」ノードが画面全体にフィットして拡大する。\n最後に「Background」ノードの色をデフォルトの白から黒に変えてみよう。これは「Backgournd」の「Color」プロパティをインスペクタから 黒（#000000） に変更するだけだ。ここもご自身で設定したい色があれば、その色にしていただいて全く問題ない。ただし、各 Label ノードとのコントラストには要注意だ。\nシーンを実行して確認してみると、グッと引き締まった印象になった。これでスタート画面の見た目は出来上がった。次はスタート画面からプレイ画面への画面遷移を作っていく。\nスタート画面からプレイ画面に遷移させる ゲーム開始時のシーンとして、現在「Game.tscn」ファイルが設定されている。これを先ほど作った「GameStartView.tscn」ファイルに変更する。\n「プロジェクト」メニュー＞「プロジェクト設定」＞「一般」タブを開き、サイドバーから「Application」＞「Run」を選択する。「Main Scene」項目が現在「res://scene/Game.tscn」に設定されているのがわかるだろう。\n「フォルダ」アイコンをクリックし、「res://scene/GameStartView.tscn」ファイルを選択する。\n確認のため、プロジェクトを実行（シーンを実行ではない）してみてほしい。この時、スタート画面が表示されるはずだ。では次に画面遷移を作っていく。\nついでだが、シーンドックで「GameStartView」ノードを選択し、ツールバーにある「オブジェクトの子を選択不可にする」設定を有効にしておこう。これでこのスタート画面一式の位置関係が変わることはない。\n「GameStartView」ノードにスクリプトをアタッチしよう。名前は「GameStartView.gd」のまま、保存先に「scripts」フォルダを選択してスクリプトファイルを作成する。\n「GameStartView.gd」ファイルをスクリプトエディタで開いたら、以下の内容でスクリプトのコードを置き換えてほしい。\nextends Control func _input(event): if event is InputEventKey: yield(get_tree().create_timer(0.1), \"timeout\") print(\"Input at Game Start: \", event.as_text()) get_tree().change_scene(\"res://scene/Game.tscn\") ではスクリプトの内容を確認していこう。\nまずこのスクリプトで唯一の関数_inputは　Node クラスに組み込みのメソッドで、いわゆるコールバック関数だ。何らかの入力操作があれば、そのイベントをevent引数に格納して、関数内のコードを実行する。\nInputEventKeyというのはキーボードのいずれかのキー入力を指す。つまりif event is InputEventKey:の if 構文の意味は、何らかの入力イベントを受信した時に、その入力イベントがキーボードのキー操作だった場合は、という意味だ。\nif 構文の中を見ていこう。\nyield(get_tree().create_timer(0.1), \"timeout\") まず、yieldというコルーチン用の組み込み関数だ。コルーチンとは、関数を途中の任意のタイミングで停止し、その後任意のタイミングで再開できる機能を持つ関数を指す。この停止、再開を担当するのがyieldだ。yieldは引数なしでも使われることが多いが、ここでは引数にオブジェクトとシグナルをとる形で利用している。\n第一引数に割り当てているのは「Timer」クラスのノードだ。ただし、yieldの引数の中でノードが作成されている。get_tree関数はシーンツリーにアクセスする関数で、シーンツリーに「Timer」ノードを作成するのがcreate_timer関数だ。引数0.1はタイマーの長さで、0.1秒のタイマーということになる。第二引数timeoutは「Timer」ノードのシグナルで、タイマーの時間が経過したら発信される。まとめると、0.1 秒のタイマーがセットされた「Timer」ノードがタイムアップしたら、次の行のコードに進む、という意味になる。\nなぜ、このようなコードを記述するかを説明しておこう。スタート画面で何らかのキー入力をした時、もしそのキーがスペースキーだった場合、次のゲームプレイ画面に切り替わった瞬間、即座にパドルからボールが発射してしまう。つまり、スタート画面で入力したスペースキーが次のプレイ画面の操作としても影響してしまうということだ。そのため、プレイヤーがスタート画面で何らかのキー入力をしたら、0.1秒待機させるようにして、キー入力が次のプレイ画面に影響しないようにしているというわけである。\nMemo: コルーチンとyieldについての正確な情報は公式ドキュメント 参照のこと。\nprint(\"Input at Game Start: \", event.as_text()) これは出力コンソールにどのキーが入力されたかを出力するために追加している。目的は挙動をチェックする際に本当にキー入力が正しく認識されているかを確認することだ。つまり、コードに不備がなければこの一行のコードは無くても良い。\nget_tree().change_scene(\"res://scene/Game.tscn\") 最後にget_tree関数でシーンツリーにアクセスし、change_scene関数で引数で指定したシーンに切り替える。change_scene関数の引数にはゲームプレイ画面のシーンファイルのパス「res://scene/Game.tscn」を入力している。シーンの切り替えは基本的にこのような記述になる。今後よく利用するので頭の片隅に置いておくと良いだろう。\nでは、実際にスタート画面からプレイ画面にきちんと切り替わるか、プロジェクトを実行して見てみよう。スタート画面でスペースキーやエンターキーその他何でも良いので適当にキーを押下して、プレイ画面に遷移したらOKだ。\nもし余力があれば、動作確認として、ぜひyield(get_tree().create_timer(0.1), \"timeout\")の一行をコメントアウトしてプロジェクトを実行してみてほしい。\nゲームオーバー画面を作る 基本的な手順はスタート画面を作るのと同じなので、細かい解説はなしにしてどんどん進めていこう。\nゲームオーバー画面のシーンを作る 「シーン」メニュー＞「新規シーン」から、「ユーザーインターフェース」を選択して「Control」ノードをルートノードにする。名前は「GameOverView」とする。\nここで先にシーンを保存しておこう。名前はそのまま「GameOverView.tscn」として、「scene」フォルダに保存する。\n「GameOverView」ノードに「ColorRect」クラスのノードを追加する。名前を「Background」に変更しておこう。インスペクタ一番上の「Color」プロパティを黒（000000）に変更する。\n「GameOverView」ノードに「VBoxContainer」クラスのノードを追加し、名前を「VBox」とする。あとは、インスペクタで「Alignment」を「Center」に変更、「Custom Constants」の値を60に変更しよう。\n「Background」、「VBox」それぞれについて、ツールバーの「レイアウト」＞「Rect全面」を選択して画面一杯に広げておこう。\n次に「VBox」ノードの子ノードとして2つの「Label」クラスのノードを追加する。それぞれ名前を「GameOverLabel」、「Message」とする。\nここまででシーンドックは以下のスクリーンショットのようになったはずだ。\nでは「GameOverLabel」ノードのプロパティを以下のように設定しよう。\n「Text」プロパティに「gameover」と入力 「Align」を「Center」にする 「Uppercase」プロパティをオンにする 「Custom Fonts」＞「Font」に「新規 DynamicFont」を適用 「Custom Fonts」＞「Font」＞「Font Data」にフォントファイルの「PressStart2P」を割り当てる 「Custom Fonts」＞「Settings」＞「Size」の値を48に変更 「Custom Colors」＞「Font Color」に赤色（ff0000）を割り当てて、ゲームオーバーを演出する 続いて「Message」ノードのプロパティを以下のように設定しよう。\n「Text」プロパティに下記文言を入力\nTo Quit Press Q\nTo Continue Press Enter 「Align」を「Center」にする 「Custom Fonts」＞「Font」に「新規 DynamicFont」を適用 「Custom Fonts」＞「Font」＞「Font Data」にフォントファイルの「PressStart2P」を割り当てる 「Custom Fonts」＞「Settings」＞「Size」の値を12に変更 「Custom Colors」＞「Font Color」に薄いピンク（ffbebe）を割り当てる シーンドックで「GameOverView」ノードを選択した状態で、ツールバーから「オブジェクトの子を選択不可にする」を有効にして位置関係を固定しておこう。\nここまでできたら、一度シーンを実行してみよう。以下のスクリーンショットのようになっていればOKだ。\nゲームオーバー画面からスタート画面に遷移またはゲームを終了させる 画面遷移の処理も、基本的にはスタート画面でやったことと同じなので、サクサク進めていくが、一つ下準備をしておこう。\n下準備というのはインプットマップの追加だ。ゲームオーバー画面で「Q」キーを押下したらゲームを完全に終了できるようにしていく。ここではひとまず、「プロジェクト」メニュー＞「プロジェクト設定」＞「インプットマップ」タブにて、「Quit」という名前のインプットマップを追加して「Q」キーを割り当てよう。\nそれではスクリプトの方の作業に移ろう。\nまずはシーンドックで「GameOverView」ノードを選択して、新規スクリプトをアタッチしよう。スクリプトは保存先を「res://scripts」、名前を「GameOverView.gd」として保存する。\nスクリプトの内容を以下のコードで置き換えてほしい。\nextends Control func _input(event): if event is InputEventKey: print(\"Input at Game Over: \", event.as_text()) if event.is_action_released(\"Quit\"): get_tree().quit() elif event.is_action_released(\"ui_accept\"): get_tree().change_scene(\"res://scene/GameStartView.tscn\") では、スクリプトの内容を確認していく。\nスタート画面と大まかには同じようなコードだ。組み込みのコールバック関数_inputによって、プレイヤーが何らかの入力をすれば関数内のコードが実行される。\n今回のコードは if 構文が2段階になっている（これをネストという）。まず最初の if 構文で、入力がキーボード入力だった場合、ひとまず入力したキーを出力コンソールに出力して確認するためprint関数を使用している。\nその後、さらに内側の if 構文に進む。\nif event.is_action_pressed(\"Quit\"): これはシンプルに、入力されたイベントがインプットマップの「Quit」の操作だったら、つまりプレイヤーが「Q」のキーを押したら、という意味合いだ。その場合に実行されるのがget_tree().quit()だ。get_tree関数でシーンツリーにアクセスし、そこからquit関数によって、ゲームアプリケーションが終了させられる。なお、iOSデバイス向けにゲームを作る場合は、この関数は機能しないようなので、今後のご自身の開発ではご注意いただきたい。\n次にelifのブロックだ。\nelif event.is_action_released(\"ui_accept\"): elifから始まる行は、最初のifから始まる行の条件に当てはまらなかった場合に実行される。is_action_released関数は、引数のインプットマップの操作があったかどうかを Bool 値で返してくれる。ただし、さきほどのifの行では関数名に pressedが含まれていたが、今回は releasedが名前に含まれている。これは、操作の最後にキーから指が離れたかどうかを確認している。\n具体的に、ここでのコードは『入力操作がインプットマップの「ui_accept」の操作で、最後に指がキーから離れたら』という意味合いになる。そして「ui_accept」はデフォルトで用意されているインプットマップで、スペースキーやエンターキーが割り当てられている。\nその次の最後の行のコードはスタート画面の時と同様の処理で、get_tree関数でシーンツリーにアクセスし、そこから別のシーンに切り替えるための関数change_sceneを実行している。引数には\"res://scene/GameStartView.tscn\"を指定しており、スタート画面に戻るように指定している。\nここまでできたら、シーンを実行して動作確認してみよう。下のGIF画像は次の順序で画面遷移を確認している。\nシーンを実行して「GameOverView」シーンが表示されたところから開始 「Enter」キーを押下 「GameStartView」シーンが表示される 「Space」キーを押下 「Game」シーンが表示される デバッグパネルを一度終了して、再度シーンを実行して「GameOverView」シーンを表示 「Q」キーを押下 デバッグパネルが閉じて終了\nプレイ画面からゲームオーバー画面に遷移させる 一般的に、ゲームオーバー画面が表示されるのは、プレイ画面で何らかの失敗をした時だ。ブロック崩しではボールが画面下に落ちたら失敗というわかりやすいルールなので、その条件でゲームオーバー画面が表示されるように更新していこう。\nボールが画面下に落ちた瞬間に検知させる 画面下にボールが落ちた瞬間にそのことを検知する必要がある。そのためにはまず「Game.tscn」シーンに切り替えて、「Ball」ノードに「VisibilityNotifier2D」クラスのノードを子ノードとして追加しよう。\nこのノードを追加したのは、このノードのシグナルが便利だからだ。\nさっそく、シーンドックで「VisibilityNotifier2D」ノードを選択した状態から、「ノード」ドックの「シグナル」タブを開こう。使用したいのは「screen_exited()」というシグナルだ。これはノードがスクリーンの外に出た瞬間に発信される。\n「screen_exited()」をダブルクリック、または右下の「接続」をクリックする。\n「Ball」ノードのスクリプトを選択して「接続」をクリックする。なお、受信側メソッドの名前はそのままで良い。\nスクリプトエディタに切り替わり、メソッドが追加され、左側にシグナルとの接続を示す緑色のアイコンが表示されているのが確認できるだろう。ではこのメソッドの中身を編集していこう。\n_on_VisibilityNotifier2D_screen_exitedメソッドを編集した結果、「Ball.gd」スクリプト全体は以下のようなコードになる。追加したメソッドは一番下にある。\nextends RigidBody2D const MAX_SPEED = 300.0 export (float) var ball_speed = 150.0 export (float) var speed_up = 4.0 var direction: Vector2 var velocity: Vector2 onready var paddle = get_node(\"../Paddle\") func _ready(): direction = Vector2(1, -1).normalized() velocity = direction * ball_speed func _process(delta): if mode == 3: position.x = paddle.position.x if Input.is_action_just_pressed(\"launch_ball\"): mode = 2 apply_impulse(Vector2.ZERO, velocity) func _on_Ball_body_entered(body): ball_speed += speed_up print(\"ball_speed: \"+str(ball_speed)) direction = linear_velocity.normalized() velocity = direction * min(ball_speed, MAX_SPEED) if body.is_in_group(\"Bricks\"): body.queue_free() if body.get_name() == \"Paddle\": direction = (position - body.position).normalized() velocity = direction * min(ball_speed, MAX_SPEED) linear_velocity = velocity func _on_VisibilityNotifier2D_screen_exited(): queue_free() get_tree().change_scene(\"res://scene/GameOverView.tscn\") _on_VisibilityNotifier2D_screen_exitedメソッドが実行されると、まずqueue_freeという関数が実行される。これはスクリプトがアタッチされているノード自体を開放（シーンツリーから消す）する。つまり、ボールが画面下に落ちたら、「Ball」ノードそのものが消えるということだ。これを実行しないと、画面上には表示されてなくとも、「Ball」ノードは生きたまま落下し続けている状態になる。ただし、開放するタイミングは次のフレームだ。だから「Ball」ノードが消える前に次の行のコードもきっちり処理される。\nそして次の最後の行だが、すっかりお馴染みのchange_scene関数だ。引数に\"res://scene/GameOverView.tscn\"をとって、ゲームオーバー画面に遷移するようにしている。\nこれで、ボールが画面下に落ちたらゲームオーバー画面に切り替わるようになったはずだ。プロジェクトを実行して最初から画面遷移を確認してみよう。\nおわりに 以上で Part 6 は完了だ。今回はスタート画面、ゲームオーバー画面を作って、プレイ画面を含めた画面遷移を完成させた。よりゲームらしさが演出できたのではないだろうか。\n次回 Part 7 では HUD（ヘッドアップディスプレイ）を追加していく。\n","wordCount":"9551","inLanguage":"ja","image":"https://www.peanuts-code.com/images/tutorials/gd0004_breakout/breakout_6/img_44.gif","datePublished":"2021-11-21T13:39:21+09:00","dateModified":"2021-11-21T13:39:21+09:00","author":{"@type":"Person","name":"Gobo"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/breakout_6/"},"publisher":{"@type":"Organization","name":"Peanuts Code","logo":{"@type":"ImageObject","url":"https://www.peanuts-code.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.peanuts-code.com/ja/ accesskey=h title="Peanuts Code (Alt + H)"><img src=https://www.peanuts-code.com/images/logomark.png alt aria-label=logo height=35>Peanuts Code</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.peanuts-code.com/ja/ title=ホーム><span>ホーム</span></a></li><li><a href=https://www.peanuts-code.com/ja/portfolio/ title=作ったゲーム><span>作ったゲーム</span></a></li><li><a href=https://www.peanuts-code.com/ja/posts/ title=ブログ><span>ブログ</span></a></li><li><a href=https://www.peanuts-code.com/ja/tutorials/ title=チュートリアル><span>チュートリアル</span></a></li><li><a href=https://www.peanuts-code.com/ja/about/ title=サイト情報><span>サイト情報</span></a></li><li><a href=https://www.peanuts-code.com/ja/search/ title="検索 (Alt + /)" accesskey=/><span>検索</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.peanuts-code.com/ja/>ホーム</a>&nbsp;»&nbsp;<a href=https://www.peanuts-code.com/ja/tutorials/>🤖 チュートリアル</a>&nbsp;»&nbsp;<a href=https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/>🤖 シリーズ：Godot で作るブロック崩し</a></div><h1 class=post-title>Godot で作るブロック崩し Part 6：ゲームスタート/ゲームオーバーの画面を作ろう！</h1><div class=post-meta><span title='2021-11-21 13:39:21 +0900 +0900'>2021-11-21</span>&nbsp;·&nbsp;20 分&nbsp;·&nbsp;Gobo</div></header><figure class=entry-cover><img loading=lazy src=https://www.peanuts-code.com/images/tutorials/gd0004_breakout/breakout_6/img_44.gif alt="ブロック崩し Part 6 サムネイル"></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目次</span></summary><div class=inner><ul><li><a href=#%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8b aria-label=スタート画面を作る>スタート画面を作る</a><ul><ul><li><a href=#%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e7%94%bb%e9%9d%a2%e3%81%ae%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e3%81%a3%e3%81%a6%e5%bf%85%e8%a6%81%e3%81%aa%e3%83%8e%e3%83%bc%e3%83%89%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b aria-label=スタート画面のシーンを作って必要なノードを追加する>スタート画面のシーンを作って必要なノードを追加する</a></li><li><a href=#%e3%81%9d%e3%82%8c%e3%81%9e%e3%82%8c%e3%81%aelabel%e3%83%8e%e3%83%bc%e3%83%89%e3%81%ae%e8%a8%ad%e5%ae%9a%e3%82%92%e5%a4%89%e6%9b%b4%e3%81%99%e3%82%8b aria-label=それぞれのLabelノードの設定を変更する>それぞれのLabelノードの設定を変更する</a></li><li><a href=#%e3%82%ab%e3%82%b9%e3%82%bf%e3%83%a0%e3%83%95%e3%82%a9%e3%83%b3%e3%83%88%e3%82%92%e8%a8%ad%e5%ae%9a%e3%81%99%e3%82%8b aria-label=カスタムフォントを設定する>カスタムフォントを設定する</a></li><li><a href=#%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e7%94%bb%e9%9d%a2%e3%81%ae%e8%83%8c%e6%99%af%e8%89%b2%e3%82%92%e5%a4%89%e3%81%88%e3%82%8b aria-label=スタート画面の背景色を変える>スタート画面の背景色を変える</a></li><li><a href=#%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e7%94%bb%e9%9d%a2%e3%81%8b%e3%82%89%e3%83%97%e3%83%ac%e3%82%a4%e7%94%bb%e9%9d%a2%e3%81%ab%e9%81%b7%e7%a7%bb%e3%81%95%e3%81%9b%e3%82%8b aria-label=スタート画面からプレイ画面に遷移させる>スタート画面からプレイ画面に遷移させる</a></li></ul></ul></li><li><a href=#%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%aa%e3%83%bc%e3%83%90%e3%83%bc%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8b aria-label=ゲームオーバー画面を作る>ゲームオーバー画面を作る</a><ul><ul><li><a href=#%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%aa%e3%83%bc%e3%83%90%e3%83%bc%e7%94%bb%e9%9d%a2%e3%81%ae%e3%82%b7%e3%83%bc%e3%83%b3%e3%82%92%e4%bd%9c%e3%82%8b aria-label=ゲームオーバー画面のシーンを作る>ゲームオーバー画面のシーンを作る</a></li><li><a href=#%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%aa%e3%83%bc%e3%83%90%e3%83%bc%e7%94%bb%e9%9d%a2%e3%81%8b%e3%82%89%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e7%94%bb%e9%9d%a2%e3%81%ab%e9%81%b7%e7%a7%bb%e3%81%be%e3%81%9f%e3%81%af%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%92%e7%b5%82%e4%ba%86%e3%81%95%e3%81%9b%e3%82%8b aria-label=ゲームオーバー画面からスタート画面に遷移またはゲームを終了させる>ゲームオーバー画面からスタート画面に遷移またはゲームを終了させる</a></li></ul></ul></li><li><a href=#%e3%83%97%e3%83%ac%e3%82%a4%e7%94%bb%e9%9d%a2%e3%81%8b%e3%82%89%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%aa%e3%83%bc%e3%83%90%e3%83%bc%e7%94%bb%e9%9d%a2%e3%81%ab%e9%81%b7%e7%a7%bb%e3%81%95%e3%81%9b%e3%82%8b aria-label=プレイ画面からゲームオーバー画面に遷移させる>プレイ画面からゲームオーバー画面に遷移させる</a><ul><ul><li><a href=#%e3%83%9c%e3%83%bc%e3%83%ab%e3%81%8c%e7%94%bb%e9%9d%a2%e4%b8%8b%e3%81%ab%e8%90%bd%e3%81%a1%e3%81%9f%e7%9e%ac%e9%96%93%e3%81%ab%e6%a4%9c%e7%9f%a5%e3%81%95%e3%81%9b%e3%82%8b aria-label=ボールが画面下に落ちた瞬間に検知させる>ボールが画面下に落ちた瞬間に検知させる</a></li></ul></ul></li><li><a href=#%e3%81%8a%e3%82%8f%e3%82%8a%e3%81%ab aria-label=おわりに>おわりに</a></li></ul></div></details></div><div class=post-content><p>Part 6 の今回は、ゲームスタート画面とゲームオーバーの画面を作り、それらとプレイ画面との間で適宜、画面が遷移するようにしていく。</p><p>それでは前回に引き続き<strong>ブロック崩し</strong>を開発していこう。</p><br><blockquote><p><em><strong><span style=color:salmon>Memo:</span></strong><br>過去のシリーズをまだご覧になっていない方は、そちらを先にご覧いただくことをおすすめします。<br><a href=https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/ title="Godot で作るブロック崩し">Godot で作るブロック崩し</a></em></p></blockquote><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=スタート画面を作る>スタート画面を作る<a hidden class=anchor aria-hidden=true href=#スタート画面を作る>#</a></h1><p>ゲームを開始した時、ゲームタイトルが表示され、ボタンを押すなり何らかの操作によってプレイ画面に遷移するのが一般的だし、プレイヤーにとってもそのような流れが馴染み深く、わかりやすいはずだ。では実際にブロック崩しでもスタート画面を作ってプレイ画面へ遷移するようにアップデートしていこう。</p><h3 id=スタート画面のシーンを作って必要なノードを追加する>スタート画面のシーンを作って必要なノードを追加する<a hidden class=anchor aria-hidden=true href=#スタート画面のシーンを作って必要なノードを追加する>#</a></h3><p>「シーン」メニュー＞「新規シーン」を選択して新しいシーンを作る。</p><p>続けて緑色の「ユーザーインターフェース」を選択すると、シーンのルートノードとして「Control」クラスのノードが生成される。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_1.png alt=ユーザーインターフェースを選択></p><p>名前を「GameStartView」に変更する。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_2.png alt=ノードの名前をGameStartViewに変更></p><p>続いて「GameStartView」に「VBoxContainer」ノードを追加する。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_3.png alt=VBoxContainerを追加></p><p>名前を「VBox」に変更しよう。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_4.png alt=名前をVBoxに変更></p><p>この「VBoxContainer」クラスのノードは、単にその子ノードを縦に自動的に配置してくれる箱のようなものだ。頭文字の <strong>V</strong> は <strong>V</strong>ertical（垂直方向）の V だ。似たようなクラスで「HBoxContainer」もあり、こちらは <strong>H</strong>orizontal（水平方向）に子ノードを並べたいときに使う。</p><p>まずは、シーンドックで「VBox」ノードを選択して、ツールバーの「レイアウト」をクリックし、「Rect全面」を選択しよう。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_5.png alt=レイアウト＞Rect全面を選択></p><p>すると「VBox」ノードが親ノード「GameStartView」の大きさまで目一杯拡大する。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_5.1.png alt=Rect全面が適用された画面></p><p>インスペクタで「Alignment」プロパティを「Center」に変更しておこう。これで「VBox」ノードの子ノードは全て中央に合わせて配置される。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_6.png alt=インスペクタでAlignmentプロパティ編集></p><p>「VBox」ノードができたら、その子ノードとして「Label」クラスのノードを3つ追加していく。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_7.png alt=Labelノード追加></p><p>追加できたら、それぞれ名前を「Title」、「Message」、「SIL」に変更する。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_8.png alt=Labelノード3つの名前変更></p><p>ここまでできたら、一度シーンを保存しておこう。保存先フォルダを「res://scene/」にして、「GameStartView.tscn」という名前で保存する。</p><br><h3 id=それぞれのlabelノードの設定を変更する>それぞれのLabelノードの設定を変更する<a hidden class=anchor aria-hidden=true href=#それぞれのlabelノードの設定を変更する>#</a></h3><p>次にインスペクタで「Title」ノードの以下のプロパティを変更する。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_9.png alt=Titleノードのプロパティ編集></p><ol><li><strong>Text</strong>: 画面に表示したい文言を入力する。ここでは「breakout」と入力。一旦小文字で良い。</li><li><strong>Align</strong>: テキストの位置を決める。今回は中央に配置したいので「Center」を選択。</li><li><strong>Uppercase</strong>: これは大文字という意味だ。文字全てを大文字にしたい場合に有効にする。では有効にしよう。先ほど小文字で入力した「Text」プロパティが大文字で表示されているのがわかるだろう。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_10.png alt=2DワークスペースのTitleノード表示></li></ol><br><p>同様に「Message」ノードも以下の内容で設定する。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_11.png alt=Messageノードのプロパティ編集></p><ol><li><strong>Text</strong>: 「Press Any Key」と入力。大文字、小文字はお好みで。</li><li><strong>Align</strong>: 「Center」を選択。</li></ol><p>2D ワークスペースにはこのように表示されるはずだ。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_12.png alt=2DワークスペースのMessageノード表示></p><br><p>さらに「SIL」ノードも編集していこう。ちなみに、<strong>SIL</strong> とはフォントのライセンスの一つだ。詳しくはGoogle検索で調べてほしいが、大事なこと部分お伝えすると、このライセンスを保持するフォントデータは、利用は比較的自由だが、ソフトウェアなどに利用する場合は書作権とライセンスの情報を明記する必要がある。後ほどこのライセンスのフォントを一つ利用するので、著作権とSILの情報を明記するためにこのラベルを用意した。</p><p>設定すべき内容は以下のとおりだ。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_13.png alt=SILノードのプロパティ編集></p><ol><li><strong>Text</strong>: 以下の文を改行を含めて設定。</li></ol><blockquote><p>[Press Start 2P]<br>Designed by CodeMan38 (<a href="https://fonts.google.com/?query=CodeMan38" target=_blank>https://fonts.google.com/?query=CodeMan38</a>
)<br>Licensed under SIL Open Font License 1.1 (<a href=http://scripts.sil.org/OFL target=_blank>http://scripts.sil.org/OFL</a>
)<br>©Google Inc.</p></blockquote><ol start=2><li><strong>Align</strong>: 「Center」を選択。</li></ol><p>2D ワークスペースの表示はこのようになる。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_14.png alt=2DワークスペースのSILノード表示></p><br><p>ここまでできたら、一度シーンを実行してみよう。デバッグパネルは以下のようなに表示されただろうか。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_15.png alt=デバッグパネルで確認></p><br><h3 id=カスタムフォントを設定する>カスタムフォントを設定する<a hidden class=anchor aria-hidden=true href=#カスタムフォントを設定する>#</a></h3><p>全ての文字がデフォルトのフォントのままでは、とても味気ないので、Google fontsから SIL のフォントを一つダウンロードし、それをゲームに適用していく。</p><p>まずは <a href="https://fonts.google.com/specimen/Press+Start+2P?preview.text=BREAKOUT%20press%20any%20key&amp;preview.text_type=custom&amp;stylecount=1&amp;query=press" target=_blank>Google Fonts のサイト</a>
から「<strong>Press Start 2P</strong>」というフォントをダウンロードしよう。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_16.png alt="Google Fontsからダウンロード"></p><p>ダウンロードしたら.zipファイルを展開して、フォントファイルをファイルシステムドックへドラッグ&ドロップする。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_17.png alt=システムドックにドラッグ&amp;amp;ドロップ></p><p>次にシーンドックで「Title」ノードを選択したら、インスペクタで「Custom Fonts」を開き、「Font」プロパティの**[空]**のプルダウンをクリックして「新規 DynamicFont」を選択する。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_18.png alt="Custom Fonts &amp;gt; Font"></p><p>続けてインスペクタ上で「Font」を開いておき「Font Data」プロパティの**[空]**を目掛けて、さっきファイルシステムに追加したフォントファイル「PressStart2P-Regular.ttf」をドラッグ&ドロップする。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_19.png alt=フォントファイルをドラッグ&amp;amp;ドロップ></p><p>これでフォントファイルが「Title」ノードのテキストに反映したはずだ。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_20.png alt="Custom Fontsプロパティ群"></p><p>さらにフォントサイズをタイトルらしく大きく表示したいので、そのままインスペクタにて「Custom Fonts」＞「Settings」＞「Size」プロパティの値を<code>56</code>に変更する。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_21.png alt="Custom Fonts &amp;gt; Settings &amp;gt; Size"></p><p>ここまでカスタムフォントの設定ができたら、シーンを実行してみて実際の画面表示を確認してみよう。ゲームがレトロなのでフォントもレトロにしたが、タイトルは一旦これで良い塩梅になっただろう。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_22.png alt=デバッグパネルで確認></p><p>同様に「Message」ノードの「Custom Fonts」プロパティも同様に「ressStart2P-Regular.ttf」をフォントとして読み込み、設定していこう。ただし、「Settings」＞「Size」プロパティの値は<code>16</code>とする。</p><p>さらに「Custom Colors」＞「Font Color」プロパティで文字の色を変える。ここでは「41b0ff」の水色っぽいカラーを指定したがお好みの色に変えていただいて問題ない。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_23.png alt="Custom Colors &amp;gt; Font Color"></p><p>「VBox」の子ノード（Label ノード）同志、間隔が狭すぎるので広げよう。「VBox」ノードの「Custom Constants」＞「Separation」プロパティにチェックを入れ、値を入力する。値が大きいほど間隔が広くなる。ここでは<code>48</code>とする。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_24.png alt=VBoxノードのSeparationプロパティを編集></p><p>ここで再度シーンを実行して確認しよう。これでさっきよりスッキリした印象だ。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_25.png alt></p><br><h3 id=スタート画面の背景色を変える>スタート画面の背景色を変える<a hidden class=anchor aria-hidden=true href=#スタート画面の背景色を変える>#</a></h3><p>それでは最後にスタート画面の背景の色を変えていこう。</p><p>まず、背景用のノードを「GameStartView」ノードに追加する必要がある。「ColorRect」ノードを追加しよう。ちなみに <strong>Rect</strong> は Rectanble（長方形）の略だ。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_26.png alt=ColorRectクラスのノード追加></p><p>名前を「Background」に変更し、シーンドック上「GameStartView」ノードのすぐ下（子ノードの中で一番上）に移動させる。シーンドック上、上にあるほど画面上では背面に位置することになるので、「Background」ノードが一番後ろに移動した形だ。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_27.png alt=Backgroundに名前変更して順序を再背面に></p><p>そのまま「Background」を選択した状態で、ツールバーの「レイアウト」＞「Rect前面」を選択しよう。「VBox」ノードの時と同様に、「Background」ノードが画面全体にフィットして拡大する。</p><p>最後に「Background」ノードの色をデフォルトの白から<strong>黒</strong>に変えてみよう。これは「Backgournd」の「Color」プロパティをインスペクタから <strong>黒（#000000）</strong> に変更するだけだ。ここもご自身で設定したい色があれば、その色にしていただいて全く問題ない。ただし、各 Label ノードとのコントラストには要注意だ。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_28.png alt=BackgroundノードのColorプロパティを黒に変更></p><p>シーンを実行して確認してみると、グッと引き締まった印象になった。これでスタート画面の見た目は出来上がった。次はスタート画面からプレイ画面への画面遷移を作っていく。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_29.png alt=デバッグパネルで確認></p><br><h3 id=スタート画面からプレイ画面に遷移させる>スタート画面からプレイ画面に遷移させる<a hidden class=anchor aria-hidden=true href=#スタート画面からプレイ画面に遷移させる>#</a></h3><p>ゲーム開始時のシーンとして、現在「Game.tscn」ファイルが設定されている。これを先ほど作った「GameStartView.tscn」ファイルに変更する。</p><p>「プロジェクト」メニュー＞「プロジェクト設定」＞「一般」タブを開き、サイドバーから「Application」＞「Run」を選択する。「Main Scene」項目が現在「res://scene/Game.tscn」に設定されているのがわかるだろう。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_30.png alt="Main Sceneの編集"></p><p>「フォルダ」アイコンをクリックし、「res://scene/GameStartView.tscn」ファイルを選択する。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_31.png alt=フォルダ選択></p><p>確認のため、プロジェクトを実行（シーンを実行ではない）してみてほしい。この時、スタート画面が表示されるはずだ。では次に画面遷移を作っていく。</p><p>ついでだが、シーンドックで「GameStartView」ノードを選択し、ツールバーにある「オブジェクトの子を選択不可にする」設定を有効にしておこう。これでこのスタート画面一式の位置関係が変わることはない。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_32.png alt=オブジェクトの子を選択不可にする></p><p>「GameStartView」ノードにスクリプトをアタッチしよう。名前は「GameStartView.gd」のまま、保存先に「scripts」フォルダを選択してスクリプトファイルを作成する。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_33.png alt=スクリプトをアタッチ></p><p>「GameStartView.gd」ファイルをスクリプトエディタで開いたら、以下の内容でスクリプトのコードを置き換えてほしい。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-GDScript data-lang=GDScript><span style=display:flex><span><span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Control</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>_input</span>(event):
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> event <span style=color:#f92672>is</span> <span style=color:#a6e22e>InputEventKey</span>:
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>yield</span>(<span style=color:#a6e22e>get_tree</span>()<span style=color:#f92672>.</span><span style=color:#a6e22e>create_timer</span>(<span style=color:#ae81ff>0.1</span>), <span style=color:#e6db74>&#34;timeout&#34;</span>)
</span></span><span style=display:flex><span>		print(<span style=color:#e6db74>&#34;Input at Game Start: &#34;</span>, event<span style=color:#f92672>.</span><span style=color:#a6e22e>as_text</span>())
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>get_tree</span>()<span style=color:#f92672>.</span><span style=color:#a6e22e>change_scene</span>(<span style=color:#e6db74>&#34;res://scene/Game.tscn&#34;</span>)
</span></span></code></pre></div><br><p>ではスクリプトの内容を確認していこう。</p><p>まずこのスクリプトで唯一の関数<code>_input</code>は　Node クラスに組み込みのメソッドで、いわゆるコールバック関数だ。何らかの入力操作があれば、そのイベントを<code>event</code>引数に格納して、関数内のコードを実行する。</p><p><code>InputEventKey</code>というのはキーボードのいずれかのキー入力を指す。つまり<code>if event is InputEventKey:</code>の if 構文の意味は、何らかの入力イベントを受信した時に、その入力イベントがキーボードのキー操作だった場合は、という意味だ。</p><p>if 構文の中を見ていこう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-GDScript data-lang=GDScript><span style=display:flex><span>		<span style=color:#66d9ef>yield</span>(<span style=color:#a6e22e>get_tree</span>()<span style=color:#f92672>.</span><span style=color:#a6e22e>create_timer</span>(<span style=color:#ae81ff>0.1</span>), <span style=color:#e6db74>&#34;timeout&#34;</span>)
</span></span></code></pre></div><p>まず、<code>yield</code>というコルーチン用の組み込み関数だ。コルーチンとは、関数を途中の任意のタイミングで停止し、その後任意のタイミングで再開できる機能を持つ関数を指す。この停止、再開を担当するのが<code>yield</code>だ。<code>yield</code>は引数なしでも使われることが多いが、ここでは引数にオブジェクトとシグナルをとる形で利用している。</p><p>第一引数に割り当てているのは「Timer」クラスのノードだ。ただし、<code>yield</code>の引数の中でノードが作成されている。<code>get_tree</code>関数はシーンツリーにアクセスする関数で、シーンツリーに「Timer」ノードを作成するのが<code>create_timer</code>関数だ。引数<code>0.1</code>はタイマーの長さで、0.1秒のタイマーということになる。第二引数<code>timeout</code>は「Timer」ノードのシグナルで、タイマーの時間が経過したら発信される。まとめると、0.1 秒のタイマーがセットされた「Timer」ノードがタイムアップしたら、次の行のコードに進む、という意味になる。</p><p>なぜ、このようなコードを記述するかを説明しておこう。スタート画面で何らかのキー入力をした時、もしそのキーが<strong>スペース</strong>キーだった場合、次のゲームプレイ画面に切り替わった瞬間、即座にパドルからボールが発射してしまう。つまり、スタート画面で入力したスペースキーが次のプレイ画面の操作としても影響してしまうということだ。そのため、プレイヤーがスタート画面で何らかのキー入力をしたら、0.1秒待機させるようにして、キー入力が次のプレイ画面に影響しないようにしているというわけである。</p><blockquote><p><span style=color:salmon>Memo:</span><br>コルーチンと<code>yield</code>についての正確な情報は<a href=https://docs.godotengine.org/ja/stable/getting_started/scripting/gdscript/gdscript_basics.html#coroutines-with-yield target=_blank>公式ドキュメント</a>
参照のこと。</p></blockquote><br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-GDScript data-lang=GDScript><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Input at Game Start: &#34;</span>, event<span style=color:#f92672>.</span><span style=color:#a6e22e>as_text</span>())
</span></span></code></pre></div><p>これは出力コンソールにどのキーが入力されたかを出力するために追加している。目的は挙動をチェックする際に本当にキー入力が正しく認識されているかを確認することだ。つまり、コードに不備がなければこの一行のコードは無くても良い。</p><br><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-GDScript data-lang=GDScript><span style=display:flex><span><span style=color:#a6e22e>get_tree</span>()<span style=color:#f92672>.</span><span style=color:#a6e22e>change_scene</span>(<span style=color:#e6db74>&#34;res://scene/Game.tscn&#34;</span>)
</span></span></code></pre></div><p>最後に<code>get_tree</code>関数でシーンツリーにアクセスし、<code>change_scene</code>関数で引数で指定したシーンに切り替える。<code>change_scene</code>関数の引数にはゲームプレイ画面のシーンファイルのパス「res://scene/Game.tscn」を入力している。シーンの切り替えは基本的にこのような記述になる。今後よく利用するので頭の片隅に置いておくと良いだろう。</p><br><p>では、実際にスタート画面からプレイ画面にきちんと切り替わるか、<strong>プロジェクト</strong>を実行して見てみよう。スタート画面でスペースキーやエンターキーその他何でも良いので適当にキーを押下して、プレイ画面に遷移したらOKだ。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_34.gif alt=スタート画面からプレイ画面への遷移></p><p>もし余力があれば、動作確認として、ぜひ<code>yield(get_tree().create_timer(0.1), "timeout")</code>の一行をコメントアウトしてプロジェクトを実行してみてほしい。</p><br><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h1 id=ゲームオーバー画面を作る>ゲームオーバー画面を作る<a hidden class=anchor aria-hidden=true href=#ゲームオーバー画面を作る>#</a></h1><p>基本的な手順はスタート画面を作るのと同じなので、細かい解説はなしにしてどんどん進めていこう。</p><h3 id=ゲームオーバー画面のシーンを作る>ゲームオーバー画面のシーンを作る<a hidden class=anchor aria-hidden=true href=#ゲームオーバー画面のシーンを作る>#</a></h3><p>「シーン」メニュー＞「新規シーン」から、「ユーザーインターフェース」を選択して「Control」ノードをルートノードにする。名前は「GameOverView」とする。</p><p>ここで先にシーンを保存しておこう。名前はそのまま「GameOverView.tscn」として、「scene」フォルダに保存する。</p><p>「GameOverView」ノードに「ColorRect」クラスのノードを追加する。名前を「Background」に変更しておこう。インスペクタ一番上の「Color」プロパティを黒（000000）に変更する。</p><p>「GameOverView」ノードに「VBoxContainer」クラスのノードを追加し、名前を「VBox」とする。あとは、インスペクタで「Alignment」を「Center」に変更、「Custom Constants」の値を<code>60</code>に変更しよう。</p><p>「Background」、「VBox」それぞれについて、ツールバーの「レイアウト」＞「Rect全面」を選択して画面一杯に広げておこう。</p><p>次に「VBox」ノードの子ノードとして2つの「Label」クラスのノードを追加する。それぞれ名前を「GameOverLabel」、「Message」とする。</p><p>ここまででシーンドックは以下のスクリーンショットのようになったはずだ。</p><p><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_35.png alt=シーンドックでGameOverViewシーンのノード確認></p><br><p>では「GameOverLabel」ノードのプロパティを以下のように設定しよう。</p><ul><li>「Text」プロパティに「gameover」と入力</li><li>「Align」を「Center」にする</li><li>「Uppercase」プロパティをオンにする</li><li>「Custom Fonts」＞「Font」に「新規 DynamicFont」を適用</li><li>「Custom Fonts」＞「Font」＞「Font Data」にフォントファイルの「PressStart2P」を割り当てる</li><li>「Custom Fonts」＞「Settings」＞「Size」の値を<code>48</code>に変更</li><li>「Custom Colors」＞「Font Color」に赤色（ff0000）を割り当てて、ゲームオーバーを演出する</li></ul><br><p>続いて「Message」ノードのプロパティを以下のように設定しよう。</p><ul><li>「Text」プロパティに下記文言を入力<br>To Quit Press Q<br>To Continue Press Enter</li><li>「Align」を「Center」にする</li><li>「Custom Fonts」＞「Font」に「新規 DynamicFont」を適用</li><li>「Custom Fonts」＞「Font」＞「Font Data」にフォントファイルの「PressStart2P」を割り当てる</li><li>「Custom Fonts」＞「Settings」＞「Size」の値を<code>12</code>に変更</li><li>「Custom Colors」＞「Font Color」に薄いピンク（ffbebe）を割り当てる</li></ul><br><p>シーンドックで「GameOverView」ノードを選択した状態で、ツールバーから「オブジェクトの子を選択不可にする」を有効にして位置関係を固定しておこう。</p><p>ここまでできたら、一度シーンを実行してみよう。以下のスクリーンショットのようになっていればOKだ。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_36.png alt=デバッグパネルでゲームオーバー画面の確認></p><br><h3 id=ゲームオーバー画面からスタート画面に遷移またはゲームを終了させる>ゲームオーバー画面からスタート画面に遷移またはゲームを終了させる<a hidden class=anchor aria-hidden=true href=#ゲームオーバー画面からスタート画面に遷移またはゲームを終了させる>#</a></h3><p>画面遷移の処理も、基本的にはスタート画面でやったことと同じなので、サクサク進めていくが、一つ下準備をしておこう。</p><p>下準備というのはインプットマップの追加だ。ゲームオーバー画面で「Q」キーを押下したらゲームを完全に終了できるようにしていく。ここではひとまず、「プロジェクト」メニュー＞「プロジェクト設定」＞「インプットマップ」タブにて、「Quit」という名前のインプットマップを追加して「Q」キーを割り当てよう。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_37.png alt=Quitというインプットマップを追加></p><p>それではスクリプトの方の作業に移ろう。</p><p>まずはシーンドックで「GameOverView」ノードを選択して、新規スクリプトをアタッチしよう。スクリプトは保存先を「res://scripts」、名前を「GameOverView.gd」として保存する。</p><p>スクリプトの内容を以下のコードで置き換えてほしい。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-GDScript data-lang=GDScript><span style=display:flex><span><span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Control</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>_input</span>(event):
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> event <span style=color:#f92672>is</span> <span style=color:#a6e22e>InputEventKey</span>:
</span></span><span style=display:flex><span>		print(<span style=color:#e6db74>&#34;Input at Game Over: &#34;</span>, event<span style=color:#f92672>.</span><span style=color:#a6e22e>as_text</span>())
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> event<span style=color:#f92672>.</span><span style=color:#a6e22e>is_action_released</span>(<span style=color:#e6db74>&#34;Quit&#34;</span>):
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>get_tree</span>()<span style=color:#f92672>.</span><span style=color:#a6e22e>quit</span>()
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>elif</span> event<span style=color:#f92672>.</span><span style=color:#a6e22e>is_action_released</span>(<span style=color:#e6db74>&#34;ui_accept&#34;</span>):
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>get_tree</span>()<span style=color:#f92672>.</span><span style=color:#a6e22e>change_scene</span>(<span style=color:#e6db74>&#34;res://scene/GameStartView.tscn&#34;</span>)
</span></span></code></pre></div><br><p>では、スクリプトの内容を確認していく。</p><p>スタート画面と大まかには同じようなコードだ。組み込みのコールバック関数<code>_input</code>によって、プレイヤーが何らかの入力をすれば関数内のコードが実行される。</p><p>今回のコードは if 構文が2段階になっている（これをネストという）。まず最初の if 構文で、入力がキーボード入力だった場合、ひとまず入力したキーを出力コンソールに出力して確認するため<code>print</code>関数を使用している。</p><p>その後、さらに内側の if 構文に進む。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-GDScript data-lang=GDScript><span style=display:flex><span>		<span style=color:#66d9ef>if</span> event<span style=color:#f92672>.</span><span style=color:#a6e22e>is_action_pressed</span>(<span style=color:#e6db74>&#34;Quit&#34;</span>):
</span></span></code></pre></div><p>これはシンプルに、入力されたイベントがインプットマップの「Quit」の操作だったら、つまりプレイヤーが「Q」のキーを押したら、という意味合いだ。その場合に実行されるのが<code>get_tree().quit()</code>だ。<code>get_tree</code>関数でシーンツリーにアクセスし、そこから<code>quit</code>関数によって、ゲームアプリケーションが終了させられる。なお、iOSデバイス向けにゲームを作る場合は、この関数は機能しないようなので、今後のご自身の開発ではご注意いただきたい。</p><p>次に<code>elif</code>のブロックだ。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-GDScript data-lang=GDScript><span style=display:flex><span>		<span style=color:#66d9ef>elif</span> event<span style=color:#f92672>.</span><span style=color:#a6e22e>is_action_released</span>(<span style=color:#e6db74>&#34;ui_accept&#34;</span>):
</span></span></code></pre></div><p><code>elif</code>から始まる行は、最初の<code>if</code>から始まる行の条件に当てはまらなかった場合に実行される。<code>is_action_released</code>関数は、引数のインプットマップの操作があったかどうかを Bool 値で返してくれる。ただし、さきほどの<code>if</code>の行では関数名に <strong>pressed</strong>が含まれていたが、今回は <strong>released</strong>が名前に含まれている。これは、操作の最後にキーから指が離れたかどうかを確認している。</p><p>具体的に、ここでのコードは『入力操作がインプットマップの「ui_accept」の操作で、最後に指がキーから離れたら』という意味合いになる。そして「ui_accept」はデフォルトで用意されているインプットマップで、スペースキーやエンターキーが割り当てられている。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_38.png alt=インプットマップのui_accept></p><p>その次の最後の行のコードはスタート画面の時と同様の処理で、<code>get_tree</code>関数でシーンツリーにアクセスし、そこから別のシーンに切り替えるための関数<code>change_scene</code>を実行している。引数には<code>"res://scene/GameStartView.tscn"</code>を指定しており、スタート画面に戻るように指定している。</p><p>ここまでできたら、シーンを実行して動作確認してみよう。下のGIF画像は次の順序で画面遷移を確認している。</p><ol><li>シーンを実行して「GameOverView」シーンが表示されたところから開始</li><li>「Enter」キーを押下</li><li>「GameStartView」シーンが表示される</li><li>「Space」キーを押下</li><li>「Game」シーンが表示される</li><li>デバッグパネルを一度終了して、再度シーンを実行して「GameOverView」シーンを表示</li><li>「Q」キーを押下</li><li>デバッグパネルが閉じて終了<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_39.gif alt=デバッグパネルで画面遷移の確認></li></ol><br><hr><h1 id=プレイ画面からゲームオーバー画面に遷移させる>プレイ画面からゲームオーバー画面に遷移させる<a hidden class=anchor aria-hidden=true href=#プレイ画面からゲームオーバー画面に遷移させる>#</a></h1><p>一般的に、ゲームオーバー画面が表示されるのは、プレイ画面で何らかの失敗をした時だ。ブロック崩しではボールが画面下に落ちたら失敗というわかりやすいルールなので、その条件でゲームオーバー画面が表示されるように更新していこう。</p><br><h3 id=ボールが画面下に落ちた瞬間に検知させる>ボールが画面下に落ちた瞬間に検知させる<a hidden class=anchor aria-hidden=true href=#ボールが画面下に落ちた瞬間に検知させる>#</a></h3><p>画面下にボールが落ちた瞬間にそのことを検知する必要がある。そのためにはまず「Game.tscn」シーンに切り替えて、「Ball」ノードに「VisibilityNotifier2D」クラスのノードを子ノードとして追加しよう。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_40.png alt=VisibilityNotifier2Dノードを追加></p><p>このノードを追加したのは、このノードのシグナルが便利だからだ。<br>さっそく、シーンドックで「VisibilityNotifier2D」ノードを選択した状態から、「ノード」ドックの「シグナル」タブを開こう。使用したいのは「screen_exited()」というシグナルだ。これはノードがスクリーンの外に出た瞬間に発信される。</p><p>「screen_exited()」をダブルクリック、または右下の「接続」をクリックする。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_41.png alt=screen_exitedシグナルを接続></p><p>「Ball」ノードのスクリプトを選択して「接続」をクリックする。なお、受信側メソッドの名前はそのままで良い。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_42.png alt=接続先を選択></p><p>スクリプトエディタに切り替わり、メソッドが追加され、左側にシグナルとの接続を示す緑色のアイコンが表示されているのが確認できるだろう。ではこのメソッドの中身を編集していこう。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_43.png alt=スクリプトエディタで接続されたメソッドを確認></p><p><code>_on_VisibilityNotifier2D_screen_exited</code>メソッドを編集した結果、「Ball.gd」スクリプト全体は以下のようなコードになる。追加したメソッドは一番下にある。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-GDScript data-lang=GDScript><span style=display:flex><span><span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>RigidBody2D</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> MAX_SPEED <span style=color:#f92672>=</span> <span style=color:#ae81ff>300.0</span>
</span></span><span style=display:flex><span>export (<span style=color:#66d9ef>float</span>) <span style=color:#66d9ef>var</span> ball_speed <span style=color:#f92672>=</span> <span style=color:#ae81ff>150.0</span>
</span></span><span style=display:flex><span>export (<span style=color:#66d9ef>float</span>) <span style=color:#66d9ef>var</span> speed_up <span style=color:#f92672>=</span> <span style=color:#ae81ff>4.0</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> direction: <span style=color:#a6e22e>Vector2</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> velocity: <span style=color:#a6e22e>Vector2</span>
</span></span><span style=display:flex><span>onready <span style=color:#66d9ef>var</span> paddle <span style=color:#f92672>=</span> <span style=color:#a6e22e>get_node</span>(<span style=color:#e6db74>&#34;../Paddle&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>_ready</span>():
</span></span><span style=display:flex><span>	direction <span style=color:#f92672>=</span> <span style=color:#a6e22e>Vector2</span>(<span style=color:#ae81ff>1</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span><span style=color:#a6e22e>normalized</span>()
</span></span><span style=display:flex><span>	velocity <span style=color:#f92672>=</span> direction <span style=color:#f92672>*</span> ball_speed
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>_process</span>(delta):
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> mode <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span>:
</span></span><span style=display:flex><span>		position<span style=color:#f92672>.</span>x <span style=color:#f92672>=</span> paddle<span style=color:#f92672>.</span>position<span style=color:#f92672>.</span>x
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>Input</span><span style=color:#f92672>.</span><span style=color:#a6e22e>is_action_just_pressed</span>(<span style=color:#e6db74>&#34;launch_ball&#34;</span>):
</span></span><span style=display:flex><span>			mode <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>apply_impulse</span>(<span style=color:#a6e22e>Vector2</span><span style=color:#f92672>.</span>ZERO, velocity)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>_on_Ball_body_entered</span>(body):
</span></span><span style=display:flex><span>	ball_speed <span style=color:#f92672>+=</span> speed_up
</span></span><span style=display:flex><span>	print(<span style=color:#e6db74>&#34;ball_speed: &#34;</span><span style=color:#f92672>+</span>str(ball_speed))
</span></span><span style=display:flex><span>	direction <span style=color:#f92672>=</span> linear_velocity<span style=color:#f92672>.</span><span style=color:#a6e22e>normalized</span>()
</span></span><span style=display:flex><span>	velocity <span style=color:#f92672>=</span> direction <span style=color:#f92672>*</span> min(ball_speed, MAX_SPEED)
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> body<span style=color:#f92672>.</span><span style=color:#a6e22e>is_in_group</span>(<span style=color:#e6db74>&#34;Bricks&#34;</span>):
</span></span><span style=display:flex><span>		body<span style=color:#f92672>.</span><span style=color:#a6e22e>queue_free</span>()
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> body<span style=color:#f92672>.</span><span style=color:#a6e22e>get_name</span>() <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;Paddle&#34;</span>:
</span></span><span style=display:flex><span>		direction <span style=color:#f92672>=</span> (position <span style=color:#f92672>-</span> body<span style=color:#f92672>.</span>position)<span style=color:#f92672>.</span><span style=color:#a6e22e>normalized</span>()
</span></span><span style=display:flex><span>		velocity <span style=color:#f92672>=</span> direction <span style=color:#f92672>*</span> min(ball_speed, MAX_SPEED)
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	linear_velocity <span style=color:#f92672>=</span> velocity
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>_on_VisibilityNotifier2D_screen_exited</span>():
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>queue_free</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>get_tree</span>()<span style=color:#f92672>.</span><span style=color:#a6e22e>change_scene</span>(<span style=color:#e6db74>&#34;res://scene/GameOverView.tscn&#34;</span>)
</span></span></code></pre></div><p><code>_on_VisibilityNotifier2D_screen_exited</code>メソッドが実行されると、まず<code>queue_free</code>という関数が実行される。これはスクリプトがアタッチされているノード自体を開放（シーンツリーから消す）する。つまり、ボールが画面下に落ちたら、「Ball」ノードそのものが消えるということだ。これを実行しないと、画面上には表示されてなくとも、「Ball」ノードは生きたまま落下し続けている状態になる。ただし、開放するタイミングは次のフレームだ。だから「Ball」ノードが消える前に次の行のコードもきっちり処理される。</p><p>そして次の最後の行だが、すっかりお馴染みの<code>change_scene</code>関数だ。引数に<code>"res://scene/GameOverView.tscn"</code>をとって、ゲームオーバー画面に遷移するようにしている。</p><p>これで、ボールが画面下に落ちたらゲームオーバー画面に切り替わるようになったはずだ。プロジェクトを実行して最初から画面遷移を確認してみよう。<br><img loading=lazy src=/images/tutorials/gd0004_breakout/breakout_6/img_44.gif alt=デバッグパネルで画面遷移を確認></p><br><hr><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><h1 id=おわりに>おわりに<a hidden class=anchor aria-hidden=true href=#おわりに>#</a></h1><p>以上で Part 6 は完了だ。今回はスタート画面、ゲームオーバー画面を作って、プレイ画面を含めた画面遷移を完成させた。よりゲームらしさが演出できたのではないだろうか。</p><p>次回 Part 7 では HUD（ヘッドアップディスプレイ）を追加していく。</p><hr></div><footer class=post-footer><br><div class=recommendation><span>🩵この記事を気に入ってくれたらうれしいです🩵</span></div><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Godot で作るブロック崩し Part 6：ゲームスタート/ゲームオーバーの画面を作ろう！ on x" href="https://x.com/intent/tweet/?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%20Part%206%ef%bc%9a%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%2f%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%aa%e3%83%bc%e3%83%90%e3%83%bc%e3%81%ae%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout%2fbreakout_6%2f&amp;hashtags=GodotEngine%2cGameDev%2c%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%2c2D"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Godot で作るブロック崩し Part 6：ゲームスタート/ゲームオーバーの画面を作ろう！ on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout%2fbreakout_6%2f&amp;title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%20Part%206%ef%bc%9a%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%2f%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%aa%e3%83%bc%e3%83%90%e3%83%bc%e3%81%ae%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81&amp;summary=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%20Part%206%ef%bc%9a%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%2f%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%aa%e3%83%bc%e3%83%90%e3%83%bc%e3%81%ae%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81&amp;source=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout%2fbreakout_6%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Godot で作るブロック崩し Part 6：ゲームスタート/ゲームオーバーの画面を作ろう！ on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout%2fbreakout_6%2f&title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%20Part%206%ef%bc%9a%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%2f%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%aa%e3%83%bc%e3%83%90%e3%83%bc%e3%81%ae%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Godot で作るブロック崩し Part 6：ゲームスタート/ゲームオーバーの画面を作ろう！ on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout%2fbreakout_6%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Godot で作るブロック崩し Part 6：ゲームスタート/ゲームオーバーの画面を作ろう！ on whatsapp" href="https://api.whatsapp.com/send?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%20Part%206%ef%bc%9a%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%2f%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%aa%e3%83%bc%e3%83%90%e3%83%bc%e3%81%ae%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81%20-%20https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout%2fbreakout_6%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Godot で作るブロック崩し Part 6：ゲームスタート/ゲームオーバーの画面を作ろう！ on telegram" href="https://telegram.me/share/url?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%20Part%206%ef%bc%9a%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%2f%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%aa%e3%83%bc%e3%83%90%e3%83%bc%e3%81%ae%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout%2fbreakout_6%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Godot で作るブロック崩し Part 6：ゲームスタート/ゲームオーバーの画面を作ろう！ on ycombinator" href="https://news.ycombinator.com/submitlink?t=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%20Part%206%ef%bc%9a%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%2f%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%aa%e3%83%bc%e3%83%90%e3%83%bc%e3%81%ae%e7%94%bb%e9%9d%a2%e3%82%92%e4%bd%9c%e3%82%8d%e3%81%86%ef%bc%81&u=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout%2fbreakout_6%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></div><ul class=post-tags><li><a href=https://www.peanuts-code.com/ja/tags/godotengine/>GodotEngine</a></li><li><a href=https://www.peanuts-code.com/ja/tags/gamedev/>GameDev</a></li><li><a href=https://www.peanuts-code.com/ja/tags/%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E5%B4%A9%E3%81%97/>ブロック崩し</a></li><li><a href=https://www.peanuts-code.com/ja/tags/2d/>2D</a></li></ul><nav class=paginav><a class=prev href=https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/breakout_5/><span class=title>« 前へ</span><br><span>Godot で作るブロック崩し Part 5：細かい更新をしてゲーム性を高めよう！</span>
</a><a class=next href=https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/breakout_7/><span class=title>次へ »</span><br><span>Godot で作るブロック崩し Part 7：HUDを作って表示内容を更新してみよう！</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://www.peanuts-code.com/ja/>Peanuts Code</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="コピー";function s(){t.innerHTML="コピーされました!",setTimeout(()=>{t.innerHTML="コピー"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>