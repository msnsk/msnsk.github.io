<!DOCTYPE html>
<html lang="ja" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Godot で作るブロック崩し Part 13：ハイスコアのデータを保存しよう！ | Peanuts Code</title>
<meta name="keywords" content="Godot, GodotEngine, ゲーム開発, チュートリアル, ブロック崩し, 初級" />
<meta name="description" content="Part 13 の今回は、ブロック崩しの HUD にハイスコア、ハイレベル（過去最高クリアレベルのことをこう呼ぶことにする）の要素を追加し、ゲームオーバーになった時点でそのデータが自動的に保存されるようにして、一度ゲームを終了しても記録が消えない仕組みを作っていく。">
<meta name="author" content="Masanao Sako">
<link rel="canonical" href="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/breakout_13/" />
<meta name="google-site-verification" content="XYZabc" />
<meta name="yandex-verification" content="XYZabc" />
<meta name="msvalidate.01" content="XYZabc" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.css" rel="preload stylesheet" as="style">
<link rel="preload" href="/images/logomark.png" as="image">
<link rel="icon" href="https://www.peanuts-code.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.peanuts-code.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.peanuts-code.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://www.peanuts-code.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://www.peanuts-code.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.92.0" />
<link rel="alternate" hreflang="ja" href="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/breakout_13/" />

<script async src="https://www.googletagmanager.com/gtag/js?id=G-DK0NK2RTTW"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-DK0NK2RTTW', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="Godot で作るブロック崩し Part 13：ハイスコアのデータを保存しよう！" />
<meta property="og:description" content="Part 13 の今回は、ブロック崩しの HUD にハイスコア、ハイレベル（過去最高クリアレベルのことをこう呼ぶことにする）の要素を追加し、ゲームオーバーになった時点でそのデータが自動的に保存されるようにして、一度ゲームを終了しても記録が消えない仕組みを作っていく。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/breakout_13/" />
<meta property="og:image" content="https://www.peanuts-code.com/images/tutorials/gd0004_breakout/breakout_13/img_16.gif" /><meta property="article:section" content="tutorials" />
<meta property="article:published_time" content="2021-12-23T16:55:59&#43;09:00" />
<meta property="article:modified_time" content="2021-12-23T16:55:59&#43;09:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://www.peanuts-code.com/images/tutorials/gd0004_breakout/breakout_13/img_16.gif" />
<meta name="twitter:title" content="Godot で作るブロック崩し Part 13：ハイスコアのデータを保存しよう！"/>
<meta name="twitter:description" content="Part 13 の今回は、ブロック崩しの HUD にハイスコア、ハイレベル（過去最高クリアレベルのことをこう呼ぶことにする）の要素を追加し、ゲームオーバーになった時点でそのデータが自動的に保存されるようにして、一度ゲームを終了しても記録が消えない仕組みを作っていく。"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Tutorials",
      "item": "https://www.peanuts-code.com/ja/tutorials/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Godot で作るブロック崩し",
      "item": "https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Godot で作るブロック崩し Part 13：ハイスコアのデータを保存しよう！",
      "item": "https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/breakout_13/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Godot で作るブロック崩し Part 13：ハイスコアのデータを保存しよう！",
  "name": "Godot で作るブロック崩し Part 13：ハイスコアのデータを保存しよう！",
  "description": "Part 13 の今回は、ブロック崩しの HUD にハイスコア、ハイレベル（過去最高クリアレベルのことをこう呼ぶことにする）の要素を追加し、ゲームオーバーになった時点でそのデータが自動的に保存されるようにして、一度ゲームを終了しても記録が消えない仕組みを作っていく。",
  "keywords": [
    "Godot", "GodotEngine", "ゲーム開発", "チュートリアル", "ブロック崩し", "初級"
  ],
  "articleBody": "Part 13 の今回は、ブロック崩しの HUD にハイスコア、ハイレベル（過去最高クリアレベルのことをこう呼ぶことにする）の要素を追加し、ゲームオーバーになった時点でそのデータが自動的に保存されるようにして、一度ゲームを終了しても記録が消えない仕組みを作っていく。\n Memo: \n過去のシリーズをまだご覧になっていない方は、そちらを先にご覧いただくことをおすすめします。\nGodot で作るブロック崩し \n  \n (adsbygoogle = window.adsbygoogle || []).push({});   HUD をアップデートする 今回、「ハイスコア」と「ハイレベル」の要素をゲームに追加する。これに伴い、HUD にもそれぞれのノードを追加して、プロパティを編集していく。\nでは、「Game.tscn」シーンを開いて手順を進めていこう。\nノードを追加する 「HUD」ノードの「LeftBox」ノードの次に、新たに「VBoxContainer」クラスのノードを追加し、名前を「MidBox」に変更しよう。\nさらに「MidBox」ノードには「Label」クラスのノードを 2 つ追加し、それぞれの名前を「HighScore」、「HighLevel」に変更しよう。これで「HUD」ノードの構成は以下のようになったはずだ。\n追加したノードのプロパティを編集する 「LeftBox」ノードと「MidBox」ノードの位置と枠の大きさを編集する。HUD のレイアウトは、ブロックの配置の都合上、全て画面上端に並べる必要がある。\n2D ワークスペースで「MidBox」をドラッグして画面上端中央に配置しても問題ないが、インスペクタドックで数値を調整するならそれぞれのノードで「Margin」プロパティが以下の値になるようにしよう。\n 「LeftBox」ノード\n 「MidBox」ノード\n  これで、画面上端中央に「MidBox」ノードが配置された。\n次にインスペクタドックで、「MidBox」ノードの子ノードである「HighScore」ノードと「HighLevel」ノードの「Text」プロパティを設定する。\n 「HighScore」ノードの「Text」プロパティ：「H Scr: 0」 「HighLevel」ノードの「Text」プロパティ：「H Lvl: 1」  この時点で、ゲーム画面は以下のようになったはずだ。\nGame.gd スクリプトを更新する HUD の見た目は更新できたので、次はスクリプトで表示される値を制御していく。ここで、ゲームデータを保存する機能と保存されたゲームデータを読み込む機能を新たに実装していく。\nではここから「Game.gd」スクリプトを開いて編集していこう。\n必要な定数と変数を追加する まずは新たにいくつか変数を定義していく。「# 追加」のコメントを記述している行が今回定義した定数と変数だ。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  extends Node2D const POINT = 100 const MAX_LIFE = 5 const SCORE_FILE_PATH = \"user://score_record.save\" # 追加 export var drop_rate = 0.2 var level_num: int = 1 var high_level_num: int = 0 # 追加 var score: int = 0 var high_score: int = 0 # 追加 #（中略） onready var hud_level = $HUD/LeftBox/Level onready var hud_high_level = $HUD/MidBox/HighLevel # 追加 onready var hud_score = $HUD/LeftBox/Score onready var hud_high_score = $HUD/MidBox/HighScore # 追加 #（後略）   まずconstキーワードで定義しているのはSCORE_FILE_PATHという定数だ。その値を\"user://score_record.save\"としてデータの保存先となるファイルパスを指定した。\nこのように、データを保存するファイルの頭にuser://をつけるとプロジェクトの所定の場所にデータを保存してくれる。このファイルにデータを書き込めば、シーンを切り替えたり、ゲームを一度終了してから再開しても、ファイルからデータを読み込んで、以前プレイした時の状態を引き継ぐことが可能だ。\n次に変数high_level_numだが、これはゲーム開始時に前回までのハイレベルを渡しておくためのものだ。同様に、もう一つの変数high_scoreには、ゲーム開始時に前回までのハイスコアを渡しておく。また、ゲームオーバーの時に、記録が更新される際にも利用する。\n続いてonreadyキーワード付きの変数だが、これらは特定のノードを指すのに使っている。hud_high_levelは「HighLevel」ノードを、hud_high_scoreは「HighScore」ノードを指している。\n保存用のメソッドを追加する 引き続き「Game.gd」スクリプトに、ゲームのデータを保存するためのメソッドを追加する。\n1 2 3 4 5 6 7 8 9 10 11  func save_data(): var data = { \"last_level\": level_num, \"high_level\": high_level_num, \"last_score\": score, \"high_score\": high_score, } var file = File.new() file.open(SCORE_FILE_PATH, File.WRITE) file.store_line(to_json(data)) file.close()   save_dataというメソッドを定義した。まず変数dataをメソッド内で定義している。メソッド内で定義した変数は、そのメソッドの外では使えないので注意してほしい。dataは辞書型データで{\"key\": value}の組み合わせで複数のデータをまとめることができる。\nここではデータとして保存したい値を格納したlevel_num、high_level_num、score、high_scoreの4つの変数それぞれを Value とし、対応する Key を\"last_level\"、“high_level”、“last_score”、“high_score\"として定義した。\nそのあとはfileという変数を定義している。newメソッドを実行して作成されたFileクラスのノードを値として代入している。これ以降Fileクラスのメソッドが続く。\nデータを保存するには保存先のファイルを開く必要がある。openは第一引数で指定したパスのファイルを開くメソッドだ。ここでは、先に定義した定数SCORE_FILE_PATH（\"user://score_record.save\"）を第一引数として渡している。第二引数にはファイルを開くときのモードを指定する。ここではデータを書き込んで保存したいので、WRITEを指定して書き込みモードにしている。\n次にstore_lineメソッドでファイルにデータを書き込んでいる。store_xxxという名前のメソッドは他にもいくつかあるが、このstore_lineは1行のstring型データをファイルに書き込む。そして、store_lineの引数が書き込むデータになるが、ここでは先に定義した辞書型の変数dataをto_jsonで変換した値を指定している。dataは辞書型データで、スクリプト上は見やすさのため改行しているが、実際には1行のデータだ。\nここでto_jsonについても説明しておく。まず「JSON」というのは「JavaScript Object Notation」の略で、JavaScript というプログラミング言語でのオブジェクトの記述方式で保存されたデータフォーマットだ。そして、その構造は GDScript を含む各種プログラミング言語の辞書型データにもそっくりの{\"key\": value}という形式だ。先に保存したいデータを辞書型でまとめておき、保存データを指定するときにその辞書型データをto_jsonメソッドの引数にして、JSON形式に変換して保存するようにしたというわけだ。\n最後にcloseメソッドでファイルを閉じている。開きっぱなしにして、メモリを消耗しないよう注意しよう。\n読み込み用のメソッドを追加する 「Game.gd」スクリプトで、今度は保存したデータを読み込むメソッドを追加する。\n1 2 3 4 5 6 7 8 9 10 11  func load_data(): var file = File.new() if file.file_exists(SCORE_FILE_PATH): file.open(SCORE_FILE_PATH, File.READ) var data = parse_json(file.get_line()) if data != null: high_score = data[\"high_score\"] high_level_num = data[\"high_level\"] file.close() hud_high_score.text = \"H Scr: \" + str(high_score) hud_high_level.text = \"H Lvl: \" + str(high_level_num)   データを読み込むのはload_dataというメソッドだ。\n先ほどの書き込みメソッドsave_dataと同様に、まずはFileクラスのnewメソッドにより、Fileクラスのノードを作成する。そこからまたFileクラスのメソッドが続くが順番に見ていこう。\nまずはif構文で、file_existsメソッドによりデータ保存先のファイル（定数SCORE_FILE_PATHの値）があるか確認している。ファイルがあればifブロックの中の処理を続行する。\nではifブロックの中のコードを見ていこう。まず、ファイルをopenメソッドで開く。ここではモードをREADにして読み込みモードにしている。\n次はget_lineメソッドでファイルに保存されている一行のデータを読み込む。この時、この読み込んだデータはJSON形式なので、これをparse_jsonメソッド GDScript の辞書型データに変換して、変数dataに格納している。\n2段回目のif構文だが、もし変数dataが空っぽのnullでなければ、変数high_scoreにファイルに保存しているハイスコアのデータを、変数high_level_numにはファイルに保存しているハイレベルのデータを代入する。\nそこまでできたら、忘れずにファイルをcloseメソッドで閉じる。\n最後に、ファイルから得たそれぞれのデータをstring形に変換して、頭にH Str: 、H Lvl: を付け足して、HUD の「HighScore」ノードと「HighLevel」ノードそれぞれの「Text」プロパティに適用している。\n追加したメソッドを適切なタイミングで実行させる データを保存するメソッドと保存したデータを読み込むメソッドを用意できたので、それらのメソッドを適切なタイミングで実行するようにコードを更新していく。\nまずは_readyメソッドを編集する。\n1 2 3 4 5 6  func _ready(): randomize() add_new_level() add_new_ball() update_hud_life() load_data() # 追加   単純に、先ほど作成したload_dataメソッドを追加しただけだ。これで、ゲーム開始前にデータを保存しているファイルからハイスコアやハイレベルの値を取得して HUD に反映してくれる。\n次に_on_Ball_tree_exitedメソッドを編集する。ちなみにこのメソッドは、ボールオブジェクトが消える時に発信されるシグナルによって呼ばれる。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  func _on_Ball_tree_exited(): print(\"_on_Ball_tree_exited() called\") var no_ball = true for child in get_children(): if child.is_in_group(\"Balls\"): print(\"found ball\") no_ball = false break if no_ball: if is_playing: life -= 1 if life  0: if high_score  score: # 追加 high_score = score if high_level_num  level_num: # 追加 high_level_num = level_num save_data() # 追加 get_tree().change_scene(\"res://scene/GameOverView.tscn\") else: update_hud_life() life_down_sound.play() #（後略）   このメソッド内のif no_ball:でネストされたif is_playing:でさらにネストされたif life ブロック内を編集する。このブロック内のコードは、『画面からボールが一つも無くなった場合』、『ゲームプレイ中であり』、『ライフが 0』の場合に実行される。つまり、ゲームオーバーになる場合だ。\n元々このブロックには、シーンを「GameOverView.tscn」に切り替えて、ゲームオーバー画面に遷移するためのコードget_tree().change_scene(\"res://scene/GameOverView.tscn\")のみを記述していた。今回はそのコードの前に、ハイスコアとハイレベルを更新するコードを追加した。\n具体的には、これまでのハイスコアを表す変数high_scoreの値が今プレイしていた時のスコアを表す変数scoreの値より小さければ、scoreの値を新しいハイスコアとしてhigh_scoreへ代入する、というプログラムをif構文で記述した。\n同様に、これまでのハイレベルを表す変数high_level_numの値が今プレイしていた時のレベルを表す変数level_numの値より小さければ、level_numの値を新しいハイレベルとしてhigh_level_numへ代入するよう記述した。\n \n (adsbygoogle = window.adsbygoogle || []).push({});   ゲームオーバー画面を更新する 次にハイスコア、ハイレベルの表示が必要なのがゲームオーバー画面だ。プレイヤーの心情としては、ゲームオーバーになった時に、最終的に自分のスコアがどの程度でどのレベルまで到達したのかを確認したい。さらに、その結果はこれまでの最高記録を塗り替えたのかどうかも知りたいものだ。\nしたがって、ゲームオーバー画面には以下の4つの結果を表示するようにしていく。\n ハイスコア（過去最高獲得スコア） ラストスコア（今のプレイで最終的に獲得したスコア） ハイレベル（過去最高到達レベル） ラストレベル（今のプレイで最終的に到達したレベル）  それでは「GameOverView.tscn」シーンを開いて編集していこう。\nノードを追加して、プロパティを編集する 以下の手順で、シーンドックおよびインスペクタドックにて、必要なノードを追加し、プロパティを編集していこう。\n  シーンドックで「VBox」ノードに「VBoxContainer」クラスのノードを一つ追加して、名前を「ResultsContainer」に変更する。\n  シーンドックで「ResultsContainer」ノードの順番を「GameOverLavel」ノードの下、「Message」ノードの前に移動する。\n  インスペクタドックで「ResultsContainer」ノードの「Custom Constants」＞「Separation」プロパティを10にして有効にする。\n  シーンドックで「ResultsContainer」ノードに「Label」クラスのノードを 1 つ追加し、名前を「HighScore」に変更する。\n  インスペクタドックで「HighScore」ノードの「Align」プロパティを「Center」に変更する。\n  インスペクタドックで「HighScore」ノードの「Uppercase」プロパティを「オン」にする。\n  インスペクタドックで既存の「Message」ノードの「Custom Fonts」＞「Font」をコピーする。\n  インスペクタドックで「HighScore」ノードの「Custom Fonts」＞「Font」に貼り付けする。\n  さらに「HighScore」ノードの「Custom Fonts」＞「Font」をユニーク化する。\n  さらに「HighScore」ノードの「Custom Fonts」＞「Settings」＞「Size」プロパティを16にする。\n  シーンドックで「HighScore」ノードを3つ複製し、それらの名前を上から順番に「LastScore」、「HighLevel」、「LastLevel」に変更する。この時点でシーンドックは以下のようになる。\n  インスペクタドックで「HighScore」ノードの「Text」プロパティを「High Score: 0」にする。\n  同様に「LastScore」ノードの「Text」プロパティを「Last Score: 0」にする。\n  同様に「HighLevel」ノードの「Text」プロパティを「High Level: 0」にする。\n  同様に「LastLevel」ノードの「Text」プロパティを「Last Level: 0」にする。\n  ここまでの手順ができたら、2D ワークスペースから以下のようになっているのを確認できるはずだ。\nGameOverView.gd スクリプトを更新する ゲームオーバー画面のノードの追加と編集ができたので、ここからはスクリプトでゲームオーバー画面に切り替わる際のデータの読み込みを実装していく。ちなみに、ゲームオーバー画面なので、データの保存機能は不要だ。\nそれでは「GameOverView.gd」スクリプトを開いて編集していこう。\n必要な変数を追加する データの読み込みとその読み込んだデータを画面に反映させるために、まずは変数をいくつか追加しておく。\n1 2 3 4 5 6 7 8  const SCORE_FILE_PATH = \"user://score_record.save\" onready var high_score = $VBox/ResultsContainer/HighScore onready var last_score = $VBox/ResultsContainer/LastScore onready var high_level = $VBox/ResultsContainer/HighLevel onready var last_level = $VBox/ResultsContainer/LastLevel #（後略）   constキーワードで定数SCORE_FILE_PATHを定義した。値はデータが保存されいているファイルのパスだ。「Game.gd」スクリプトでも同じ定数を定義したところである。\n次にonreadyキーワード付きの変数をhigh_scoreをはじめとして 4 つ定義しているが、これらは今回追加した「Label」クラスのそれぞれのノードを指している。\n読み込み用のメソッドを追加する ほどんど「Game.gd」スクリプトで実装した内容と同じになるが、「GameOverView.gd」スクリプトの方でも、データ読み込み用のメソッドを追加する必要がある。\n1 2 3 4 5 6 7 8 9 10 11  func load_data(): var file = File.new() if file.file_exists(SCORE_FILE_PATH): file.open(SCORE_FILE_PATH, File.READ) var data = parse_json(file.get_line()) if data != null: high_score.text = \"High Score: \" + str(data[\"high_score\"]) last_score.text = \"Last Score: \" + str(data[\"last_score\"]) high_level.text = \"High Level: \" + str(data[\"high_level\"]) last_level.text = \"Last Level: \" + str(data[\"last_level\"]) file.close()   laod_dataという名前で読み込み用メソッドを定義した。if data != null:の行までは「Game.gd」スクリプトと全く同じだが、そのifブロックの中のコードがゲームオーバー画面仕様になっている。\nこのメソッドのコードを要約すると、データ保存先のファイルがあればファイルを開き、そのあとデータが空っぽでなければ、単純に「HighScore」、「LastScore」、「HighLevel」、「LastLevel」それぞれのノードの「Text」プロパティに、ファイルから取得したJSONデータを最終的にstring型に変換して反映する。もしファイルがない、またはデータがなければ、「Text」プロパティの値はデフォルトの設定で表示される。\nなお、繰り返しになるが、最後のファイルを閉じるcloseメソッドは忘れてはいけない。\n追加したメソッドを適切なタイミングで実行させる 読み込み用メソッドが定義できたので、これを_readyメソッド内で実行させる。コードは至ってシンプルだ。\n1 2  func _ready(): load_data()   これだけで、ゲームオーバー画面に遷移した時にファイルの読み込みに失敗さえしなければ、きちんと画面上にデータを表示してくれるはずだ。今はまだデータファイルが作成されていないので、シーンを実行するとデフォルトの値で表示される。\n 最終確認 それでは最後にデータの保存とデータの読み込みがうまくいくかプロジェクトを実行して確認してみよう。\n 初回プレイ時、ライフが 0 になったタイミングでデータがファイルに保存され、ゲームオーバー画面に遷移した時にそのファイルのデータが読み込まれ画面上に結果が表示された。 2回目、3回目プレイ時は、最初からファイルのデータが読み込まれ HUD 中央のハイスコアに反映された。 2回目プレイで初回より高いスコアを獲得してからゲームオーバーになった時、画面には更新されたハイスコアが表示された。 3回目プレイで2回目プレイより低いスコアでゲームオーバーになった時、画面には2回目プレイ時のハイスコアが表示された。 1 ~ 3回目のプレイでのゲームオーバー画面でその時々のスコアが「Last Score」に反映された。  以上のことが確認できたので、今回のデータの保存と読み込みは問題なく実装できたと判断できる。なお、レベルの方の確認はカットするが、こちらも問題ないはずだ。\nところで、実際にデバッグ作業を行う中で、作成されたデータファイルを削除したい場合も発生するだろう。その場合は、ご利用のOSのファイルマネージャー（Windows なら Explorer、macOS なら Finder）から保存先のフォルダパスへアクセスして削除してほしい。なお、データの保存先は以下の通りだ。\n Windows: %APPDATA%¥Godot¥app_userdata¥[ProjectName]¥ macOS: ~/Library/Application Support/Godot/app_userdata/[ProjectName]/ Linux: ~/.local/share/godot/app_userdata/[ProjectName]/   Memo: \n詳細は公式ドキュメントの File paths in Godot projects の項目をご参照ください。\n 最後に今回編集した「Game.gd」と「GameOverView.gd」のスクリプト全体のコードもここに公開しておく。\n 「Game.gd」スクリプト全体を見る 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301  extends Node2D const POINT = 100 const MAX_LIFE = 5 # Added @ P11 const SCORE_FILE_PATH = \"user://score_record.save\" # Added @ P13 export var drop_rate = 0.2 var level_num: int = 1 var high_level_num: int = 0 # Added @ P13 var score: int = 0 var high_score: int = 0 # Added @ P13 var bonus_rate = 1.0 var life = 3 var is_playing = true var is_multiple_on = false # Added @ P11 var is_laser_on = false # Added @ P11 #onready var level = $Level1 # Removed @ P11 onready var next_screen = $NextScreen onready var next_screen_level = $NextScreen/VBox/Level onready var next_screen_score = $NextScreen/VBox/Score onready var next_screen_life = $NextScreen/VBox/HBox/Life onready var hud_level = $HUD/LeftBox/Level onready var hud_high_level = $HUD/MidBox/HighLevel # Added @ P13 onready var hud_score = $HUD/LeftBox/Score onready var hud_high_score = $HUD/MidBox/HighScore # Added @ P13 onready var hud_rightbox = $HUD/RightBox onready var paddle = $Paddle #onready var ball = $Ball # Removed @ P11 onready var pause_screen = $PauseScreen onready var life_down_sound = $LifeDownSound onready var slow_collide_sound = $SlowCollideSound onready var expand_collide_sound = $ExpandCollideSound onready var multiple_collide_sound = $MultipleCollideSound onready var laser_collide_sound = $LaserCollideSound onready var life_collide_sound = $LifeCollideSound onready var play_bgm = $PlayBGM onready var paddle_position = paddle.position onready var paddle_scale = paddle.scale # Added @ P11 #onready var ball_position = ball.position # Removed @ P11 onready var ball = preload(\"res://scene/Ball.tscn\") # Added @ P11 onready var laser = preload(\"res://scene/Laser.tscn\") # Added @ P11 onready var powerup = preload(\"res://scene/Powerup.tscn\") # Added @ P10 onready var level = null # Updated @ P11 func _ready(): randomize() # Added @ P10 add_new_level() # Added @ P11 add_new_ball() # Added @ P11 update_hud_life() load_data() # Added @ P13 # For debug #leave_one_brick(43) # Moved @ P11 #ball.connect(\"tree_exited\", self, \"_on_Ball_tree_exited\") # Removed @ P11 #for brick in level.get_children(): # Removed @ P11 #brick.connect(\"tree_exited\", self, \"_on_Brick_tree_exited\", [brick.global_position]) # Updated @ P10 func _process(_delta): # Added @ P11 if is_multiple_on and Input.is_action_just_pressed(\"launch_ball\"): add_new_ball() if is_laser_on and Input.is_action_just_pressed(\"ui_up\"): fire_laser() # For debug func leave_one_brick(brick_num: int): for child in level.get_children(): if child.get_name() == \"Brick\" + str(brick_num): continue child.queue_free() # Method receiving Ball signal func _on_Ball_tree_exited(): print(\"_on_Ball_tree_exited() called\") var no_ball = true # Added @ P11 for child in get_children(): # Added @ P11 if child.is_in_group(\"Balls\"): print(\"found ball\") no_ball = false break if no_ball: # Added and Edited @ P11 if is_playing: life -= 1 if life  0: if high_score  score: # Added @ P13 high_score = score if high_level_num  level_num: # Added @ P13 high_level_num = level_num save_data() # Added @ P13 get_tree().change_scene(\"res://scene/GameOverView.tscn\") else: update_hud_life() life_down_sound.play() else: is_playing = true # Clear powerup items for child in get_children(): # Added @ P10 if child.is_in_group(\"PowerupItems\"): child.queue_free() # Set Paddle and Balls as default is_multiple_on = false # Added @ P11 is_laser_on = false # Added @ P11 paddle.position = paddle_position paddle.scale = paddle_scale # Added @ P11 add_new_ball() # Added @ P11 #ball = load(\"res://scene/Ball.tscn\").instance() # Removed @ P11 #call_deferred(\"add_child\", ball) # Removed @ P11 #call_deferred(\"move_child\", ball, 3) # Removed @ P11 #ball.connect(\"tree_exited\", self, \"_on_Ball_tree_exited\") # Removed @ P11 # Set life nodes shown and hidden as life variable func update_hud_life(): var count = 0 for child in hud_rightbox.get_children(): count += 1 if count  life: child.show() else: child.hide() # Add a new ball func add_new_ball(): # Added @ P11 print(\"add_new_ball() called\") var instance = ball.instance() instance.position = Vector2(paddle.position.x, paddle.position.y - 10) # Added @ P11 call_deferred(\"add_child\", instance) call_deferred(\"move_child\", instance, 4) instance.connect(\"tree_exited\", self, \"_on_Ball_tree_exited\")\t#instance.mode = 3 # Removed @ P11 # Method receiving Brick signal func _on_Brick_tree_exited(brick_position): # Update Score score += POINT * bonus_rate bonus_rate += 0.1 hud_score.text = \"Score: \" + str(score) # Exit current Level node if level.get_child_count()  0: set_next_level() else: # Added @ P11 # Drop powerup item drop_powerup(brick_position) # Added @ P10 func drop_powerup(brick_position: Vector2): # Added @ P10 if randf()  drop_rate: var powerup_instance = powerup.instance() powerup_instance.position = brick_position call_deferred(\"add_child\", powerup_instance) call_deferred(\"move_child\", powerup_instance, 5) # Added @ P 11 powerup_instance.connect(\"item_collided\", self, \"_on_Powerup_item_collided\") # Action when powerup item collided func _on_Powerup_item_collided(item): # Updated @ P11 match item: 0: # SLOW slow_balls() 1: # EXPAND expand_paddle() 2: # MULTIPLE enable_multiple_balls() 3: # LASER enable_laser() 4: # LIFE add_life() # slow balls func slow_balls(): # Added @ P11 slow_collide_sound.play() # Added @ P12 for child in get_children(): if child.is_in_group(\"Balls\"): child.ball_speed = child.first_speed # Stretch paddle func expand_paddle(): # Added @ P11 expand_collide_sound.play() # Added @ P12 if paddle.scale  paddle_scale: paddle.scale.x *= 2 yield(get_tree().create_timer(10), \"timeout\") paddle.scale = paddle_scale # enable powerup Multiple func enable_multiple_balls(): # Added @ P11 multiple_collide_sound.play() # Added @ P12 if not is_multiple_on: is_multiple_on = true yield(get_tree().create_timer(3), \"timeout\") is_multiple_on = false # enable powerup Laser func enable_laser(): # Added @ P11 laser_collide_sound.play() # Added @ P12 if not is_laser_on: is_laser_on = true yield(get_tree().create_timer(3), \"timeout\") is_laser_on = false # fire laser beam func fire_laser(): var instance = laser.instance() call_deferred(\"add_child\", instance) call_deferred(\"move_child\", instance, 6) instance.position.x = paddle.position.x instance.position.y = paddle.position.y - 16 # Add a life if less than 5 func add_life(): # Added @ P11 life_collide_sound.play() # Added @ P12 if life  MAX_LIFE: life += 1 update_hud_life() # set next level func set_next_level(): print(\"set_next_level() called\") # Change status is_playing = false is_multiple_on = false # Added @ P11 is_laser_on = false # Added @ P11 # Clear left objects level.queue_free() for child in get_children(): if child.is_in_group(\"Balls\") or child.is_in_group(\"Lasers\"): # 追加 child.queue_free() # Increment level number level_num += 1 # Stop PauseScreen node pause_screen.pause_mode = 1 # Show NextScreen node next_screen.pause_mode = 2 next_screen_level.text = \"Level: \" + str(level_num) next_screen_score.text = \"Score: \" + str(score) next_screen_life.text = \"x \" + str(life) next_screen.show() # Set Level of HUD the next level hud_level.text = \"Level: \" + str(level_num) # Set Paddle and Ball the first position #paddle.position = paddle_position # Removed @ P11 #paddle.scale = paddle_scale # Removed @ P11 #ball.position = ball_position # Removed @ P11 #ball.mode = 3 # Removed @ P11 # Set next Level node add_new_level() # Added @ P11 #level = load(\"res://scene/Level\" + str(level_num) + \".tscn\").instance() # Removed @ P11 #add_child(level) # Removed @ P11 #move_child(level, 5) # Removed @ P11 #for child in level.get_children(): # Removed @ P11 #child.connect(\"tree_exited\", self, \"_on_Brick_tree_exited\") # Removed @ P11 # Pause game until NextScreen is hidden get_tree().paused = true # Add new level func add_new_level(): # Added @ P11 level = load(\"res://scene/Level\" + str(level_num) + \".tscn\").instance() add_child(level) move_child(level, 3) # Changed from 5 to 3 @ P11 for child in level.get_children(): child.connect(\"tree_exited\", self, \"_on_Brick_tree_exited\", [child.global_position]) # Updated to add th 4th arg @ P11  func _on_PauseScreen_visibility_changed(): play_bgm.stream_paused = not play_bgm.stream_paused # Save data func save_data(): # Added @ P13 var data = { \"last_level\": level_num, \"high_level\": high_level_num, \"last_score\": score, \"high_score\": high_score, } var file = File.new() file.open(SCORE_FILE_PATH, File.WRITE) file.store_line(to_json(data)) file.close() # Load data func load_data(): # Added @ P13 var file = File.new() if file.file_exists(SCORE_FILE_PATH): file.open(SCORE_FILE_PATH, File.READ) var data = parse_json(file.get_line()) if data != null: high_score = data[\"high_score\"] high_level_num = data[\"high_level\"] file.close() hud_high_score.text = \"H Scr: \" + str(high_score) hud_high_level.text = \"H Lvl: \" + str(high_level_num)     「GameOverView.gd」スクリプト全体を見る 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40  extends Control const SCORE_FILE_PATH = \"user://score_record.save\" # Added @ P13 onready var high_score = $VBox/ResultsContainer/HighScore # Added @ P13 onready var last_score = $VBox/ResultsContainer/LastScore # Added @ P13 onready var high_level = $VBox/ResultsContainer/HighLevel # Added @ P13 onready var last_level = $VBox/ResultsContainer/LastLevel # Added @ P13 onready var sound = $KeySound func _ready(): # Added @ P13 load_data() func _input(event): if event is InputEventKey: print(\"Input at Game Over: \", event.as_text()) if event.is_action_released(\"Quit\"): sound.play() yield(sound, \"finished\") get_tree().quit() elif event.is_action_released(\"ui_accept\"): sound.play() yield(sound, \"finished\") get_tree().change_scene(\"res://scene/GameStartView.tscn\") func load_data(): # Added @ P13 var file = File.new() if file.file_exists(SCORE_FILE_PATH): file.open(SCORE_FILE_PATH, File.READ) var data = parse_json(file.get_line()) if data != null: high_score.text = \"High Score: \" + str(data[\"high_score\"]) last_score.text = \"Last Score: \" + str(data[\"last_score\"]) high_level.text = \"High Level: \" + str(data[\"high_level\"]) last_level.text = \"Last Level: \" + str(data[\"last_level\"]) file.close()     おわりに 以上で Part 13 は完了だ。今回はデータを保存する機能、保存したデータを読み込む機能を実装した。ゲームによって、保存したいデータは変わり、規模が大きくなるほど、保存するデータも複雑化するだろう。しかし、何事も基本が重要なので、今回のチュートリアルの内容をぜひ今後の開発に役立てていただければと思う。\n次回 Part 14 ではブロックの種類（例えば一回の衝突では消えない硬いブロックなど）を増やして、レベルに応じて難易度の幅を広くできるように調整し、複数のレベルをデザインする。\n \n (adsbygoogle = window.adsbygoogle || []).push({});  ",
  "wordCount" : "2231",
  "inLanguage": "ja",
  "image":"https://www.peanuts-code.com/images/tutorials/gd0004_breakout/breakout_13/img_16.gif","datePublished": "2021-12-23T16:55:59+09:00",
  "dateModified": "2021-12-23T16:55:59+09:00",
  "author":{
    "@type": "Person",
    "name": "Masanao Sako"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/breakout_13/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Peanuts Code",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.peanuts-code.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.peanuts-code.com/ja/" accesskey="h" title="Peanuts Code (Alt + H)">
                <img src="/images/logomark.png" alt="logo" aria-label="logo"
                    height="35">Peanuts Code</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://www.peanuts-code.com/en/" title="English"
                            aria-label="English">En</a>
                    </li>
                </ul>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.peanuts-code.com/ja/" title="ホーム">
                    <span>ホーム</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/posts/" title="ブログ">
                    <span>ブログ</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/tutorials/" title="チュートリアル">
                    <span>チュートリアル</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/tags/" title="タグ">
                    <span>タグ</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/ja/about/" title="アバウト">
                    <span>アバウト</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://www.peanuts-code.com/ja/">Home</a>&nbsp;»&nbsp;<a href="https://www.peanuts-code.com/ja/tutorials/">Tutorials</a>&nbsp;»&nbsp;<a href="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/">Godot で作るブロック崩し</a></div>
    <h1 class="post-title">
      Godot で作るブロック崩し Part 13：ハイスコアのデータを保存しよう！
    </h1>
    <div class="post-meta">2021-12-23&nbsp;·&nbsp;11 分&nbsp;·&nbsp;Masanao Sako
</div>
  </header> 
<figure class="entry-cover"><img loading="lazy" src="https://www.peanuts-code.com/images/tutorials/gd0004_breakout/breakout_13/img_16.gif" alt="ブロック崩しPart13サムネイル">
        
</figure><div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目次</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#hud-%e3%82%92%e3%82%a2%e3%83%83%e3%83%97%e3%83%87%e3%83%bc%e3%83%88%e3%81%99%e3%82%8b" aria-label="HUD をアップデートする">HUD をアップデートする</a><ul>
                        
                <li>
                    <a href="#%e3%83%8e%e3%83%bc%e3%83%89%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b" aria-label="ノードを追加する">ノードを追加する</a></li>
                <li>
                    <a href="#%e8%bf%bd%e5%8a%a0%e3%81%97%e3%81%9f%e3%83%8e%e3%83%bc%e3%83%89%e3%81%ae%e3%83%97%e3%83%ad%e3%83%91%e3%83%86%e3%82%a3%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b" aria-label="追加したノードのプロパティを編集する">追加したノードのプロパティを編集する</a></li>
                <li>
                    <a href="#gamegd-%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%82%92%e6%9b%b4%e6%96%b0%e3%81%99%e3%82%8b" aria-label="Game.gd スクリプトを更新する">Game.gd スクリプトを更新する</a><ul>
                        
                <li>
                    <a href="#%e5%bf%85%e8%a6%81%e3%81%aa%e5%ae%9a%e6%95%b0%e3%81%a8%e5%a4%89%e6%95%b0%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b" aria-label="必要な定数と変数を追加する">必要な定数と変数を追加する</a></li>
                <li>
                    <a href="#%e4%bf%9d%e5%ad%98%e7%94%a8%e3%81%ae%e3%83%a1%e3%82%bd%e3%83%83%e3%83%89%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b" aria-label="保存用のメソッドを追加する">保存用のメソッドを追加する</a></li>
                <li>
                    <a href="#%e8%aa%ad%e3%81%bf%e8%be%bc%e3%81%bf%e7%94%a8%e3%81%ae%e3%83%a1%e3%82%bd%e3%83%83%e3%83%89%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b" aria-label="読み込み用のメソッドを追加する">読み込み用のメソッドを追加する</a></li>
                <li>
                    <a href="#%e8%bf%bd%e5%8a%a0%e3%81%97%e3%81%9f%e3%83%a1%e3%82%bd%e3%83%83%e3%83%89%e3%82%92%e9%81%a9%e5%88%87%e3%81%aa%e3%82%bf%e3%82%a4%e3%83%9f%e3%83%b3%e3%82%b0%e3%81%a7%e5%ae%9f%e8%a1%8c%e3%81%95%e3%81%9b%e3%82%8b" aria-label="追加したメソッドを適切なタイミングで実行させる">追加したメソッドを適切なタイミングで実行させる</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%aa%e3%83%bc%e3%83%90%e3%83%bc%e7%94%bb%e9%9d%a2%e3%82%92%e6%9b%b4%e6%96%b0%e3%81%99%e3%82%8b" aria-label="ゲームオーバー画面を更新する">ゲームオーバー画面を更新する</a><ul>
                        
                <li>
                    <a href="#%e3%83%8e%e3%83%bc%e3%83%89%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%97%e3%81%a6%e3%83%97%e3%83%ad%e3%83%91%e3%83%86%e3%82%a3%e3%82%92%e7%b7%a8%e9%9b%86%e3%81%99%e3%82%8b" aria-label="ノードを追加して、プロパティを編集する">ノードを追加して、プロパティを編集する</a></li>
                <li>
                    <a href="#gameoverviewgd-%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%82%92%e6%9b%b4%e6%96%b0%e3%81%99%e3%82%8b" aria-label="GameOverView.gd スクリプトを更新する">GameOverView.gd スクリプトを更新する</a><ul>
                        
                <li>
                    <a href="#%e5%bf%85%e8%a6%81%e3%81%aa%e5%a4%89%e6%95%b0%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b" aria-label="必要な変数を追加する">必要な変数を追加する</a></li>
                <li>
                    <a href="#%e8%aa%ad%e3%81%bf%e8%be%bc%e3%81%bf%e7%94%a8%e3%81%ae%e3%83%a1%e3%82%bd%e3%83%83%e3%83%89%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b-1" aria-label="読み込み用のメソッドを追加する">読み込み用のメソッドを追加する</a></li>
                <li>
                    <a href="#%e8%bf%bd%e5%8a%a0%e3%81%97%e3%81%9f%e3%83%a1%e3%82%bd%e3%83%83%e3%83%89%e3%82%92%e9%81%a9%e5%88%87%e3%81%aa%e3%82%bf%e3%82%a4%e3%83%9f%e3%83%b3%e3%82%b0%e3%81%a7%e5%ae%9f%e8%a1%8c%e3%81%95%e3%81%9b%e3%82%8b-1" aria-label="追加したメソッドを適切なタイミングで実行させる">追加したメソッドを適切なタイミングで実行させる</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e6%9c%80%e7%b5%82%e7%a2%ba%e8%aa%8d" aria-label="最終確認">最終確認</a></li>
                <li>
                    <a href="#%e3%81%8a%e3%82%8f%e3%82%8a%e3%81%ab" aria-label="おわりに">おわりに</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>Part 13 の今回は、ブロック崩しの HUD にハイスコア、ハイレベル（過去最高クリアレベルのことをこう呼ぶことにする）の要素を追加し、ゲームオーバーになった時点でそのデータが自動的に保存されるようにして、一度ゲームを終了しても記録が消えない仕組みを作っていく。</p>
<br>
<blockquote>
<p><em><strong><span style="color:teal">Memo:</span>
</strong><br>
過去のシリーズをまだご覧になっていない方は、そちらを先にご覧いただくことをおすすめします。<br>
<a href="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/" title="Godot で作るブロック崩し">Godot で作るブロック崩し</a>
</em></p>
</blockquote>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="hud-をアップデートする">HUD をアップデートする<a hidden class="anchor" aria-hidden="true" href="#hud-をアップデートする">#</a></h1>
<p>今回、「ハイスコア」と「ハイレベル」の要素をゲームに追加する。これに伴い、HUD にもそれぞれのノードを追加して、プロパティを編集していく。</p>
<p>では、「Game.tscn」シーンを開いて手順を進めていこう。</p>
<br>
<h2 id="ノードを追加する">ノードを追加する<a hidden class="anchor" aria-hidden="true" href="#ノードを追加する">#</a></h2>
<p>「HUD」ノードの「LeftBox」ノードの次に、新たに「VBoxContainer」クラスのノードを追加し、名前を「MidBox」に変更しよう。<br>
さらに「MidBox」ノードには「Label」クラスのノードを 2 つ追加し、それぞれの名前を「HighScore」、「HighLevel」に変更しよう。これで「HUD」ノードの構成は以下のようになったはずだ。</p>
<p><img loading="lazy" src="/images/tutorials/gd0004_breakout/breakout_13/img_1.png" alt="HUDの構成"  />
</p>
<br>
<h2 id="追加したノードのプロパティを編集する">追加したノードのプロパティを編集する<a hidden class="anchor" aria-hidden="true" href="#追加したノードのプロパティを編集する">#</a></h2>
<p>「LeftBox」ノードと「MidBox」ノードの位置と枠の大きさを編集する。HUD のレイアウトは、ブロックの配置の都合上、全て画面上端に並べる必要がある。</p>
<p>2D ワークスペースで「MidBox」をドラッグして画面上端中央に配置しても問題ないが、インスペクタドックで数値を調整するならそれぞれのノードで「Margin」プロパティが以下の値になるようにしよう。</p>
<ul>
<li>「LeftBox」ノード<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout/breakout_13/img_2.png" alt="LeftBoxのMarginプロパティ"  />
</li>
<li>「MidBox」ノード<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout/breakout_13/img_3.png" alt="MidBoxのMarginプロパティ"  />
</li>
</ul>
<p>これで、画面上端中央に「MidBox」ノードが配置された。</p>
<p>次にインスペクタドックで、「MidBox」ノードの子ノードである「HighScore」ノードと「HighLevel」ノードの「Text」プロパティを設定する。</p>
<ul>
<li>「HighScore」ノードの「Text」プロパティ：「H Scr: 0」</li>
<li>「HighLevel」ノードの「Text」プロパティ：「H Lvl: 1」</li>
</ul>
<p>この時点で、ゲーム画面は以下のようになったはずだ。</p>
<p><img loading="lazy" src="/images/tutorials/gd0004_breakout/breakout_13/img_4.png" alt="ゲーム画面でHUDの見た目を確認"  />
</p>
<br>
<h2 id="gamegd-スクリプトを更新する">Game.gd スクリプトを更新する<a hidden class="anchor" aria-hidden="true" href="#gamegd-スクリプトを更新する">#</a></h2>
<p>HUD の見た目は更新できたので、次はスクリプトで表示される値を制御していく。ここで、ゲームデータを保存する機能と保存されたゲームデータを読み込む機能を新たに実装していく。</p>
<p>ではここから「Game.gd」スクリプトを開いて編集していこう。</p>
<br>
<h3 id="必要な定数と変数を追加する">必要な定数と変数を追加する<a hidden class="anchor" aria-hidden="true" href="#必要な定数と変数を追加する">#</a></h3>
<p>まずは新たにいくつか変数を定義していく。「# 追加」のコメントを記述している行が今回定義した定数と変数だ。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Node2D</span>

<span style="color:#66d9ef">const</span> POINT <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
<span style="color:#66d9ef">const</span> MAX_LIFE <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
<span style="color:#66d9ef">const</span> SCORE_FILE_PATH <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;user://score_record.save&#34;</span> <span style="color:#75715e"># 追加</span>

<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">var</span> drop_rate <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.2</span>

<span style="color:#66d9ef">var</span> level_num: <span style="color:#a6e22e">int</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">var</span> high_level_num: <span style="color:#a6e22e">int</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># 追加</span>
<span style="color:#66d9ef">var</span> score: <span style="color:#a6e22e">int</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">var</span> high_score: <span style="color:#a6e22e">int</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># 追加</span>

<span style="color:#75715e">#（中略）</span>

<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> hud_level <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>HUD<span style="color:#f92672">/</span>LeftBox<span style="color:#f92672">/</span>Level
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> hud_high_level <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>HUD<span style="color:#f92672">/</span>MidBox<span style="color:#f92672">/</span>HighLevel <span style="color:#75715e"># 追加</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> hud_score <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>HUD<span style="color:#f92672">/</span>LeftBox<span style="color:#f92672">/</span>Score
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> hud_high_score <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>HUD<span style="color:#f92672">/</span>MidBox<span style="color:#f92672">/</span>HighScore <span style="color:#75715e"># 追加</span>

<span style="color:#75715e">#（後略）</span>
</code></pre></td></tr></table>
</div>
</div><p>まず<code>const</code>キーワードで定義しているのは<code>SCORE_FILE_PATH</code>という定数だ。その値を<code>&quot;user://score_record.save&quot;</code>としてデータの保存先となるファイルパスを指定した。</p>
<p>このように、データを保存するファイルの頭に<code>user://</code>をつけるとプロジェクトの所定の場所にデータを保存してくれる。このファイルにデータを書き込めば、シーンを切り替えたり、ゲームを一度終了してから再開しても、ファイルからデータを読み込んで、以前プレイした時の状態を引き継ぐことが可能だ。</p>
<p>次に変数<code>high_level_num</code>だが、これはゲーム開始時に前回までのハイレベルを渡しておくためのものだ。同様に、もう一つの変数<code>high_score</code>には、ゲーム開始時に前回までのハイスコアを渡しておく。また、ゲームオーバーの時に、記録が更新される際にも利用する。</p>
<p>続いて<code>onready</code>キーワード付きの変数だが、これらは特定のノードを指すのに使っている。<code>hud_high_level</code>は「HighLevel」ノードを、<code>hud_high_score</code>は「HighScore」ノードを指している。</p>
<br>
<h3 id="保存用のメソッドを追加する">保存用のメソッドを追加する<a hidden class="anchor" aria-hidden="true" href="#保存用のメソッドを追加する">#</a></h3>
<p>引き続き「Game.gd」スクリプトに、ゲームのデータを保存するためのメソッドを追加する。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">func</span> save_data():
	<span style="color:#66d9ef">var</span> data <span style="color:#f92672">=</span> {
	<span style="color:#e6db74">&#34;last_level&#34;</span>: level_num,
	<span style="color:#e6db74">&#34;high_level&#34;</span>: high_level_num,
	<span style="color:#e6db74">&#34;last_score&#34;</span>: score,
	<span style="color:#e6db74">&#34;high_score&#34;</span>: high_score,
	}
	<span style="color:#66d9ef">var</span> file <span style="color:#f92672">=</span> <span style="color:#a6e22e">File</span><span style="color:#f92672">.</span>new()
	file<span style="color:#f92672">.</span>open(SCORE_FILE_PATH, <span style="color:#a6e22e">File</span><span style="color:#f92672">.</span>WRITE)
	file<span style="color:#f92672">.</span>store_line(to_json(data))
	file<span style="color:#f92672">.</span>close()
</code></pre></td></tr></table>
</div>
</div><p><code>save_data</code>というメソッドを定義した。まず変数<code>data</code>をメソッド内で定義している。メソッド内で定義した変数は、そのメソッドの外では使えないので注意してほしい。<code>data</code>は辞書型データで<code>{&quot;key&quot;: value}</code>の組み合わせで複数のデータをまとめることができる。</p>
<p>ここではデータとして保存したい値を格納した<code>level_num</code>、<code>high_level_num</code>、<code>score</code>、<code>high_score</code>の4つの変数それぞれを Value とし、対応する Key を&quot;last_level&quot;、&ldquo;high_level&rdquo;、&ldquo;last_score&rdquo;、&ldquo;high_score&quot;として定義した。</p>
<p>そのあとは<code>file</code>という変数を定義している。<code>new</code>メソッドを実行して作成された<code>File</code>クラスのノードを値として代入している。これ以降<code>File</code>クラスのメソッドが続く。</p>
<p>データを保存するには保存先のファイルを開く必要がある。<code>open</code>は第一引数で指定したパスのファイルを開くメソッドだ。ここでは、先に定義した定数<code>SCORE_FILE_PATH</code>（<code>&quot;user://score_record.save&quot;</code>）を第一引数として渡している。第二引数にはファイルを開くときのモードを指定する。ここではデータを書き込んで保存したいので、<code>WRITE</code>を指定して書き込みモードにしている。</p>
<p>次に<code>store_line</code>メソッドでファイルにデータを書き込んでいる。<code>store_xxx</code>という名前のメソッドは他にもいくつかあるが、この<code>store_line</code>は1行の<code>string</code>型データをファイルに書き込む。そして、<code>store_line</code>の引数が書き込むデータになるが、ここでは先に定義した辞書型の変数<code>data</code>を<code>to_json</code>で変換した値を指定している。<code>data</code>は辞書型データで、スクリプト上は見やすさのため改行しているが、実際には1行のデータだ。</p>
<p>ここで<code>to_json</code>についても説明しておく。まず「JSON」というのは「JavaScript Object Notation」の略で、JavaScript というプログラミング言語でのオブジェクトの記述方式で保存されたデータフォーマットだ。そして、その構造は GDScript を含む各種プログラミング言語の辞書型データにもそっくりの<code>{&quot;key&quot;: value}</code>という形式だ。先に保存したいデータを辞書型でまとめておき、保存データを指定するときにその辞書型データを<code>to_json</code>メソッドの引数にして、JSON形式に変換して保存するようにしたというわけだ。</p>
<p>最後に<code>close</code>メソッドでファイルを閉じている。開きっぱなしにして、メモリを消耗しないよう注意しよう。</p>
<br>
<h3 id="読み込み用のメソッドを追加する">読み込み用のメソッドを追加する<a hidden class="anchor" aria-hidden="true" href="#読み込み用のメソッドを追加する">#</a></h3>
<p>「Game.gd」スクリプトで、今度は保存したデータを読み込むメソッドを追加する。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">func</span> load_data():
	<span style="color:#66d9ef">var</span> file <span style="color:#f92672">=</span> <span style="color:#a6e22e">File</span><span style="color:#f92672">.</span>new()
	<span style="color:#66d9ef">if</span> file<span style="color:#f92672">.</span>file_exists(SCORE_FILE_PATH):
		file<span style="color:#f92672">.</span>open(SCORE_FILE_PATH, <span style="color:#a6e22e">File</span><span style="color:#f92672">.</span>READ)
		<span style="color:#66d9ef">var</span> data <span style="color:#f92672">=</span> parse_json(file<span style="color:#f92672">.</span>get_line())
		<span style="color:#66d9ef">if</span> data <span style="color:#f92672">!=</span> null:
			high_score <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#34;high_score&#34;</span>]
			high_level_num <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#34;high_level&#34;</span>]
		file<span style="color:#f92672">.</span>close()
	hud_high_score<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;H Scr: &#34;</span> <span style="color:#f92672">+</span> str(high_score)
	hud_high_level<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;H Lvl: &#34;</span> <span style="color:#f92672">+</span> str(high_level_num)
</code></pre></td></tr></table>
</div>
</div><p>データを読み込むのは<code>load_data</code>というメソッドだ。</p>
<p>先ほどの書き込みメソッド<code>save_data</code>と同様に、まずは<code>File</code>クラスの<code>new</code>メソッドにより、<code>File</code>クラスのノードを作成する。そこからまた<code>File</code>クラスのメソッドが続くが順番に見ていこう。</p>
<p>まずは<code>if</code>構文で、<code>file_exists</code>メソッドによりデータ保存先のファイル（定数<code>SCORE_FILE_PATH</code>の値）があるか確認している。ファイルがあれば<code>if</code>ブロックの中の処理を続行する。</p>
<p>では<code>if</code>ブロックの中のコードを見ていこう。まず、ファイルを<code>open</code>メソッドで開く。ここではモードを<code>READ</code>にして読み込みモードにしている。</p>
<p>次は<code>get_line</code>メソッドでファイルに保存されている一行のデータを読み込む。この時、この読み込んだデータはJSON形式なので、これを<code>parse_json</code>メソッド GDScript の辞書型データに変換して、変数<code>data</code>に格納している。</p>
<p>2段回目の<code>if</code>構文だが、もし変数<code>data</code>が空っぽの<code>null</code>でなければ、変数<code>high_score</code>にファイルに保存しているハイスコアのデータを、変数<code>high_level_num</code>にはファイルに保存しているハイレベルのデータを代入する。</p>
<p>そこまでできたら、忘れずにファイルを<code>close</code>メソッドで閉じる。</p>
<p>最後に、ファイルから得たそれぞれのデータを<code>string</code>形に変換して、頭に<code>H Str: </code>、<code>H Lvl: </code>を付け足して、HUD の「HighScore」ノードと「HighLevel」ノードそれぞれの「Text」プロパティに適用している。</p>
<br>
<h3 id="追加したメソッドを適切なタイミングで実行させる">追加したメソッドを適切なタイミングで実行させる<a hidden class="anchor" aria-hidden="true" href="#追加したメソッドを適切なタイミングで実行させる">#</a></h3>
<p>データを保存するメソッドと保存したデータを読み込むメソッドを用意できたので、それらのメソッドを適切なタイミングで実行するようにコードを更新していく。</p>
<p>まずは<code>_ready</code>メソッドを編集する。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">func</span> _ready():
	randomize()
	add_new_level()
	add_new_ball()
	update_hud_life()
	load_data() <span style="color:#75715e"># 追加</span>
</code></pre></td></tr></table>
</div>
</div><p>単純に、先ほど作成した<code>load_data</code>メソッドを追加しただけだ。これで、ゲーム開始前にデータを保存しているファイルからハイスコアやハイレベルの値を取得して HUD に反映してくれる。</p>
<br>
<p>次に<code>_on_Ball_tree_exited</code>メソッドを編集する。ちなみにこのメソッドは、ボールオブジェクトが消える時に発信されるシグナルによって呼ばれる。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">func</span> _on_Ball_tree_exited():
	print(<span style="color:#e6db74">&#34;_on_Ball_tree_exited() called&#34;</span>)
	<span style="color:#66d9ef">var</span> no_ball <span style="color:#f92672">=</span> true
	<span style="color:#66d9ef">for</span> child <span style="color:#f92672">in</span> get_children():
		<span style="color:#66d9ef">if</span> child<span style="color:#f92672">.</span>is_in_group(<span style="color:#e6db74">&#34;Balls&#34;</span>):
			print(<span style="color:#e6db74">&#34;found ball&#34;</span>)
			no_ball <span style="color:#f92672">=</span> false
			<span style="color:#66d9ef">break</span>
	
	<span style="color:#66d9ef">if</span> no_ball:
		<span style="color:#66d9ef">if</span> is_playing:
			life <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
			<span style="color:#66d9ef">if</span> life <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>:
				<span style="color:#66d9ef">if</span> high_score <span style="color:#f92672">&lt;</span> score: <span style="color:#75715e"># 追加</span>
					high_score <span style="color:#f92672">=</span> score
				<span style="color:#66d9ef">if</span> high_level_num <span style="color:#f92672">&lt;</span> level_num: <span style="color:#75715e"># 追加</span>
					high_level_num <span style="color:#f92672">=</span> level_num
				save_data() <span style="color:#75715e"># 追加</span>
				get_tree()<span style="color:#f92672">.</span>change_scene(<span style="color:#e6db74">&#34;res://scene/GameOverView.tscn&#34;</span>)
			<span style="color:#66d9ef">else</span>:
				update_hud_life()
				life_down_sound<span style="color:#f92672">.</span>play()

		<span style="color:#75715e">#（後略）</span>
</code></pre></td></tr></table>
</div>
</div><p>このメソッド内の<code>if no_ball:</code>でネストされた<code>if is_playing:</code>でさらにネストされた<code>if life &lt;= 0:</code>ブロック内を編集する。このブロック内のコードは、『画面からボールが一つも無くなった場合』、『ゲームプレイ中であり』、『ライフが 0』の場合に実行される。つまり、ゲームオーバーになる場合だ。</p>
<p>元々このブロックには、シーンを「GameOverView.tscn」に切り替えて、ゲームオーバー画面に遷移するためのコード<code>get_tree().change_scene(&quot;res://scene/GameOverView.tscn&quot;)</code>のみを記述していた。今回はそのコードの前に、ハイスコアとハイレベルを更新するコードを追加した。</p>
<p>具体的には、これまでのハイスコアを表す変数<code>high_score</code>の値が今プレイしていた時のスコアを表す変数<code>score</code>の値より小さければ、<code>score</code>の値を新しいハイスコアとして<code>high_score</code>へ代入する、というプログラムを<code>if</code>構文で記述した。</p>
<p>同様に、これまでのハイレベルを表す変数<code>high_level_num</code>の値が今プレイしていた時のレベルを表す変数<code>level_num</code>の値より小さければ、<code>level_num</code>の値を新しいハイレベルとして<code>high_level_num</code>へ代入するよう記述した。</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h1 id="ゲームオーバー画面を更新する">ゲームオーバー画面を更新する<a hidden class="anchor" aria-hidden="true" href="#ゲームオーバー画面を更新する">#</a></h1>
<p>次にハイスコア、ハイレベルの表示が必要なのがゲームオーバー画面だ。プレイヤーの心情としては、ゲームオーバーになった時に、最終的に自分のスコアがどの程度でどのレベルまで到達したのかを確認したい。さらに、その結果はこれまでの最高記録を塗り替えたのかどうかも知りたいものだ。</p>
<p>したがって、ゲームオーバー画面には以下の4つの結果を表示するようにしていく。</p>
<ul>
<li>ハイスコア（過去最高獲得スコア）</li>
<li>ラストスコア（今のプレイで最終的に獲得したスコア）</li>
<li>ハイレベル（過去最高到達レベル）</li>
<li>ラストレベル（今のプレイで最終的に到達したレベル）</li>
</ul>
<p>それでは「GameOverView.tscn」シーンを開いて編集していこう。</p>
<br>
<h2 id="ノードを追加してプロパティを編集する">ノードを追加して、プロパティを編集する<a hidden class="anchor" aria-hidden="true" href="#ノードを追加してプロパティを編集する">#</a></h2>
<p>以下の手順で、シーンドックおよびインスペクタドックにて、必要なノードを追加し、プロパティを編集していこう。</p>
<ol>
<li>
<p>シーンドックで「VBox」ノードに「VBoxContainer」クラスのノードを一つ追加して、名前を「ResultsContainer」に変更する。</p>
</li>
<li>
<p>シーンドックで「ResultsContainer」ノードの順番を「GameOverLavel」ノードの下、「Message」ノードの前に移動する。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout/breakout_13/img_4.1.png" alt="シーンドック上のResultsContainerノードの順番"  />
</p>
</li>
<li>
<p>インスペクタドックで「ResultsContainer」ノードの「Custom Constants」＞「Separation」プロパティを<code>10</code>にして有効にする。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout/breakout_13/img_5.png" alt="ResultsContainerのSeparationプロパティ"  />
</p>
</li>
<li>
<p>シーンドックで「ResultsContainer」ノードに「Label」クラスのノードを 1 つ追加し、名前を「HighScore」に変更する。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout/breakout_13/img_5.1.png" alt="HighScoreノードの追加"  />
</p>
</li>
<li>
<p>インスペクタドックで「HighScore」ノードの「Align」プロパティを「Center」に変更する。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout/breakout_13/img_6.png" alt="HighScoreノードのAlignプロパティ"  />
</p>
</li>
<li>
<p>インスペクタドックで「HighScore」ノードの「Uppercase」プロパティを「オン」にする。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout/breakout_13/img_7.png" alt="HighScoreノードのUppercaseプロパティ"  />
</p>
</li>
<li>
<p>インスペクタドックで既存の「Message」ノードの「Custom Fonts」＞「Font」をコピーする。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout/breakout_13/img_8.png" alt="MessageノードのDynamicFontをコピー"  />
</p>
</li>
<li>
<p>インスペクタドックで「HighScore」ノードの「Custom Fonts」＞「Font」に貼り付けする。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout/breakout_13/img_9.png" alt="HighScoreノードのDynamicFontに貼り付け"  />
</p>
</li>
<li>
<p>さらに「HighScore」ノードの「Custom Fonts」＞「Font」をユニーク化する。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout/breakout_13/img_10.png" alt="HighScoreノードのDynamicFontをユニーク化"  />
</p>
</li>
<li>
<p>さらに「HighScore」ノードの「Custom Fonts」＞「Settings」＞「Size」プロパティを<code>16</code>にする。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout/breakout_13/img_11.png" alt="HighScoreノードのDynamicFontのSizeを編集"  />
</p>
</li>
<li>
<p>シーンドックで「HighScore」ノードを3つ複製し、それらの名前を上から順番に「LastScore」、「HighLevel」、「LastLevel」に変更する。この時点でシーンドックは以下のようになる。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout/breakout_13/img_12.png" alt="GameOverView.tscnノード追加後のシーンドック"  />
</p>
</li>
<li>
<p>インスペクタドックで「HighScore」ノードの「Text」プロパティを「High Score: 0」にする。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout/breakout_13/img_13.png" alt="HighScoreノードのTextプロパティを編集"  />
</p>
</li>
<li>
<p>同様に「LastScore」ノードの「Text」プロパティを「Last Score: 0」にする。</p>
</li>
<li>
<p>同様に「HighLevel」ノードの「Text」プロパティを「High Level: 0」にする。</p>
</li>
<li>
<p>同様に「LastLevel」ノードの「Text」プロパティを「Last Level: 0」にする。</p>
</li>
</ol>
<p>ここまでの手順ができたら、2D ワークスペースから以下のようになっているのを確認できるはずだ。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout/breakout_13/img_14.png" alt="GameOverView編集後の2Dワークスペース"  />
</p>
<br>
<h2 id="gameoverviewgd-スクリプトを更新する">GameOverView.gd スクリプトを更新する<a hidden class="anchor" aria-hidden="true" href="#gameoverviewgd-スクリプトを更新する">#</a></h2>
<p>ゲームオーバー画面のノードの追加と編集ができたので、ここからはスクリプトでゲームオーバー画面に切り替わる際のデータの読み込みを実装していく。ちなみに、ゲームオーバー画面なので、データの保存機能は不要だ。</p>
<p>それでは「GameOverView.gd」スクリプトを開いて編集していこう。</p>
<br>
<h3 id="必要な変数を追加する">必要な変数を追加する<a hidden class="anchor" aria-hidden="true" href="#必要な変数を追加する">#</a></h3>
<p>データの読み込みとその読み込んだデータを画面に反映させるために、まずは変数をいくつか追加しておく。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">const</span> SCORE_FILE_PATH <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;user://score_record.save&#34;</span>

<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> high_score <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>VBox<span style="color:#f92672">/</span>ResultsContainer<span style="color:#f92672">/</span>HighScore
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> last_score <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>VBox<span style="color:#f92672">/</span>ResultsContainer<span style="color:#f92672">/</span>LastScore
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> high_level <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>VBox<span style="color:#f92672">/</span>ResultsContainer<span style="color:#f92672">/</span>HighLevel
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> last_level <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>VBox<span style="color:#f92672">/</span>ResultsContainer<span style="color:#f92672">/</span>LastLevel

<span style="color:#75715e">#（後略）</span>
</code></pre></td></tr></table>
</div>
</div><p><code>const</code>キーワードで定数<code>SCORE_FILE_PATH</code>を定義した。値はデータが保存されいているファイルのパスだ。「Game.gd」スクリプトでも同じ定数を定義したところである。</p>
<p>次に<code>onready</code>キーワード付きの変数を<code>high_score</code>をはじめとして 4 つ定義しているが、これらは今回追加した「Label」クラスのそれぞれのノードを指している。</p>
<br>
<h3 id="読み込み用のメソッドを追加する-1">読み込み用のメソッドを追加する<a hidden class="anchor" aria-hidden="true" href="#読み込み用のメソッドを追加する-1">#</a></h3>
<p>ほどんど「Game.gd」スクリプトで実装した内容と同じになるが、「GameOverView.gd」スクリプトの方でも、データ読み込み用のメソッドを追加する必要がある。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">func</span> load_data():
	<span style="color:#66d9ef">var</span> file <span style="color:#f92672">=</span> <span style="color:#a6e22e">File</span><span style="color:#f92672">.</span>new()
	<span style="color:#66d9ef">if</span> file<span style="color:#f92672">.</span>file_exists(SCORE_FILE_PATH):
		file<span style="color:#f92672">.</span>open(SCORE_FILE_PATH, <span style="color:#a6e22e">File</span><span style="color:#f92672">.</span>READ)
		<span style="color:#66d9ef">var</span> data <span style="color:#f92672">=</span> parse_json(file<span style="color:#f92672">.</span>get_line())
		<span style="color:#66d9ef">if</span> data <span style="color:#f92672">!=</span> null:
			high_score<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;High Score: &#34;</span> <span style="color:#f92672">+</span> str(data[<span style="color:#e6db74">&#34;high_score&#34;</span>])
			last_score<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Last Score: &#34;</span> <span style="color:#f92672">+</span> str(data[<span style="color:#e6db74">&#34;last_score&#34;</span>])
			high_level<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;High Level: &#34;</span> <span style="color:#f92672">+</span> str(data[<span style="color:#e6db74">&#34;high_level&#34;</span>])
			last_level<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Last Level: &#34;</span> <span style="color:#f92672">+</span> str(data[<span style="color:#e6db74">&#34;last_level&#34;</span>])
		file<span style="color:#f92672">.</span>close()
</code></pre></td></tr></table>
</div>
</div><p><code>laod_data</code>という名前で読み込み用メソッドを定義した。<code>if data != null:</code>の行までは「Game.gd」スクリプトと全く同じだが、その<code>if</code>ブロックの中のコードがゲームオーバー画面仕様になっている。</p>
<p>このメソッドのコードを要約すると、データ保存先のファイルがあればファイルを開き、そのあとデータが空っぽでなければ、単純に「HighScore」、「LastScore」、「HighLevel」、「LastLevel」それぞれのノードの「Text」プロパティに、ファイルから取得したJSONデータを最終的に<code>string</code>型に変換して反映する。もしファイルがない、またはデータがなければ、「Text」プロパティの値はデフォルトの設定で表示される。</p>
<p>なお、繰り返しになるが、最後のファイルを閉じる<code>close</code>メソッドは忘れてはいけない。</p>
<br>
<h3 id="追加したメソッドを適切なタイミングで実行させる-1">追加したメソッドを適切なタイミングで実行させる<a hidden class="anchor" aria-hidden="true" href="#追加したメソッドを適切なタイミングで実行させる-1">#</a></h3>
<p>読み込み用メソッドが定義できたので、これを<code>_ready</code>メソッド内で実行させる。コードは至ってシンプルだ。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">func</span> _ready():
	load_data()
</code></pre></td></tr></table>
</div>
</div><p>これだけで、ゲームオーバー画面に遷移した時にファイルの読み込みに失敗さえしなければ、きちんと画面上にデータを表示してくれるはずだ。今はまだデータファイルが作成されていないので、シーンを実行するとデフォルトの値で表示される。<br>
<img loading="lazy" src="/images/tutorials/gd0004_breakout/breakout_13/img_15.png" alt="GameOverViewシーンを実行"  />
</p>
<br>
<hr>
<h1 id="最終確認">最終確認<a hidden class="anchor" aria-hidden="true" href="#最終確認">#</a></h1>
<p>それでは最後にデータの保存とデータの読み込みがうまくいくかプロジェクトを実行して確認してみよう。</p>
<p><img loading="lazy" src="/images/tutorials/gd0004_breakout/breakout_13/img_16.gif" alt="GameOverViewシーンを実行"  />
</p>
<ul>
<li>初回プレイ時、ライフが 0 になったタイミングでデータがファイルに保存され、ゲームオーバー画面に遷移した時にそのファイルのデータが読み込まれ画面上に結果が表示された。</li>
<li>2回目、3回目プレイ時は、最初からファイルのデータが読み込まれ HUD 中央のハイスコアに反映された。</li>
<li>2回目プレイで初回より高いスコアを獲得してからゲームオーバーになった時、画面には更新されたハイスコアが表示された。</li>
<li>3回目プレイで2回目プレイより低いスコアでゲームオーバーになった時、画面には2回目プレイ時のハイスコアが表示された。</li>
<li>1 ~ 3回目のプレイでのゲームオーバー画面でその時々のスコアが「Last Score」に反映された。</li>
</ul>
<p>以上のことが確認できたので、今回のデータの保存と読み込みは問題なく実装できたと判断できる。なお、レベルの方の確認はカットするが、こちらも問題ないはずだ。</p>
<p>ところで、実際にデバッグ作業を行う中で、作成されたデータファイルを削除したい場合も発生するだろう。その場合は、ご利用のOSのファイルマネージャー（Windows なら Explorer、macOS なら Finder）から保存先のフォルダパスへアクセスして削除してほしい。なお、データの保存先は以下の通りだ。</p>
<ul>
<li>Windows: %APPDATA%¥Godot¥app_userdata¥[ProjectName]¥</li>
<li>macOS: ~/Library/Application Support/Godot/app_userdata/[ProjectName]/</li>
<li>Linux: ~/.local/share/godot/app_userdata/[ProjectName]/</li>
</ul>
<blockquote>
<p><strong><span style="color:Teal">Memo:</span>
</strong><br>
<em>詳細は公式ドキュメントの <a href="https://docs.godotengine.org/en/3.4/tutorials/io/data_paths.html" target="_blank">File paths in Godot projects</a>
の項目をご参照ください。</em></p>
</blockquote>
<br>
<p>最後に今回編集した「Game.gd」と「GameOverView.gd」のスクリプト全体のコードもここに公開しておく。</p>
<details>
<summary>「Game.gd」スクリプト全体を見る</summary>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">211
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">212
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">213
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">214
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">215
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">216
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">217
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">218
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">219
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">220
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">221
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">222
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">223
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">224
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">225
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">226
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">227
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">228
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">229
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">230
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">231
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">232
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">233
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">234
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">235
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">236
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">237
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">238
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">239
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">240
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">241
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">242
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">243
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">244
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">245
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">246
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">247
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">248
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">249
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">250
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">251
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">252
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">253
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">254
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">255
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">256
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">257
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">258
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">259
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">260
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">261
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">262
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">263
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">264
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">265
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">266
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">267
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">268
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">269
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">270
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">271
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">272
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">273
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">274
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">275
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">276
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">277
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">278
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">279
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">280
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">281
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">282
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">283
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">284
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">285
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">286
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">287
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">288
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">289
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">290
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">291
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">292
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">293
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">294
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">295
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">296
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">297
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">298
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">299
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">300
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">301
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Node2D</span>

<span style="color:#66d9ef">const</span> POINT <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
<span style="color:#66d9ef">const</span> MAX_LIFE <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span> <span style="color:#75715e"># Added @ P11</span>
<span style="color:#66d9ef">const</span> SCORE_FILE_PATH <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;user://score_record.save&#34;</span> <span style="color:#75715e"># Added @ P13</span>

<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">var</span> drop_rate <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.2</span>

<span style="color:#66d9ef">var</span> level_num: <span style="color:#a6e22e">int</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">var</span> high_level_num: <span style="color:#a6e22e">int</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># Added @ P13</span>
<span style="color:#66d9ef">var</span> score: <span style="color:#a6e22e">int</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">var</span> high_score: <span style="color:#a6e22e">int</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># Added @ P13</span>
<span style="color:#66d9ef">var</span> bonus_rate <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
<span style="color:#66d9ef">var</span> life <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
<span style="color:#66d9ef">var</span> is_playing <span style="color:#f92672">=</span> true
<span style="color:#66d9ef">var</span> is_multiple_on <span style="color:#f92672">=</span> false <span style="color:#75715e"># Added @ P11</span>
<span style="color:#66d9ef">var</span> is_laser_on <span style="color:#f92672">=</span> false <span style="color:#75715e"># Added @ P11</span>

<span style="color:#75715e">#onready var level = $Level1 # Removed @ P11</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> next_screen <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>NextScreen
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> next_screen_level <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>NextScreen<span style="color:#f92672">/</span>VBox<span style="color:#f92672">/</span>Level
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> next_screen_score <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>NextScreen<span style="color:#f92672">/</span>VBox<span style="color:#f92672">/</span>Score
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> next_screen_life <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>NextScreen<span style="color:#f92672">/</span>VBox<span style="color:#f92672">/</span>HBox<span style="color:#f92672">/</span>Life
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> hud_level <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>HUD<span style="color:#f92672">/</span>LeftBox<span style="color:#f92672">/</span>Level
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> hud_high_level <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>HUD<span style="color:#f92672">/</span>MidBox<span style="color:#f92672">/</span>HighLevel <span style="color:#75715e"># Added @ P13</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> hud_score <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>HUD<span style="color:#f92672">/</span>LeftBox<span style="color:#f92672">/</span>Score
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> hud_high_score <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>HUD<span style="color:#f92672">/</span>MidBox<span style="color:#f92672">/</span>HighScore <span style="color:#75715e"># Added @ P13</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> hud_rightbox <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>HUD<span style="color:#f92672">/</span>RightBox
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> paddle <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>Paddle
<span style="color:#75715e">#onready var ball = $Ball # Removed @ P11</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> pause_screen <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>PauseScreen
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> life_down_sound <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>LifeDownSound
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> slow_collide_sound <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>SlowCollideSound
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> expand_collide_sound <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>ExpandCollideSound
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> multiple_collide_sound <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>MultipleCollideSound
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> laser_collide_sound <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>LaserCollideSound
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> life_collide_sound <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>LifeCollideSound
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> play_bgm <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>PlayBGM

<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> paddle_position <span style="color:#f92672">=</span> paddle<span style="color:#f92672">.</span>position
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> paddle_scale <span style="color:#f92672">=</span> paddle<span style="color:#f92672">.</span>scale <span style="color:#75715e"># Added @ P11</span>
<span style="color:#75715e">#onready var ball_position = ball.position # Removed @ P11</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> ball <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://scene/Ball.tscn&#34;</span>) <span style="color:#75715e"># Added @ P11</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> laser <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://scene/Laser.tscn&#34;</span>) <span style="color:#75715e"># Added @ P11</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> powerup <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://scene/Powerup.tscn&#34;</span>) <span style="color:#75715e"># Added @ P10</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> level <span style="color:#f92672">=</span> null <span style="color:#75715e"># Updated @ P11</span>

<span style="color:#66d9ef">func</span> _ready():
	randomize() <span style="color:#75715e"># Added @ P10</span>
	add_new_level() <span style="color:#75715e"># Added @ P11</span>
	add_new_ball() <span style="color:#75715e"># Added @ P11</span>
	update_hud_life()
	load_data() <span style="color:#75715e"># Added @ P13</span>
	<span style="color:#75715e"># For debug</span>
	<span style="color:#75715e">#leave_one_brick(43) # Moved @ P11</span>
	<span style="color:#75715e">#ball.connect(&#34;tree_exited&#34;, self, &#34;_on_Ball_tree_exited&#34;) # Removed @ P11</span>
	<span style="color:#75715e">#for brick in level.get_children(): # Removed @ P11</span>
		<span style="color:#75715e">#brick.connect(&#34;tree_exited&#34;, self, &#34;_on_Brick_tree_exited&#34;, [brick.global_position]) # Updated @ P10</span>


<span style="color:#66d9ef">func</span> _process(_delta): <span style="color:#75715e"># Added @ P11</span>
	<span style="color:#66d9ef">if</span> is_multiple_on <span style="color:#f92672">and</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_just_pressed(<span style="color:#e6db74">&#34;launch_ball&#34;</span>):
		add_new_ball()
	<span style="color:#66d9ef">if</span> is_laser_on <span style="color:#f92672">and</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_just_pressed(<span style="color:#e6db74">&#34;ui_up&#34;</span>):
		fire_laser()


<span style="color:#75715e"># For debug</span>
<span style="color:#66d9ef">func</span> leave_one_brick(brick_num: <span style="color:#a6e22e">int</span>):
	<span style="color:#66d9ef">for</span> child <span style="color:#f92672">in</span> level<span style="color:#f92672">.</span>get_children():
		<span style="color:#66d9ef">if</span> child<span style="color:#f92672">.</span>get_name() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Brick&#34;</span> <span style="color:#f92672">+</span> str(brick_num):
			<span style="color:#66d9ef">continue</span>
		child<span style="color:#f92672">.</span>queue_free()

<span style="color:#75715e"># Method receiving Ball signal</span>
<span style="color:#66d9ef">func</span> _on_Ball_tree_exited():
	print(<span style="color:#e6db74">&#34;_on_Ball_tree_exited() called&#34;</span>)
	<span style="color:#66d9ef">var</span> no_ball <span style="color:#f92672">=</span> true <span style="color:#75715e"># Added @ P11</span>
	<span style="color:#66d9ef">for</span> child <span style="color:#f92672">in</span> get_children(): <span style="color:#75715e"># Added @ P11</span>
		<span style="color:#66d9ef">if</span> child<span style="color:#f92672">.</span>is_in_group(<span style="color:#e6db74">&#34;Balls&#34;</span>):
			print(<span style="color:#e6db74">&#34;found ball&#34;</span>)
			no_ball <span style="color:#f92672">=</span> false
			<span style="color:#66d9ef">break</span>
	
	<span style="color:#66d9ef">if</span> no_ball: <span style="color:#75715e"># Added and Edited @ P11</span>
		<span style="color:#66d9ef">if</span> is_playing:
			life <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
			<span style="color:#66d9ef">if</span> life <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>:
				<span style="color:#66d9ef">if</span> high_score <span style="color:#f92672">&lt;</span> score: <span style="color:#75715e"># Added @ P13</span>
					high_score <span style="color:#f92672">=</span> score
				<span style="color:#66d9ef">if</span> high_level_num <span style="color:#f92672">&lt;</span> level_num: <span style="color:#75715e"># Added @ P13</span>
					high_level_num <span style="color:#f92672">=</span> level_num
				save_data() <span style="color:#75715e"># Added @ P13</span>
				get_tree()<span style="color:#f92672">.</span>change_scene(<span style="color:#e6db74">&#34;res://scene/GameOverView.tscn&#34;</span>)
			<span style="color:#66d9ef">else</span>:
				update_hud_life()
				life_down_sound<span style="color:#f92672">.</span>play()
		<span style="color:#66d9ef">else</span>:
			is_playing <span style="color:#f92672">=</span> true
		<span style="color:#75715e"># Clear powerup items</span>
		<span style="color:#66d9ef">for</span> child <span style="color:#f92672">in</span> get_children(): <span style="color:#75715e"># Added @ P10</span>
			<span style="color:#66d9ef">if</span> child<span style="color:#f92672">.</span>is_in_group(<span style="color:#e6db74">&#34;PowerupItems&#34;</span>):
				child<span style="color:#f92672">.</span>queue_free()
		<span style="color:#75715e"># Set Paddle and Balls as default</span>
		is_multiple_on <span style="color:#f92672">=</span> false <span style="color:#75715e"># Added @ P11</span>
		is_laser_on <span style="color:#f92672">=</span> false <span style="color:#75715e"># Added @ P11</span>
		paddle<span style="color:#f92672">.</span>position <span style="color:#f92672">=</span> paddle_position
		paddle<span style="color:#f92672">.</span>scale <span style="color:#f92672">=</span> paddle_scale <span style="color:#75715e"># Added @ P11</span>
		add_new_ball() <span style="color:#75715e"># Added @ P11</span>
		<span style="color:#75715e">#ball = load(&#34;res://scene/Ball.tscn&#34;).instance() # Removed @ P11</span>
		<span style="color:#75715e">#call_deferred(&#34;add_child&#34;, ball) # Removed @ P11</span>
		<span style="color:#75715e">#call_deferred(&#34;move_child&#34;, ball, 3) # Removed @ P11</span>
		<span style="color:#75715e">#ball.connect(&#34;tree_exited&#34;, self, &#34;_on_Ball_tree_exited&#34;) # Removed @ P11</span>


<span style="color:#75715e"># Set life nodes shown and hidden as life variable</span>
<span style="color:#66d9ef">func</span> update_hud_life():
	<span style="color:#66d9ef">var</span> count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
	<span style="color:#66d9ef">for</span> child <span style="color:#f92672">in</span> hud_rightbox<span style="color:#f92672">.</span>get_children():
		count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
		<span style="color:#66d9ef">if</span> count <span style="color:#f92672">&lt;=</span> life:
			child<span style="color:#f92672">.</span>show()
		<span style="color:#66d9ef">else</span>:
			child<span style="color:#f92672">.</span>hide()


<span style="color:#75715e"># Add a new ball</span>
<span style="color:#66d9ef">func</span> add_new_ball(): <span style="color:#75715e"># Added @ P11</span>
	print(<span style="color:#e6db74">&#34;add_new_ball() called&#34;</span>)
	<span style="color:#66d9ef">var</span> instance <span style="color:#f92672">=</span> ball<span style="color:#f92672">.</span>instance()
	instance<span style="color:#f92672">.</span>position <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>(paddle<span style="color:#f92672">.</span>position<span style="color:#f92672">.</span>x, paddle<span style="color:#f92672">.</span>position<span style="color:#f92672">.</span>y <span style="color:#f92672">-</span> <span style="color:#ae81ff">10</span>) <span style="color:#75715e"># Added @ P11</span>
	call_deferred(<span style="color:#e6db74">&#34;add_child&#34;</span>, instance)
	call_deferred(<span style="color:#e6db74">&#34;move_child&#34;</span>, instance, <span style="color:#ae81ff">4</span>)
	instance<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#34;tree_exited&#34;</span>, self, <span style="color:#e6db74">&#34;_on_Ball_tree_exited&#34;</span>)	
	<span style="color:#75715e">#instance.mode = 3 # Removed @ P11</span>


<span style="color:#75715e"># Method receiving Brick signal</span>
<span style="color:#66d9ef">func</span> _on_Brick_tree_exited(brick_position):
	<span style="color:#75715e"># Update Score</span>
	score <span style="color:#f92672">+=</span> POINT <span style="color:#f92672">*</span> bonus_rate
	bonus_rate <span style="color:#f92672">+=</span> <span style="color:#ae81ff">0.1</span>
	hud_score<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Score: &#34;</span> <span style="color:#f92672">+</span> str(score)

	<span style="color:#75715e"># Exit current Level node</span>
	<span style="color:#66d9ef">if</span> level<span style="color:#f92672">.</span>get_child_count() <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>:
		set_next_level()
	<span style="color:#66d9ef">else</span>: <span style="color:#75715e"># Added @ P11</span>
		<span style="color:#75715e"># Drop powerup item</span>
		drop_powerup(brick_position) <span style="color:#75715e"># Added @ P10</span>


<span style="color:#66d9ef">func</span> drop_powerup(brick_position: <span style="color:#a6e22e">Vector2</span>): <span style="color:#75715e"># Added @ P10</span>
	<span style="color:#66d9ef">if</span> randf() <span style="color:#f92672">&lt;=</span> drop_rate:
		<span style="color:#66d9ef">var</span> powerup_instance <span style="color:#f92672">=</span> powerup<span style="color:#f92672">.</span>instance()
		powerup_instance<span style="color:#f92672">.</span>position <span style="color:#f92672">=</span> brick_position
		call_deferred(<span style="color:#e6db74">&#34;add_child&#34;</span>, powerup_instance)
		call_deferred(<span style="color:#e6db74">&#34;move_child&#34;</span>, powerup_instance, <span style="color:#ae81ff">5</span>) <span style="color:#75715e"># Added @ P 11</span>
		powerup_instance<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#34;item_collided&#34;</span>, self, <span style="color:#e6db74">&#34;_on_Powerup_item_collided&#34;</span>) 

<span style="color:#75715e"># Action when powerup item collided</span>
<span style="color:#66d9ef">func</span> _on_Powerup_item_collided(item): <span style="color:#75715e"># Updated @ P11</span>
	match item:
		<span style="color:#ae81ff">0</span>: <span style="color:#75715e"># SLOW</span>
			slow_balls()
		<span style="color:#ae81ff">1</span>: <span style="color:#75715e"># EXPAND</span>
			expand_paddle()
		<span style="color:#ae81ff">2</span>: <span style="color:#75715e"># MULTIPLE</span>
			enable_multiple_balls()
		<span style="color:#ae81ff">3</span>: <span style="color:#75715e"># LASER</span>
			enable_laser()
		<span style="color:#ae81ff">4</span>: <span style="color:#75715e"># LIFE</span>
			add_life()

<span style="color:#75715e"># slow balls</span>
<span style="color:#66d9ef">func</span> slow_balls(): <span style="color:#75715e"># Added @ P11</span>
	slow_collide_sound<span style="color:#f92672">.</span>play() <span style="color:#75715e"># Added @ P12</span>
	<span style="color:#66d9ef">for</span> child <span style="color:#f92672">in</span> get_children():
		<span style="color:#66d9ef">if</span> child<span style="color:#f92672">.</span>is_in_group(<span style="color:#e6db74">&#34;Balls&#34;</span>):
			child<span style="color:#f92672">.</span>ball_speed <span style="color:#f92672">=</span> child<span style="color:#f92672">.</span>first_speed

<span style="color:#75715e"># Stretch paddle</span>
<span style="color:#66d9ef">func</span> expand_paddle(): <span style="color:#75715e"># Added @ P11</span>
	expand_collide_sound<span style="color:#f92672">.</span>play() <span style="color:#75715e"># Added @ P12</span>
	<span style="color:#66d9ef">if</span> paddle<span style="color:#f92672">.</span>scale <span style="color:#f92672">&lt;=</span> paddle_scale:
		paddle<span style="color:#f92672">.</span>scale<span style="color:#f92672">.</span>x <span style="color:#f92672">*=</span> <span style="color:#ae81ff">2</span>
		yield(get_tree()<span style="color:#f92672">.</span>create_timer(<span style="color:#ae81ff">10</span>), <span style="color:#e6db74">&#34;timeout&#34;</span>)
		paddle<span style="color:#f92672">.</span>scale <span style="color:#f92672">=</span> paddle_scale

<span style="color:#75715e"># enable powerup Multiple</span>
<span style="color:#66d9ef">func</span> enable_multiple_balls(): <span style="color:#75715e"># Added @ P11</span>
	multiple_collide_sound<span style="color:#f92672">.</span>play() <span style="color:#75715e"># Added @ P12</span>
	<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> is_multiple_on:
		is_multiple_on <span style="color:#f92672">=</span> true
		yield(get_tree()<span style="color:#f92672">.</span>create_timer(<span style="color:#ae81ff">3</span>), <span style="color:#e6db74">&#34;timeout&#34;</span>)
		is_multiple_on <span style="color:#f92672">=</span> false

<span style="color:#75715e"># enable powerup Laser</span>
<span style="color:#66d9ef">func</span> enable_laser(): <span style="color:#75715e"># Added @ P11</span>
	laser_collide_sound<span style="color:#f92672">.</span>play() <span style="color:#75715e"># Added @ P12</span>
	<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> is_laser_on:
		is_laser_on <span style="color:#f92672">=</span> true
		yield(get_tree()<span style="color:#f92672">.</span>create_timer(<span style="color:#ae81ff">3</span>), <span style="color:#e6db74">&#34;timeout&#34;</span>)
		is_laser_on <span style="color:#f92672">=</span> false

<span style="color:#75715e"># fire laser beam</span>
<span style="color:#66d9ef">func</span> fire_laser():
	<span style="color:#66d9ef">var</span> instance <span style="color:#f92672">=</span> laser<span style="color:#f92672">.</span>instance()
	call_deferred(<span style="color:#e6db74">&#34;add_child&#34;</span>, instance)
	call_deferred(<span style="color:#e6db74">&#34;move_child&#34;</span>, instance, <span style="color:#ae81ff">6</span>)
	instance<span style="color:#f92672">.</span>position<span style="color:#f92672">.</span>x <span style="color:#f92672">=</span> paddle<span style="color:#f92672">.</span>position<span style="color:#f92672">.</span>x
	instance<span style="color:#f92672">.</span>position<span style="color:#f92672">.</span>y <span style="color:#f92672">=</span> paddle<span style="color:#f92672">.</span>position<span style="color:#f92672">.</span>y <span style="color:#f92672">-</span> <span style="color:#ae81ff">16</span>

<span style="color:#75715e"># Add a life if less than 5</span>
<span style="color:#66d9ef">func</span> add_life(): <span style="color:#75715e"># Added @ P11</span>
	life_collide_sound<span style="color:#f92672">.</span>play() <span style="color:#75715e"># Added @ P12</span>
	<span style="color:#66d9ef">if</span> life <span style="color:#f92672">&lt;</span> MAX_LIFE:
		life <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
		update_hud_life()

<span style="color:#75715e"># set next level</span>
<span style="color:#66d9ef">func</span> set_next_level():
	print(<span style="color:#e6db74">&#34;set_next_level() called&#34;</span>)
	<span style="color:#75715e"># Change status</span>
	is_playing <span style="color:#f92672">=</span> false
	is_multiple_on <span style="color:#f92672">=</span> false <span style="color:#75715e"># Added @ P11</span>
	is_laser_on <span style="color:#f92672">=</span> false <span style="color:#75715e"># Added @ P11</span>
	
	<span style="color:#75715e"># Clear left objects</span>
	level<span style="color:#f92672">.</span>queue_free()
	<span style="color:#66d9ef">for</span> child <span style="color:#f92672">in</span> get_children():
		<span style="color:#66d9ef">if</span> child<span style="color:#f92672">.</span>is_in_group(<span style="color:#e6db74">&#34;Balls&#34;</span>) <span style="color:#f92672">or</span> child<span style="color:#f92672">.</span>is_in_group(<span style="color:#e6db74">&#34;Lasers&#34;</span>): <span style="color:#75715e"># 追加</span>
			child<span style="color:#f92672">.</span>queue_free()
	
	<span style="color:#75715e"># Increment level number</span>
	level_num <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
	<span style="color:#75715e"># Stop PauseScreen node</span>
	pause_screen<span style="color:#f92672">.</span>pause_mode <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
	<span style="color:#75715e"># Show NextScreen node</span>
	next_screen<span style="color:#f92672">.</span>pause_mode <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
	next_screen_level<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Level: &#34;</span> <span style="color:#f92672">+</span> str(level_num)
	next_screen_score<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Score: &#34;</span> <span style="color:#f92672">+</span> str(score)
	next_screen_life<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;x &#34;</span> <span style="color:#f92672">+</span> str(life)
	next_screen<span style="color:#f92672">.</span>show()
	<span style="color:#75715e"># Set Level of HUD the next level</span>
	hud_level<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Level: &#34;</span> <span style="color:#f92672">+</span> str(level_num)
	<span style="color:#75715e"># Set Paddle and Ball the first position</span>
	<span style="color:#75715e">#paddle.position = paddle_position # Removed @ P11</span>
	<span style="color:#75715e">#paddle.scale = paddle_scale # Removed @ P11</span>
	<span style="color:#75715e">#ball.position = ball_position # Removed @ P11</span>
	<span style="color:#75715e">#ball.mode = 3 # Removed @ P11</span>
	<span style="color:#75715e"># Set next Level node</span>
	add_new_level() <span style="color:#75715e"># Added @ P11</span>
	<span style="color:#75715e">#level = load(&#34;res://scene/Level&#34; + str(level_num) + &#34;.tscn&#34;).instance() # Removed @ P11</span>
	<span style="color:#75715e">#add_child(level) # Removed @ P11</span>
	<span style="color:#75715e">#move_child(level, 5) # Removed @ P11</span>
	<span style="color:#75715e">#for child in level.get_children(): # Removed @ P11</span>
		<span style="color:#75715e">#child.connect(&#34;tree_exited&#34;, self, &#34;_on_Brick_tree_exited&#34;) # Removed @ P11</span>
	<span style="color:#75715e"># Pause game until NextScreen is hidden</span>
	get_tree()<span style="color:#f92672">.</span>paused <span style="color:#f92672">=</span> true

<span style="color:#75715e"># Add new level</span>
<span style="color:#66d9ef">func</span> add_new_level(): <span style="color:#75715e"># Added @ P11</span>
	level <span style="color:#f92672">=</span> load(<span style="color:#e6db74">&#34;res://scene/Level&#34;</span> <span style="color:#f92672">+</span> str(level_num) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.tscn&#34;</span>)<span style="color:#f92672">.</span>instance()
	add_child(level)
	move_child(level, <span style="color:#ae81ff">3</span>) <span style="color:#75715e"># Changed from 5 to 3 @ P11</span>
	<span style="color:#66d9ef">for</span> child <span style="color:#f92672">in</span> level<span style="color:#f92672">.</span>get_children():
		child<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#34;tree_exited&#34;</span>, self, <span style="color:#e6db74">&#34;_on_Brick_tree_exited&#34;</span>, [child<span style="color:#f92672">.</span>global_position]) <span style="color:#75715e"># Updated to add th 4th arg @ P11 </span>


<span style="color:#66d9ef">func</span> _on_PauseScreen_visibility_changed():
	play_bgm<span style="color:#f92672">.</span>stream_paused <span style="color:#f92672">=</span> <span style="color:#f92672">not</span> play_bgm<span style="color:#f92672">.</span>stream_paused


<span style="color:#75715e"># Save data</span>
<span style="color:#66d9ef">func</span> save_data(): <span style="color:#75715e"># Added @ P13</span>
	<span style="color:#66d9ef">var</span> data <span style="color:#f92672">=</span> {
	<span style="color:#e6db74">&#34;last_level&#34;</span>: level_num,
	<span style="color:#e6db74">&#34;high_level&#34;</span>: high_level_num,
	<span style="color:#e6db74">&#34;last_score&#34;</span>: score,
	<span style="color:#e6db74">&#34;high_score&#34;</span>: high_score,
	}
	<span style="color:#66d9ef">var</span> file <span style="color:#f92672">=</span> <span style="color:#a6e22e">File</span><span style="color:#f92672">.</span>new()
	file<span style="color:#f92672">.</span>open(SCORE_FILE_PATH, <span style="color:#a6e22e">File</span><span style="color:#f92672">.</span>WRITE)
	file<span style="color:#f92672">.</span>store_line(to_json(data))
	file<span style="color:#f92672">.</span>close()


<span style="color:#75715e"># Load data</span>
<span style="color:#66d9ef">func</span> load_data(): <span style="color:#75715e"># Added @ P13</span>
	<span style="color:#66d9ef">var</span> file <span style="color:#f92672">=</span> <span style="color:#a6e22e">File</span><span style="color:#f92672">.</span>new()
	<span style="color:#66d9ef">if</span> file<span style="color:#f92672">.</span>file_exists(SCORE_FILE_PATH):
		file<span style="color:#f92672">.</span>open(SCORE_FILE_PATH, <span style="color:#a6e22e">File</span><span style="color:#f92672">.</span>READ)
		<span style="color:#66d9ef">var</span> data <span style="color:#f92672">=</span> parse_json(file<span style="color:#f92672">.</span>get_line())
		<span style="color:#66d9ef">if</span> data <span style="color:#f92672">!=</span> null:
			high_score <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#34;high_score&#34;</span>]
			high_level_num <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#34;high_level&#34;</span>]
		file<span style="color:#f92672">.</span>close()
	hud_high_score<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;H Scr: &#34;</span> <span style="color:#f92672">+</span> str(high_score)
	hud_high_level<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;H Lvl: &#34;</span> <span style="color:#f92672">+</span> str(high_level_num)
  
</code></pre></td></tr></table>
</div>
</div></details>
<br>
<details>
<summary>「GameOverView.gd」スクリプト全体を見る</summary>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GDScript" data-lang="GDScript"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Control</span>


<span style="color:#66d9ef">const</span> SCORE_FILE_PATH <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;user://score_record.save&#34;</span> <span style="color:#75715e"># Added @ P13</span>

<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> high_score <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>VBox<span style="color:#f92672">/</span>ResultsContainer<span style="color:#f92672">/</span>HighScore <span style="color:#75715e"># Added @ P13</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> last_score <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>VBox<span style="color:#f92672">/</span>ResultsContainer<span style="color:#f92672">/</span>LastScore <span style="color:#75715e"># Added @ P13</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> high_level <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>VBox<span style="color:#f92672">/</span>ResultsContainer<span style="color:#f92672">/</span>HighLevel <span style="color:#75715e"># Added @ P13</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> last_level <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>VBox<span style="color:#f92672">/</span>ResultsContainer<span style="color:#f92672">/</span>LastLevel <span style="color:#75715e"># Added @ P13</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> sound <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>KeySound


<span style="color:#66d9ef">func</span> _ready(): <span style="color:#75715e"># Added @ P13</span>
	load_data()
	

<span style="color:#66d9ef">func</span> _input(event):
	<span style="color:#66d9ef">if</span> event is <span style="color:#a6e22e">InputEventKey</span>:
		print(<span style="color:#e6db74">&#34;Input at Game Over: &#34;</span>, event<span style="color:#f92672">.</span>as_text())
		<span style="color:#66d9ef">if</span> event<span style="color:#f92672">.</span>is_action_released(<span style="color:#e6db74">&#34;Quit&#34;</span>):
			sound<span style="color:#f92672">.</span>play()
			yield(sound, <span style="color:#e6db74">&#34;finished&#34;</span>)
			get_tree()<span style="color:#f92672">.</span>quit()
		<span style="color:#66d9ef">elif</span> event<span style="color:#f92672">.</span>is_action_released(<span style="color:#e6db74">&#34;ui_accept&#34;</span>):
			sound<span style="color:#f92672">.</span>play()
			yield(sound, <span style="color:#e6db74">&#34;finished&#34;</span>)
			get_tree()<span style="color:#f92672">.</span>change_scene(<span style="color:#e6db74">&#34;res://scene/GameStartView.tscn&#34;</span>)


<span style="color:#66d9ef">func</span> load_data(): <span style="color:#75715e"># Added @ P13</span>
	<span style="color:#66d9ef">var</span> file <span style="color:#f92672">=</span> <span style="color:#a6e22e">File</span><span style="color:#f92672">.</span>new()
	<span style="color:#66d9ef">if</span> file<span style="color:#f92672">.</span>file_exists(SCORE_FILE_PATH):
		file<span style="color:#f92672">.</span>open(SCORE_FILE_PATH, <span style="color:#a6e22e">File</span><span style="color:#f92672">.</span>READ)
		<span style="color:#66d9ef">var</span> data <span style="color:#f92672">=</span> parse_json(file<span style="color:#f92672">.</span>get_line())
		<span style="color:#66d9ef">if</span> data <span style="color:#f92672">!=</span> null:
			high_score<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;High Score: &#34;</span> <span style="color:#f92672">+</span> str(data[<span style="color:#e6db74">&#34;high_score&#34;</span>])
			last_score<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Last Score: &#34;</span> <span style="color:#f92672">+</span> str(data[<span style="color:#e6db74">&#34;last_score&#34;</span>])
			high_level<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;High Level: &#34;</span> <span style="color:#f92672">+</span> str(data[<span style="color:#e6db74">&#34;high_level&#34;</span>])
			last_level<span style="color:#f92672">.</span>text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Last Level: &#34;</span> <span style="color:#f92672">+</span> str(data[<span style="color:#e6db74">&#34;last_level&#34;</span>])
		file<span style="color:#f92672">.</span>close()
</code></pre></td></tr></table>
</div>
</div></details>
<hr>
<h1 id="おわりに">おわりに<a hidden class="anchor" aria-hidden="true" href="#おわりに">#</a></h1>
<p>以上で Part 13 は完了だ。今回はデータを保存する機能、保存したデータを読み込む機能を実装した。ゲームによって、保存したいデータは変わり、規模が大きくなるほど、保存するデータも複雑化するだろう。しかし、何事も基本が重要なので、今回のチュートリアルの内容をぜひ今後の開発に役立てていただければと思う。</p>
<p>次回 Part 14 ではブロックの種類（例えば一回の衝突では消えない硬いブロックなど）を増やして、レベルに応じて難易度の幅を広くできるように調整し、複数のレベルをデザインする。</p>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://www.peanuts-code.com/ja/tags/godot/">Godot</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/godotengine/">GodotEngine</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%82%B2%E3%83%BC%E3%83%A0%E9%96%8B%E7%99%BA/">ゲーム開発</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB/">チュートリアル</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E5%B4%A9%E3%81%97/">ブロック崩し</a></li>
      <li><a href="https://www.peanuts-code.com/ja/tags/%E5%88%9D%E7%B4%9A/">初級</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/breakout_12/">
    <span class="title">« 前のページ</span>
    <br>
    <span>Godot で作るブロック崩し Part 12：BGMとサウンドエフェクトを追加しよう！</span>
  </a>
  <a class="next" href="https://www.peanuts-code.com/ja/tutorials/gd0004_breakout/breakout_14/">
    <span class="title">次のページ »</span>
    <br>
    <span>Godot で作るブロック崩し Part 14：ブロックの種類を増やしてレベルをデザインしよう！</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るブロック崩し Part 13：ハイスコアのデータを保存しよう！ on twitter"
        href="https://twitter.com/intent/tweet/?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%20Part%2013%ef%bc%9a%e3%83%8f%e3%82%a4%e3%82%b9%e3%82%b3%e3%82%a2%e3%81%ae%e3%83%87%e3%83%bc%e3%82%bf%e3%82%92%e4%bf%9d%e5%ad%98%e3%81%97%e3%82%88%e3%81%86%ef%bc%81&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout%2fbreakout_13%2f&amp;hashtags=Godot%2cGodotEngine%2c%e3%82%b2%e3%83%bc%e3%83%a0%e9%96%8b%e7%99%ba%2c%e3%83%81%e3%83%a5%e3%83%bc%e3%83%88%e3%83%aa%e3%82%a2%e3%83%ab%2c%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%2c%e5%88%9d%e7%b4%9a">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るブロック崩し Part 13：ハイスコアのデータを保存しよう！ on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout%2fbreakout_13%2f&amp;title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%20Part%2013%ef%bc%9a%e3%83%8f%e3%82%a4%e3%82%b9%e3%82%b3%e3%82%a2%e3%81%ae%e3%83%87%e3%83%bc%e3%82%bf%e3%82%92%e4%bf%9d%e5%ad%98%e3%81%97%e3%82%88%e3%81%86%ef%bc%81&amp;summary=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%20Part%2013%ef%bc%9a%e3%83%8f%e3%82%a4%e3%82%b9%e3%82%b3%e3%82%a2%e3%81%ae%e3%83%87%e3%83%bc%e3%82%bf%e3%82%92%e4%bf%9d%e5%ad%98%e3%81%97%e3%82%88%e3%81%86%ef%bc%81&amp;source=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout%2fbreakout_13%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るブロック崩し Part 13：ハイスコアのデータを保存しよう！ on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout%2fbreakout_13%2f&title=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%20Part%2013%ef%bc%9a%e3%83%8f%e3%82%a4%e3%82%b9%e3%82%b3%e3%82%a2%e3%81%ae%e3%83%87%e3%83%bc%e3%82%bf%e3%82%92%e4%bf%9d%e5%ad%98%e3%81%97%e3%82%88%e3%81%86%ef%bc%81">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るブロック崩し Part 13：ハイスコアのデータを保存しよう！ on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout%2fbreakout_13%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るブロック崩し Part 13：ハイスコアのデータを保存しよう！ on whatsapp"
        href="https://api.whatsapp.com/send?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%20Part%2013%ef%bc%9a%e3%83%8f%e3%82%a4%e3%82%b9%e3%82%b3%e3%82%a2%e3%81%ae%e3%83%87%e3%83%bc%e3%82%bf%e3%82%92%e4%bf%9d%e5%ad%98%e3%81%97%e3%82%88%e3%81%86%ef%bc%81%20-%20https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout%2fbreakout_13%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Godot で作るブロック崩し Part 13：ハイスコアのデータを保存しよう！ on telegram"
        href="https://telegram.me/share/url?text=Godot%20%e3%81%a7%e4%bd%9c%e3%82%8b%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e5%b4%a9%e3%81%97%20Part%2013%ef%bc%9a%e3%83%8f%e3%82%a4%e3%82%b9%e3%82%b3%e3%82%a2%e3%81%ae%e3%83%87%e3%83%bc%e3%82%bf%e3%82%92%e4%bf%9d%e5%ad%98%e3%81%97%e3%82%88%e3%81%86%ef%bc%81&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fja%2ftutorials%2fgd0004_breakout%2fbreakout_13%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://www.peanuts-code.com/ja/">Peanuts Code</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
