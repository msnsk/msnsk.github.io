<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ğŸ¤– 2D Path Finding in Godot3 | Peanuts Code</title>
<meta name=keywords content="GameDev,GodotEngine,Godot3,2D,PathFinding"><meta name=description content="This tutorial introduces Path Finding in 2D games. Path finding is a function that determines the shortest possible path from an object to its destination, for example, when moving an object to a certain destination. Up to Godot 3.4, the Navigation node was used to implement path finding. This was not particularly inconvenient, but the methodology for game development using it was limited and inapplicable in some areas. This time, I would like to introduce an implementation method using Navigation Server, which was added to Godot 3.5. This is a backport from Godot 4, which is currently under active development. This article is intended for users of Godot 3.5 or later. Users of Godot version 3.4 or earlier should take note. The final project file for this tutorial is available at GitHub repository . You can also check the project directly by downloading the .zip file and importing the &ldquo;project.godot&rdquo; file in the &ldquo;End&rdquo; folder with the Godot Engine. Environment Godot version: 3.5 Computer OS: macOS 11.6.5 Basic Articles You may also find the following articles useful. Downloading Godot Project"><meta name=author content="gobo"><link rel=canonical href=https://www.peanuts-code.com/en/tutorials/gd0016_2d_path_finding/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://www.peanuts-code.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.peanuts-code.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.peanuts-code.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.peanuts-code.com/apple-touch-icon.png><link rel=mask-icon href=https://www.peanuts-code.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ja href=https://www.peanuts-code.com/ja/tutorials/gd0016_2d_path_finding/><link rel=alternate hreflang=en href=https://www.peanuts-code.com/en/tutorials/gd0016_2d_path_finding/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="ğŸ¤– 2D Path Finding in Godot3"><meta property="og:description" content="This tutorial introduces Path Finding in 2D games. Path finding is a function that determines the shortest possible path from an object to its destination, for example, when moving an object to a certain destination. Up to Godot 3.4, the Navigation node was used to implement path finding. This was not particularly inconvenient, but the methodology for game development using it was limited and inapplicable in some areas. This time, I would like to introduce an implementation method using Navigation Server, which was added to Godot 3.5. This is a backport from Godot 4, which is currently under active development. This article is intended for users of Godot 3.5 or later. Users of Godot version 3.4 or earlier should take note. The final project file for this tutorial is available at GitHub repository . You can also check the project directly by downloading the .zip file and importing the &ldquo;project.godot&rdquo; file in the &ldquo;End&rdquo; folder with the Godot Engine. Environment Godot version: 3.5 Computer OS: macOS 11.6.5 Basic Articles You may also find the following articles useful. Downloading Godot Project"><meta property="og:type" content="article"><meta property="og:url" content="https://www.peanuts-code.com/en/tutorials/gd0016_2d_path_finding/"><meta property="og:image" content="https://www.peanuts-code.com/images/tutorials/gd0016_2d_path_finding/img0.gif"><meta property="article:section" content="tutorials"><meta property="article:published_time" content="2022-08-16T23:10:00+09:00"><meta property="article:modified_time" content="2022-08-16T23:10:00+09:00"><meta property="og:site_name" content="Peanuts Code ğŸ¥œ"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.peanuts-code.com/images/tutorials/gd0016_2d_path_finding/img0.gif"><meta name=twitter:title content="ğŸ¤– 2D Path Finding in Godot3"><meta name=twitter:description content="This tutorial introduces Path Finding in 2D games. Path finding is a function that determines the shortest possible path from an object to its destination, for example, when moving an object to a certain destination. Up to Godot 3.4, the Navigation node was used to implement path finding. This was not particularly inconvenient, but the methodology for game development using it was limited and inapplicable in some areas. This time, I would like to introduce an implementation method using Navigation Server, which was added to Godot 3.5. This is a backport from Godot 4, which is currently under active development. This article is intended for users of Godot 3.5 or later. Users of Godot version 3.4 or earlier should take note. The final project file for this tutorial is available at GitHub repository . You can also check the project directly by downloading the .zip file and importing the &ldquo;project.godot&rdquo; file in the &ldquo;End&rdquo; folder with the Godot Engine. Environment Godot version: 3.5 Computer OS: macOS 11.6.5 Basic Articles You may also find the following articles useful. Downloading Godot Project"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ğŸ¤– Tutorials","item":"https://www.peanuts-code.com/en/tutorials/"},{"@type":"ListItem","position":2,"name":"ğŸ¤– 2D Path Finding in Godot3","item":"https://www.peanuts-code.com/en/tutorials/gd0016_2d_path_finding/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ğŸ¤– 2D Path Finding in Godot3","name":"ğŸ¤– 2D Path Finding in Godot3","description":"This tutorial introduces Path Finding in 2D games. Path finding is a function that determines the shortest possible path from an object to its destination, for example, when moving an object to a certain destination. Up to Godot 3.4, the Navigation node was used to implement path finding. This was not particularly inconvenient, but the methodology for game development using it was limited and inapplicable in some areas. This time, I would like to introduce an implementation method using Navigation Server, which was added to Godot 3.5. This is a backport from Godot 4, which is currently under active development. This article is intended for users of Godot 3.5 or later. Users of Godot version 3.4 or earlier should take note. The final project file for this tutorial is available at GitHub repository . You can also check the project directly by downloading the .zip file and importing the \u0026ldquo;project.godot\u0026rdquo; file in the \u0026ldquo;End\u0026rdquo; folder with the Godot Engine. Environment Godot version: 3.5 Computer OS: macOS 11.6.5 Basic Articles You may also find the following articles useful. Downloading Godot Project","keywords":["GameDev","GodotEngine","Godot3","2D","PathFinding"],"articleBody":"This tutorial introduces Path Finding in 2D games. Path finding is a function that determines the shortest possible path from an object to its destination, for example, when moving an object to a certain destination.\nUp to Godot 3.4, the Navigation node was used to implement path finding. This was not particularly inconvenient, but the methodology for game development using it was limited and inapplicable in some areas. This time, I would like to introduce an implementation method using Navigation Server, which was added to Godot 3.5. This is a backport from Godot 4, which is currently under active development. This article is intended for users of Godot 3.5 or later. Users of Godot version 3.4 or earlier should take note.\nThe final project file for this tutorial is available at GitHub repository . You can also check the project directly by downloading the .zip file and importing the â€œproject.godotâ€ file in the â€œEndâ€ folder with the Godot Engine.\nEnvironment Godot version: 3.5\nComputer OS: macOS 11.6.5\nBasic Articles You may also find the following articles useful.\nDownloading Godot Project Manager of Godot Preparation Creating a new project Start Godot Engine and create a new project. You can name your project as you like. If you canâ€™t think of one, letâ€™s call it â€œ2D Path Finding Startâ€.\nUpdating project settings Once the editor appears, we should update project settings for the entire project.\nFirst, set the display size for the game.\nOpen the â€œProjectâ€ menu \u003e â€œProject Settings\nSelect â€œDisplayâ€ \u003e â€œWindowâ€ from the sidebar of the â€œGeneralâ€ tab. In the â€œSizeâ€ section, change the values of the following items. Width: 512 Height: 320 Test Width: 768 Test Height: 480 In the â€œStretchâ€ section, change the values of the following items Mode: 2d Aspect: keep Switch to the â€œInput Mapâ€ tab and add â€œmove_toâ€ to the action. Assign the â€œleft mouse buttonâ€ to the â€œmove_toâ€ action.\nDownloading and importing assets Next, letâ€™s download assets from KENNEYâ€™s site and use them. The asset pack we will use is called 1-Bit Pack . I canâ€™t help but be thankful for this wonderful free material.\nOnce downloaded, drag and drop the â€œcolored-transparent_packed.pngâ€ file from the â€œTilesheetâ€ folder into the editorâ€™s file system dock to import it into your project.\nImmediately after importing the file, the image will look blurry, so correct this by following the steps below.\nMake the imported asset file selected in the file system dock. Select â€œPresetâ€ \u003e â€œ2D Pixelâ€ in the import dock.\nClick the â€œRe-importâ€ button at the bottom.\nThe image should now have the edges characteristic of pixel art. The imported tileset will be used later for tile maps and player character textures.\nCreating a World scene Creating a new World scene The first step is to create a â€œWorldâ€ scene to prepare the game world. 1. Select â€œSceneâ€ menu \u003e â€œNew Sceneâ€.\nSelect â€œOther Nodeâ€ in â€œGenerate Root Nodeâ€. When the root node of the â€œNode2Dâ€ class is generated, rename it to â€œWorldâ€. Save the scene. Create a folder and save the scene with the file path â€œres://Scene/World.tscnâ€. Adding and editing a TileMap node Adding a â€œTileMapâ€ node to the â€œWorldâ€ root node.\nIn the inspector, apply the â€œNew TileSetâ€ resource to the â€œTileSetâ€ property of the â€œTileMapâ€ node.\nClick on the applied â€œTileSetâ€ resource to open the TileSet panel at the bottom of the editor.\nAdd imported KENNEY â€œres://colored-transparent_packed.pngâ€ resource file by dragging it to the left sidebar of the TileSet panel.\nSelect the added texture sheet and prepare the following three single tiles.\nTile for the characterâ€™s pathway.\n*Tiles with this navigation area set are the target of the pathfinding. Use gravel tiles Collision polygon: not required Navigation polygon: Needed Tiles that characters do not pass through but do not collide with each other.\n*Use as a margin so that the character does not get caught by tree tiles with collision geometry when moving along the path. Use grass texture Collision polygons: not needed Navigation polygons: not needed Tiles that characters cannot pass through and have collision detection.\n*Use as impassable obstacles during path finding. Use tree texture Collision polygon: Needed Navigation polygons: not required Select â€œTileMapâ€ in the scene dock and create a tile map on the 2D workspace. Below is a sample. It is OK if the gravel tiles provide some pathways (navigation areas).\nIt is important to note, however, that once you place the tree tiles for obstacles, be sure to place the grass tiles for margins around them. Otherwise, the character will try to pass right through the wooden tiles when moving along the path, and will get stuck and not be able to move. This is something I would like to see improved in future Godot updates. I havenâ€™t implemented the character yet, but Iâ€™ll show you how it behaves first.\nAdding and editing the Line2D node The â€œLine2Dâ€ node is used to make the explored and determined path visually clear.\nAdd a â€œLine2Dâ€ node to the â€œWorldâ€ root node.\nIn the inspector, set the â€œWidthâ€ property of the â€œLine2Dâ€ node to.\nCreating a Player scene From here, we will create a scene for the player character to move along the found path.\nCreating a new Player scene Select â€œSceneâ€ menu \u003e â€œNew Sceneâ€. Select â€œOther Nodeâ€ in â€œGenerate Root Nodeâ€. When the root node of the â€œKinematicBody2Dâ€ class is created, rename it to â€œPlayerâ€. Save the scene. Create a folder and save the scene with the file path â€œres://Scenes/Player.tscnâ€. Adding and editing nodes to the Player scene Add nodes to the â€œPlayerâ€ root node to make the scene tree look like this.\nPlayer(KinematicBody2D) Sprite CollisionShape2D NavigationAgent2D Each node is then edited.\nSprite node This node is used to apply texture (appearance) to the â€œPlayerâ€ scene.\nIn the inspector, apply the â€œres://colored-transparent_packed.pngâ€ resource downloaded from KENNEYâ€™s site to the â€œTextureâ€ property.\nEnable the â€œRegionâ€ \u003e â€œEnabledâ€ property.\nOpen the Texture Region panel at the bottom of the editor and select the region of the player character texture of your choice. For this tutorial, we used a sheriff-like texture.\nCollisionShape2D node This node sets the collision shape for the â€œPlayerâ€ root node of the KinematicBody2D class.\nApply a new â€œRectangleShape2Dâ€ resource to the â€œShapeâ€ property in the inspector. Set the value of the â€œExtentsâ€ property of the applied â€œRectangleShape2Dâ€ resource to (x: 6, y: 6).\nOn the 2D workspace it will look like this.\nNavigationAgent2D node This node was introduced in Godot 3.5 as a backported node from Godot 4. A parent node (in this case, the â€œPlayerâ€ node) adding this node to its children will automatically avoid collisions with obstacles and will be able to move by path finding. It seems to be controlled by being registered in the navigation map of the default World2D. For more details, please refer to Godotâ€™s official online documentation.\nGodot Docs: NavigationAgent2D Check the â€œAvoidanceâ€ \u003e â€œAvoidance Enabledâ€ property to enable it. This controls collision avoidance with obstacles and enables path finding. Set the â€œAvoidanceâ€ \u003e â€œRadiusâ€ property to 8. This property is the size of this agent. We set the radius to 8 px to match the size of the texture on the â€œSpriteâ€ node. Set the â€œAvoidanceâ€ \u003e â€œNeighbor Distâ€ property to 8. This property sets the distance at which other agents will be detected. Later we will create other object scenes that will automatically track the Player and add NavigationAgent2D nodes to them as well, but they will not need to be detected until they are right next to the Player, so we set this property to 8 as well as the agentâ€™s. Set the â€œAvoidanceâ€ \u003e â€œMax Speedâ€ property to 40. This is the maximum movement speed of the agents. Adding an instance of the Player scene to the World scene Add an instance node of the â€œPlayer.tscnâ€ scene created here to the â€œWorldâ€ scene. It is OK if the scene dock of the â€œWorldâ€ scene looks like the following.\nAttaching and editing scripts to the Player node After returning to the â€œPlayerâ€ scene, attach a script to the â€œPlayerâ€ root node and write the code. Create a script with the file path â€œres://Scripts/Player.gdâ€. When the script editor opens, write the following code.\n###Player.gd### extends KinematicBody2D # Player speed export (float) var speed = 40 # Refer to the Line2D node in the World scene onready var line: Line2D = get_node(\"... /Line2D\") # Refer to the NavigationAgent2D node onready var nav_agent = $NavigationAgent2D # Built-in function called when a node is loaded into the scene tree func _ready(): # Set the current location as a temporary destination by NavigationAgent2D nav_agent.set_target_location(global_position) # Built-in physics process function called every frame func _physics_process(delta): # If the last position of the found path has not been reached if not nav_agent.is_navigation_finished(): # Get the next navigable position without obstacles var next_loc = nav_agent.get_next_location() # Get the current Player location var current_pos = global_position # Calculate velocity from direction and speed for next possible location var velocity = current_pos.direction_to(next_loc) * speed # Pass velocity to NavigationAgent2D's collision avoidance algorithm # send velocity_computed signal as soon as velocity adjustment is complete nav_agent.set_velocity(velocity) # When the input map action move_to (left mouse button) is pressed if Input.is_action_pressed(\"move_to\"): # call a method to start path finding find_path() # Define after this # Method to start path finding func find_path(): # Set the current mouse position as the next destination by NavigationAgent2D nav_agent.set_target_location(get_global_mouse_position()) # Get the next possible location to move to without obstacles nav_agent.get_next_location() # Pass the information of the path generated by NavigationAgent2D to the path of Line2D in the World scene # Both data types are PoolVector2Array, so they can be passed as is line.points = nav_agent.get_nav_path() Now connect three different signals of the â€œNavigationAgent2Dâ€ node to this script.\nThe first one is the â€œvelocity_computedâ€ signal. This signal is sent when NavigationAgent2D has completed adjusting its velocity to avoid collisions with surrounding objects.\nThe second is the â€œtarget_reachedâ€ signal. This signal is sent out when the next moveable position on the path to the final destination is reached.\nThe third signal is â€œnavigation_finished. This signal is sent out when the final destination on the route is reached.\nAfter connecting each signal to the script, write the necessary code in the generated method. The code is as follows.\n###Player.gd### # Called with a signal that is sent out when NavigationAgent2D has finished adjusting its velocity func _on_NavigationAgent2D_velocity_computed(safe_velocity): # Apply the adjusted velocity to the Player's movement move_and_slide(safe_velocity). # Called with a signal that is sent when the NavigationAgent2D reaches its next moveable position. func _on_NavigationAgent2D_target_reached(): # On the path of a Line2D node in the World scene... # reflect the updated path of the NavigationAgent2D line.points = nav_agent.get_nav_path() # Called with a signal that is sent out when NavigationAgent2D reaches the last destination in its path func _on_NavigationAgent2D_navigation_finished(): # Reset the points of the path of the Line2D node in the World scene to 0 line.points.resize(0) This completes the editing of the â€œPlayer.gdâ€ script. At this point, try running the project once. If you are running the project for the first time, select â€œres://Scenes/World.tscnâ€ as the main scene.\nLetâ€™s click on the tile map appropriately and check if â€œPlayerâ€ moves along the path search without any problem.\nCreating an Animal scene In the â€œPlayerâ€ scene, we implemented path finding using the mouse position as the destination. From now on, we will implement path finding for another object that moves with the moving â€œPlayerâ€ as its destination. However, there is no need to worry, since most of the work is the same.\nLetâ€™s make multiple animal objects gather around the â€œPlayerâ€ instance object we just created. We will now create an â€œAnimalâ€ scene for the animal objects.\nCreating a new Animal scene Select â€œSceneâ€ menu \u003e â€œNew Sceneâ€. Select â€œOther Nodeâ€ in â€œCreate Root Nodeâ€. When the root node of the â€œKinematicBody2Dâ€ class is created, rename it to â€œAnimalâ€. Save the scene. Create a folder and save the scene with the file path â€œres://Scenes/Animal.tscnâ€. Adding and editing nodes in the Animal scene Add some nodes to the â€œAnimalâ€ root node and make the scene tree as follows.\nAnimal(KinematicBody2D) Sprite CollisionShape2D NavigationAgent2D PathTimer(Timer)\nThen edit each node.\nSprite node This node is used to give texture (appearance) to the â€œAnimalâ€ scene.\nIn the inspector, apply the â€œres://colored-transparent_packed.pngâ€ resource downloaded from the KENNEY website to the â€œTextureâ€ property.\nEnable the â€œRegionâ€ \u003e â€œEnabledâ€ property.\nOpen the texture region panel at the bottom of the editor and select a region for the six animal textures.\nSet the value of the â€œAnimationâ€ \u003e â€œHframesâ€ property to 6. Since the texture area selected earlier contains 6 types of animals, the value is set to be 1 frame for each type of animal. The default frame is set to 0 (first frame) in the â€œFrameâ€ property.\nCollisionShape2D node This node sets the collision shape for the â€œAnimalâ€ root node of the KinematicBody2D class.\nApply the â€œNew RectangleShape2Dâ€ resource to the â€œShapeâ€ property in the inspector. Set the value of the â€œExtentsâ€ property of the applied â€œRectangleShape2Dâ€ resource to (x: 8, y: 8).\nOn the 2D workspace it will look like this.\nNavigationAgent2D node In the â€œAnimalâ€ scene, as in the â€œPlayerâ€ scene, this node is used to avoid collisions with obstacles and to enable movement by path finding.\nEnable the â€œAvoidanceâ€ \u003e â€œAvoidance Enabledâ€ property. Leave the â€œAvoidanceâ€ \u003e â€œRadiusâ€ property at the default value of 10. The size of the texture is slightly larger than the size of the Sprite nodeâ€™s texture, so that the animals are slightly spaced apart. The â€œAvoidanceâ€ \u003e â€œNeighbor Distâ€ property was also left at the default value of 500. Since the width of the display size is set to 512 px, setting it to 500 will allow other agents to be detected from one end of the display to the other and avoid collisions. The goal is to reduce the number of instances of the â€œAnimalâ€ scene that will crowd around the â€œPlayerâ€ instance and thus reduce the possibility of being stuck in the scene.\nPathTimer(Timer) Node This node is used to periodically update the position of the moving destination (instance node of â€œPlayerâ€).\nThe â€œWait Timeâ€ property is left at the default value of 1. The â€œOne Shotâ€ property should also be left at the default value of 1 and disabled. This will time out repeatedly every second. Enable the â€œAutostartâ€ property. The timer will now start automatically when this node is loaded into the scene tree.\nAttaching and editing scripts to the â€œAnimalâ€ node From here, we will attach a script to the â€œAnimalâ€ root node and write code to control the â€œAnimalâ€ scene. Create a script with the file path â€œres://Scripts/Animal.gdâ€. When the script editor opens, code as follows.\n###Animal.gd### extends KinematicBody2D # Speed of Animal var speed = 30 # Variable to assign the object that will be the destination of the route var target # Reference to the Sprite node onready var sprite = $Sprite # Reference to NavigationAgent2D onready var nav_agent = $NavigationAgent2D # Same as Player.gd below func _ready(): nav_agent.set_target_location(global_position) func _physics_process(_delta): if not nav_agent.is_navigation_finished(): var current_pos = global_position var next_loc = nav_agent.get_next_location() var velocity = current_pos.direction_to(next_loc) * speed nav_agent.set_velocity(velocity) # If the x-coordinate of the destination object is smaller than the x-coordinate of the animal node # flip the Texture image of the Sprite node sprite.flip_h = target.global_position.x \u003c global_position.x Two signals must then be connected to the script.\nThe first one is to connect the â€œvelocity_computedâ€ signal of the â€œNavigationAgent2Dâ€ node as in the â€œPlayerâ€ scene.\nOnce connected, write a move_and_slide method in the generated _on_NavigationAgent2D_velocity_computed method to control the movement of the â€œAnimalâ€ node.\n###Animal.gd### # Called with a signal that is sent out when NavigationAgent2D has finished adjusting its velocity func _on_NavigationAgent2D_velocity_computed(safe_velocity): # Apply the adjusted velocity to the Player's movement move_and_slide(safe_velocity) The next step is to connect the â€œtimeoutâ€ signal of the â€œPathTimerâ€ node to the script.\nOnce connected, within the generated method _on_PathTimer_timeout, describe the set_target_location method of the â€œNavigationAgent2Dâ€ node to set the location of the destination object (in this case â€œPlayerâ€) as the destination during path finding. Now, at the time of timeout every second, the position of the latest â€œPlayerâ€ instance node is acquired and the path finding is performed with that as the destination.\n###Animal.gd### func _on_PathTimer_timeout(): nav_agent.set_target_location(target.global_position) The â€œAnimal.gdâ€ script is now complete.\nAdding an Animals node to the â€œWorldâ€ scene Add a node of class Node2D to the â€œWorldâ€ scene as a container for multiple instances of the â€œAnimalsâ€ scene and rename it to â€œAnimalsâ€. Adding instances of â€œAnimalâ€ will be done by script after this.\nAttach a script to the â€œWorldâ€ node and edit it Attach a script to the â€œWorldâ€ root node and edit it, adding multiple instances of â€œAnimalâ€. Save the script with the file path as â€œres://Scripts/World.gdâ€ and when the script editor opens, write the code as follows.\n###World.gd### extends Node2D # Reference to preloaded Animal scene file const animal_scn = preload(\"res://Scenes/Animal.tscn\") # Number of Animal instances export (int) var head_count = 12 # Reference to TileMap node onready var tile_map = $TileMap # Reference to the Player node onready var player = $Player # Reference the Animals(Node2D) node onready var animals = $Animals func _ready(): # Randomize seed for random number generation function randomize(). # Get an array of ID 9 tiles on the TileMap # IDs can be found by clicking the (i) icon in the tileset panel edit screen var cells = tile_map.get_used_cells_by_id(9) # Loop for the number of Animal instances for i in head_count : # Get random index within the number of tiles with ID 9 var random_index = randi() % cells.size() # Get a tile from the ID 9 tiles that fits the random value var spawn_tile = cells.pop_at(random_index) # loop if the tile has already been spawned from the array and the array is not yet empty while spawn_tile == null and not cells.empty(): # Generate a random value within the range of the number of ID9 liles again random_index = randi() % cells.size() # Spawn a tile from the ID9 tiles again that fits the random value spawn_tile = cells.pop_at(random_index) # Place an Animal instance on the acquired tile... # by calling a method to create an Animal instance spawn_animal(spawn_tile) # method to spawn Animal instance func spawn_animal(spawn_tile): # Get the position of the tile passed as argument, shifted by (8, 8) to the x,y coordinates of the tile var spawn_pos = tile_map.map_to_world(spawn_tile, true) + Vector2(8, 8) # Create an instance of the Animal scene var animal = animal_scn.instance() # Position the Animal instance on the tile passed as argument animal.position = spawn_pos # Assign and reference the Player node to the destination property of the Animal instance animal.target = player.global_position # Randomly determine the texture of the Sprite node of the Animal instance animal.get_node(\"Sprite\").frame = randi() % animal.get_node(\"Sprite\").hframes # Make the Animal instance a child of the Animals node animals.add_child(animal) The â€œWorld.gdâ€ script is now complete. Letâ€™s run the project and see how multiple instances of â€œAnimalâ€ approach â€œPlayerâ€.\nThe number of head_count properties defined in the script can be easily edited in the inspector, since it comes with the export keyword. I increased the number of â€œAnimalâ€ instances to 100 as a test, but it got stuck at the end. If â€œAnimalâ€ were a zombie, it would be a hellish scene.\nSample game I have prepared a sample game that further brushes up the project created in this tutorial.\nYour browser does not support the video tag. The project file of the sample game is located in GitHub repository , so please download the .zip file from there. You can check it by importing the â€œproject.godotâ€ file in the â€œSampleâ€ folder with the Godot Engine.\nGame Rules: Left mouse click to move to the mouse cursor position Spacebar to shoot the gun in the direction of the mouse cursor. When you run out of bullets, reload 12 bullets after reloading animation. When you hit an enemy, you lose a heart. When you run out of all 5 hearts, the game is over. The darker the color of an enemy, the more lives it has and the slower its speed is. The lighter the color, the less lives it has and the faster its speed is. The playerâ€™s score is the number of jewels that dropped when an enemy is defeated. Conclusion In this tutorial, we implemented the new Navigation Server added in Godot 3.5.\nFor a simple 2D route search like this one, it was relatively easy to implement using NavigationAgent2D, although there are still some itchy points, such as the problem of getting caught in a corner when using a TileMap without a margin tile. However, we hope that this will be improved in future updates.\nLet me summarize the key points of this project.\nWhen using TileMap, be sure to set navigation to movable tiles. When using TileMap, make a margin with tiles that are set only in the area so that they do not get caught in corners. You can also define a navigation area using the NavigationPolygonInstance node, which we did not use in this case. Adding a â€œNavigationAgent2Dâ€ node to the child of the object you want to move. When controlling path finding in scripts, write the code with the following order in mind: set the final destination, obtain the next possible moving position, adjust the speed to avoid collision, and move at the adjusted speed. References Official Article - Navigation Server for Godot 4.0 Official Article - Godot 3.5: Can't stop won't stop Godot Doc - NavigationAgent2D YouTube - Godot 3.5 | NavigationAgent2D YouTube - Godot 3.5 is Out, and it's SICK! Real-time pathfinding, new tween animations, and more GitHub - godotengine/godot - issue #60546 ","wordCount":"3627","inLanguage":"en","image":"https://www.peanuts-code.com/images/tutorials/gd0016_2d_path_finding/img0.gif","datePublished":"2022-08-16T23:10:00+09:00","dateModified":"2022-08-16T23:10:00+09:00","author":{"@type":"Person","name":"gobo"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.peanuts-code.com/en/tutorials/gd0016_2d_path_finding/"},"publisher":{"@type":"Organization","name":"Peanuts Code","logo":{"@type":"ImageObject","url":"https://www.peanuts-code.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.peanuts-code.com/en/ accesskey=h title="Peanuts Code (Alt + H)"><img src=https://www.peanuts-code.com/images/logomark.png alt aria-label=logo height=35>Peanuts Code</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://www.peanuts-code.com/ja/ title=Japanese aria-label=ğŸ‡¯ğŸ‡µæ—¥æœ¬èª>ğŸ‡¯ğŸ‡µæ—¥æœ¬èª</a></li></ul></div></div><ul id=menu><li><a href=https://www.peanuts-code.com/en/ title=Home><span>Home</span></a></li><li><a href=https://www.peanuts-code.com/en/portfolio/ title=Works><span>Works</span></a></li><li><a href=https://www.peanuts-code.com/en/posts/ title=Blogs><span>Blogs</span></a></li><li><a href=https://www.peanuts-code.com/en/tutorials/ title=Tutorials><span>Tutorials</span></a></li><li><a href=https://www.peanuts-code.com/en/about/ title=About><span>About</span></a></li><li><a href=https://www.peanuts-code.com/en/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.peanuts-code.com/en/>Home</a>&nbsp;Â»&nbsp;<a href=https://www.peanuts-code.com/en/tutorials/>ğŸ¤– Tutorials</a></div><h1 class="post-title entry-hint-parent">ğŸ¤– 2D Path Finding in Godot3</h1><div class=post-meta><span title='2022-08-16 23:10:00 +0900 +0900'>2022-08-16</span>&nbsp;Â·&nbsp;8 min&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://www.peanuts-code.com/ja/tutorials/gd0016_2d_path_finding/>ğŸ‡¯ğŸ‡µæ—¥æœ¬èª</a></li></ul></div><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share ğŸ¤– 2D Path Finding in Godot3 on x" href="https://x.com/intent/tweet/?text=%f0%9f%a4%96%202D%20Path%20Finding%20in%20Godot3&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fen%2ftutorials%2fgd0016_2d_path_finding%2f&amp;hashtags=GameDev%2cGodotEngine%2cGodot3%2c2D%2cPathFinding"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share ğŸ¤– 2D Path Finding in Godot3 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.peanuts-code.com%2fen%2ftutorials%2fgd0016_2d_path_finding%2f&title=%f0%9f%a4%96%202D%20Path%20Finding%20in%20Godot3"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share ğŸ¤– 2D Path Finding in Godot3 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.peanuts-code.com%2fen%2ftutorials%2fgd0016_2d_path_finding%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li></ul><ul class=post-tags><li><a href=https://www.peanuts-code.com/en/tags/gamedev/>GameDev</a></li><li><a href=https://www.peanuts-code.com/en/tags/godotengine/>GodotEngine</a></li><li><a href=https://www.peanuts-code.com/en/tags/godot3/>Godot3</a></li><li><a href=https://www.peanuts-code.com/en/tags/2d/>2D</a></li><li><a href=https://www.peanuts-code.com/en/tags/pathfinding/>PathFinding</a></li></ul></header><figure class=entry-cover><img loading=eager src=https://www.peanuts-code.com/images/tutorials/gd0016_2d_path_finding/img0.gif alt="2D Path Finding in Godot"></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#preparation>Preparation</a><ul><li><a href=#creating-a-new-project>Creating a new project</a></li><li><a href=#updating-project-settings>Updating project settings</a></li><li><a href=#downloading-and-importing-assets>Downloading and importing assets</a></li></ul></li><li><a href=#creating-a-world-scene>Creating a World scene</a><ul><li><a href=#creating-a-new-world-scene>Creating a new World scene</a></li><li><a href=#adding-and-editing-a-tilemap-node>Adding and editing a TileMap node</a></li><li><a href=#adding-and-editing-the-line2d-node>Adding and editing the Line2D node</a></li></ul></li><li><a href=#creating-a-player-scene>Creating a Player scene</a><ul><li><a href=#creating-a-new-player-scene>Creating a new Player scene</a></li><li><a href=#adding-and-editing-nodes-to-the-player-scene>Adding and editing nodes to the Player scene</a></li><li><a href=#adding-an-instance-of-the-player-scene-to-the-world-scene>Adding an instance of the Player scene to the World scene</a></li><li><a href=#attaching-and-editing-scripts-to-the-player-node>Attaching and editing scripts to the Player node</a></li></ul></li><li><a href=#creating-an-animal-scene>Creating an Animal scene</a><ul><li><a href=#creating-a-new-animal-scene>Creating a new Animal scene</a></li><li><a href=#adding-and-editing-nodes-in-the-animal-scene>Adding and editing nodes in the Animal scene</a></li><li><a href=#attaching-and-editing-scripts-to-the-animal-node>Attaching and editing scripts to the &ldquo;Animal&rdquo; node</a></li><li><a href=#adding-an-animals-node-to-the-world-scene>Adding an Animals node to the &ldquo;World&rdquo; scene</a></li><li><a href=#attach-a-script-to-the-world-node-and-edit-it>Attach a script to the &ldquo;World&rdquo; node and edit it</a></li></ul></li><li><a href=#sample-game>Sample game</a><ul><li></li></ul></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#references>References</a></li></ul></nav></div></details></div><div class=post-content><p>This tutorial introduces Path Finding in 2D games. Path finding is a function that determines the shortest possible path from an object to its destination, for example, when moving an object to a certain destination.</p><p>Up to Godot 3.4, the <strong>Navigation</strong> node was used to implement path finding. This was not particularly inconvenient, but the methodology for game development using it was limited and inapplicable in some areas. This time, I would like to introduce an implementation method using <strong>Navigation Server</strong>, which was added to Godot 3.5. This is a backport from Godot 4, which is currently under active development. This article is intended for users of Godot 3.5 or later. Users of Godot version 3.4 or earlier should take note.</p><p>The final project file for this tutorial is available at <a href=https://github.com/msnsk/2DPathFinding.git target=_blank>GitHub repository</a>
. You can also check the project directly by downloading the .zip file and importing the &ldquo;project.godot&rdquo; file in the &ldquo;End&rdquo; folder with the Godot Engine.</p><blockquote><p><strong><span style=color:salmon>Environment</span></strong><br><em>Godot version: <strong>3.5</strong></em><br><em>Computer OS: <strong>macOS 11.6.5</strong></em></p></blockquote><blockquote><p><strong><span style=color:salmon>Basic Articles</span></strong><br><em>You may also find the following articles useful.<br><a href=https://www.peanuts-code.com/en/tutorials/gd0001_download/>Downloading Godot</a><br><a href=https://www.peanuts-code.com/en/tutorials/gd0002_project_manager/>Project Manager of Godot</a></em></p></blockquote><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h2 id=preparation>Preparation</h2><h3 id=creating-a-new-project>Creating a new project</h3><p>Start Godot Engine and create a new project. You can name your project as you like. If you can&rsquo;t think of one, let&rsquo;s call it &ldquo;2D Path Finding Start&rdquo;.</p><br><h3 id=updating-project-settings>Updating project settings</h3><p>Once the editor appears, we should update project settings for the entire project.</p><p>First, set the display size for the game.</p><ol><li>Open the &ldquo;Project&rdquo; menu > &ldquo;Project Settings<br>Select &ldquo;Display&rdquo; > &ldquo;Window&rdquo; from the sidebar of the &ldquo;General&rdquo; tab.</li><li>In the &ldquo;Size&rdquo; section, change the values of the following items.<ul><li>Width: 512</li><li>Height: 320</li><li>Test Width: 768</li><li>Test Height: 480</li></ul></li><li>In the &ldquo;Stretch&rdquo; section, change the values of the following items<ul><li>Mode: 2d</li><li>Aspect: keep</li></ul></li><li>Switch to the &ldquo;Input Map&rdquo; tab and add &ldquo;move_to&rdquo; to the action.</li><li>Assign the &ldquo;left mouse button&rdquo; to the &ldquo;move_to&rdquo; action.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img1.png alt="Inputmap - action - shake"></li></ol><br><h3 id=downloading-and-importing-assets>Downloading and importing assets</h3><p>Next, let&rsquo;s download assets from KENNEY&rsquo;s site and use them. The asset pack we will use is called <strong><a href=https://www.kenney.nl/assets/bit-pack target=_blank>1-Bit Pack</a>
</strong>. I can&rsquo;t help but be thankful for this wonderful free material.</p><p>Once downloaded, drag and drop the &ldquo;colored-transparent_packed.png&rdquo; file from the &ldquo;Tilesheet&rdquo; folder into the editor&rsquo;s file system dock to import it into your project.</p><p>Immediately after importing the file, the image will look blurry, so correct this by following the steps below.</p><ol><li>Make the imported asset file selected in the file system dock.</li><li>Select &ldquo;Preset&rdquo; > &ldquo;2D Pixel&rdquo; in the import dock.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img2.png alt="select 2D Pixel"></li><li>Click the &ldquo;Re-import&rdquo; button at the bottom.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img3.png alt="click reinport"></li></ol><p>The image should now have the edges characteristic of pixel art. The imported tileset will be used later for tile maps and player character textures.</p><br><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h2 id=creating-a-world-scene>Creating a World scene</h2><h3 id=creating-a-new-world-scene>Creating a new World scene</h3><p>The first step is to create a &ldquo;World&rdquo; scene to prepare the game world. 1. Select &ldquo;Scene&rdquo; menu > &ldquo;New Scene&rdquo;.</p><ol><li>Select &ldquo;Other Node&rdquo; in &ldquo;Generate Root Node&rdquo;.</li><li>When the root node of the &ldquo;Node2D&rdquo; class is generated, rename it to &ldquo;World&rdquo;.</li><li>Save the scene. Create a folder and save the scene with the file path &ldquo;res://Scene/World.tscn&rdquo;.</li></ol><br><h3 id=adding-and-editing-a-tilemap-node>Adding and editing a TileMap node</h3><ol><li><p>Adding a &ldquo;TileMap&rdquo; node to the &ldquo;World&rdquo; root node.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img3.1.png alt="Scene Dock - Added TileMap"></p></li><li><p>In the inspector, apply the &ldquo;New TileSet&rdquo; resource to the &ldquo;TileSet&rdquo; property of the &ldquo;TileMap&rdquo; node.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img4.png alt="TileMap - TileSet"></p></li><li><p>Click on the applied &ldquo;TileSet&rdquo; resource to open the TileSet panel at the bottom of the editor.</p></li><li><p>Add imported KENNEY &ldquo;res://colored-transparent_packed.png&rdquo; resource file by dragging it to the left sidebar of the TileSet panel.</p></li><li><p>Select the added texture sheet and prepare the following three single tiles.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img5.png alt="TileSet Pannel"></p><ul><li>Tile for the character&rsquo;s pathway.<br>*Tiles with this navigation area set are the target of the pathfinding.<ul><li>Use gravel tiles</li><li>Collision polygon: not required</li><li>Navigation polygon: <strong>Needed</strong></li></ul></li><li>Tiles that characters do not pass through but do not collide with each other.<br>*Use as a margin so that the character does not get caught by tree tiles with collision geometry when moving along the path.<ul><li>Use grass texture</li><li>Collision polygons: not needed</li><li>Navigation polygons: not needed</li></ul></li><li>Tiles that characters cannot pass through and have collision detection.<br>*Use as impassable obstacles during path finding.<ul><li>Use tree texture</li><li>Collision polygon: <strong>Needed</strong></li><li>Navigation polygons: not required</li></ul></li></ul></li><li><p>Select &ldquo;TileMap&rdquo; in the scene dock and create a tile map on the 2D workspace. Below is a sample. It is OK if the gravel tiles provide some pathways (navigation areas).<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img6.png alt="TileMap - 2D workspace"><br>It is important to note, however, that once you place the tree tiles for obstacles, be sure to place the grass tiles for margins around them. Otherwise, the character will try to pass right through the wooden tiles when moving along the path, and will get stuck and not be able to move. This is something I would like to see improved in future Godot updates. I haven&rsquo;t implemented the character yet, but I&rsquo;ll show you how it behaves first.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img7.gif alt="TileMap - Stuck with collision shape"></p></li></ol><br><h3 id=adding-and-editing-the-line2d-node>Adding and editing the Line2D node</h3><p>The &ldquo;Line2D&rdquo; node is used to make the explored and determined path visually clear.</p><ol><li>Add a &ldquo;Line2D&rdquo; node to the &ldquo;World&rdquo; root node.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img8.png alt="Scene Dock - Added Line2D"></li><li>In the inspector, set the &ldquo;Width&rdquo; property of the &ldquo;Line2D&rdquo; node to.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img9.png alt="Line2D - Width"></li></ol><br><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h2 id=creating-a-player-scene>Creating a Player scene</h2><p>From here, we will create a scene for the player character to move along the found path.</p><h3 id=creating-a-new-player-scene>Creating a new Player scene</h3><ol><li>Select &ldquo;Scene&rdquo; menu > &ldquo;New Scene&rdquo;.</li><li>Select &ldquo;Other Node&rdquo; in &ldquo;Generate Root Node&rdquo;.</li><li>When the root node of the &ldquo;KinematicBody2D&rdquo; class is created, rename it to &ldquo;Player&rdquo;.</li><li>Save the scene. Create a folder and save the scene with the file path &ldquo;res://Scenes/Player.tscn&rdquo;.</li></ol><h3 id=adding-and-editing-nodes-to-the-player-scene>Adding and editing nodes to the Player scene</h3><p>Add nodes to the &ldquo;Player&rdquo; root node to make the scene tree look like this.</p><ul><li>Player(KinematicBody2D)<ul><li>Sprite</li><li>CollisionShape2D</li><li>NavigationAgent2D</li></ul></li></ul><p><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img10.png alt="Player scene - Scene Dock"></p><p>Each node is then edited.<br><br></p><h4 id=sprite-node>Sprite node</h4><p>This node is used to apply texture (appearance) to the &ldquo;Player&rdquo; scene.</p><ol><li>In the inspector, apply the &ldquo;res://colored-transparent_packed.png&rdquo; resource downloaded from KENNEY&rsquo;s site to the &ldquo;Texture&rdquo; property.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img11.png alt="Sprite node - texture"></li><li>Enable the &ldquo;Region&rdquo; > &ldquo;Enabled&rdquo; property.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img12.png alt="Sprite node - Region - enabled"></li><li>Open the Texture Region panel at the bottom of the editor and select the region of the player character texture of your choice. For this tutorial, we used a sheriff-like texture.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img13.png alt="Sprite node - texture region pannel"></li></ol><br><h4 id=collisionshape2d-node>CollisionShape2D node</h4><p>This node sets the collision shape for the &ldquo;Player&rdquo; root node of the KinematicBody2D class.</p><ol><li>Apply a new &ldquo;RectangleShape2D&rdquo; resource to the &ldquo;Shape&rdquo; property in the inspector.</li><li>Set the value of the &ldquo;Extents&rdquo; property of the applied &ldquo;RectangleShape2D&rdquo; resource to (x: 6, y: 6).<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img14.png alt="CollisionShape2D node - Shape - Extents"></li><li>On the 2D workspace it will look like this.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img15.png alt="CollisionShape2D node - 2D Workspace"></li></ol><br><h4 id=navigationagent2d-node>NavigationAgent2D node</h4><p>This node was introduced in Godot 3.5 as a backported node from Godot 4. A parent node (in this case, the &ldquo;Player&rdquo; node) adding this node to its children will automatically avoid collisions with obstacles and will be able to move by path finding. It seems to be controlled by being registered in the <strong>navigation map</strong> of the default <strong>World2D</strong>. For more details, please refer to Godot&rsquo;s official online documentation.</p><blockquote><p><em><strong><span style=color:salmon>Godot Docs:</span></strong></em><br><em><a href=https://docs.godotengine.org/en/stable/classes/class_navigationagent2d.html target=_blank>NavigationAgent2D</a></em></p></blockquote><ol><li>Check the &ldquo;Avoidance&rdquo; > &ldquo;Avoidance Enabled&rdquo; property to enable it. This controls collision avoidance with obstacles and enables path finding.</li><li>Set the &ldquo;Avoidance&rdquo; > &ldquo;Radius&rdquo; property to 8. This property is the size of this agent. We set the radius to 8 px to match the size of the texture on the &ldquo;Sprite&rdquo; node.</li><li>Set the &ldquo;Avoidance&rdquo; > &ldquo;Neighbor Dist&rdquo; property to 8. This property sets the distance at which other agents will be detected. Later we will create other object scenes that will automatically track the Player and add <strong>NavigationAgent2D</strong> nodes to them as well, but they will not need to be detected until they are right next to the Player, so we set this property to 8 as well as the agent&rsquo;s.</li><li>Set the &ldquo;Avoidance&rdquo; > &ldquo;Max Speed&rdquo; property to 40. This is the maximum movement speed of the agents.</li></ol><p><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img15.1.png alt="NavigationAgent2D node - properties"></p><br><h3 id=adding-an-instance-of-the-player-scene-to-the-world-scene>Adding an instance of the Player scene to the World scene</h3><p>Add an instance node of the &ldquo;Player.tscn&rdquo; scene created here to the &ldquo;World&rdquo; scene. It is OK if the scene dock of the &ldquo;World&rdquo; scene looks like the following.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img16.png alt="World scene - added Player node"></p><br><h3 id=attaching-and-editing-scripts-to-the-player-node>Attaching and editing scripts to the Player node</h3><p>After returning to the &ldquo;Player&rdquo; scene, attach a script to the &ldquo;Player&rdquo; root node and write the code. Create a script with the file path &ldquo;res://Scripts/Player.gd&rdquo;. When the script editor opens, write the following code.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1>###Player.gd###</span>
</span></span><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>KinematicBody2D</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Player speed</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=p>(</span><span class=kt>float</span><span class=p>)</span> <span class=kd>var</span> <span class=n>speed</span> <span class=o>=</span> <span class=mi>40</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Refer to the Line2D node in the World scene</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>line</span><span class=p>:</span> <span class=nc>Line2D</span> <span class=o>=</span> <span class=nf>get_node</span><span class=p>(</span><span class=s2>&#34;... /Line2D&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># Refer to the NavigationAgent2D node</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>nav_agent</span> <span class=o>=</span> <span class=nx>$NavigationAgent2D</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Built-in function called when a node is loaded into the scene tree</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># Set the current location as a temporary destination by NavigationAgent2D</span>
</span></span><span class=line><span class=cl>	<span class=n>nav_agent</span><span class=o>.</span><span class=nf>set_target_location</span><span class=p>(</span><span class=n>global_position</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Built-in physics process function called every frame</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_physics_process</span><span class=p>(</span><span class=n>delta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># If the last position of the found path has not been reached</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=ow>not</span> <span class=n>nav_agent</span><span class=o>.</span><span class=nf>is_navigation_finished</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=c1># Get the next navigable position without obstacles</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=n>next_loc</span> <span class=o>=</span> <span class=n>nav_agent</span><span class=o>.</span><span class=nf>get_next_location</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=c1># Get the current Player location</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=n>current_pos</span> <span class=o>=</span> <span class=n>global_position</span>
</span></span><span class=line><span class=cl>        <span class=c1># Calculate velocity from direction and speed for next possible location</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=n>velocity</span> <span class=o>=</span> <span class=n>current_pos</span><span class=o>.</span><span class=nf>direction_to</span><span class=p>(</span><span class=n>next_loc</span><span class=p>)</span> <span class=o>*</span> <span class=n>speed</span>
</span></span><span class=line><span class=cl>        <span class=c1># Pass velocity to NavigationAgent2D&#39;s collision avoidance algorithm</span>
</span></span><span class=line><span class=cl>        <span class=c1># send velocity_computed signal as soon as velocity adjustment is complete</span>
</span></span><span class=line><span class=cl>		<span class=n>nav_agent</span><span class=o>.</span><span class=nf>set_velocity</span><span class=p>(</span><span class=n>velocity</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># When the input map action move_to (left mouse button) is pressed</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nc>Input</span><span class=o>.</span><span class=nf>is_action_pressed</span><span class=p>(</span><span class=s2>&#34;move_to&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># call a method to start path finding</span>
</span></span><span class=line><span class=cl>		<span class=nf>find_path</span><span class=p>()</span> <span class=c1># Define after this</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Method to start path finding</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>find_path</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># Set the current mouse position as the next destination by NavigationAgent2D</span>
</span></span><span class=line><span class=cl>	<span class=n>nav_agent</span><span class=o>.</span><span class=nf>set_target_location</span><span class=p>(</span><span class=nf>get_global_mouse_position</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=c1># Get the next possible location to move to without obstacles</span>
</span></span><span class=line><span class=cl>	<span class=n>nav_agent</span><span class=o>.</span><span class=nf>get_next_location</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1># Pass the information of the path generated by NavigationAgent2D to the path of Line2D in the World scene</span>
</span></span><span class=line><span class=cl>    <span class=c1># Both data types are PoolVector2Array, so they can be passed as is</span>
</span></span><span class=line><span class=cl>	<span class=n>line</span><span class=o>.</span><span class=n>points</span> <span class=o>=</span> <span class=n>nav_agent</span><span class=o>.</span><span class=nf>get_nav_path</span><span class=p>()</span>
</span></span></code></pre></div><p>Now connect three different signals of the &ldquo;NavigationAgent2D&rdquo; node to this script.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img16.1.png alt="NavigationAgent2D - Signals"></p><p>The first one is the &ldquo;velocity_computed&rdquo; signal. This signal is sent when NavigationAgent2D has completed adjusting its velocity to avoid collisions with surrounding objects.</p><p>The second is the &ldquo;target_reached&rdquo; signal. This signal is sent out when the next moveable position on the path to the final destination is reached.</p><p>The third signal is &ldquo;navigation_finished. This signal is sent out when the final destination on the route is reached.</p><p>After connecting each signal to the script, write the necessary code in the generated method. The code is as follows.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1>###Player.gd###</span>
</span></span><span class=line><span class=cl><span class=c1># Called with a signal that is sent out when NavigationAgent2D has finished adjusting its velocity</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_NavigationAgent2D_velocity_computed</span><span class=p>(</span><span class=n>safe_velocity</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Apply the adjusted velocity to the Player&#39;s movement</span>
</span></span><span class=line><span class=cl>	<span class=nf>move_and_slide</span><span class=p>(</span><span class=n>safe_velocity</span><span class=p>)</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Called with a signal that is sent when the NavigationAgent2D reaches its next moveable position.</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_NavigationAgent2D_target_reached</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># On the path of a Line2D node in the World scene...</span>
</span></span><span class=line><span class=cl>    <span class=c1># reflect the updated path of the NavigationAgent2D</span>
</span></span><span class=line><span class=cl>	<span class=n>line</span><span class=o>.</span><span class=n>points</span> <span class=o>=</span> <span class=n>nav_agent</span><span class=o>.</span><span class=nf>get_nav_path</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Called with a signal that is sent out when NavigationAgent2D reaches the last destination in its path</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_NavigationAgent2D_navigation_finished</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># Reset the points of the path of the Line2D node in the World scene to 0</span>
</span></span><span class=line><span class=cl>	<span class=n>line</span><span class=o>.</span><span class=n>points</span><span class=o>.</span><span class=nf>resize</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span></code></pre></div><br><p>This completes the editing of the &ldquo;Player.gd&rdquo; script. At this point, try running the project once. If you are running the project for the first time, select &ldquo;res://Scenes/World.tscn&rdquo; as the main scene.</p><p>Let&rsquo;s click on the tile map appropriately and check if &ldquo;Player&rdquo; moves along the path search without any problem.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img17.gif alt="World scene - added Player node"></p><br><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h2 id=creating-an-animal-scene>Creating an Animal scene</h2><p>In the &ldquo;Player&rdquo; scene, we implemented path finding using the mouse position as the destination. From now on, we will implement path finding for another object that moves with the moving &ldquo;Player&rdquo; as its destination. However, there is no need to worry, since most of the work is the same.</p><p>Let&rsquo;s make multiple animal objects gather around the &ldquo;Player&rdquo; instance object we just created. We will now create an &ldquo;Animal&rdquo; scene for the animal objects.</p><h3 id=creating-a-new-animal-scene>Creating a new Animal scene</h3><ol><li>Select &ldquo;Scene&rdquo; menu > &ldquo;New Scene&rdquo;.</li><li>Select &ldquo;Other Node&rdquo; in &ldquo;Create Root Node&rdquo;.</li><li>When the root node of the &ldquo;KinematicBody2D&rdquo; class is created, rename it to &ldquo;Animal&rdquo;.</li><li>Save the scene. Create a folder and save the scene with the file path &ldquo;res://Scenes/Animal.tscn&rdquo;.</li></ol><h3 id=adding-and-editing-nodes-in-the-animal-scene>Adding and editing nodes in the Animal scene</h3><p>Add some nodes to the &ldquo;Animal&rdquo; root node and make the scene tree as follows.</p><ul><li>Animal(KinematicBody2D)<ul><li>Sprite</li><li>CollisionShape2D</li><li>NavigationAgent2D</li><li>PathTimer(Timer)<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img18.png alt="Animal scene - Scene Dock"></li></ul></li></ul><p>Then edit each node.<br><br></p><h4 id=sprite-node-1>Sprite node</h4><p>This node is used to give texture (appearance) to the &ldquo;Animal&rdquo; scene.</p><ol><li>In the inspector, apply the &ldquo;res://colored-transparent_packed.png&rdquo; resource downloaded from the KENNEY website to the &ldquo;Texture&rdquo; property.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img19.png alt="Sprite node - texture"></li><li>Enable the &ldquo;Region&rdquo; > &ldquo;Enabled&rdquo; property.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img20.png alt="Sprite node - Region - enabled"></li><li>Open the texture region panel at the bottom of the editor and select a region for the six animal textures.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img21.png alt="Sprite node - texture region pannel"></li><li>Set the value of the &ldquo;Animation&rdquo; > &ldquo;Hframes&rdquo; property to 6. Since the texture area selected earlier contains 6 types of animals, the value is set to be 1 frame for each type of animal. The default frame is set to 0 (first frame) in the &ldquo;Frame&rdquo; property.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img22.png alt="Sprite node - Animation - Hframes"></li></ol><br><h4 id=collisionshape2d-node-1>CollisionShape2D node</h4><p>This node sets the collision shape for the &ldquo;Animal&rdquo; root node of the KinematicBody2D class.</p><ol><li>Apply the &ldquo;New RectangleShape2D&rdquo; resource to the &ldquo;Shape&rdquo; property in the inspector.</li><li>Set the value of the &ldquo;Extents&rdquo; property of the applied &ldquo;RectangleShape2D&rdquo; resource to (x: 8, y: 8).<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img23.png alt="CollisionShape2D node - Shape - Extents"></li><li>On the 2D workspace it will look like this.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img24.png alt="CollisionShape2D node - 2D Workspace"></li></ol><br><h4 id=navigationagent2d-node-1>NavigationAgent2D node</h4><p>In the &ldquo;Animal&rdquo; scene, as in the &ldquo;Player&rdquo; scene, this node is used to avoid collisions with obstacles and to enable movement by path finding.</p><ol><li>Enable the &ldquo;Avoidance&rdquo; > &ldquo;Avoidance Enabled&rdquo; property.</li><li>Leave the &ldquo;Avoidance&rdquo; > &ldquo;Radius&rdquo; property at the default value of 10. The size of the texture is slightly larger than the size of the Sprite node&rsquo;s texture, so that the animals are slightly spaced apart.</li><li>The &ldquo;Avoidance&rdquo; > &ldquo;Neighbor Dist&rdquo; property was also left at the default value of 500. Since the width of the display size is set to 512 px, setting it to 500 will allow other agents to be detected from one end of the display to the other and avoid collisions. The goal is to reduce the number of instances of the &ldquo;Animal&rdquo; scene that will crowd around the &ldquo;Player&rdquo; instance and thus reduce the possibility of being stuck in the scene.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img25.png alt="NavigationAgent2D node - "></li></ol><br><h4 id=pathtimertimer-node>PathTimer(Timer) Node</h4><p>This node is used to periodically update the position of the moving destination (instance node of &ldquo;Player&rdquo;).</p><ol><li>The &ldquo;Wait Time&rdquo; property is left at the default value of 1.</li><li>The &ldquo;One Shot&rdquo; property should also be left at the default value of 1 and disabled. This will time out repeatedly every second.</li><li>Enable the &ldquo;Autostart&rdquo; property. The timer will now start automatically when this node is loaded into the scene tree.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img26.png alt="PathTimer node - Autostart"></li></ol><br><h3 id=attaching-and-editing-scripts-to-the-animal-node>Attaching and editing scripts to the &ldquo;Animal&rdquo; node</h3><p>From here, we will attach a script to the &ldquo;Animal&rdquo; root node and write code to control the &ldquo;Animal&rdquo; scene. Create a script with the file path &ldquo;res://Scripts/Animal.gd&rdquo;. When the script editor opens, code as follows.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1>###Animal.gd###</span>
</span></span><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>KinematicBody2D</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Speed of Animal</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>speed</span> <span class=o>=</span> <span class=mi>30</span>
</span></span><span class=line><span class=cl><span class=c1># Variable to assign the object that will be the destination of the route</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=n>target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Reference to the Sprite node</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>sprite</span> <span class=o>=</span> <span class=nx>$Sprite</span>
</span></span><span class=line><span class=cl><span class=c1># Reference to NavigationAgent2D</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>nav_agent</span> <span class=o>=</span> <span class=nx>$NavigationAgent2D</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Same as Player.gd below</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>nav_agent</span><span class=o>.</span><span class=nf>set_target_location</span><span class=p>(</span><span class=n>global_position</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_physics_process</span><span class=p>(</span><span class=n>_delta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=ow>not</span> <span class=n>nav_agent</span><span class=o>.</span><span class=nf>is_navigation_finished</span><span class=p>():</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=n>current_pos</span> <span class=o>=</span> <span class=n>global_position</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=n>next_loc</span> <span class=o>=</span> <span class=n>nav_agent</span><span class=o>.</span><span class=nf>get_next_location</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=n>velocity</span> <span class=o>=</span> <span class=n>current_pos</span><span class=o>.</span><span class=nf>direction_to</span><span class=p>(</span><span class=n>next_loc</span><span class=p>)</span> <span class=o>*</span> <span class=n>speed</span>
</span></span><span class=line><span class=cl>		<span class=n>nav_agent</span><span class=o>.</span><span class=nf>set_velocity</span><span class=p>(</span><span class=n>velocity</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># If the x-coordinate of the destination object is smaller than the x-coordinate of the animal node</span>
</span></span><span class=line><span class=cl>        <span class=c1># flip the Texture image of the Sprite node</span>
</span></span><span class=line><span class=cl>		<span class=n>sprite</span><span class=o>.</span><span class=n>flip_h</span> <span class=o>=</span> <span class=n>target</span><span class=o>.</span><span class=n>global_position</span><span class=o>.</span><span class=n>x</span> <span class=o>&lt;</span> <span class=n>global_position</span><span class=o>.</span><span class=n>x</span>
</span></span></code></pre></div><p><br><br>Two signals must then be connected to the script.</p><p>The first one is to connect the &ldquo;velocity_computed&rdquo; signal of the &ldquo;NavigationAgent2D&rdquo; node as in the &ldquo;Player&rdquo; scene.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img27.png alt="NavigationAgent2D - velocity_computed signal"></p><p>Once connected, write a <code>move_and_slide</code> method in the generated <code>_on_NavigationAgent2D_velocity_computed</code> method to control the movement of the &ldquo;Animal&rdquo; node.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1>###Animal.gd###</span>
</span></span><span class=line><span class=cl><span class=c1># Called with a signal that is sent out when NavigationAgent2D has finished adjusting its velocity</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_NavigationAgent2D_velocity_computed</span><span class=p>(</span><span class=n>safe_velocity</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Apply the adjusted velocity to the Player&#39;s movement</span>
</span></span><span class=line><span class=cl>	<span class=nf>move_and_slide</span><span class=p>(</span><span class=n>safe_velocity</span><span class=p>)</span>
</span></span></code></pre></div><br><p>The next step is to connect the &ldquo;timeout&rdquo; signal of the &ldquo;PathTimer&rdquo; node to the script.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img28.png alt="PathTimer - timeout signal"></p><p>Once connected, within the generated method <code>_on_PathTimer_timeout</code>, describe the <code>set_target_location</code> method of the &ldquo;NavigationAgent2D&rdquo; node to set the location of the destination object (in this case &ldquo;Player&rdquo;) as the destination during path finding. Now, at the time of timeout every second, the position of the latest &ldquo;Player&rdquo; instance node is acquired and the path finding is performed with that as the destination.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1>###Animal.gd###</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_on_PathTimer_timeout</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=n>nav_agent</span><span class=o>.</span><span class=nf>set_target_location</span><span class=p>(</span><span class=n>target</span><span class=o>.</span><span class=n>global_position</span><span class=p>)</span>
</span></span></code></pre></div><br><p>The &ldquo;Animal.gd&rdquo; script is now complete.</p><br><h3 id=adding-an-animals-node-to-the-world-scene>Adding an Animals node to the &ldquo;World&rdquo; scene</h3><ol><li>Add a node of class <strong>Node2D</strong> to the &ldquo;World&rdquo; scene as a container for multiple instances of the &ldquo;Animals&rdquo; scene and rename it to &ldquo;Animals&rdquo;. Adding instances of &ldquo;Animal&rdquo; will be done by script after this.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img29.png alt="World scene - Animals node"></li></ol><br><h3 id=attach-a-script-to-the-world-node-and-edit-it>Attach a script to the &ldquo;World&rdquo; node and edit it</h3><p>Attach a script to the &ldquo;World&rdquo; root node and edit it, adding multiple instances of &ldquo;Animal&rdquo;. Save the script with the file path as &ldquo;res://Scripts/World.gd&rdquo; and when the script editor opens, write the code as follows.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-GDScript data-lang=GDScript><span class=line><span class=cl><span class=c1>###World.gd###</span>
</span></span><span class=line><span class=cl><span class=kd>extends</span> <span class=nc>Node2D</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Reference to preloaded Animal scene file</span>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=n>animal_scn</span> <span class=o>=</span> <span class=nb>preload</span><span class=p>(</span><span class=s2>&#34;res://Scenes/Animal.tscn&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Number of Animal instances</span>
</span></span><span class=line><span class=cl><span class=n>export</span> <span class=p>(</span><span class=kt>int</span><span class=p>)</span> <span class=kd>var</span> <span class=n>head_count</span> <span class=o>=</span> <span class=mi>12</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Reference to TileMap node</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>tile_map</span> <span class=o>=</span> <span class=nx>$TileMap</span>
</span></span><span class=line><span class=cl><span class=c1># Reference to the Player node</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>player</span> <span class=o>=</span> <span class=nx>$Player</span>
</span></span><span class=line><span class=cl><span class=c1># Reference the Animals(Node2D) node</span>
</span></span><span class=line><span class=cl><span class=n>onready</span> <span class=kd>var</span> <span class=n>animals</span> <span class=o>=</span> <span class=nx>$Animals</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>_ready</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># Randomize seed for random number generation function</span>
</span></span><span class=line><span class=cl>	<span class=nb>randomize</span><span class=p>()</span><span class=o>.</span>
</span></span><span class=line><span class=cl>    <span class=c1># Get an array of ID 9 tiles on the TileMap</span>
</span></span><span class=line><span class=cl>    <span class=c1># IDs can be found by clicking the (i) icon in the tileset panel edit screen</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=n>cells</span> <span class=o>=</span> <span class=n>tile_map</span><span class=o>.</span><span class=nf>get_used_cells_by_id</span><span class=p>(</span><span class=mi>9</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># Loop for the number of Animal instances</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>head_count</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># Get random index within the number of tiles with ID 9</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=n>random_index</span> <span class=o>=</span> <span class=nb>randi</span><span class=p>()</span> <span class=o>%</span> <span class=n>cells</span><span class=o>.</span><span class=nf>size</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=c1># Get a tile from the ID 9 tiles that fits the random value</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=n>spawn_tile</span> <span class=o>=</span> <span class=n>cells</span><span class=o>.</span><span class=nf>pop_at</span><span class=p>(</span><span class=n>random_index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># loop if the tile has already been spawned from the array and the array is not yet empty</span>
</span></span><span class=line><span class=cl>		<span class=k>while</span> <span class=n>spawn_tile</span> <span class=o>==</span> <span class=kt>null</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>cells</span><span class=o>.</span><span class=nf>empty</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=c1># Generate a random value within the range of the number of ID9 liles again</span>
</span></span><span class=line><span class=cl>			<span class=n>random_index</span> <span class=o>=</span> <span class=nb>randi</span><span class=p>()</span> <span class=o>%</span> <span class=n>cells</span><span class=o>.</span><span class=nf>size</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=c1># Spawn a tile from the ID9 tiles again that fits the random value</span>
</span></span><span class=line><span class=cl>			<span class=n>spawn_tile</span> <span class=o>=</span> <span class=n>cells</span><span class=o>.</span><span class=nf>pop_at</span><span class=p>(</span><span class=n>random_index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># Place an Animal instance on the acquired tile...</span>
</span></span><span class=line><span class=cl>        <span class=c1># by calling a method to create an Animal instance</span>
</span></span><span class=line><span class=cl>		<span class=nf>spawn_animal</span><span class=p>(</span><span class=n>spawn_tile</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># method to spawn Animal instance</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>spawn_animal</span><span class=p>(</span><span class=n>spawn_tile</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Get the position of the tile passed as argument, shifted by (8, 8) to the x,y coordinates of the tile</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=n>spawn_pos</span> <span class=o>=</span> <span class=n>tile_map</span><span class=o>.</span><span class=nf>map_to_world</span><span class=p>(</span><span class=n>spawn_tile</span><span class=p>,</span> <span class=kc>true</span><span class=p>)</span> <span class=o>+</span> <span class=nc>Vector2</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># Create an instance of the Animal scene</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=n>animal</span> <span class=o>=</span> <span class=n>animal_scn</span><span class=o>.</span><span class=nf>instance</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1># Position the Animal instance on the tile passed as argument</span>
</span></span><span class=line><span class=cl>	<span class=n>animal</span><span class=o>.</span><span class=n>position</span> <span class=o>=</span> <span class=n>spawn_pos</span>
</span></span><span class=line><span class=cl>    <span class=c1># Assign and reference the Player node to the destination property of the Animal instance</span>
</span></span><span class=line><span class=cl>	<span class=n>animal</span><span class=o>.</span><span class=n>target</span> <span class=o>=</span> <span class=n>player</span><span class=o>.</span><span class=n>global_position</span>
</span></span><span class=line><span class=cl>    <span class=c1># Randomly determine the texture of the Sprite node of the Animal instance</span>
</span></span><span class=line><span class=cl>	<span class=n>animal</span><span class=o>.</span><span class=nf>get_node</span><span class=p>(</span><span class=s2>&#34;Sprite&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>frame</span> <span class=o>=</span> <span class=nb>randi</span><span class=p>()</span> <span class=o>%</span> <span class=n>animal</span><span class=o>.</span><span class=nf>get_node</span><span class=p>(</span><span class=s2>&#34;Sprite&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>hframes</span>
</span></span><span class=line><span class=cl>    <span class=c1># Make the Animal instance a child of the Animals node</span>
</span></span><span class=line><span class=cl>	<span class=n>animals</span><span class=o>.</span><span class=nf>add_child</span><span class=p>(</span><span class=n>animal</span><span class=p>)</span>
</span></span></code></pre></div><br><p>The &ldquo;World.gd&rdquo; script is now complete. Let&rsquo;s run the project and see how multiple instances of &ldquo;Animal&rdquo; approach &ldquo;Player&rdquo;.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img30.gif alt="run project"></p><p>The number of <code>head_count</code> properties defined in the script can be easily edited in the inspector, since it comes with the <code>export</code> keyword. I increased the number of &ldquo;Animal&rdquo; instances to 100 as a test, but it got stuck at the end. If &ldquo;Animal&rdquo; were a zombie, it would be a hellish scene.<br><img loading=lazy src=/images/tutorials/gd0016_2d_path_finding/img31.gif alt="run project"></p><br><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h2 id=sample-game>Sample game</h2><p>I have prepared a sample game that further brushes up the project created in this tutorial.</p><p><div><video controls autoplay loop muted playsinline aria-label='Sample game demo' style=zgotmplz>
<source src=/images/tutorials/gd0016_2d_path_finding/img32.mp4 type=video/mp4>Your browser does not support the video tag.</video></div><br><br></p><p>The project file of the sample game is located in <a href=https://github.com/msnsk/2DPathFinding.git target=_blank>GitHub repository</a>
, so please download the .zip file from there. You can check it by importing the &ldquo;project.godot&rdquo; file in the &ldquo;Sample&rdquo; folder with the Godot Engine.<br><br></p><h4 id=game-rules>Game Rules:</h4><ul><li>Left mouse click to move to the mouse cursor position</li><li>Spacebar to shoot the gun in the direction of the mouse cursor.</li><li>When you run out of bullets, reload 12 bullets after reloading animation.</li><li>When you hit an enemy, you lose a heart.</li><li>When you run out of all 5 hearts, the game is over.</li><li>The darker the color of an enemy, the more lives it has and the slower its speed is. The lighter the color, the less lives it has and the faster its speed is.</li><li>The player&rsquo;s score is the number of jewels that dropped when an enemy is defeated.</li></ul><br><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><h2 id=conclusion>Conclusion</h2><p>In this tutorial, we implemented the new <strong>Navigation Server</strong> added in Godot 3.5.</p><p>For a simple 2D route search like this one, it was relatively easy to implement using <strong>NavigationAgent2D</strong>, although there are still some itchy points, such as the problem of getting caught in a corner when using a TileMap without a margin tile. However, we hope that this will be improved in future updates.</p><p>Let me summarize the key points of this project.</p><ul><li>When using TileMap, be sure to set navigation to movable tiles.</li><li>When using TileMap, make a margin with tiles that are set only in the area so that they do not get caught in corners.</li><li>You can also define a navigation area using the <strong>NavigationPolygonInstance</strong> node, which we did not use in this case.</li><li>Adding a &ldquo;NavigationAgent2D&rdquo; node to the child of the object you want to move.</li><li>When controlling path finding in scripts, write the code with the following order in mind: set the final destination, obtain the next possible moving position, adjust the speed to avoid collision, and move at the adjusted speed.</li></ul><hr><h2 id=references>References</h2><ul><li><a href=https://godotengine.org/article/navigation-server-godot-4-0 target=_blank>Official Article - Navigation Server for Godot 4.0</a></li><li><a href=https://godotengine.org/article/godot-3-5-cant-stop-wont-stop target=_blank>Official Article - Godot 3.5: Can't stop won't stop</a></li><li><a href=https://docs.godotengine.org/en/stable/classes/class_navigationagent2d.html target=_blank>Godot Doc - NavigationAgent2D</a></li><li><a href=https://youtu.be/xdih_csmVqk target=_blank>YouTube - Godot 3.5 | NavigationAgent2D</a></li><li><a href=https://youtu.be/NjIJm2jax68 target=_blank>YouTube - Godot 3.5 is Out, and it's SICK! Real-time pathfinding, new tween animations, and more</a></li><li><a href=https://github.com/godotengine/godot/issues/60546 target=_blank>GitHub - godotengine/godot - issue #60546</a></li></ul><hr><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901" crossorigin=anonymous></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-4952908839423901 data-ad-slot=9419515863></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer class=post-footer><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share ğŸ¤– 2D Path Finding in Godot3 on x" href="https://x.com/intent/tweet/?text=%f0%9f%a4%96%202D%20Path%20Finding%20in%20Godot3&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fen%2ftutorials%2fgd0016_2d_path_finding%2f&amp;hashtags=GameDev%2cGodotEngine%2cGodot3%2c2D%2cPathFinding"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share ğŸ¤– 2D Path Finding in Godot3 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.peanuts-code.com%2fen%2ftutorials%2fgd0016_2d_path_finding%2f&title=%f0%9f%a4%96%202D%20Path%20Finding%20in%20Godot3"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share ğŸ¤– 2D Path Finding in Godot3 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.peanuts-code.com%2fen%2ftutorials%2fgd0016_2d_path_finding%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li></ul><ul class=post-tags><li><a href=https://www.peanuts-code.com/en/tags/gamedev/>GameDev</a></li><li><a href=https://www.peanuts-code.com/en/tags/godotengine/>GodotEngine</a></li><li><a href=https://www.peanuts-code.com/en/tags/godot3/>Godot3</a></li><li><a href=https://www.peanuts-code.com/en/tags/2d/>2D</a></li><li><a href=https://www.peanuts-code.com/en/tags/pathfinding/>PathFinding</a></li></ul><nav class=paginav><a class=prev href=https://www.peanuts-code.com/en/posts/post0004_my_first_game_jam/><span class=title>Â« Prev</span><br><span>ğŸ“” Grow with game jams</span>
</a><a class=next href=https://www.peanuts-code.com/en/tutorials/gd0015_circular_progress_bar/><span class=title>Next Â»</span><br><span>ğŸ¤– Circular Progress Bar in Godot3</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://www.peanuts-code.com/en/>Peanuts Code</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>