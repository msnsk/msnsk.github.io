<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>2D Path Finding in Godot | Peanuts Code</title>
<meta name="keywords" content="GameDev, GodotEngine, Godot3, 2D, PathFinding" />
<meta name="description" content="This tutorial introduces Path Finding in 2D games. Path finding is a function that determines the shortest possible path from an object to its destination, for example, when moving an object to a certain destination. Up to Godot 3.4, the Navigation node was used to implement path finding. This was not particularly inconvenient, but the methodology for game development using it was limited and inapplicable in some areas. This time, I would like to introduce an implementation method using Navigation Server, which was added to Godot 3.5. This is a backport from Godot 4, which is currently under active development.">
<meta name="author" content="Gobo">
<link rel="canonical" href="https://www.peanuts-code.com/en/tutorials/gd0016_2d_path_finding/" />
<meta name="google-site-verification" content="XYZabc" />
<meta name="yandex-verification" content="XYZabc" />
<meta name="msvalidate.01" content="XYZabc" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.css" rel="preload stylesheet" as="style">
<link rel="preload" href="/images/logomark.png" as="image">
<link rel="icon" href="https://www.peanuts-code.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.peanuts-code.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.peanuts-code.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://www.peanuts-code.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://www.peanuts-code.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.102.3" />
<link rel="alternate" hreflang="ja" href="https://www.peanuts-code.com/ja/tutorials/gd0016_2d_path_finding/" />
<link rel="alternate" hreflang="en" href="https://www.peanuts-code.com/en/tutorials/gd0016_2d_path_finding/" />

<script async src="https://www.googletagmanager.com/gtag/js?id=G-DK0NK2RTTW"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-DK0NK2RTTW', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="2D Path Finding in Godot" />
<meta property="og:description" content="This tutorial introduces Path Finding in 2D games. Path finding is a function that determines the shortest possible path from an object to its destination, for example, when moving an object to a certain destination. Up to Godot 3.4, the Navigation node was used to implement path finding. This was not particularly inconvenient, but the methodology for game development using it was limited and inapplicable in some areas. This time, I would like to introduce an implementation method using Navigation Server, which was added to Godot 3.5. This is a backport from Godot 4, which is currently under active development." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.peanuts-code.com/en/tutorials/gd0016_2d_path_finding/" />
<meta property="og:image" content="https://www.peanuts-code.com/images/tutorials/gd0016_2d_path_finding/img0.gif" /><meta property="article:section" content="tutorials" />
<meta property="article:published_time" content="2022-08-16T23:10:00&#43;09:00" />
<meta property="article:modified_time" content="2022-08-16T23:10:00&#43;09:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://www.peanuts-code.com/images/tutorials/gd0016_2d_path_finding/img0.gif" />
<meta name="twitter:title" content="2D Path Finding in Godot"/>
<meta name="twitter:description" content="This tutorial introduces Path Finding in 2D games. Path finding is a function that determines the shortest possible path from an object to its destination, for example, when moving an object to a certain destination. Up to Godot 3.4, the Navigation node was used to implement path finding. This was not particularly inconvenient, but the methodology for game development using it was limited and inapplicable in some areas. This time, I would like to introduce an implementation method using Navigation Server, which was added to Godot 3.5. This is a backport from Godot 4, which is currently under active development."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Tutorials",
      "item": "https://www.peanuts-code.com/en/tutorials/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "2D Path Finding in Godot",
      "item": "https://www.peanuts-code.com/en/tutorials/gd0016_2d_path_finding/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "2D Path Finding in Godot",
  "name": "2D Path Finding in Godot",
  "description": "This tutorial introduces Path Finding in 2D games. Path finding is a function that determines the shortest possible path from an object to its destination, for example, when moving an object to a certain destination. Up to Godot 3.4, the Navigation node was used to implement path finding. This was not particularly inconvenient, but the methodology for game development using it was limited and inapplicable in some areas. This time, I would like to introduce an implementation method using Navigation Server, which was added to Godot 3.5. This is a backport from Godot 4, which is currently under active development.",
  "keywords": [
    "GameDev", "GodotEngine", "Godot3", "2D", "PathFinding"
  ],
  "articleBody": "This tutorial introduces Path Finding in 2D games. Path finding is a function that determines the shortest possible path from an object to its destination, for example, when moving an object to a certain destination.\nUp to Godot 3.4, the Navigation node was used to implement path finding. This was not particularly inconvenient, but the methodology for game development using it was limited and inapplicable in some areas. This time, I would like to introduce an implementation method using Navigation Server, which was added to Godot 3.5. This is a backport from Godot 4, which is currently under active development. This article is intended for users of Godot 3.5 or later. Users of Godot version 3.4 or earlier should take note.\nThe final project file for this tutorial is available at GitHub repository . You can also check the project directly by downloading the .zip file and importing the “project.godot” file in the “End” folder with the Godot Engine.\nEnvironment Godot version: 3.5\nComputer OS: macOS 11.6.5\nBasic Articles You may also find the following articles useful.\nDownloading Godot Project Manager of Godot Preparation Creating a new project Start Godot Engine and create a new project. You can name your project as you like. If you can’t think of one, let’s call it “2D Path Finding Start”.\nUpdating project settings Once the editor appears, we should update project settings for the entire project.\nFirst, set the display size for the game.\nOpen the “Project” menu \u003e “Project Settings\nSelect “Display” \u003e “Window” from the sidebar of the “General” tab. In the “Size” section, change the values of the following items. Width: 512 Height: 320 Test Width: 768 Test Height: 480 In the “Stretch” section, change the values of the following items Mode: 2d Aspect: keep Switch to the “Input Map” tab and add “move_to” to the action. Assign the “left mouse button” to the “move_to” action.\nDownloading and importing assets Next, let’s download assets from KENNEY’s site and use them. The asset pack we will use is called 1-Bit Pack . I can’t help but be thankful for this wonderful free material.\nOnce downloaded, drag and drop the “colored-transparent_packed.png” file from the “Tilesheet” folder into the editor’s file system dock to import it into your project.\nImmediately after importing the file, the image will look blurry, so correct this by following the steps below.\nMake the imported asset file selected in the file system dock. Select “Preset” \u003e “2D Pixel” in the import dock.\nClick the “Re-import” button at the bottom.\nThe image should now have the edges characteristic of pixel art. The imported tileset will be used later for tile maps and player character textures.\nCreating a World scene Creating a new World scene The first step is to create a “World” scene to prepare the game world. 1. Select “Scene” menu \u003e “New Scene”.\nSelect “Other Node” in “Generate Root Node”. When the root node of the “Node2D” class is generated, rename it to “World”. Save the scene. Create a folder and save the scene with the file path “res://Scene/World.tscn”. Adding and editing a TileMap node Adding a “TileMap” node to the “World” root node.\nIn the inspector, apply the “New TileSet” resource to the “TileSet” property of the “TileMap” node.\nClick on the applied “TileSet” resource to open the TileSet panel at the bottom of the editor.\nAdd imported KENNEY “res://colored-transparent_packed.png” resource file by dragging it to the left sidebar of the TileSet panel.\nSelect the added texture sheet and prepare the following three single tiles.\nTile for the character’s pathway.\n*Tiles with this navigation area set are the target of the pathfinding. Use gravel tiles Collision polygon: not required Navigation polygon: Needed Tiles that characters do not pass through but do not collide with each other.\n*Use as a margin so that the character does not get caught by tree tiles with collision geometry when moving along the path. Use grass texture Collision polygons: not needed Navigation polygons: not needed Tiles that characters cannot pass through and have collision detection.\n*Use as impassable obstacles during path finding. Use tree texture Collision polygon: Needed Navigation polygons: not required Select “TileMap” in the scene dock and create a tile map on the 2D workspace. Below is a sample. It is OK if the gravel tiles provide some pathways (navigation areas).\nIt is important to note, however, that once you place the tree tiles for obstacles, be sure to place the grass tiles for margins around them. Otherwise, the character will try to pass right through the wooden tiles when moving along the path, and will get stuck and not be able to move. This is something I would like to see improved in future Godot updates. I haven’t implemented the character yet, but I’ll show you how it behaves first.\nAdding and editing the Line2D node The “Line2D” node is used to make the explored and determined path visually clear.\nAdd a “Line2D” node to the “World” root node.\nIn the inspector, set the “Width” property of the “Line2D” node to.\nCreating a Player scene From here, we will create a scene for the player character to move along the found path.\nCreating a new Player scene Select “Scene” menu \u003e “New Scene”. Select “Other Node” in “Generate Root Node”. When the root node of the “KinematicBody2D” class is created, rename it to “Player”. Save the scene. Create a folder and save the scene with the file path “res://Scenes/Player.tscn”. Adding and editing nodes to the Player scene Add nodes to the “Player” root node to make the scene tree look like this.\nPlayer(KinematicBody2D) Sprite CollisionShape2D NavigationAgent2D Each node is then edited.\nSprite node This node is used to apply texture (appearance) to the “Player” scene.\nIn the inspector, apply the “res://colored-transparent_packed.png” resource downloaded from KENNEY’s site to the “Texture” property.\nEnable the “Region” \u003e “Enabled” property.\nOpen the Texture Region panel at the bottom of the editor and select the region of the player character texture of your choice. For this tutorial, we used a sheriff-like texture.\nCollisionShape2D node This node sets the collision shape for the “Player” root node of the KinematicBody2D class.\nApply a new “RectangleShape2D” resource to the “Shape” property in the inspector. Set the value of the “Extents” property of the applied “RectangleShape2D” resource to (x: 6, y: 6).\nOn the 2D workspace it will look like this.\nNavigationAgent2D node This node was introduced in Godot 3.5 as a backported node from Godot 4. A parent node (in this case, the “Player” node) adding this node to its children will automatically avoid collisions with obstacles and will be able to move by path finding. It seems to be controlled by being registered in the navigation map of the default World2D. For more details, please refer to Godot’s official online documentation.\nGodot Docs: NavigationAgent2D Check the “Avoidance” \u003e “Avoidance Enabled” property to enable it. This controls collision avoidance with obstacles and enables path finding. Set the “Avoidance” \u003e “Radius” property to 8. This property is the size of this agent. We set the radius to 8 px to match the size of the texture on the “Sprite” node. Set the “Avoidance” \u003e “Neighbor Dist” property to 8. This property sets the distance at which other agents will be detected. Later we will create other object scenes that will automatically track the Player and add NavigationAgent2D nodes to them as well, but they will not need to be detected until they are right next to the Player, so we set this property to 8 as well as the agent’s. Set the “Avoidance” \u003e “Max Speed” property to 40. This is the maximum movement speed of the agents. Adding an instance of the Player scene to the World scene Add an instance node of the “Player.tscn” scene created here to the “World” scene. It is OK if the scene dock of the “World” scene looks like the following.\nAttaching and editing scripts to the Player node After returning to the “Player” scene, attach a script to the “Player” root node and write the code. Create a script with the file path “res://Scripts/Player.gd”. When the script editor opens, write the following code.\n###Player.gd### extends KinematicBody2D # Player speed export (float) var speed = 40 # Refer to the Line2D node in the World scene onready var line: Line2D = get_node(\"... /Line2D\") # Refer to the NavigationAgent2D node onready var nav_agent = $NavigationAgent2D # Built-in function called when a node is loaded into the scene tree func _ready(): # Set the current location as a temporary destination by NavigationAgent2D nav_agent.set_target_location(global_position) # Built-in physics process function called every frame func _physics_process(delta): # If the last position of the found path has not been reached if not nav_agent.is_navigation_finished(): # Get the next navigable position without obstacles var next_loc = nav_agent.get_next_location() # Get the current Player location var current_pos = global_position # Calculate velocity from direction and speed for next possible location var velocity = current_pos.direction_to(next_loc) * speed # Pass velocity to NavigationAgent2D's collision avoidance algorithm # send velocity_computed signal as soon as velocity adjustment is complete nav_agent.set_velocity(velocity) # When the input map action move_to (left mouse button) is pressed if Input.is_action_pressed(\"move_to\"): # call a method to start path finding find_path() # Define after this # Method to start path finding func find_path(): # Set the current mouse position as the next destination by NavigationAgent2D nav_agent.set_target_location(get_global_mouse_position()) # Get the next possible location to move to without obstacles nav_agent.get_next_location() # Pass the information of the path generated by NavigationAgent2D to the path of Line2D in the World scene # Both data types are PoolVector2Array, so they can be passed as is line.points = nav_agent.get_nav_path() Now connect three different signals of the “NavigationAgent2D” node to this script.\nThe first one is the “velocity_computed” signal. This signal is sent when NavigationAgent2D has completed adjusting its velocity to avoid collisions with surrounding objects.\nThe second is the “target_reached” signal. This signal is sent out when the next moveable position on the path to the final destination is reached.\nThe third signal is “navigation_finished. This signal is sent out when the final destination on the route is reached.\nAfter connecting each signal to the script, write the necessary code in the generated method. The code is as follows.\n###Player.gd### # Called with a signal that is sent out when NavigationAgent2D has finished adjusting its velocity func _on_NavigationAgent2D_velocity_computed(safe_velocity): # Apply the adjusted velocity to the Player's movement move_and_slide(safe_velocity). # Called with a signal that is sent when the NavigationAgent2D reaches its next moveable position. func _on_NavigationAgent2D_target_reached(): # On the path of a Line2D node in the World scene... # reflect the updated path of the NavigationAgent2D line.points = nav_agent.get_nav_path() # Called with a signal that is sent out when NavigationAgent2D reaches the last destination in its path func _on_NavigationAgent2D_navigation_finished(): # Reset the points of the path of the Line2D node in the World scene to 0 line.points.resize(0) This completes the editing of the “Player.gd” script. At this point, try running the project once. If you are running the project for the first time, select “res://Scenes/World.tscn” as the main scene.\nLet’s click on the tile map appropriately and check if “Player” moves along the path search without any problem.\nCreating an Animal scene In the “Player” scene, we implemented path finding using the mouse position as the destination. From now on, we will implement path finding for another object that moves with the moving “Player” as its destination. However, there is no need to worry, since most of the work is the same.\nLet’s make multiple animal objects gather around the “Player” instance object we just created. We will now create an “Animal” scene for the animal objects.\nCreating a new Animal scene Select “Scene” menu \u003e “New Scene”. Select “Other Node” in “Create Root Node”. When the root node of the “KinematicBody2D” class is created, rename it to “Animal”. Save the scene. Create a folder and save the scene with the file path “res://Scenes/Animal.tscn”. Adding and editing nodes in the Animal scene Add some nodes to the “Animal” root node and make the scene tree as follows.\nAnimal(KinematicBody2D) Sprite CollisionShape2D NavigationAgent2D PathTimer(Timer)\nThen edit each node.\nSprite node This node is used to give texture (appearance) to the “Animal” scene.\nIn the inspector, apply the “res://colored-transparent_packed.png” resource downloaded from the KENNEY website to the “Texture” property.\nEnable the “Region” \u003e “Enabled” property.\nOpen the texture region panel at the bottom of the editor and select a region for the six animal textures.\nSet the value of the “Animation” \u003e “Hframes” property to 6. Since the texture area selected earlier contains 6 types of animals, the value is set to be 1 frame for each type of animal. The default frame is set to 0 (first frame) in the “Frame” property.\nCollisionShape2D node This node sets the collision shape for the “Animal” root node of the KinematicBody2D class.\nApply the “New RectangleShape2D” resource to the “Shape” property in the inspector. Set the value of the “Extents” property of the applied “RectangleShape2D” resource to (x: 8, y: 8).\nOn the 2D workspace it will look like this.\nNavigationAgent2D node In the “Animal” scene, as in the “Player” scene, this node is used to avoid collisions with obstacles and to enable movement by path finding.\nEnable the “Avoidance” \u003e “Avoidance Enabled” property. Leave the “Avoidance” \u003e “Radius” property at the default value of 10. The size of the texture is slightly larger than the size of the Sprite node’s texture, so that the animals are slightly spaced apart. The “Avoidance” \u003e “Neighbor Dist” property was also left at the default value of 500. Since the width of the display size is set to 512 px, setting it to 500 will allow other agents to be detected from one end of the display to the other and avoid collisions. The goal is to reduce the number of instances of the “Animal” scene that will crowd around the “Player” instance and thus reduce the possibility of being stuck in the scene.\nPathTimer(Timer) Node This node is used to periodically update the position of the moving destination (instance node of “Player”).\nThe “Wait Time” property is left at the default value of 1. The “One Shot” property should also be left at the default value of 1 and disabled. This will time out repeatedly every second. Enable the “Autostart” property. The timer will now start automatically when this node is loaded into the scene tree.\nAttaching and editing scripts to the “Animal” node From here, we will attach a script to the “Animal” root node and write code to control the “Animal” scene. Create a script with the file path “res://Scripts/Animal.gd”. When the script editor opens, code as follows.\n###Animal.gd### extends KinematicBody2D # Speed of Animal var speed = 30 # Variable to assign the object that will be the destination of the route var target # Reference to the Sprite node onready var sprite = $Sprite # Reference to NavigationAgent2D onready var nav_agent = $NavigationAgent2D # Same as Player.gd below func _ready(): nav_agent.set_target_location(global_position) func _physics_process(_delta): if not nav_agent.is_navigation_finished(): var current_pos = global_position var next_loc = nav_agent.get_next_location() var velocity = current_pos.direction_to(next_loc) * speed nav_agent.set_velocity(velocity) # If the x-coordinate of the destination object is smaller than the x-coordinate of the animal node # flip the Texture image of the Sprite node sprite.flip_h = target.global_position.x \u003c global_position.x Two signals must then be connected to the script. The first one is to connect the “velocity_computed” signal of the “NavigationAgent2D” node as in the “Player” scene.\nOnce connected, write a move_and_slide method in the generated _on_NavigationAgent2D_velocity_computed method to control the movement of the “Animal” node.\n###Animal.gd### # Called with a signal that is sent out when NavigationAgent2D has finished adjusting its velocity func _on_NavigationAgent2D_velocity_computed(safe_velocity): # Apply the adjusted velocity to the Player's movement move_and_slide(safe_velocity) The next step is to connect the “timeout” signal of the “PathTimer” node to the script.\nOnce connected, within the generated method _on_PathTimer_timeout, describe the set_target_location method of the “NavigationAgent2D” node to set the location of the destination object (in this case “Player”) as the destination during path finding. Now, at the time of timeout every second, the position of the latest “Player” instance node is acquired and the path finding is performed with that as the destination.\n###Animal.gd### func _on_PathTimer_timeout(): nav_agent.set_target_location(target.global_position) The “Animal.gd” script is now complete.\nAdding an Animals node to the “World” scene Add a node of class Node2D to the “World” scene as a container for multiple instances of the “Animals” scene and rename it to “Animals”. Adding instances of “Animal” will be done by script after this.\nAttach a script to the “World” node and edit it Attach a script to the “World” root node and edit it, adding multiple instances of “Animal”. Save the script with the file path as “res://Scripts/World.gd” and when the script editor opens, write the code as follows.\n###World.gd### extends Node2D # Reference to preloaded Animal scene file const animal_scn = preload(\"res://Scenes/Animal.tscn\") # Number of Animal instances export (int) var head_count = 12 # Reference to TileMap node onready var tile_map = $TileMap # Reference to the Player node onready var player = $Player # Reference the Animals(Node2D) node onready var animals = $Animals func _ready(): # Randomize seed for random number generation function randomize(). # Get an array of ID 9 tiles on the TileMap # IDs can be found by clicking the (i) icon in the tileset panel edit screen var cells = tile_map.get_used_cells_by_id(9) # Loop for the number of Animal instances for i in head_count : # Get random index within the number of tiles with ID 9 var random_index = randi() % cells.size() # Get a tile from the ID 9 tiles that fits the random value var spawn_tile = cells.pop_at(random_index) # loop if the tile has already been spawned from the array and the array is not yet empty while spawn_tile == null and not cells.empty(): # Generate a random value within the range of the number of ID9 liles again random_index = randi() % cells.size() # Spawn a tile from the ID9 tiles again that fits the random value spawn_tile = cells.pop_at(random_index) # Place an Animal instance on the acquired tile... # by calling a method to create an Animal instance spawn_animal(spawn_tile) # method to spawn Animal instance func spawn_animal(spawn_tile): # Get the position of the tile passed as argument, shifted by (8, 8) to the x,y coordinates of the tile var spawn_pos = tile_map.map_to_world(spawn_tile, true) + Vector2(8, 8) # Create an instance of the Animal scene var animal = animal_scn.instance() # Position the Animal instance on the tile passed as argument animal.position = spawn_pos # Assign and reference the Player node to the destination property of the Animal instance animal.target = player.global_position # Randomly determine the texture of the Sprite node of the Animal instance animal.get_node(\"Sprite\").frame = randi() % animal.get_node(\"Sprite\").hframes # Make the Animal instance a child of the Animals node animals.add_child(animal) The “World.gd” script is now complete. Let’s run the project and see how multiple instances of “Animal” approach “Player”.\nThe number of head_count properties defined in the script can be easily edited in the inspector, since it comes with the export keyword. I increased the number of “Animal” instances to 100 as a test, but it got stuck at the end. If “Animal” were a zombie, it would be a hellish scene.\nSample game I have prepared a sample game that further brushes up the project created in this tutorial.\nYour browser does not support the video tag. The project file of the sample game is located in GitHub repository , so please download the .zip file from there. You can check it by importing the “project.godot” file in the “Sample” folder with the Godot Engine.\nGame Rules: Left mouse click to move to the mouse cursor position Spacebar to shoot the gun in the direction of the mouse cursor. When you run out of bullets, reload 12 bullets after reloading animation. When you hit an enemy, you lose a heart. When you run out of all 5 hearts, the game is over. The darker the color of an enemy, the more lives it has and the slower its speed is. The lighter the color, the less lives it has and the faster its speed is. The player’s score is the number of jewels that dropped when an enemy is defeated. Conclusion In this tutorial, we implemented the new Navigation Server added in Godot 3.5.\nFor a simple 2D route search like this one, it was relatively easy to implement using NavigationAgent2D, although there are still some itchy points, such as the problem of getting caught in a corner when using a TileMap without a margin tile. However, we hope that this will be improved in future updates.\nLet me summarize the key points of this project.\nWhen using TileMap, be sure to set navigation to movable tiles. When using TileMap, make a margin with tiles that are set only in the area so that they do not get caught in corners. You can also define a navigation area using the NavigationPolygonInstance node, which we did not use in this case. Adding a “NavigationAgent2D” node to the child of the object you want to move. When controlling path finding in scripts, write the code with the following order in mind: set the final destination, obtain the next possible moving position, adjust the speed to avoid collision, and move at the adjusted speed. References Official Article - Navigation Server for Godot 4.0 Official Article - Godot 3.5: Can't stop won't stop Godot Doc - NavigationAgent2D YouTube - Godot 3.5 | NavigationAgent2D YouTube - Godot 3.5 is Out, and it's SICK! Real-time pathfinding, new tween animations, and more GitHub - godotengine/godot - issue #60546 ",
  "wordCount" : "3627",
  "inLanguage": "en",
  "image":"https://www.peanuts-code.com/images/tutorials/gd0016_2d_path_finding/img0.gif","datePublished": "2022-08-16T23:10:00+09:00",
  "dateModified": "2022-08-16T23:10:00+09:00",
  "author":{
    "@type": "Person",
    "name": "Gobo"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.peanuts-code.com/en/tutorials/gd0016_2d_path_finding/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Peanuts Code",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.peanuts-code.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.peanuts-code.com/en/" accesskey="h" title="Peanuts Code (Alt + H)">
                <img src="/images/logomark.png" alt="logo" aria-label="logo"
                    height="35">Peanuts Code</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://www.peanuts-code.com/ja/" title="日本語"
                            aria-label="日本語">Ja</a>
                    </li>
                </ul>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.peanuts-code.com/en/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/en/posts/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/en/tutorials/" title="Tutorials">
                    <span>Tutorials</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/en/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://www.peanuts-code.com/en/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://www.peanuts-code.com/en/">Home</a>&nbsp;»&nbsp;<a href="https://www.peanuts-code.com/en/tutorials/">Tutorials</a></div>
    <h1 class="post-title">
      2D Path Finding in Godot
    </h1>
    <div class="post-meta">2022-08-16&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Gobo&nbsp;|&nbsp;
<ul class="i18n_list">Translations:
    <li>
        <a href="https://www.peanuts-code.com/ja/tutorials/gd0016_2d_path_finding/">Ja</a>
    </li>
</ul>
</div>
    
    <ul class="post-tags">
      <li><a href="https://www.peanuts-code.com/en/tags/gamedev/">GameDev</a></li>
      <li><a href="https://www.peanuts-code.com/en/tags/godotengine/">GodotEngine</a></li>
      <li><a href="https://www.peanuts-code.com/en/tags/godot3/">Godot3</a></li>
      <li><a href="https://www.peanuts-code.com/en/tags/2d/">2D</a></li>
      <li><a href="https://www.peanuts-code.com/en/tags/pathfinding/">PathFinding</a></li>
    </ul>

<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share 2D Path Finding in Godot on twitter"
        href="https://twitter.com/intent/tweet/?text=2D%20Path%20Finding%20in%20Godot&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fen%2ftutorials%2fgd0016_2d_path_finding%2f&amp;hashtags=GameDev%2cGodotEngine%2cGodot3%2c2D%2cPathFinding">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 2D Path Finding in Godot on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fen%2ftutorials%2fgd0016_2d_path_finding%2f&amp;title=2D%20Path%20Finding%20in%20Godot&amp;summary=2D%20Path%20Finding%20in%20Godot&amp;source=https%3a%2f%2fwww.peanuts-code.com%2fen%2ftutorials%2fgd0016_2d_path_finding%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 2D Path Finding in Godot on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fwww.peanuts-code.com%2fen%2ftutorials%2fgd0016_2d_path_finding%2f&title=2D%20Path%20Finding%20in%20Godot">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 2D Path Finding in Godot on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.peanuts-code.com%2fen%2ftutorials%2fgd0016_2d_path_finding%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 2D Path Finding in Godot on whatsapp"
        href="https://api.whatsapp.com/send?text=2D%20Path%20Finding%20in%20Godot%20-%20https%3a%2f%2fwww.peanuts-code.com%2fen%2ftutorials%2fgd0016_2d_path_finding%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 2D Path Finding in Godot on telegram"
        href="https://telegram.me/share/url?text=2D%20Path%20Finding%20in%20Godot&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fen%2ftutorials%2fgd0016_2d_path_finding%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

    
    
    
  </header> 
<figure class="entry-cover"><img loading="lazy" src="https://www.peanuts-code.com/images/tutorials/gd0016_2d_path_finding/img0.gif" alt="2D Path Finding in Godot">
        
</figure><div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#preparation" aria-label="Preparation">Preparation</a><ul>
                        
                <li>
                    <a href="#creating-a-new-project" aria-label="Creating a new project">Creating a new project</a></li>
                <li>
                    <a href="#updating-project-settings" aria-label="Updating project settings">Updating project settings</a></li>
                <li>
                    <a href="#downloading-and-importing-assets" aria-label="Downloading and importing assets">Downloading and importing assets</a></li></ul>
                </li>
                <li>
                    <a href="#creating-a-world-scene" aria-label="Creating a World scene">Creating a World scene</a><ul>
                        
                <li>
                    <a href="#creating-a-new-world-scene" aria-label="Creating a new World scene">Creating a new World scene</a></li>
                <li>
                    <a href="#adding-and-editing-a-tilemap-node" aria-label="Adding and editing a TileMap node">Adding and editing a TileMap node</a></li>
                <li>
                    <a href="#adding-and-editing-the-line2d-node" aria-label="Adding and editing the Line2D node">Adding and editing the Line2D node</a></li></ul>
                </li>
                <li>
                    <a href="#creating-a-player-scene" aria-label="Creating a Player scene">Creating a Player scene</a><ul>
                        
                <li>
                    <a href="#creating-a-new-player-scene" aria-label="Creating a new Player scene">Creating a new Player scene</a></li>
                <li>
                    <a href="#adding-and-editing-nodes-to-the-player-scene" aria-label="Adding and editing nodes to the Player scene">Adding and editing nodes to the Player scene</a><ul>
                        
                <li>
                    <a href="#sprite-node" aria-label="Sprite node">Sprite node</a></li>
                <li>
                    <a href="#collisionshape2d-node" aria-label="CollisionShape2D node">CollisionShape2D node</a></li>
                <li>
                    <a href="#navigationagent2d-node" aria-label="NavigationAgent2D node">NavigationAgent2D node</a></li></ul>
                </li>
                <li>
                    <a href="#adding-an-instance-of-the-player-scene-to-the-world-scene" aria-label="Adding an instance of the Player scene to the World scene">Adding an instance of the Player scene to the World scene</a></li>
                <li>
                    <a href="#attaching-and-editing-scripts-to-the-player-node" aria-label="Attaching and editing scripts to the Player node">Attaching and editing scripts to the Player node</a></li></ul>
                </li>
                <li>
                    <a href="#creating-an-animal-scene" aria-label="Creating an Animal scene">Creating an Animal scene</a><ul>
                        
                <li>
                    <a href="#creating-a-new-animal-scene" aria-label="Creating a new Animal scene">Creating a new Animal scene</a></li>
                <li>
                    <a href="#adding-and-editing-nodes-in-the-animal-scene" aria-label="Adding and editing nodes in the Animal scene">Adding and editing nodes in the Animal scene</a><ul>
                        
                <li>
                    <a href="#sprite-node-1" aria-label="Sprite node">Sprite node</a></li>
                <li>
                    <a href="#collisionshape2d-node-1" aria-label="CollisionShape2D node">CollisionShape2D node</a></li>
                <li>
                    <a href="#navigationagent2d-node-1" aria-label="NavigationAgent2D node">NavigationAgent2D node</a></li>
                <li>
                    <a href="#pathtimertimer-node" aria-label="PathTimer(Timer) Node">PathTimer(Timer) Node</a></li></ul>
                </li>
                <li>
                    <a href="#attaching-and-editing-scripts-to-the-animal-node" aria-label="Attaching and editing scripts to the &amp;ldquo;Animal&amp;rdquo; node">Attaching and editing scripts to the &ldquo;Animal&rdquo; node</a></li>
                <li>
                    <a href="#adding-an-animals-node-to-the-world-scene" aria-label="Adding an Animals node to the &amp;ldquo;World&amp;rdquo; scene">Adding an Animals node to the &ldquo;World&rdquo; scene</a></li>
                <li>
                    <a href="#attach-a-script-to-the-world-node-and-edit-it" aria-label="Attach a script to the &amp;ldquo;World&amp;rdquo; node and edit it">Attach a script to the &ldquo;World&rdquo; node and edit it</a></li></ul>
                </li>
                <li>
                    <a href="#sample-game" aria-label="Sample game">Sample game</a><ul>
                        <ul>
                        
                <li>
                    <a href="#game-rules" aria-label="Game Rules:">Game Rules:</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#conclusion" aria-label="Conclusion">Conclusion</a></li>
                <li>
                    <a href="#references" aria-label="References">References</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>This tutorial introduces Path Finding in 2D games. Path finding is a function that determines the shortest possible path from an object to its destination, for example, when moving an object to a certain destination.</p>
<p>Up to Godot 3.4, the <strong>Navigation</strong> node was used to implement path finding. This was not particularly inconvenient, but the methodology for game development using it was limited and inapplicable in some areas. This time, I would like to introduce an implementation method using <strong>Navigation Server</strong>, which was added to Godot 3.5. This is a backport from Godot 4, which is currently under active development. This article is intended for users of Godot 3.5 or later. Users of Godot version 3.4 or earlier should take note.</p>
<p>The final project file for this tutorial is available at <a href="https://github.com/msnsk/2DPathFinding.git" target="_blank">GitHub repository</a>
. You can also check the project directly by downloading the .zip file and importing the &ldquo;project.godot&rdquo; file in the &ldquo;End&rdquo; folder with the Godot Engine.</p>
<blockquote>
<p><strong><span style="color:salmon">Environment</span>
</strong><br>
<em>Godot version: <strong>3.5</strong></em><br>
<em>Computer OS: <strong>macOS 11.6.5</strong></em></p>
</blockquote>
<blockquote>
<p><strong><span style="color:salmon">Basic Articles</span>
</strong><br>
<em>You may also find the following articles useful.<br>
<a href="https://www.peanuts-code.com/en/tutorials/gd0001_download/">Downloading Godot</a>
<br>
<a href="https://www.peanuts-code.com/en/tutorials/gd0002_project_manager/">Project Manager of Godot</a>
</em></p>
</blockquote>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h2 id="preparation">Preparation<a hidden class="anchor" aria-hidden="true" href="#preparation">#</a></h2>
<h3 id="creating-a-new-project">Creating a new project<a hidden class="anchor" aria-hidden="true" href="#creating-a-new-project">#</a></h3>
<p>Start Godot Engine and create a new project. You can name your project as you like. If you can&rsquo;t think of one, let&rsquo;s call it &ldquo;2D Path Finding Start&rdquo;.</p>
<br>
<h3 id="updating-project-settings">Updating project settings<a hidden class="anchor" aria-hidden="true" href="#updating-project-settings">#</a></h3>
<p>Once the editor appears, we should update project settings for the entire project.</p>
<p>First, set the display size for the game.</p>
<ol>
<li>Open the &ldquo;Project&rdquo; menu &gt; &ldquo;Project Settings<br>
Select &ldquo;Display&rdquo; &gt; &ldquo;Window&rdquo; from the sidebar of the &ldquo;General&rdquo; tab.</li>
<li>In the &ldquo;Size&rdquo; section, change the values of the following items.
<ul>
<li>Width: 512</li>
<li>Height: 320</li>
<li>Test Width: 768</li>
<li>Test Height: 480</li>
</ul>
</li>
<li>In the &ldquo;Stretch&rdquo; section, change the values of the following items
<ul>
<li>Mode: 2d</li>
<li>Aspect: keep</li>
</ul>
</li>
<li>Switch to the &ldquo;Input Map&rdquo; tab and add &ldquo;move_to&rdquo; to the action.</li>
<li>Assign the &ldquo;left mouse button&rdquo; to the &ldquo;move_to&rdquo; action.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img1.png" alt="Inputmap - action - shake"  />
</li>
</ol>
<br>
<h3 id="downloading-and-importing-assets">Downloading and importing assets<a hidden class="anchor" aria-hidden="true" href="#downloading-and-importing-assets">#</a></h3>
<p>Next, let&rsquo;s download assets from KENNEY&rsquo;s site and use them. The asset pack we will use is called <strong><a href="https://www.kenney.nl/assets/bit-pack" target="_blank">1-Bit Pack</a>
</strong>. I can&rsquo;t help but be thankful for this wonderful free material.</p>
<p>Once downloaded, drag and drop the &ldquo;colored-transparent_packed.png&rdquo; file from the &ldquo;Tilesheet&rdquo; folder into the editor&rsquo;s file system dock to import it into your project.</p>
<p>Immediately after importing the file, the image will look blurry, so correct this by following the steps below.</p>
<ol>
<li>Make the imported asset file selected in the file system dock.</li>
<li>Select &ldquo;Preset&rdquo; &gt; &ldquo;2D Pixel&rdquo; in the import dock.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img2.png" alt="select 2D Pixel"  />
</li>
<li>Click the &ldquo;Re-import&rdquo; button at the bottom.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img3.png" alt="click reinport"  />
</li>
</ol>
<p>The image should now have the edges characteristic of pixel art. The imported tileset will be used later for tile maps and player character textures.</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h2 id="creating-a-world-scene">Creating a World scene<a hidden class="anchor" aria-hidden="true" href="#creating-a-world-scene">#</a></h2>
<h3 id="creating-a-new-world-scene">Creating a new World scene<a hidden class="anchor" aria-hidden="true" href="#creating-a-new-world-scene">#</a></h3>
<p>The first step is to create a &ldquo;World&rdquo; scene to prepare the game world. 1. Select &ldquo;Scene&rdquo; menu &gt; &ldquo;New Scene&rdquo;.</p>
<ol>
<li>Select &ldquo;Other Node&rdquo; in &ldquo;Generate Root Node&rdquo;.</li>
<li>When the root node of the &ldquo;Node2D&rdquo; class is generated, rename it to &ldquo;World&rdquo;.</li>
<li>Save the scene. Create a folder and save the scene with the file path &ldquo;res://Scene/World.tscn&rdquo;.</li>
</ol>
<br>
<h3 id="adding-and-editing-a-tilemap-node">Adding and editing a TileMap node<a hidden class="anchor" aria-hidden="true" href="#adding-and-editing-a-tilemap-node">#</a></h3>
<ol>
<li>
<p>Adding a &ldquo;TileMap&rdquo; node to the &ldquo;World&rdquo; root node.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img3.1.png" alt="Scene Dock - Added TileMap"  />
</p>
</li>
<li>
<p>In the inspector, apply the &ldquo;New TileSet&rdquo; resource to the &ldquo;TileSet&rdquo; property of the &ldquo;TileMap&rdquo; node.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img4.png" alt="TileMap - TileSet"  />
</p>
</li>
<li>
<p>Click on the applied &ldquo;TileSet&rdquo; resource to open the TileSet panel at the bottom of the editor.</p>
</li>
<li>
<p>Add imported KENNEY &ldquo;res://colored-transparent_packed.png&rdquo; resource file by dragging it to the left sidebar of the TileSet panel.</p>
</li>
<li>
<p>Select the added texture sheet and prepare the following three single tiles.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img5.png" alt="TileSet Pannel"  />
</p>
<ul>
<li>Tile for the character&rsquo;s pathway.<br>
*Tiles with this navigation area set are the target of the pathfinding.
<ul>
<li>Use gravel tiles</li>
<li>Collision polygon: not required</li>
<li>Navigation polygon: <strong>Needed</strong></li>
</ul>
</li>
<li>Tiles that characters do not pass through but do not collide with each other.<br>
*Use as a margin so that the character does not get caught by tree tiles with collision geometry when moving along the path.
<ul>
<li>Use grass texture</li>
<li>Collision polygons: not needed</li>
<li>Navigation polygons: not needed</li>
</ul>
</li>
<li>Tiles that characters cannot pass through and have collision detection.<br>
*Use as impassable obstacles during path finding.
<ul>
<li>Use tree texture</li>
<li>Collision polygon: <strong>Needed</strong></li>
<li>Navigation polygons: not required</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Select &ldquo;TileMap&rdquo; in the scene dock and create a tile map on the 2D workspace. Below is a sample. It is OK if the gravel tiles provide some pathways (navigation areas).<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img6.png" alt="TileMap - 2D workspace"  />
<br>
It is important to note, however, that once you place the tree tiles for obstacles, be sure to place the grass tiles for margins around them. Otherwise, the character will try to pass right through the wooden tiles when moving along the path, and will get stuck and not be able to move. This is something I would like to see improved in future Godot updates. I haven&rsquo;t implemented the character yet, but I&rsquo;ll show you how it behaves first.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img7.gif" alt="TileMap - Stuck with collision shape"  />
</p>
</li>
</ol>
<br>
<h3 id="adding-and-editing-the-line2d-node">Adding and editing the Line2D node<a hidden class="anchor" aria-hidden="true" href="#adding-and-editing-the-line2d-node">#</a></h3>
<p>The &ldquo;Line2D&rdquo; node is used to make the explored and determined path visually clear.</p>
<ol>
<li>Add a &ldquo;Line2D&rdquo; node to the &ldquo;World&rdquo; root node.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img8.png" alt="Scene Dock - Added Line2D"  />
</li>
<li>In the inspector, set the &ldquo;Width&rdquo; property of the &ldquo;Line2D&rdquo; node to.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img9.png" alt="Line2D - Width"  />
</li>
</ol>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h2 id="creating-a-player-scene">Creating a Player scene<a hidden class="anchor" aria-hidden="true" href="#creating-a-player-scene">#</a></h2>
<p>From here, we will create a scene for the player character to move along the found path.</p>
<h3 id="creating-a-new-player-scene">Creating a new Player scene<a hidden class="anchor" aria-hidden="true" href="#creating-a-new-player-scene">#</a></h3>
<ol>
<li>Select &ldquo;Scene&rdquo; menu &gt; &ldquo;New Scene&rdquo;.</li>
<li>Select &ldquo;Other Node&rdquo; in &ldquo;Generate Root Node&rdquo;.</li>
<li>When the root node of the &ldquo;KinematicBody2D&rdquo; class is created, rename it to &ldquo;Player&rdquo;.</li>
<li>Save the scene. Create a folder and save the scene with the file path &ldquo;res://Scenes/Player.tscn&rdquo;.</li>
</ol>
<h3 id="adding-and-editing-nodes-to-the-player-scene">Adding and editing nodes to the Player scene<a hidden class="anchor" aria-hidden="true" href="#adding-and-editing-nodes-to-the-player-scene">#</a></h3>
<p>Add nodes to the &ldquo;Player&rdquo; root node to make the scene tree look like this.</p>
<ul>
<li>Player(KinematicBody2D)
<ul>
<li>Sprite</li>
<li>CollisionShape2D</li>
<li>NavigationAgent2D</li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img10.png" alt="Player scene - Scene Dock"  />
</p>
<p>Each node is then edited.<br>
<br></p>
<h4 id="sprite-node">Sprite node<a hidden class="anchor" aria-hidden="true" href="#sprite-node">#</a></h4>
<p>This node is used to apply texture (appearance) to the &ldquo;Player&rdquo; scene.</p>
<ol>
<li>In the inspector, apply the &ldquo;res://colored-transparent_packed.png&rdquo; resource downloaded from KENNEY&rsquo;s site to the &ldquo;Texture&rdquo; property.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img11.png" alt="Sprite node - texture"  />
</li>
<li>Enable the &ldquo;Region&rdquo; &gt; &ldquo;Enabled&rdquo; property.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img12.png" alt="Sprite node - Region - enabled"  />
</li>
<li>Open the Texture Region panel at the bottom of the editor and select the region of the player character texture of your choice. For this tutorial, we used a sheriff-like texture.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img13.png" alt="Sprite node - texture region pannel"  />
</li>
</ol>
<br>
<h4 id="collisionshape2d-node">CollisionShape2D node<a hidden class="anchor" aria-hidden="true" href="#collisionshape2d-node">#</a></h4>
<p>This node sets the collision shape for the &ldquo;Player&rdquo; root node of the KinematicBody2D class.</p>
<ol>
<li>Apply a new &ldquo;RectangleShape2D&rdquo; resource to the &ldquo;Shape&rdquo; property in the inspector.</li>
<li>Set the value of the &ldquo;Extents&rdquo; property of the applied &ldquo;RectangleShape2D&rdquo; resource to (x: 6, y: 6).<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img14.png" alt="CollisionShape2D node - Shape - Extents"  />
</li>
<li>On the 2D workspace it will look like this.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img15.png" alt="CollisionShape2D node - 2D Workspace"  />
</li>
</ol>
<br>
<h4 id="navigationagent2d-node">NavigationAgent2D node<a hidden class="anchor" aria-hidden="true" href="#navigationagent2d-node">#</a></h4>
<p>This node was introduced in Godot 3.5 as a backported node from Godot 4. A parent node (in this case, the &ldquo;Player&rdquo; node) adding this node to its children will automatically avoid collisions with obstacles and will be able to move by path finding. It seems to be controlled by being registered in the <strong>navigation map</strong> of the default <strong>World2D</strong>. For more details, please refer to Godot&rsquo;s official online documentation.</p>
<blockquote>
<p><em><strong><span style="color:salmon">Godot Docs:</span>
</strong></em><br>
<em><a href="https://docs.godotengine.org/en/stable/classes/class_navigationagent2d.html" target="_blank">NavigationAgent2D</a>
</em></p>
</blockquote>
<ol>
<li>Check the &ldquo;Avoidance&rdquo; &gt; &ldquo;Avoidance Enabled&rdquo; property to enable it. This controls collision avoidance with obstacles and enables path finding.</li>
<li>Set the &ldquo;Avoidance&rdquo; &gt; &ldquo;Radius&rdquo; property to 8. This property is the size of this agent. We set the radius to 8 px to match the size of the texture on the &ldquo;Sprite&rdquo; node.</li>
<li>Set the &ldquo;Avoidance&rdquo; &gt; &ldquo;Neighbor Dist&rdquo; property to 8. This property sets the distance at which other agents will be detected. Later we will create other object scenes that will automatically track the Player and add <strong>NavigationAgent2D</strong> nodes to them as well, but they will not need to be detected until they are right next to the Player, so we set this property to 8 as well as the agent&rsquo;s.</li>
<li>Set the &ldquo;Avoidance&rdquo; &gt; &ldquo;Max Speed&rdquo; property to 40. This is the maximum movement speed of the agents.</li>
</ol>
<p><img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img15.1.png" alt="NavigationAgent2D node - properties"  />
</p>
<br>
<h3 id="adding-an-instance-of-the-player-scene-to-the-world-scene">Adding an instance of the Player scene to the World scene<a hidden class="anchor" aria-hidden="true" href="#adding-an-instance-of-the-player-scene-to-the-world-scene">#</a></h3>
<p>Add an instance node of the &ldquo;Player.tscn&rdquo; scene created here to the &ldquo;World&rdquo; scene. It is OK if the scene dock of the &ldquo;World&rdquo; scene looks like the following.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img16.png" alt="World scene - added Player node"  />
</p>
<br>
<h3 id="attaching-and-editing-scripts-to-the-player-node">Attaching and editing scripts to the Player node<a hidden class="anchor" aria-hidden="true" href="#attaching-and-editing-scripts-to-the-player-node">#</a></h3>
<p>After returning to the &ldquo;Player&rdquo; scene, attach a script to the &ldquo;Player&rdquo; root node and write the code. Create a script with the file path &ldquo;res://Scripts/Player.gd&rdquo;. When the script editor opens, write the following code.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">###Player.gd###</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">KinematicBody2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Player speed</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> (<span style="color:#a6e22e">float</span>) <span style="color:#66d9ef">var</span> speed <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Refer to the Line2D node in the World scene</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> line: Line2D <span style="color:#f92672">=</span> get_node(<span style="color:#e6db74">&#34;... /Line2D&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Refer to the NavigationAgent2D node</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> nav_agent <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>NavigationAgent2D
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Built-in function called when a node is loaded into the scene tree</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Set the current location as a temporary destination by NavigationAgent2D</span>
</span></span><span style="display:flex;"><span>	nav_agent<span style="color:#f92672">.</span>set_target_location(global_position)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Built-in physics process function called every frame</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _physics_process(delta):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># If the last position of the found path has not been reached</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> nav_agent<span style="color:#f92672">.</span>is_navigation_finished():
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Get the next navigable position without obstacles</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> next_loc <span style="color:#f92672">=</span> nav_agent<span style="color:#f92672">.</span>get_next_location()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Get the current Player location</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> current_pos <span style="color:#f92672">=</span> global_position
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Calculate velocity from direction and speed for next possible location</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> velocity <span style="color:#f92672">=</span> current_pos<span style="color:#f92672">.</span>direction_to(next_loc) <span style="color:#f92672">*</span> speed
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Pass velocity to NavigationAgent2D&#39;s collision avoidance algorithm</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># send velocity_computed signal as soon as velocity adjustment is complete</span>
</span></span><span style="display:flex;"><span>		nav_agent<span style="color:#f92672">.</span>set_velocity(velocity)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># When the input map action move_to (left mouse button) is pressed</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">Input</span><span style="color:#f92672">.</span>is_action_pressed(<span style="color:#e6db74">&#34;move_to&#34;</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># call a method to start path finding</span>
</span></span><span style="display:flex;"><span>		find_path() <span style="color:#75715e"># Define after this</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Method to start path finding</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> find_path():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Set the current mouse position as the next destination by NavigationAgent2D</span>
</span></span><span style="display:flex;"><span>	nav_agent<span style="color:#f92672">.</span>set_target_location(get_global_mouse_position())
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Get the next possible location to move to without obstacles</span>
</span></span><span style="display:flex;"><span>	nav_agent<span style="color:#f92672">.</span>get_next_location()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Pass the information of the path generated by NavigationAgent2D to the path of Line2D in the World scene</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Both data types are PoolVector2Array, so they can be passed as is</span>
</span></span><span style="display:flex;"><span>	line<span style="color:#f92672">.</span>points <span style="color:#f92672">=</span> nav_agent<span style="color:#f92672">.</span>get_nav_path()
</span></span></code></pre></div><p>Now connect three different signals of the &ldquo;NavigationAgent2D&rdquo; node to this script.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img16.1.png" alt="NavigationAgent2D - Signals"  />
</p>
<p>The first one is the &ldquo;velocity_computed&rdquo; signal. This signal is sent when NavigationAgent2D has completed adjusting its velocity to avoid collisions with surrounding objects.</p>
<p>The second is the &ldquo;target_reached&rdquo; signal. This signal is sent out when the next moveable position on the path to the final destination is reached.</p>
<p>The third signal is &ldquo;navigation_finished. This signal is sent out when the final destination on the route is reached.</p>
<p>After connecting each signal to the script, write the necessary code in the generated method. The code is as follows.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">###Player.gd###</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Called with a signal that is sent out when NavigationAgent2D has finished adjusting its velocity</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_NavigationAgent2D_velocity_computed(safe_velocity):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Apply the adjusted velocity to the Player&#39;s movement</span>
</span></span><span style="display:flex;"><span>	move_and_slide(safe_velocity)<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Called with a signal that is sent when the NavigationAgent2D reaches its next moveable position.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_NavigationAgent2D_target_reached():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># On the path of a Line2D node in the World scene...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># reflect the updated path of the NavigationAgent2D</span>
</span></span><span style="display:flex;"><span>	line<span style="color:#f92672">.</span>points <span style="color:#f92672">=</span> nav_agent<span style="color:#f92672">.</span>get_nav_path()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Called with a signal that is sent out when NavigationAgent2D reaches the last destination in its path</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_NavigationAgent2D_navigation_finished():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Reset the points of the path of the Line2D node in the World scene to 0</span>
</span></span><span style="display:flex;"><span>	line<span style="color:#f92672">.</span>points<span style="color:#f92672">.</span>resize(<span style="color:#ae81ff">0</span>)
</span></span></code></pre></div><br>
<p>This completes the editing of the &ldquo;Player.gd&rdquo; script. At this point, try running the project once. If you are running the project for the first time, select &ldquo;res://Scenes/World.tscn&rdquo; as the main scene.</p>
<p>Let&rsquo;s click on the tile map appropriately and check if &ldquo;Player&rdquo; moves along the path search without any problem.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img17.gif" alt="World scene - added Player node"  />
</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h2 id="creating-an-animal-scene">Creating an Animal scene<a hidden class="anchor" aria-hidden="true" href="#creating-an-animal-scene">#</a></h2>
<p>In the &ldquo;Player&rdquo; scene, we implemented path finding using the mouse position as the destination. From now on, we will implement path finding for another object that moves with the moving &ldquo;Player&rdquo; as its destination. However, there is no need to worry, since most of the work is the same.</p>
<p>Let&rsquo;s make multiple animal objects gather around the &ldquo;Player&rdquo; instance object we just created. We will now create an &ldquo;Animal&rdquo; scene for the animal objects.</p>
<h3 id="creating-a-new-animal-scene">Creating a new Animal scene<a hidden class="anchor" aria-hidden="true" href="#creating-a-new-animal-scene">#</a></h3>
<ol>
<li>Select &ldquo;Scene&rdquo; menu &gt; &ldquo;New Scene&rdquo;.</li>
<li>Select &ldquo;Other Node&rdquo; in &ldquo;Create Root Node&rdquo;.</li>
<li>When the root node of the &ldquo;KinematicBody2D&rdquo; class is created, rename it to &ldquo;Animal&rdquo;.</li>
<li>Save the scene. Create a folder and save the scene with the file path &ldquo;res://Scenes/Animal.tscn&rdquo;.</li>
</ol>
<h3 id="adding-and-editing-nodes-in-the-animal-scene">Adding and editing nodes in the Animal scene<a hidden class="anchor" aria-hidden="true" href="#adding-and-editing-nodes-in-the-animal-scene">#</a></h3>
<p>Add some nodes to the &ldquo;Animal&rdquo; root node and make the scene tree as follows.</p>
<ul>
<li>Animal(KinematicBody2D)
<ul>
<li>Sprite</li>
<li>CollisionShape2D</li>
<li>NavigationAgent2D</li>
<li>PathTimer(Timer)<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img18.png" alt="Animal scene - Scene Dock"  />
</li>
</ul>
</li>
</ul>
<p>Then edit each node.<br>
<br></p>
<h4 id="sprite-node-1">Sprite node<a hidden class="anchor" aria-hidden="true" href="#sprite-node-1">#</a></h4>
<p>This node is used to give texture (appearance) to the &ldquo;Animal&rdquo; scene.</p>
<ol>
<li>In the inspector, apply the &ldquo;res://colored-transparent_packed.png&rdquo; resource downloaded from the KENNEY website to the &ldquo;Texture&rdquo; property.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img19.png" alt="Sprite node - texture"  />
</li>
<li>Enable the &ldquo;Region&rdquo; &gt; &ldquo;Enabled&rdquo; property.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img20.png" alt="Sprite node - Region - enabled"  />
</li>
<li>Open the texture region panel at the bottom of the editor and select a region for the six animal textures.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img21.png" alt="Sprite node - texture region pannel"  />
</li>
<li>Set the value of the &ldquo;Animation&rdquo; &gt; &ldquo;Hframes&rdquo; property to 6. Since the texture area selected earlier contains 6 types of animals, the value is set to be 1 frame for each type of animal. The default frame is set to 0 (first frame) in the &ldquo;Frame&rdquo; property.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img22.png" alt="Sprite node - Animation - Hframes"  />
</li>
</ol>
<br>
<h4 id="collisionshape2d-node-1">CollisionShape2D node<a hidden class="anchor" aria-hidden="true" href="#collisionshape2d-node-1">#</a></h4>
<p>This node sets the collision shape for the &ldquo;Animal&rdquo; root node of the KinematicBody2D class.</p>
<ol>
<li>Apply the &ldquo;New RectangleShape2D&rdquo; resource to the &ldquo;Shape&rdquo; property in the inspector.</li>
<li>Set the value of the &ldquo;Extents&rdquo; property of the applied &ldquo;RectangleShape2D&rdquo; resource to (x: 8, y: 8).<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img23.png" alt="CollisionShape2D node - Shape - Extents"  />
</li>
<li>On the 2D workspace it will look like this.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img24.png" alt="CollisionShape2D node - 2D Workspace"  />
</li>
</ol>
<br>
<h4 id="navigationagent2d-node-1">NavigationAgent2D node<a hidden class="anchor" aria-hidden="true" href="#navigationagent2d-node-1">#</a></h4>
<p>In the &ldquo;Animal&rdquo; scene, as in the &ldquo;Player&rdquo; scene, this node is used to avoid collisions with obstacles and to enable movement by path finding.</p>
<ol>
<li>Enable the &ldquo;Avoidance&rdquo; &gt; &ldquo;Avoidance Enabled&rdquo; property.</li>
<li>Leave the &ldquo;Avoidance&rdquo; &gt; &ldquo;Radius&rdquo; property at the default value of 10. The size of the texture is slightly larger than the size of the Sprite node&rsquo;s texture, so that the animals are slightly spaced apart.</li>
<li>The &ldquo;Avoidance&rdquo; &gt; &ldquo;Neighbor Dist&rdquo; property was also left at the default value of 500. Since the width of the display size is set to 512 px, setting it to 500 will allow other agents to be detected from one end of the display to the other and avoid collisions. The goal is to reduce the number of instances of the &ldquo;Animal&rdquo; scene that will crowd around the &ldquo;Player&rdquo; instance and thus reduce the possibility of being stuck in the scene.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img25.png" alt="NavigationAgent2D node - "  />
</li>
</ol>
<br>
<h4 id="pathtimertimer-node">PathTimer(Timer) Node<a hidden class="anchor" aria-hidden="true" href="#pathtimertimer-node">#</a></h4>
<p>This node is used to periodically update the position of the moving destination (instance node of &ldquo;Player&rdquo;).</p>
<ol>
<li>The &ldquo;Wait Time&rdquo; property is left at the default value of 1.</li>
<li>The &ldquo;One Shot&rdquo; property should also be left at the default value of 1 and disabled. This will time out repeatedly every second.</li>
<li>Enable the &ldquo;Autostart&rdquo; property. The timer will now start automatically when this node is loaded into the scene tree.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img26.png" alt="PathTimer node - Autostart"  />
</li>
</ol>
<br>
<h3 id="attaching-and-editing-scripts-to-the-animal-node">Attaching and editing scripts to the &ldquo;Animal&rdquo; node<a hidden class="anchor" aria-hidden="true" href="#attaching-and-editing-scripts-to-the-animal-node">#</a></h3>
<p>From here, we will attach a script to the &ldquo;Animal&rdquo; root node and write code to control the &ldquo;Animal&rdquo; scene. Create a script with the file path &ldquo;res://Scripts/Animal.gd&rdquo;. When the script editor opens, code as follows.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">###Animal.gd###</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">KinematicBody2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Speed of Animal</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> speed <span style="color:#f92672">=</span> <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Variable to assign the object that will be the destination of the route</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> target
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Reference to the Sprite node</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> sprite <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Sprite</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Reference to NavigationAgent2D</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> nav_agent <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>NavigationAgent2D
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Same as Player.gd below</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>	nav_agent<span style="color:#f92672">.</span>set_target_location(global_position)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _physics_process(_delta):
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> nav_agent<span style="color:#f92672">.</span>is_navigation_finished():
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> current_pos <span style="color:#f92672">=</span> global_position
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> next_loc <span style="color:#f92672">=</span> nav_agent<span style="color:#f92672">.</span>get_next_location()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> velocity <span style="color:#f92672">=</span> current_pos<span style="color:#f92672">.</span>direction_to(next_loc) <span style="color:#f92672">*</span> speed
</span></span><span style="display:flex;"><span>		nav_agent<span style="color:#f92672">.</span>set_velocity(velocity)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># If the x-coordinate of the destination object is smaller than the x-coordinate of the animal node</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># flip the Texture image of the Sprite node</span>
</span></span><span style="display:flex;"><span>		sprite<span style="color:#f92672">.</span>flip_h <span style="color:#f92672">=</span> target<span style="color:#f92672">.</span>global_position<span style="color:#f92672">.</span>x <span style="color:#f92672">&lt;</span> global_position<span style="color:#f92672">.</span>x
</span></span></code></pre></div><br>
Two signals must then be connected to the script.
<p>The first one is to connect the &ldquo;velocity_computed&rdquo; signal of the &ldquo;NavigationAgent2D&rdquo; node as in the &ldquo;Player&rdquo; scene.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img27.png" alt="NavigationAgent2D - velocity_computed signal"  />
</p>
<p>Once connected, write a <code>move_and_slide</code> method in the generated <code>_on_NavigationAgent2D_velocity_computed</code> method to control the movement of the &ldquo;Animal&rdquo; node.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">###Animal.gd###</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Called with a signal that is sent out when NavigationAgent2D has finished adjusting its velocity</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_NavigationAgent2D_velocity_computed(safe_velocity):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Apply the adjusted velocity to the Player&#39;s movement</span>
</span></span><span style="display:flex;"><span>	move_and_slide(safe_velocity)
</span></span></code></pre></div><br>
<p>The next step is to connect the &ldquo;timeout&rdquo; signal of the &ldquo;PathTimer&rdquo; node to the script.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img28.png" alt="PathTimer - timeout signal"  />
</p>
<p>Once connected, within the generated method <code>_on_PathTimer_timeout</code>, describe the <code>set_target_location</code> method of the &ldquo;NavigationAgent2D&rdquo; node to set the location of the destination object (in this case &ldquo;Player&rdquo;) as the destination during path finding. Now, at the time of timeout every second, the position of the latest &ldquo;Player&rdquo; instance node is acquired and the path finding is performed with that as the destination.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">###Animal.gd###</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _on_PathTimer_timeout():
</span></span><span style="display:flex;"><span>	nav_agent<span style="color:#f92672">.</span>set_target_location(target<span style="color:#f92672">.</span>global_position)
</span></span></code></pre></div><br>
<p>The &ldquo;Animal.gd&rdquo; script is now complete.</p>
<br>
<h3 id="adding-an-animals-node-to-the-world-scene">Adding an Animals node to the &ldquo;World&rdquo; scene<a hidden class="anchor" aria-hidden="true" href="#adding-an-animals-node-to-the-world-scene">#</a></h3>
<ol>
<li>Add a node of class <strong>Node2D</strong> to the &ldquo;World&rdquo; scene as a container for multiple instances of the &ldquo;Animals&rdquo; scene and rename it to &ldquo;Animals&rdquo;. Adding instances of &ldquo;Animal&rdquo; will be done by script after this.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img29.png" alt="World scene - Animals node"  />
</li>
</ol>
<br>
<h3 id="attach-a-script-to-the-world-node-and-edit-it">Attach a script to the &ldquo;World&rdquo; node and edit it<a hidden class="anchor" aria-hidden="true" href="#attach-a-script-to-the-world-node-and-edit-it">#</a></h3>
<p>Attach a script to the &ldquo;World&rdquo; root node and edit it, adding multiple instances of &ldquo;Animal&rdquo;. Save the script with the file path as &ldquo;res://Scripts/World.gd&rdquo; and when the script editor opens, write the code as follows.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-GDScript" data-lang="GDScript"><span style="display:flex;"><span><span style="color:#75715e">###World.gd###</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Node2D</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Reference to preloaded Animal scene file</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> animal_scn <span style="color:#f92672">=</span> preload(<span style="color:#e6db74">&#34;res://Scenes/Animal.tscn&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Number of Animal instances</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> (<span style="color:#a6e22e">int</span>) <span style="color:#66d9ef">var</span> head_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Reference to TileMap node</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> tile_map <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">TileMap</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Reference to the Player node</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> player <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>Player
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Reference the Animals(Node2D) node</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> animals <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>Animals
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> _ready():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Randomize seed for random number generation function</span>
</span></span><span style="display:flex;"><span>	randomize()<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Get an array of ID 9 tiles on the TileMap</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># IDs can be found by clicking the (i) icon in the tileset panel edit screen</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> cells <span style="color:#f92672">=</span> tile_map<span style="color:#f92672">.</span>get_used_cells_by_id(<span style="color:#ae81ff">9</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Loop for the number of Animal instances</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> head_count :
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Get random index within the number of tiles with ID 9</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> random_index <span style="color:#f92672">=</span> randi() <span style="color:#f92672">%</span> cells<span style="color:#f92672">.</span>size()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Get a tile from the ID 9 tiles that fits the random value</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">var</span> spawn_tile <span style="color:#f92672">=</span> cells<span style="color:#f92672">.</span>pop_at(random_index)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># loop if the tile has already been spawned from the array and the array is not yet empty</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">while</span> spawn_tile <span style="color:#f92672">==</span> null <span style="color:#f92672">and</span> <span style="color:#f92672">not</span> cells<span style="color:#f92672">.</span>empty():
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Generate a random value within the range of the number of ID9 liles again</span>
</span></span><span style="display:flex;"><span>			random_index <span style="color:#f92672">=</span> randi() <span style="color:#f92672">%</span> cells<span style="color:#f92672">.</span>size()
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Spawn a tile from the ID9 tiles again that fits the random value</span>
</span></span><span style="display:flex;"><span>			spawn_tile <span style="color:#f92672">=</span> cells<span style="color:#f92672">.</span>pop_at(random_index)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Place an Animal instance on the acquired tile...</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># by calling a method to create an Animal instance</span>
</span></span><span style="display:flex;"><span>		spawn_animal(spawn_tile)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># method to spawn Animal instance</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> spawn_animal(spawn_tile):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Get the position of the tile passed as argument, shifted by (8, 8) to the x,y coordinates of the tile</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> spawn_pos <span style="color:#f92672">=</span> tile_map<span style="color:#f92672">.</span>map_to_world(spawn_tile, true) <span style="color:#f92672">+</span> <span style="color:#a6e22e">Vector2</span>(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">8</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Create an instance of the Animal scene</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> animal <span style="color:#f92672">=</span> animal_scn<span style="color:#f92672">.</span>instance()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Position the Animal instance on the tile passed as argument</span>
</span></span><span style="display:flex;"><span>	animal<span style="color:#f92672">.</span>position <span style="color:#f92672">=</span> spawn_pos
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Assign and reference the Player node to the destination property of the Animal instance</span>
</span></span><span style="display:flex;"><span>	animal<span style="color:#f92672">.</span>target <span style="color:#f92672">=</span> player<span style="color:#f92672">.</span>global_position
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Randomly determine the texture of the Sprite node of the Animal instance</span>
</span></span><span style="display:flex;"><span>	animal<span style="color:#f92672">.</span>get_node(<span style="color:#e6db74">&#34;Sprite&#34;</span>)<span style="color:#f92672">.</span>frame <span style="color:#f92672">=</span> randi() <span style="color:#f92672">%</span> animal<span style="color:#f92672">.</span>get_node(<span style="color:#e6db74">&#34;Sprite&#34;</span>)<span style="color:#f92672">.</span>hframes
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Make the Animal instance a child of the Animals node</span>
</span></span><span style="display:flex;"><span>	animals<span style="color:#f92672">.</span>add_child(animal)
</span></span></code></pre></div><br>
<p>The &ldquo;World.gd&rdquo; script is now complete. Let&rsquo;s run the project and see how multiple instances of &ldquo;Animal&rdquo; approach &ldquo;Player&rdquo;.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img30.gif" alt="run project"  />
</p>
<p>The number of <code>head_count</code> properties defined in the script can be easily edited in the inspector, since it comes with the <code>export</code> keyword. I increased the number of &ldquo;Animal&rdquo; instances to 100 as a test, but it got stuck at the end. If &ldquo;Animal&rdquo; were a zombie, it would be a hellish scene.<br>
<img loading="lazy" src="/images/tutorials/gd0016_2d_path_finding/img31.gif" alt="run project"  />
</p>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<hr>
<h2 id="sample-game">Sample game<a hidden class="anchor" aria-hidden="true" href="#sample-game">#</a></h2>
<p>I have prepared a sample game that further brushes up the project created in this tutorial.</p>
<p>
<video controls autoplay loop muted playsinline aria-label='Sample game demo' style='ZgotmplZ'>

    <source src="/images/tutorials/gd0016_2d_path_finding/img32.mp4" type="video/mp4">
    
    Your browser does not support the video tag.
</video>
<br>
<br></p>
<p>The project file of the sample game is located in <a href="https://github.com/msnsk/2DPathFinding.git" target="_blank">GitHub repository</a>
, so please download the .zip file from there. You can check it by importing the &ldquo;project.godot&rdquo; file in the &ldquo;Sample&rdquo; folder with the Godot Engine.<br>
<br></p>
<h4 id="game-rules">Game Rules:<a hidden class="anchor" aria-hidden="true" href="#game-rules">#</a></h4>
<ul>
<li>Left mouse click to move to the mouse cursor position</li>
<li>Spacebar to shoot the gun in the direction of the mouse cursor.</li>
<li>When you run out of bullets, reload 12 bullets after reloading animation.</li>
<li>When you hit an enemy, you lose a heart.</li>
<li>When you run out of all 5 hearts, the game is over.</li>
<li>The darker the color of an enemy, the more lives it has and the slower its speed is. The lighter the color, the less lives it has and the faster its speed is.</li>
<li>The player&rsquo;s score is the number of jewels that dropped when an enemy is defeated.</li>
</ul>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>In this tutorial, we implemented the new <strong>Navigation Server</strong> added in Godot 3.5.</p>
<p>For a simple 2D route search like this one, it was relatively easy to implement using <strong>NavigationAgent2D</strong>, although there are still some itchy points, such as the problem of getting caught in a corner when using a TileMap without a margin tile. However, we hope that this will be improved in future updates.</p>
<p>Let me summarize the key points of this project.</p>
<ul>
<li>When using TileMap, be sure to set navigation to movable tiles.</li>
<li>When using TileMap, make a margin with tiles that are set only in the area so that they do not get caught in corners.</li>
<li>You can also define a navigation area using the <strong>NavigationPolygonInstance</strong> node, which we did not use in this case.</li>
<li>Adding a &ldquo;NavigationAgent2D&rdquo; node to the child of the object you want to move.</li>
<li>When controlling path finding in scripts, write the code with the following order in mind: set the final destination, obtain the next possible moving position, adjust the speed to avoid collision, and move at the adjusted speed.</li>
</ul>
<hr>
<h2 id="references">References<a hidden class="anchor" aria-hidden="true" href="#references">#</a></h2>
<ul>
<li><a href="https://godotengine.org/article/navigation-server-godot-4-0" target="_blank">Official Article - Navigation Server for Godot 4.0</a>
</li>
<li><a href="https://godotengine.org/article/godot-3-5-cant-stop-wont-stop" target="_blank">Official Article - Godot 3.5: Can&#39;t stop won&#39;t stop</a>
</li>
<li><a href="https://docs.godotengine.org/en/stable/classes/class_navigationagent2d.html" target="_blank">Godot Doc - NavigationAgent2D</a>
</li>
<li><a href="https://youtu.be/xdih_csmVqk" target="_blank">YouTube - Godot 3.5 | NavigationAgent2D</a>
</li>
<li><a href="https://youtu.be/NjIJm2jax68" target="_blank">YouTube - Godot 3.5 is Out, and it&#39;s SICK! Real-time pathfinding, new tween animations, and more</a>
</li>
<li><a href="https://github.com/godotengine/godot/issues/60546" target="_blank">GitHub - godotengine/godot - issue #60546</a>
</li>
</ul>
<hr>
<!-- **UPDATE** -->
<!-- 2022/05/25 新規作成 -->
<!-- --- -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4952908839423901"
     crossorigin="anonymous"></script>
<p><ins class="adsbygoogle"
style="display:block; text-align:center;"
data-ad-layout="in-article"
data-ad-format="fluid"
data-ad-client="ca-pub-4952908839423901"
data-ad-slot="9419515863"></ins></p>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>


  </div>

  <footer class="post-footer">
    
    <div class="recommendation">
        <span>Please feel free to follow my accounts!</span>
      <div class="social-icons">
    <a href="https://twitter.com/MasanaoSako" target="_blank" rel="noopener noreferrer me" title="Twitter">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z">
    </path>
</svg>
    </a>
    <a href="https://github.com/msnsk/" target="_blank" rel="noopener noreferrer me" title="GitHub">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
    </a>
</div>

    </div>
    <div class="recommendation">
        <span>If you liked this article, please share it!</span>
    </div>
    
    

<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share 2D Path Finding in Godot on twitter"
        href="https://twitter.com/intent/tweet/?text=2D%20Path%20Finding%20in%20Godot&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fen%2ftutorials%2fgd0016_2d_path_finding%2f&amp;hashtags=GameDev%2cGodotEngine%2cGodot3%2c2D%2cPathFinding">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 2D Path Finding in Godot on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fen%2ftutorials%2fgd0016_2d_path_finding%2f&amp;title=2D%20Path%20Finding%20in%20Godot&amp;summary=2D%20Path%20Finding%20in%20Godot&amp;source=https%3a%2f%2fwww.peanuts-code.com%2fen%2ftutorials%2fgd0016_2d_path_finding%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 2D Path Finding in Godot on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fwww.peanuts-code.com%2fen%2ftutorials%2fgd0016_2d_path_finding%2f&title=2D%20Path%20Finding%20in%20Godot">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 2D Path Finding in Godot on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.peanuts-code.com%2fen%2ftutorials%2fgd0016_2d_path_finding%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 2D Path Finding in Godot on whatsapp"
        href="https://api.whatsapp.com/send?text=2D%20Path%20Finding%20in%20Godot%20-%20https%3a%2f%2fwww.peanuts-code.com%2fen%2ftutorials%2fgd0016_2d_path_finding%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 2D Path Finding in Godot on telegram"
        href="https://telegram.me/share/url?text=2D%20Path%20Finding%20in%20Godot&amp;url=https%3a%2f%2fwww.peanuts-code.com%2fen%2ftutorials%2fgd0016_2d_path_finding%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

    <ul class="post-tags">
      <li><a href="https://www.peanuts-code.com/en/tags/gamedev/">GameDev</a></li>
      <li><a href="https://www.peanuts-code.com/en/tags/godotengine/">GodotEngine</a></li>
      <li><a href="https://www.peanuts-code.com/en/tags/godot3/">Godot3</a></li>
      <li><a href="https://www.peanuts-code.com/en/tags/2d/">2D</a></li>
      <li><a href="https://www.peanuts-code.com/en/tags/pathfinding/">PathFinding</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="https://www.peanuts-code.com/en/tutorials/gd0015_circular_progress_bar/">
    <span class="title">Next Page »</span>
    <br>
    <span>Circular Progress Bar in Godot</span>
  </a>
</nav>

    
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://www.peanuts-code.com/en/">Peanuts Code</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
